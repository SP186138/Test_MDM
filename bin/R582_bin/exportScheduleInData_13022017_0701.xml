<?xml version="1.0" encoding="UTF-8"?>
<arrayList domain="1CP">
  <ProcessingTemplate id="[1CP]1CP_I2_MDM_CNTRY_ITERATOR" calculatedExpectedDuration="110719" deadlineDuration="0" description="i2xml Processing: Iterate on each Country Parameter" domain="1CP" durationSum="10000" estimatedDuration="110719" expectedDuration="60000" forEachCollection="${CNTRY_PARAMETER_LIST}" forEachIteratorName="CNTRY_PARAMETER" forEachSeparator="," forceChronology="false" onHold="false" owner="Ss186037" passBy="false" priority="0" processingType="WORKFLOW" sequentialProcessing="false" successResult="0" tags="1CP,I2XML,MDM" taskType="SH" turnOffDurationEstimation="false" workflowType="FOR_EACH" />
  <SubProcessingTemplate id="[1CP]1CP_I2_MDM_CNTRY_ITERATOR|[1CP]1CP_I2_MDM_CNTRY_CALL" failureCase="false" freeFloat="0" name="[1CP]1CP_I2_MDM_CNTRY_CALL" parent="[1CP]1CP_I2_MDM_CNTRY_ITERATOR" processingDateOffset="0" processingTemplate="[1CP]1CP_I2_MDM_CNTRY_CALL" processingType="TASK" sortOrder="0" taskType="SH" workflowType="STANDARD" />
  <SubProcessingTemplate id="[1CP]1CP_I2_MDM_CNTRY_ITERATOR|[1CP]1CP_I2_MDM_CNTRY_CALL_NONDTC" failureCase="false" freeFloat="0" name="[1CP]1CP_I2_MDM_CNTRY_CALL_NONDTC" parent="[1CP]1CP_I2_MDM_CNTRY_ITERATOR" processingDateOffset="0" processingTemplate="[1CP]1CP_I2_MDM_CNTRY_CALL_NONDTC" processingType="TASK" sortOrder="3" taskType="SH" workflowType="STANDARD" />
  <SubProcessingTemplate id="[1CP]1CP_I2_MDM_CNTRY_ITERATOR|[1CP]1CP_ALL_ETL_SET_ENV" failureCase="false" freeFloat="0" name="[1CP]1CP_ALL_ETL_SET_ENV" parent="[1CP]1CP_I2_MDM_CNTRY_ITERATOR" processingDateOffset="0" processingTemplate="[1CP]1CP_ALL_ETL_SET_ENV" processingType="TASK" sortOrder="4" taskSubType="SET_CONTEXT_VARIABLE_VALUE" taskType="SCHEDULE_IN" workflowType="STANDARD" />
  <SubProcessingTemplate id="[1CP]1CP_I2_MDM_CNTRY_ITERATOR|[1CP]1CP_I5_ETL_SET_ENV" failureCase="false" freeFloat="0" name="[1CP]1CP_I5_ETL_SET_ENV" parent="[1CP]1CP_I2_MDM_CNTRY_ITERATOR" processingDateOffset="0" processingTemplate="[1CP]1CP_I5_ETL_SET_ENV" processingType="TASK" sortOrder="5" taskType="SH" workflowType="STANDARD" />
  <SubProcessingTemplate id="[1CP]1CP_I2_MDM_CNTRY_ITERATOR|[1CP]1CP_I2_CNSMR_ACTN_UPDT" failureCase="false" freeFloat="0" name="[1CP]1CP_I2_CNSMR_ACTN_UPDT" parent="[1CP]1CP_I2_MDM_CNTRY_ITERATOR" processingDateOffset="0" processingTemplate="[1CP]1CP_I2_CNSMR_ACTN_UPDT" processingType="TASK" sortOrder="6" taskType="SH" workflowType="STANDARD" />
  <SubProcessingTemplate id="[1CP]1CP_I2_MDM_CNTRY_ITERATOR|[1CP]1CP_I2_MDM_WAITER" failureCase="false" freeFloat="0" name="[1CP]1CP_I2_MDM_WAITER" parent="[1CP]1CP_I2_MDM_CNTRY_ITERATOR" processingDateOffset="0" processingTemplate="[1CP]1CP_I2_MDM_WAITER" processingType="TASK" sortOrder="6" taskType="SH" workflowType="STANDARD" />
  <SubProcessingTemplate id="[1CP]1CP_I2_MDM_CNTRY_ITERATOR|[1CP]1CP_I2_DMC_CONTACT_UPDT" failureCase="false" freeFloat="0" name="[1CP]1CP_I2_DMC_CONTACT_UPDT" parent="[1CP]1CP_I2_MDM_CNTRY_ITERATOR" processingDateOffset="0" processingTemplate="[1CP]1CP_I2_DMC_CONTACT_UPDT" processingType="TASK" sortOrder="7" taskType="SH" workflowType="STANDARD" />
  <SubProcessingTemplate id="[1CP]1CP_I2_MDM_CNTRY_ITERATOR|[1CP]1CP_DMC_ETL_SET_ENV" failureCase="false" freeFloat="0" name="[1CP]1CP_DMC_ETL_SET_ENV" parent="[1CP]1CP_I2_MDM_CNTRY_ITERATOR" processingDateOffset="0" processingTemplate="[1CP]1CP_DMC_ETL_SET_ENV" processingType="TASK" sortOrder="8" taskType="SH" workflowType="STANDARD" />
  <SubProcessingTemplateMapping failureCase="false" predecessor="[1CP]1CP_I2_MDM_CNTRY_ITERATOR|[1CP]1CP_I2_MDM_CNTRY_CALL" processingTemplate="[1CP]1CP_I2_MDM_CNTRY_ITERATOR" successor="[1CP]1CP_I2_MDM_CNTRY_ITERATOR|[1CP]1CP_I2_MDM_CNTRY_CALL_NONDTC" />
  <SubProcessingTemplateMapping failureCase="false" predecessor="[1CP]1CP_I2_MDM_CNTRY_ITERATOR|[1CP]1CP_I2_MDM_CNTRY_CALL_NONDTC" processingTemplate="[1CP]1CP_I2_MDM_CNTRY_ITERATOR" successor="[1CP]1CP_I2_MDM_CNTRY_ITERATOR|[1CP]1CP_ALL_ETL_SET_ENV" />
  <SubProcessingTemplateMapping failureCase="false" predecessor="[1CP]1CP_I2_MDM_CNTRY_ITERATOR|[1CP]1CP_ALL_ETL_SET_ENV" processingTemplate="[1CP]1CP_I2_MDM_CNTRY_ITERATOR" successor="[1CP]1CP_I2_MDM_CNTRY_ITERATOR|[1CP]1CP_I5_ETL_SET_ENV" />
  <SubProcessingTemplateMapping failureCase="false" predecessor="[1CP]1CP_I2_MDM_CNTRY_ITERATOR|[1CP]1CP_I5_ETL_SET_ENV" processingTemplate="[1CP]1CP_I2_MDM_CNTRY_ITERATOR" successor="[1CP]1CP_I2_MDM_CNTRY_ITERATOR|[1CP]1CP_I2_CNSMR_ACTN_UPDT" />
  <SubProcessingTemplateMapping failureCase="false" predecessor="[1CP]1CP_I2_MDM_CNTRY_ITERATOR|[1CP]1CP_I2_DMC_CONTACT_UPDT" processingTemplate="[1CP]1CP_I2_MDM_CNTRY_ITERATOR" successor="[1CP]1CP_I2_MDM_CNTRY_ITERATOR|[1CP]1CP_I2_MDM_WAITER" />
  <SubProcessingTemplateMapping failureCase="false" predecessor="[1CP]1CP_I2_MDM_CNTRY_ITERATOR|[1CP]1CP_I2_CNSMR_ACTN_UPDT" processingTemplate="[1CP]1CP_I2_MDM_CNTRY_ITERATOR" successor="[1CP]1CP_I2_MDM_CNTRY_ITERATOR|[1CP]1CP_DMC_ETL_SET_ENV" />
  <SubProcessingTemplateMapping failureCase="false" predecessor="[1CP]1CP_I2_MDM_CNTRY_ITERATOR|[1CP]1CP_DMC_ETL_SET_ENV" processingTemplate="[1CP]1CP_I2_MDM_CNTRY_ITERATOR" successor="[1CP]1CP_I2_MDM_CNTRY_ITERATOR|[1CP]1CP_I2_DMC_CONTACT_UPDT" />
  <SemaphoreConstraintTemplate binarySemaphoreWait="ON" parent="[1CP]1CP_I2_MDM_CNTRY_ITERATOR" permits="1" processingTemplateName="[1CP]1CP_I2_MDM_CNTRY_ITERATOR" semaphore="[1CP]1CP_I2_MDM_LOADS" semaphoreType="STOCK" variableOperator="EQ" />
  <ProcessingTemplateCargo id="9187708" cargo="CREATE VOLATILE TABLE MPN AS (&#10;SEL MKTNG_PGM_NBR FROM MDM.TRILLIUM_OUTPUT1_${CNTRY_PARAMETER}_TEMP&#10;)&#10;WITH DATA&#10;PRIMARY INDEX (MKTNG_PGM_NBR)&#10;ON COMMIT PRESERVE ROWS;&#10;.IF ERRORLEVEL &gt; 0 THEN .GOTO EXIT;&#10;&#10;CREATE VOLATILE TABLE NEW_REGIS AS&#10;(&#10;SELECT &#10;        P.REGIS_PRSNA_ID&#10;       ,M.HSHLD_PRSNA_ID&#10;       ,P.MATCHD_CNSMR_PRSNA_ID&#10;       ,CASE WHEN E.CNTCT_POINT_CATEG_CODE = &apos;EP&apos; THEN 552&#10;       WHEN E.CNTCT_POINT_CATEG_CODE = &apos;EM&apos; THEN 553&#10;       WHEN E.CNTCT_POINT_CATEG_CODE = &apos;EB&apos; THEN 554&#10;       END AS ATTRIBUTE_SCHEMA_ID&#10;       ,CASE WHEN E.CNTCT_POINT_CATEG_CODE = &apos;EP&apos; THEN 895&#10;       WHEN E.CNTCT_POINT_CATEG_CODE = &apos;EM&apos; THEN 902&#10;       WHEN E.CNTCT_POINT_CATEG_CODE = &apos;EB&apos; THEN 904&#10;       END AS HH_ATTRIBUTE_SCHEMA_ID&#10;   ,CASE WHEN E.CNTCT_POINT_CATEG_CODE = &apos;EP&apos; THEN 894&#10;       WHEN E.CNTCT_POINT_CATEG_CODE = &apos;EM&apos; THEN 903&#10;       WHEN E.CNTCT_POINT_CATEG_CODE = &apos;EB&apos; THEN 905&#10;       END AS MC_ATTRIBUTE_SCHEMA_ID&#10;       ,E.TEMPORAL_TIME &#10;       ,P.SYS_SOURCE&#10;&#10;FROM  ${ICRM_VIEW}.REGIS_PRSNA_EMAIL_ADDR  E&#10;JOIN  ${ICRM_VIEW}.REGIS_PRSNA             P&#10;ON    E.LEGAL_ENT_NBR             = P.LEGAL_ENT_NBR&#10;AND   E.MKTNG_PGM_NBR             = P.MKTNG_PGM_NBR&#10;AND   E.REGIS_PRSNA_ID            = P.REGIS_PRSNA_ID&#10;&#10;JOIN ${ICRM_VIEW}.MATCHD_CNSMR_PRSNA      M&#10;ON    P.MATCHD_CNSMR_PRSNA_ID     = M.MATCHD_CNSMR_PRSNA_ID&#10;AND   P.LEGAL_ENT_NBR             = M.LEGAL_ENT_NBR&#10;&#10;WHERE P.PRSNA_STATUS_CODE         = &apos;AC&apos;&#10;AND E.VALID_CNTCT_POINT_IND     = &apos;Y&apos;&#10;AND E.PREF_CNTCT_POINT_IND = &apos;Y&apos;&#10;AND E.SUBSCRPTN_OPT_IND    = &apos;I&apos;&#10;AND COALESCE(E.EMAIL_STATUS_CODE,&apos;AC&apos;) = &apos;AC&apos;&#10;AND E.MKTNG_PGM_NBR IN (SEL MKTNG_PGM_NBR FROM MPN)&#10;AND ATTRIBUTE_SCHEMA_ID IS NOT NULL&#10;QUALIFY ROW_NUMBER() OVER (PARTITION BY P.REGIS_PRSNA_ID,ATTRIBUTE_SCHEMA_ID&#10;ORDER BY E.TEMPORAL_TIME DESC) = 1&#10;)&#10;WITH DATA&#10;PRIMARY INDEX(REGIS_PRSNA_ID)&#10;ON COMMIT PRESERVE ROWS;&#10;.IF ERRORLEVEL &gt; 0 THEN .GOTO EXIT;&#10;&#10;COLLECT STATS NEW_REGIS&#10;COLUMN REGIS_PRSNA_ID;&#10;.IF ERRORLEVEL &gt; 0 THEN .GOTO EXIT;&#10;&#10;COLLECT STATS NEW_REGIS&#10;COLUMN ATTRIBUTE_SCHEMA_ID;&#10;.IF ERRORLEVEL &gt; 0 THEN .GOTO EXIT;&#10;&#10;COLLECT STATS NEW_REGIS&#10;COLUMN HH_ATTRIBUTE_SCHEMA_ID;&#10;.IF ERRORLEVEL &gt; 0 THEN .GOTO EXIT;&#10;&#10;COLLECT STATS NEW_REGIS&#10;COLUMN MC_ATTRIBUTE_SCHEMA_ID;&#10;.IF ERRORLEVEL &gt; 0 THEN .GOTO EXIT;&#10;&#10;CREATE VOLATILE TABLE REGIS_EXISTS AS (&#10;SELECT DISTINCT P.REGIS_PRSNA_ID, P.HSHLD_PRSNA_ID, P.MATCHD_CNSMR_PRSNA_ID, &#10;P.ATTRIBUTE_SCHEMA_ID,CURRENT_TIMESTAMP(0) AS SYS_CREATION_DATE,CURRENT_TIMESTAMP(0) AS SYS_LAST_MODIFIED_DATE,P.SYS_SOURCE&#10;FROM NEW_REGIS P&#10;JOIN ${TRM}.RT_DMC_CONTACT DMC&#10;  ON DMC.REGIS_PRSNA_ID = P.REGIS_PRSNA_ID&#10;AND DMC.ATTRIBUTE_SCHEMA_ID = P.ATTRIBUTE_SCHEMA_ID&#10;)&#10;WITH DATA&#10;PRIMARY INDEX (REGIS_PRSNA_ID)&#10;PARTITION BY ATTRIBUTE_SCHEMA_ID&#10;ON COMMIT PRESERVE ROWS;&#10;.IF ERRORLEVEL &gt; 0 THEN .GOTO EXIT;&#10;&#10;COLLECT STATS REGIS_EXISTS &#10;COLUMN REGIS_PRSNA_ID;&#10;.IF ERRORLEVEL &gt; 0 THEN .GOTO EXIT;&#10;&#10;COLLECT STATS REGIS_EXISTS &#10;COLUMN ATTRIBUTE_SCHEMA_ID;&#10;.IF ERRORLEVEL &gt; 0 THEN .GOTO EXIT;&#10;&#10;CREATE VOLATILE TABLE REGIS_NOTEXISTS AS (&#10;SELECT DISTINCT P.REGIS_PRSNA_ID, P.HSHLD_PRSNA_ID, P.MATCHD_CNSMR_PRSNA_ID, &#10;P.ATTRIBUTE_SCHEMA_ID,CURRENT_TIMESTAMP(0) AS SYS_CREATION_DATE,CURRENT_TIMESTAMP(0) AS SYS_LAST_MODIFIED_DATE,P.SYS_SOURCE&#10;FROM NEW_REGIS P&#10;LEFT JOIN ${TRM}.RT_DMC_CONTACT DMC&#10;  ON DMC.REGIS_PRSNA_ID = P.REGIS_PRSNA_ID&#10;AND DMC.ATTRIBUTE_SCHEMA_ID = P.ATTRIBUTE_SCHEMA_ID&#10;WHERE DMC.REGIS_PRSNA_ID IS NULL&#10;AND DMC.ATTRIBUTE_SCHEMA_ID IS NULL&#10;)&#10;WITH DATA&#10;PRIMARY INDEX (HSHLD_PRSNA_ID, MATCHD_CNSMR_PRSNA_ID,REGIS_PRSNA_ID)&#10;PARTITION BY ATTRIBUTE_SCHEMA_ID&#10;ON COMMIT PRESERVE ROWS;&#10;.IF ERRORLEVEL &gt; 0 THEN .GOTO EXIT;&#10;&#10;COLLECT STATS REGIS_NOTEXISTS &#10;COLUMN REGIS_PRSNA_ID;&#10;.IF ERRORLEVEL &gt; 0 THEN .GOTO EXIT;&#10;&#10;COLLECT STATS REGIS_NOTEXISTS &#10;COLUMN ATTRIBUTE_SCHEMA_ID;&#10;.IF ERRORLEVEL &gt; 0 THEN .GOTO EXIT;&#10;&#10;&#10;INS REGIS_NOTEXISTS &#10;(REGIS_PRSNA_ID, HSHLD_PRSNA_ID, MATCHD_CNSMR_PRSNA_ID,&#10; ATTRIBUTE_SCHEMA_ID,SYS_CREATION_DATE,SYS_LAST_MODIFIED_DATE,SYS_SOURCE)&#10;SEL DISTINCT&#10;NULL AS REGIS_PRSNA_ID, P.HSHLD_PRSNA_ID, P.MATCHD_CNSMR_PRSNA_ID,&#10; P.MC_ATTRIBUTE_SCHEMA_ID,CURRENT_TIMESTAMP(0) AS SYS_CREATION_DATE,CURRENT_TIMESTAMP(0) AS SYS_LAST_MODIFIED_DATE,P.SYS_SOURCE&#10;FROM NEW_REGIS P&#10;LEFT JOIN ${TRM}.RT_DMC_CONTACT DMC&#10; ON DMC.REGIS_PRSNA_ID IS NULL&#10;   AND DMC.MATCHD_CNSMR_PRSNA_ID = P.MATCHD_CNSMR_PRSNA_ID&#10;   AND DMC.ATTRIBUTE_SCHEMA_ID = P.MC_ATTRIBUTE_SCHEMA_ID&#10;WHERE DMC.MATCHD_CNSMR_PRSNA_ID IS NULL&#10;AND DMC.ATTRIBUTE_SCHEMA_ID IS NULL&#10;QUALIFY ROW_NUMBER() OVER (PARTITION BY P.MATCHD_CNSMR_PRSNA_ID,MC_ATTRIBUTE_SCHEMA_ID&#10;ORDER BY P.SYS_SOURCE DESC) = 1;&#10;.IF ERRORLEVEL &gt; 0 THEN .GOTO EXIT;&#10;&#10;&#10;INS REGIS_NOTEXISTS &#10;(REGIS_PRSNA_ID, HSHLD_PRSNA_ID, MATCHD_CNSMR_PRSNA_ID,&#10; ATTRIBUTE_SCHEMA_ID,SYS_CREATION_DATE,SYS_LAST_MODIFIED_DATE,SYS_SOURCE)&#10;SEL DISTINCT&#10;NULL AS REGIS_PRSNA_ID, P.HSHLD_PRSNA_ID, NULL AS MATCHD_CNSMR_PRSNA_ID, &#10;P.HH_ATTRIBUTE_SCHEMA_ID,CURRENT_TIMESTAMP(0) AS SYS_CREATION_DATE,CURRENT_TIMESTAMP(0) AS SYS_LAST_MODIFIED_DATE,P.SYS_SOURCE&#10;FROM NEW_REGIS P&#10;LEFT JOIN ${TRM}.RT_DMC_CONTACT DMC&#10; ON DMC.REGIS_PRSNA_ID IS NULL&#10;   AND DMC.HSHLD_PRSNA_ID = P.HSHLD_PRSNA_ID&#10;   AND DMC.MATCHD_CNSMR_PRSNA_ID IS NULL&#10;   AND DMC.ATTRIBUTE_SCHEMA_ID = P.HH_ATTRIBUTE_SCHEMA_ID&#10;WHERE DMC.HSHLD_PRSNA_ID IS NULL&#10;AND DMC.ATTRIBUTE_SCHEMA_ID IS NULL&#10;QUALIFY ROW_NUMBER() OVER (PARTITION BY P.HSHLD_PRSNA_ID,P.HH_ATTRIBUTE_SCHEMA_ID&#10;ORDER BY P.SYS_SOURCE DESC) = 1;&#10;.IF ERRORLEVEL &gt; 0 THEN .GOTO EXIT;&#10;&#10;&#10;UPDATE ${TRM_TBL}.RT_DMC_CONTACT&#10;FROM REGIS_EXISTS A&#10;SET MATCHD_CNSMR_PRSNA_ID=A.MATCHD_CNSMR_PRSNA_ID&#10;,HSHLD_PRSNA_ID=A.HSHLD_PRSNA_ID&#10;,SYS_SOURCE=A.SYS_SOURCE&#10;,SYS_LAST_MODIFIED_DATE=CURRENT_TIMESTAMP(0)&#10;WHERE ${TRM_TBL}.RT_DMC_CONTACT.REGIS_PRSNA_ID=A.REGIS_PRSNA_ID&#10;AND ${TRM_TBL}.RT_DMC_CONTACT.ATTRIBUTE_SCHEMA_ID=A.ATTRIBUTE_SCHEMA_ID;&#10;.IF ERRORLEVEL &gt; 0 THEN .GOTO EXIT;&#10;&#10;INSERT INTO ${TRM_TBL}.RT_DMC_CONTACT&#10;(REGIS_PRSNA_ID, HSHLD_PRSNA_ID, MATCHD_CNSMR_PRSNA_ID, ATTRIBUTE_SCHEMA_ID,SYS_CREATION_DATE,SYS_LAST_MODIFIED_DATE,SYS_SOURCE) &#10;SEL DISTINCT&#10;REGIS_PRSNA_ID, HSHLD_PRSNA_ID, MATCHD_CNSMR_PRSNA_ID, &#10;ATTRIBUTE_SCHEMA_ID,SYS_CREATION_DATE,SYS_LAST_MODIFIED_DATE,SYS_SOURCE&#10;FROM REGIS_NOTEXISTS P;&#10;.IF ERRORLEVEL &gt; 0 THEN .GOTO EXIT;" />
  <ProcessingTemplate id="[1CP]1CP_I2_DMC_CONTACT_UPDT" description="i2 Processing: Update DMC contact with new registrations, matched consumers and households" domain="1CP" forceChronology="false" node="[1CP]ETL_SERVER" onHold="false" owner="Ss186037" passBy="false" priority="0" processingType="TASK" successResult="0" tags="1CP,EDW,MDM" taskCargo="9187708" taskCommand="${BIN_DIR}/id_sql_exec.sh ${TDPID} ${USERNAME} &quot;${USERPASSWORD}&quot; &quot;WorkFlow=MDM;Interface=i2;Process=DMCContactUpdate;Step=Step01;&quot; CARGO N $[TmpDir]/cargo/$[Agent].`printf %015d ${id}`.`printf %03d ${timesRestarted}`.CARGO" taskType="SH" turnOffDurationEstimation="false" workflowType="STANDARD" />
  </arrayList>

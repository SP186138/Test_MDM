CREATE SET TABLE MDM.CNSMR_TSS_CLEANSE_INPUT1 ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      LEGAL_ENT_NBR SMALLINT NOT NULL,
      MKTNG_PGM_NBR INTEGER NOT NULL,
      REGIS_CNSMR_ID_VAL VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC NOT NULL,
      NAME_PREFX_TXT CHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      GVN_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      MID_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      FAMLY_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      NAME_SUFFX_TXT CHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      FULL_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      GENDR_IND CHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      BRTH_DATE DATE FORMAT 'YY/MM/DD',
      ADDR_LINE_1_TXT VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      ADDR_LINE_2_TXT VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      ADDR_LINE_3_TXT VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      STRET_NUM VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
      STRET_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      APT_NUM VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PO_BOX_NUM VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
      CITY_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      POSTL_AREA_CODE VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
      TERR_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      CNTRY_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DPEND_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PET_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      WIN_KEY VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYNC_STATUS VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      USER_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      LANG_CODE CHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_SOURCE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_NC_TYPE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_CREATION_DATE TIMESTAMP(0),
      EMAIL_ADDR_TXT VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PHONE_EXTSN_NUM VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      FULL_PHONE_NUM VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      PHONE_LINE_NBR INTEGER,
      PHONE_AREA_NBR INTEGER,
      PHONE_EXCHG_NBR INTEGER,
      PHONE_CNTRY_NBR INTEGER,
      PRSNA_REG_DT TIMESTAMP(0) NOT NULL,
      ADDRESS_CONTACT VARCHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      ADDRESS_SUBSCRPTN VARCHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PHONE_CONTACT VARCHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PHONE_SUBSCRPTN VARCHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      EMAIL_CONTACT VARCHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      EMAIL_SUBSCRPTN VARCHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_TARGET_ID INTEGER)
PRIMARY INDEX ( MKTNG_PGM_NBR ,REGIS_CNSMR_ID_VAL ,
SYS_SOURCE  );

CREATE MULTISET TABLE MDM.REF_DATA_IGNORE ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      SYS_SOURCE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC)
PRIMARY INDEX ( SYS_SOURCE );


REPLACE VIEW MDM.CNSMR_TSS_CLEANSE_INPUT
 AS
 LOCKING ROW FOR ACCESS
 
 SELECT
LEGAL_ENT_NBR                 
,MKTNG_PGM_NBR                 
,REGIS_CNSMR_ID_VAL            
,NAME_PREFX_TXT                
,GVN_NAME                      
,MID_NAME                      
,FAMLY_NAME                    
,NAME_SUFFX_TXT                
,FULL_NAME                     
,GENDR_IND                     
,BRTH_DATE                     
,ADDR_LINE_1_TXT               
,ADDR_LINE_2_TXT               
,ADDR_LINE_3_TXT               
,STRET_NUM                     
,STRET_NAME                    
,APT_NUM                       
,PO_BOX_NUM                    
,CITY_NAME                     
,POSTL_AREA_CODE               
,TERR_NAME                     
,CNTRY_NAME                    
,DPEND_NAME                    
,PET_NAME                      
,WIN_KEY                       
,SYNC_STATUS                   
,USER_NAME                     
,LANG_CODE                     
,SYS_SOURCE                    
,SYS_NC_TYPE                   
,SYS_CREATION_DATE             
,EMAIL_ADDR_TXT                
,PHONE_EXTSN_NUM               
,FULL_PHONE_NUM                
,PHONE_LINE_NBR                
,PHONE_AREA_NBR                
,PHONE_EXCHG_NBR               
,PHONE_CNTRY_NBR               
,PRSNA_REG_DT                  
,ADDRESS_CONTACT
,ADDRESS_SUBSCRPTN
,EMAIL_CONTACT
,EMAIL_SUBSCRPTN
,PHONE_CONTACT
,PHONE_SUBSCRPTN
,SYS_TARGET_ID
FROM 

MDM.CNSMR_TSS_CLEANSE_INPUT1;

REPLACE VIEW MDM.CNSMR_TSS_MATCH_CRM
AS
LOCKING ROW FOR ACCESS

SELECT
      REGIS_PRSNA_1.MKTNG_PGM_NBR
     ,REGIS_PRSNA_1.REGIS_CNSMR_ID_VAL
     ,REGIS_PRSNA_1.NAME_PREFX_TXT
     ,REGIS_PRSNA_1.GVN_NAME
     ,REGIS_PRSNA_1.MID_NAME
     ,REGIS_PRSNA_1.FAMLY_NAME
     ,REGIS_PRSNA_1.NAME_SUFFX_TXT
     ,REGIS_PRSNA_1.FULL_NAME
     ,REGIS_PRSNA_1.GENDR_IND
     ,REGIS_PRSNA_1.BRTH_DATE
     ,REGIS_PRSNA_1.CNSMR_USER_NAME
     ,REGIS_PRSNA_1.LANG_CODE
     ,PRSNA_POSTL_ADDR_1.ADDR_LINE_1_TXT
     ,PRSNA_POSTL_ADDR_1.ADDR_LINE_2_TXT
     ,PRSNA_POSTL_ADDR_1.ADDR_LINE_3_TXT
     ,PRSNA_POSTL_ADDR_1.STRET_NUM
     ,PRSNA_POSTL_ADDR_1.STRET_NAME
     ,PRSNA_POSTL_ADDR_1.APT_NUM
     ,PRSNA_POSTL_ADDR_1.PO_BOX_NUM
     ,PRSNA_POSTL_ADDR_1.CITY_NAME
     ,PRSNA_POSTL_ADDR_1.POSTL_AREA_CODE
     ,PRSNA_POSTL_ADDR_1.TERR_CODE
     ,PRSNA_POSTL_ADDR_1.CNTRY_CODE
     ,PRSNA_EMAIL_ADDR_1.EMAIL_ADDR_TXT AS EMAIL_ADDR_TXT_1
     ,PRSNA_PHONE_1.PHONE_CNTRY_NBR AS PHONE_CNTRY_NBR_1
     ,PRSNA_PHONE_1.PHONE_AREA_NBR  AS PHONE_AREA_NBR_1
     ,PRSNA_PHONE_1.PHONE_EXCHG_NBR AS PHONE_EXCHG_NBR_1
     ,PRSNA_PHONE_1.PHONE_LINE_NBR  AS PHONE_LINE_NBR_1
     ,PRSNA_PHONE_1.PHONE_EXTSN_NUM AS PHONE_EXTSN_NUM_1
     ,PRSNA_PHONE_1.FULL_PHONE_NUM  AS FULL_PHONE_NUM_1
     ,PRSNA_POSTL_ADDR_1.WIN_KEY
     ,DPEND_1.DPEND_NAME
     ,PET_1.PET_NAME
     ,REGIS_PRSNA_1.REGIS_PRSNA_ID 
     ,LEGAL_ENT_PRSNA_1.MATCHD_CNSMR_PRSNA_ID
     ,LEGAL_ENT_PRSNA_1.HSHLD_PRSNA_ID
     ,REGIS_PRSNA_1.LEGAL_ENT_NBR
    
      FROM  (SELECT MKTNG_PGM_NBR FROM MDM.PRSNA_STG UNION 
      SELECT MKTNG_PGM_NBR FROM MDM.CNSMR_TSS_CLEANSE_INPUT_DEDUP GROUP BY 1) C
      
      INNER JOIN MDM.REGIS_PRSNA REGIS_PRSNA_1
      ON REGIS_PRSNA_1.MKTNG_PGM_NBR = C.MKTNG_PGM_NBR      
    
      INNER JOIN MDM.MATCHD_CNSMR_PRSNA LEGAL_ENT_PRSNA_1
        ON REGIS_PRSNA_1.MATCHD_CNSMR_PRSNA_ID = LEGAL_ENT_PRSNA_1.MATCHD_CNSMR_PRSNA_ID
       AND REGIS_PRSNA_1.LEGAL_ENT_NBR = LEGAL_ENT_PRSNA_1.LEGAL_ENT_NBR
       AND REGIS_PRSNA_1.PRSNA_STATUS_CODE = 'AC'
       
  LEFT OUTER JOIN ICRM_TBL.REGIS_PRSNA_POSTL_ADDR PRSNA_POSTL_ADDR_1
    ON REGIS_PRSNA_1.REGIS_PRSNA_ID = PRSNA_POSTL_ADDR_1.REGIS_PRSNA_ID
   AND REGIS_PRSNA_1.MKTNG_PGM_NBR = PRSNA_POSTL_ADDR_1.MKTNG_PGM_NBR
   AND REGIS_PRSNA_1.LEGAL_ENT_NBR = PRSNA_POSTL_ADDR_1.LEGAL_ENT_NBR

  LEFT OUTER JOIN ICRM_TBL.REGIS_PRSNA_PHONE PRSNA_PHONE_1
    ON REGIS_PRSNA_1.REGIS_PRSNA_ID = PRSNA_PHONE_1.REGIS_PRSNA_ID
   AND REGIS_PRSNA_1.MKTNG_PGM_NBR = PRSNA_PHONE_1.MKTNG_PGM_NBR
   AND REGIS_PRSNA_1.LEGAL_ENT_NBR = PRSNA_PHONE_1.LEGAL_ENT_NBR
    
  LEFT OUTER JOIN ICRM_TBL.REGIS_PRSNA_EMAIL_ADDR PRSNA_EMAIL_ADDR_1
    ON REGIS_PRSNA_1.REGIS_PRSNA_ID = PRSNA_EMAIL_ADDR_1.REGIS_PRSNA_ID
   AND REGIS_PRSNA_1.MKTNG_PGM_NBR = PRSNA_EMAIL_ADDR_1.MKTNG_PGM_NBR
   AND REGIS_PRSNA_1.LEGAL_ENT_NBR = PRSNA_EMAIL_ADDR_1.LEGAL_ENT_NBR 

  LEFT OUTER JOIN ICRM_TBL.DPEND DPEND_1
    ON REGIS_PRSNA_1.REGIS_PRSNA_ID = DPEND_1.REGIS_PRSNA_ID
   AND REGIS_PRSNA_1.MKTNG_PGM_NBR = DPEND_1.MKTNG_PGM_NBR
   AND REGIS_PRSNA_1.LEGAL_ENT_NBR = DPEND_1.LEGAL_ENT_NBR

  LEFT OUTER JOIN ICRM_TBL.PET PET_1
    ON REGIS_PRSNA_1.REGIS_PRSNA_ID = PET_1.REGIS_PRSNA_ID
   AND REGIS_PRSNA_1.MKTNG_PGM_NBR = PET_1.MKTNG_PGM_NBR
   AND REGIS_PRSNA_1.LEGAL_ENT_NBR = PET_1.LEGAL_ENT_NBR
;



REPLACE VIEW MDM.CNSMR_TSS_WINKEY
AS
LOCKING ROW FOR ACCESS

SELECT
   WINDOW_KEY_01                 
  ,EMAIL_ADDR_TXT
         ,PHONE
         ,LEGAL_ENT_NBR

  FROM MDM.WINKEY_TRIGGER
;





REPLACE VIEW MDM.CNSMR_TSS_MATCH_INPUT
AS
LOCKING ROW FOR ACCESS

SELECT 
   CNSMR_TSS_MATCH_CRM_1.MKTNG_PGM_NBR      AS MKTNG_PGM_NBR_CRM            
  ,CNSMR_TSS_MATCH_CRM_1.REGIS_CNSMR_ID_VAL AS REGIS_CNSMR_ID_VAL_CRM       
  ,CNSMR_TSS_MATCH_CRM_1.NAME_PREFX_TXT     AS NAME_PREFX_TXT_CRM           
  ,CNSMR_TSS_MATCH_CRM_1.GVN_NAME           AS GVN_NAME_CRM                 
  ,CNSMR_TSS_MATCH_CRM_1.MID_NAME           AS MID_NAME_CRM                 
  ,CNSMR_TSS_MATCH_CRM_1.FAMLY_NAME         AS FAMLY_NAME_CRM               
  ,CNSMR_TSS_MATCH_CRM_1.NAME_SUFFX_TXT     AS NAME_SUFFX_TXT_CRM           
  ,CNSMR_TSS_MATCH_CRM_1.FULL_NAME          AS FULL_NAME_CRM                
  ,CNSMR_TSS_MATCH_CRM_1.GENDR_IND          AS GENDR_IND_CRM                
  ,CNSMR_TSS_MATCH_CRM_1.BRTH_DATE          AS BRTH_DATE_CRM                
  ,CNSMR_TSS_MATCH_CRM_1.CNSMR_USER_NAME    AS USER_NAME_CRM                
  ,CNSMR_TSS_MATCH_CRM_1.LANG_CODE          AS LANG_CODE_CRM    
  ,CNSMR_TSS_MATCH_CRM_1.ADDR_LINE_1_TXT    AS ADDR_LINE_1_TXT_CRM          
  ,CNSMR_TSS_MATCH_CRM_1.ADDR_LINE_2_TXT    AS ADDR_LINE_2_TXT_CRM          
  ,CNSMR_TSS_MATCH_CRM_1.ADDR_LINE_3_TXT    AS ADDR_LINE_3_TXT_CRM          
  ,CNSMR_TSS_MATCH_CRM_1.STRET_NUM          AS STRET_NUM_CRM                
  ,CNSMR_TSS_MATCH_CRM_1.STRET_NAME         AS STRET_NAME_CRM               
  ,CNSMR_TSS_MATCH_CRM_1.APT_NUM            AS APT_NUM_CRM                  
  ,CNSMR_TSS_MATCH_CRM_1.PO_BOX_NUM         AS PO_BOX_NUM_CRM               
  ,CNSMR_TSS_MATCH_CRM_1.CITY_NAME          AS CITY_NAME_CRM                
  ,CNSMR_TSS_MATCH_CRM_1.POSTL_AREA_CODE    AS POSTL_AREA_CODE_CRM                          
  ,CNSMR_TSS_MATCH_CRM_1.TERR_CODE          AS TERR_CODE_CRM
  ,CNSMR_TSS_MATCH_CRM_1.CNTRY_CODE         AS CNTRY_CODE_CRM          
  ,CNSMR_TSS_MATCH_CRM_1.EMAIL_ADDR_TXT_1   AS EMAIL_ADDR_TXT_1_CRM              
  ,CNSMR_TSS_MATCH_CRM_1.PHONE_CNTRY_NBR_1  AS PHONE_CNTRY_NBR_1_CRM        
  ,CNSMR_TSS_MATCH_CRM_1.PHONE_AREA_NBR_1   AS PHONE_AREA_NBR_1_CRM         
  ,CNSMR_TSS_MATCH_CRM_1.PHONE_EXCHG_NBR_1  AS PHONE_EXCHG_NBR_1_CRM        
  ,CNSMR_TSS_MATCH_CRM_1.PHONE_LINE_NBR_1   AS PHONE_LINE_NBR_1_CRM         
  ,CNSMR_TSS_MATCH_CRM_1.PHONE_EXTSN_NUM_1  AS PHONE_EXTSN_NUM_1_CRM        
  ,CNSMR_TSS_MATCH_CRM_1.FULL_PHONE_NUM_1   AS FULL_PHONE_NUM_1_CRM 
  ,CNSMR_TSS_MATCH_CRM_1.WIN_KEY      AS WIN_KEY_CRM         
  ,CNSMR_TSS_MATCH_CRM_1.DPEND_NAME         AS DPEND_NAME_CRM
  ,CNSMR_TSS_MATCH_CRM_1.PET_NAME           AS PET_NAME_CRM
  ,CNSMR_TSS_MATCH_CRM_1.REGIS_PRSNA_ID                  
  ,CNSMR_TSS_MATCH_CRM_1.MATCHD_CNSMR_PRSNA_ID AS LEGAL_ENT_PRSNA_ID        
  ,CNSMR_TSS_MATCH_CRM_1.HSHLD_PRSNA_ID     AS HSHLD_PRSNA_ID  
  ,CNSMR_TSS_MATCH_CRM_1.LEGAL_ENT_NBR


    FROM 
    MDM.CNSMR_TSS_MATCH_CRM CNSMR_TSS_MATCH_CRM_1
      WHERE
         CNSMR_TSS_MATCH_CRM_1.WIN_KEY IN 
         (
            SEL WINDOW_KEY_01 
            FROM
            MDM.CNSMR_TSS_WINKEY WINKEY
            WHERE 
            WINKEY.WINDOW_KEY_01 NOT IN ('','IN        1','JA         ','       1','CN     ','AU       1','CN')
         )
        OR
          CNSMR_TSS_MATCH_CRM_1.EMAIL_ADDR_TXT_1 IN
         (
            SEL EMAIL_ADDR_TXT
            FROM
            MDM.CNSMR_TSS_WINKEY WINKEY
            WHERE 
            WINKEY.EMAIL_ADDR_TXT <> ''
         )    
         OR
          (CNSMR_TSS_MATCH_CRM_1.FULL_PHONE_NUM_1,CNSMR_TSS_MATCH_CRM_1.LEGAL_ENT_NBR) IN
         (
            SEL PHONE,LEGAL_ENT_NBR
            FROM
            MDM.CNSMR_TSS_WINKEY WINKEY
            WHERE 
            WINKEY.PHONE <> ''
         )   
  ;



REPLACE VIEW MDM.MDM_LOAD_CONTROL
	AS
	LOCKING ROW FOR ACCESS
	SELECT DISTINCT A.LOAD_ID ,
	CASE WHEN A.SOURCE_ID IN (1001,1003,1140)
	THEN 1
	ELSE 2
	END AS PRIORITY_NO,
	A.SOURCE_ID
	FROM ETL_CTRL.LOAD_CONTROL A
	LEFT OUTER JOIN ETL_CTRL.LOAD_CONTROL B
	ON A.LOAD_ID = B.LOAD_ID
	AND B.LOAD_TYPE = 'MDM'
	WHERE
	(B.LOAD_ID IS NULL OR B.LOADSTATUS = 'RESTART')
	AND A.LOAD_TYPE = 'ETL'
	AND A.LOADSTATUS = 'Success'
	AND A.FORMAT_ID IN  (1,99)
	AND A.MDM_PROCESS_DESC='Completed'
	--AND A.SOURCE_ID IN (1001, 1003, 9938)
	
	
	AND A.TARGETCNT > 0
	--AND A.SOURCE_ID IN (1001, 1003)

	AND A.SOURCE_ID IN (1001, 1140, 1078, 9909, 9960, 9932, 9905, 
	9912, 9910, 9913, 1033, 1039, 1040, 1090, 1043, 9953, 9959, 
	9933, 9963, 9964, 9965, 9968,9973,9975,9976,--9979,9980,
	9985, 9967,9907, 9992, 1058, 1059, 1060, 1061,1062, 9938, 9962,
	1099, 1114, 1074, 1075, 1118, 1017,1021,1038,1044,1078, 
	1084, 1018, 1097,1049,1092, 1070, 1071, 1072, 1073, 1087,
	1101,1102,1098, 1026, 1047, 1041, 1048, 1082, 1100,1020,1077,1086,1053,1109,1115, 1083,--1108
	1117,1119,1076,1103,1030,1029,1103,1119,1121,1113,1112, 1085,1042,1037,1111 , 1019,1096 )
	;

/*
REPLACE PROCEDURE MDM.FLDCLEANUP (
INOUT RETURNCODE INTEGER,
IN TABLE_NAME VARCHAR(30),
IN DATABASE_NAME VARCHAR(30)
)

LMAIN: BEGIN

DECLARE SYSTEMDATE VARCHAR(19);
DECLARE ERRORTABLE1 VARCHAR(30);
DECLARE ERRORTABLE2 VARCHAR(30);
DECLARE ERRORTABLE3 VARCHAR(30);
DECLARE ERRORTABLE4 VARCHAR(30);
DECLARE DBNAME VARCHAR(30);
DECLARE TBLNAME VARCHAR(30);
DECLARE TABLEDEFN VARCHAR(10000);
DECLARE GRANTDEFN VARCHAR(10000);
DECLARE STMT VARCHAR(1);
DECLARE STMT1 VARCHAR(10000);

SET DBNAME = DATABASE_NAME;
SET TBLNAME = TABLE_NAME;
SET ERRORTABLE1 = TABLE_NAME||'_ERR1';
SET ERRORTABLE2 = TABLE_NAME||'_ERR2';

     CREATE VOLATILE TABLE ACCESSRIGHT_V2R61_REF
     (
      ACCESSRIGHT VARCHAR(2) NOT NULL,
      ACCESSRIGHT_DESC VARCHAR(10000) NOT NULL
     ) UNIQUE PRIMARY INDEX (ACCESSRIGHT)
     ON COMMIT PRESERVE ROWS;

     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('AE','ALTER EXTERNAL PROCEDURE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('AF','ALTER FUNCTION');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('AP','ALTER PROCEDURE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('AS','ABORT SESSION');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('CA','CREATE AUTHORIZATION');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('CD','CREATE DATABASE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('CE','CREATE EXTERNAL PROCEDURE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('CF','CREATE FUNCTION');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('CG','CREATE TRIGGER');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('CM','CREATE MACRO');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('CO','CREATE PROFILE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('CP','CHECKPOINT');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('CR','CREATE ROLE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('CT','CREATE TABLE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('CU','CREATE USER');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('CV','CREATE VIEW');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('D','DELETE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('DA','DROP AUTHORIZATION');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('DD','DROP DATABASE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('DF','DROP FUNCTION');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('DG','DROP TRIGGER');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('DM','DROP MACRO');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('DO','DROP PROFILE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('DP','DUMP');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('DR','DROP ROLE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('DT','DROP TABLE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('DU','DROP USER');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('DV','DROP VIEW');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('E','EXECUTE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('EF','EXECUTE FUNCTION');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('I','INSERT');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('IX','INDEX');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('MR','MONITOR RESOURCE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('MS','MONITOR SESSION');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('PC','CREATE PROCEDURE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('PD','DROP PROCEDURE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('PE','EXECUTE PROCEDURE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('R','SELECT');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('RF','REFERENCE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('RS','RESTORE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('RO','REPLICATION OVERIDE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('SR','SET RESOURCE RATE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('SS','SET SESSION RATE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('U','UPDATE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('UM','UDT METHOD');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('UT','UDT TYPE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('UU','UDT USAGE');

   
SELECT DISTINCT CAST(CAST(CURRENT_DATE AS DATE FORMAT 'YYYYMMDD') AS VARCHAR(8))||
CAST(CAST(CURRENT_TIME AS TIME FORMAT 'HHMISS') AS VARCHAR(6)) INTO :SYSTEMDATE FROM SYS_CALENDAR.CALENDAR;

SET ERRORTABLE3 = TABLE_NAME||'_ERR1'||SYSTEMDATE;
SET ERRORTABLE4 = TABLE_NAME||'_ERR2'||SYSTEMDATE;

SEL REQUESTTEXT INTO :TABLEDEFN FROM DBC.TABLES WHERE DATABASENAME=:DATABASE_NAME
AND TABLENAME=:TABLE_NAME
AND TABLEKIND='T';

SELECT 'GRANT '||TRIM(B.ACCESSRIGHT_DESC)||' ON '||TRIM(A.DATABASENAME)||'.'||TRIM(A.TABLENAME)||' TO '||
TRIM(A.USERNAME)||CASE WHEN A.GRANTAUTHORITY = 'Y' THEN ' WITH GRANT OPTION;' ELSE ';' END INTO :GRANTDEFN
FROM DBC.ALLRIGHTS A
INNER JOIN ACCESSRIGHT_V2R61_REF B
ON A.ACCESSRIGHT = B.ACCESSRIGHT
WHERE A.TABLENAME=:DATABASE_NAME
AND A.DATABASENAME=:TABLE_NAME;

L1: BEGIN

SEL 1 INTO :STMT FROM SYSADMIN.FASTLOGV WHERE DATABASENAME=:DATABASE_NAME
AND TABLENAME=:TABLE_NAME;

IF ACTIVITY_COUNT = 1 THEN 
SET STMT1 = 'DROP TABLE '||DBNAME||'.'||TBLNAME||';';
CALL DBC.SYSEXECSQL (STMT1);
CALL DBC.SYSEXECSQL (TABLEDEFN);
CALL DBC.SYSEXECSQL (GRANTDEFN);
END IF;

END L1;

L2: BEGIN

SEL REQUESTTEXT INTO :TABLEDEFN FROM DBC.TABLES WHERE DATABASENAME=:DATABASE_NAME
AND TABLENAME=:ERRORTABLE1
AND TABLEKIND='T';

IF ACTIVITY_COUNT = 1 THEN 
SEL 1 INTO :STMT FROM SYSADMIN.FASTLOGV WHERE DATABASENAME=:DATABASE_NAME
AND TABLENAME=:TABLE_NAME;

IF ACTIVITY_COUNT = 1 THEN 
SET STMT1 = 'DROP TABLE '||DBNAME||'.'||ERRORTABLE1||';';
CALL DBC.SYSEXECSQL (STMT1);
LEAVE L2;
END IF;

SET STMT1 = 'RENAME TABLE '||DBNAME||'.'||ERRORTABLE1||' TO '||DBNAME||'.'||ERRORTABLE3||';';
CALL DBC.SYSEXECSQL (STMT1);
END IF;

END L2;

L3: BEGIN

SEL REQUESTTEXT INTO :TABLEDEFN FROM DBC.TABLES WHERE DATABASENAME=:DATABASE_NAME
AND TABLENAME=:ERRORTABLE2
AND TABLEKIND='T';

IF ACTIVITY_COUNT = 1 THEN 
SEL 1 INTO :STMT FROM SYSADMIN.FASTLOGV WHERE DATABASENAME=:DATABASE_NAME
AND TABLENAME=:TABLE_NAME;

IF ACTIVITY_COUNT = 1 THEN 
SET STMT1 = 'DROP TABLE '||DBNAME||'.'||ERRORTABLE2||';';
CALL DBC.SYSEXECSQL (STMT1);
LEAVE L3;
END IF;

SET STMT1 = 'RENAME TABLE '||DBNAME||'.'||ERRORTABLE2||' TO '||DBNAME||'.'||ERRORTABLE4||';';
CALL DBC.SYSEXECSQL (STMT1);
END IF;

END L3;

DELETE FROM SYSADMIN.FASTLOGV WHERE DATABASENAME=:DATABASE_NAME
AND TABLENAME=:TABLE_NAME;

DROP TABLE ACCESSRIGHT_V2R61_REF;

SET RETURNCODE = SQLCODE;

END LMAIN;
*/

REPLACE PROCEDURE MDM.FLDCLEANUP (
INOUT RETURNCODE VARCHAR(30),
IN TABLE_NAME VARCHAR(30),
IN DATABASE_NAME VARCHAR(30)
)

LMAIN: BEGIN

DECLARE SYSTEMDATE VARCHAR(19);
DECLARE ERRORTABLE1 VARCHAR(30);
DECLARE ERRORTABLE2 VARCHAR(30);
DECLARE ERRORTABLE3 VARCHAR(30);
DECLARE ERRORTABLE4 VARCHAR(30);
DECLARE DBNAME VARCHAR(30);
DECLARE TBLNAME VARCHAR(30);
DECLARE TABLEDEFN VARCHAR(10000);
DECLARE GRANTDEFN VARCHAR(10000);
DECLARE STMT VARCHAR(1);
DECLARE STMT1 VARCHAR(10000);

SET DBNAME = DATABASE_NAME;
SET TBLNAME = TABLE_NAME;
SET ERRORTABLE1 = TABLE_NAME||'_ERR1';
SET ERRORTABLE2 = TABLE_NAME||'_ERR2';

     CREATE VOLATILE TABLE ACCESSRIGHT_V2R61_REF
     (
      ACCESSRIGHT VARCHAR(2) NOT NULL,
      ACCESSRIGHT_DESC VARCHAR(10000) NOT NULL
     ) UNIQUE PRIMARY INDEX (ACCESSRIGHT)
     ON COMMIT PRESERVE ROWS;

     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('AE','ALTER EXTERNAL PROCEDURE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('AF','ALTER FUNCTION');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('AP','ALTER PROCEDURE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('AS','ABORT SESSION');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('CA','CREATE AUTHORIZATION');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('CD','CREATE DATABASE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('CE','CREATE EXTERNAL PROCEDURE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('CF','CREATE FUNCTION');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('CG','CREATE TRIGGER');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('CM','CREATE MACRO');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('CO','CREATE PROFILE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('CP','CHECKPOINT');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('CR','CREATE ROLE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('CT','CREATE TABLE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('CU','CREATE USER');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('CV','CREATE VIEW');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('D','DELETE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('DA','DROP AUTHORIZATION');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('DD','DROP DATABASE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('DF','DROP FUNCTION');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('DG','DROP TRIGGER');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('DM','DROP MACRO');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('DO','DROP PROFILE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('DP','DUMP');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('DR','DROP ROLE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('DT','DROP TABLE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('DU','DROP USER');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('DV','DROP VIEW');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('E','EXECUTE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('EF','EXECUTE FUNCTION');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('I','INSERT');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('IX','INDEX');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('MR','MONITOR RESOURCE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('MS','MONITOR SESSION');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('PC','CREATE PROCEDURE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('PD','DROP PROCEDURE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('PE','EXECUTE PROCEDURE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('R','SELECT');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('RF','REFERENCE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('RS','RESTORE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('RO','REPLICATION OVERIDE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('SR','SET RESOURCE RATE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('SS','SET SESSION RATE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('U','UPDATE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('UM','UDT METHOD');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('UT','UDT TYPE');
     INSERT INTO ACCESSRIGHT_V2R61_REF VALUES ('UU','UDT USAGE');

   
SELECT DISTINCT CAST(CAST(CURRENT_DATE AS DATE FORMAT 'YYYYMMDD') AS VARCHAR(8))||
CAST(CAST(CURRENT_TIME AS TIME FORMAT 'HHMISS') AS VARCHAR(6)) INTO :SYSTEMDATE FROM SYS_CALENDAR.CALENDAR;

SET ERRORTABLE3 = SUBSTR(TABLE_NAME,1,10)||'_ERR1'||SYSTEMDATE;
SET ERRORTABLE4 = SUBSTR(TABLE_NAME,1,10)||'_ERR2'||SYSTEMDATE;

SEL REQUESTTEXT INTO :TABLEDEFN FROM DBC.TABLES WHERE DATABASENAME=:DATABASE_NAME
AND TABLENAME=:TABLE_NAME
AND TABLEKIND='T';

SELECT 'GRANT '||TRIM(B.ACCESSRIGHT_DESC)||' ON '||TRIM(A.DATABASENAME)||'.'||TRIM(A.TABLENAME)||' TO '||
TRIM(A.USERNAME)||CASE WHEN A.GRANTAUTHORITY = 'Y' THEN ' WITH GRANT OPTION;' ELSE ';' END INTO :GRANTDEFN
FROM DBC.ALLRIGHTS A
INNER JOIN ACCESSRIGHT_V2R61_REF B
ON A.ACCESSRIGHT = B.ACCESSRIGHT
WHERE A.TABLENAME=:DATABASE_NAME
AND A.DATABASENAME=:TABLE_NAME;

L1: BEGIN

SEL 1 INTO :STMT FROM SYSADMIN.FASTLOGV WHERE DATABASENAME=:DATABASE_NAME
AND TABLENAME=:TABLE_NAME;

IF ACTIVITY_COUNT = 1 THEN 
SET STMT1 = 'DROP TABLE '||DBNAME||'.'||TBLNAME||';';
--CALL DBC.SYSEXECSQL (STMT1);
--CALL DBC.SYSEXECSQL (TABLEDEFN);
--CALL DBC.SYSEXECSQL (GRANTDEFN);
END IF;

END L1;

L2: BEGIN

SEL REQUESTTEXT INTO :TABLEDEFN FROM DBC.TABLES WHERE DATABASENAME=:DATABASE_NAME
AND TABLENAME=:ERRORTABLE1
AND TABLEKIND='T';

IF ACTIVITY_COUNT = 1 THEN 
SEL 1 INTO :STMT FROM SYSADMIN.FASTLOGV WHERE DATABASENAME=:DATABASE_NAME
AND TABLENAME=:TABLE_NAME;

IF ACTIVITY_COUNT = 1 THEN 
SET STMT1 = 'DROP TABLE '||DBNAME||'.'||ERRORTABLE1||';';
CALL DBC.SYSEXECSQL (STMT1);
LEAVE L2;
END IF;

SET STMT1 = 'RENAME TABLE '||DBNAME||'.'||ERRORTABLE1||' TO '||DBNAME||'.'||ERRORTABLE3||';';
CALL DBC.SYSEXECSQL (STMT1);
END IF;

END L2;

L3: BEGIN

SEL REQUESTTEXT INTO :TABLEDEFN FROM DBC.TABLES WHERE DATABASENAME=:DATABASE_NAME
AND TABLENAME=:ERRORTABLE2
AND TABLEKIND='T';

IF ACTIVITY_COUNT = 1 THEN 
SEL 1 INTO :STMT FROM SYSADMIN.FASTLOGV WHERE DATABASENAME=:DATABASE_NAME
AND TABLENAME=:TABLE_NAME;

IF ACTIVITY_COUNT = 1 THEN 
SET STMT1 = 'DROP TABLE '||DBNAME||'.'||ERRORTABLE2||';';
CALL DBC.SYSEXECSQL (STMT1);
LEAVE L3;
END IF;

SET STMT1 = 'RENAME TABLE '||DBNAME||'.'||ERRORTABLE2||' TO '||DBNAME||'.'||ERRORTABLE4||';';
CALL DBC.SYSEXECSQL (STMT1);
END IF;

END L3;

--DELETE FROM SYSADMIN.FASTLOGV WHERE DATABASENAME=:DATABASE_NAME
--AND TABLENAME=:TABLE_NAME;

--SET RETURNCODE = SQLCODE;

END LMAIN;


REPLACE VIEW MDM.AGE_MIN_MAX
AS
LOCKING ROW FOR ACCESS
SEL A.MINAGE MIN_AGE,B.MAXAGE MAX_AGE, A.COUNTRY FROM
(SELECT
CHI.AV_DESCRIPTION MINAGE, PAR.AV_DESCRIPTION COUNTRY, CHI.AV_CODE AGECODE
FROM
MST_ATTRIBUTE_VALUES PAR, MST_ATTRIBUTE_VALUES_HIERARCHY HI, MST_ATTRIBUTE_VALUES CHI
WHERE
CHI.AV_CODE IN ('MIN') AND
PAR.AV_ID = HI.AV_ID_PARENT AND
HI.AV_ID_CHILD = CHI.AV_ID
) A,
(SELECT
CHI.AV_DESCRIPTION MAXAGE, PAR.AV_DESCRIPTION COUNTRY, CHI.AV_CODE AGECODE
FROM
MST_ATTRIBUTE_VALUES PAR, MST_ATTRIBUTE_VALUES_HIERARCHY HI, MST_ATTRIBUTE_VALUES CHI
WHERE
CHI.AV_CODE IN ('MAX') AND
PAR.AV_ID = HI.AV_ID_PARENT AND
HI.AV_ID_CHILD = CHI.AV_ID
) B WHERE A.COUNTRY=B.COUNTRY;




REPLACE VIEW MDM.ERR_PRSNA_STG_VIEW
AS
LOCKING ROW FOR ACCESS
SEL MKTNG_PGM_NBR,
REGIS_CNSMR_ID_VAL,
ERR1.LOAD_ID FROM
MDM.ERR_PRSNA_STG ERR1
INNER JOIN MDM.MDM_LOAD_CONTROL LOAD
ON ERR1.LOAD_ID = LOAD.LOAD_ID
GROUP BY 1,2,3;



REPLACE VIEW MDM.CNSMR_TSS_CLEANSE_INPUT_TPT
AS
LOCKING ROW FOR ACCESS

SELECT DISTINCT
CAST(
	       COALESCE(TRIM(LEGAL_ENT_NBR),'')
	||'|'||COALESCE(TRIM(CAST(CAST(MKTNG_PGM_NBR AS INTEGER) AS CHAR(20))),'')
	||'|'||COALESCE(TRIM(REGIS_CNSMR_ID_VAL),'')
	||'|'||COALESCE(TRIM(NAME_PREFX_TXT),'')
	||'|'||COALESCE(TRIM(GVN_NAME),'')
	||'|'||COALESCE(TRIM(MID_NAME),'')
	||'|'||COALESCE(TRIM(FAMLY_NAME),'')
	||'|'||COALESCE(TRIM(NAME_SUFFX_TXT),'')
	||'|'||COALESCE(TRIM(FULL_NAME),'')
	||'|'||COALESCE(TRIM(GENDR_IND),'')
	||'|'||COALESCE(CAST(CAST(BRTH_DATE AS DATE FORMAT 'YYYY-MM-DD') AS VARCHAR(10)),'')
	||'|'||COALESCE(TRIM(ADDR_LINE_1_TXT),'')
	||'|'||COALESCE(TRIM(ADDR_LINE_2_TXT),'')
	||'|'||COALESCE(TRIM(ADDR_LINE_3_TXT),'')
	||'|'||COALESCE(TRIM(STRET_NUM),'')
	||'|'||COALESCE(TRIM(STRET_NAME),'')
	||'|'||COALESCE(TRIM(APT_NUM),'')
	||'|'||COALESCE(TRIM(PO_BOX_NUM),'')
	||'|'||COALESCE(TRIM(CITY_NAME),'')
	||'|'||COALESCE(TRIM(POSTL_AREA_CODE),'')
	||'|'||COALESCE(TRIM(TERR_NAME),'')
	||'|'||COALESCE(TRIM(CNTRY_NAME),'')
	||'|'||COALESCE(TRIM(EMAIL_ADDR_TXT_1),'')
	||'|'||COALESCE(TRIM(PHONE_EXTSN_NUM_1),'')
	||'|'||COALESCE(TRIM(FULL_PHONE_NUM_1),'')
	||'|'||COALESCE(TRIM(PHONE_LINE_NBR_1),'')
	||'|'||COALESCE(TRIM(PHONE_AREA_NBR_1),'')
	||'|'||COALESCE(TRIM(PHONE_EXCHG_NBR_1),'')
	||'|'||COALESCE(TRIM(PHONE_CNTRY_NBR_1),'')
	||'|'||COALESCE(TRIM(DPEND_NAME),'')
	||'|'||COALESCE(TRIM(PET_NAME),'')
	||'|'||COALESCE(TRIM(USER_NAME),'')
	||'|'||COALESCE(TRIM(LANG_CODE),'')
	||'|'||COALESCE(TRIM(CAST(CAST(SYS_SOURCE AS INTEGER) AS VARCHAR(20))),'')
	||'|'||COALESCE(TRIM(SYS_NC_TYPE),'')
	||'|'||COALESCE(TRIM(CAST(CAST(SYS_CREATION_DATE AS TIMESTAMP(0)) AS VARCHAR(20))),'')	
	||'|'||COALESCE(TRIM(CAST(PRSNA_REG_DT AS VARCHAR(20))),'')
    AS CHAR(2000)) CNSMR_TSS_CLEANSE_INPUT
  FROM MDM.CNSMR_TSS_CLEANSE_INPUT
;

REPLACE VIEW MDM.CNSMR_TSS_MATCH_INPUT_TPT
AS
LOCKING ROW FOR ACCESS

SELECT DISTINCT
CAST(
	 COALESCE(TRIM(MKTNG_PGM_NBR_CRM          ),'')
	 ||'|'||COALESCE(TRIM(REGIS_CNSMR_ID_VAL_CRM     ),'')
	 ||'|'||COALESCE(TRIM(NAME_PREFX_TXT_CRM         ),'')
	 ||'|'||COALESCE(TRIM(GVN_NAME_CRM               ),'')
	 ||'|'||COALESCE(TRIM(MID_NAME_CRM               ),'')
	 ||'|'||COALESCE(TRIM(FAMLY_NAME_CRM             ),'')
	 ||'|'||COALESCE(TRIM(NAME_SUFFX_TXT_CRM         ),'')
	 ||'|'||COALESCE(TRIM(FULL_NAME_CRM              ),'')
	 ||'|'||COALESCE(TRIM(GENDR_IND_CRM              ),'')
	 ||'|'||COALESCE(TRIM(CAST(CAST(BRTH_DATE_CRM AS DATE FORMAT 'YYYY-MM-DD') AS VARCHAR(10))),'')
	 ||'|'||COALESCE(TRIM(ADDR_LINE_1_TXT_CRM        ),'')
	 ||'|'||COALESCE(TRIM(ADDR_LINE_2_TXT_CRM        ),'')
	 ||'|'||COALESCE(TRIM(ADDR_LINE_3_TXT_CRM        ),'')
	 ||'|'||COALESCE(TRIM(STRET_NUM_CRM              ),'')
	 ||'|'||COALESCE(TRIM(STRET_NAME_CRM             ),'')
	 ||'|'||COALESCE(TRIM(APT_NUM_CRM                ),'')
	 ||'|'||COALESCE(TRIM(PO_BOX_NUM_CRM             ),'')
	 ||'|'||COALESCE(TRIM(CITY_NAME_CRM              ),'')
	 ||'|'||COALESCE(TRIM(POSTL_AREA_CODE_CRM        ),'')
	 ||'|'||COALESCE(TRIM(TERR_CODE_CRM              ),'')
	 ||'|'||COALESCE(TRIM(CNTRY_CODE_CRM             ),'')
	 ||'|'||COALESCE(TRIM(EMAIL_ADDR_TXT_1_CRM       ),'')
	 ||'|'||COALESCE(TRIM(PHONE_EXTSN_NUM_1_CRM      ),'')
	 ||'|'||COALESCE(TRIM(FULL_PHONE_NUM_1_CRM       ),'')
	 ||'|'||COALESCE(TRIM(PHONE_LINE_NBR_1_CRM       ),'')
	 ||'|'||COALESCE(TRIM(PHONE_AREA_NBR_1_CRM       ),'')
	 ||'|'||COALESCE(TRIM(PHONE_EXCHG_NBR_1_CRM      ),'')
	 ||'|'||COALESCE(TRIM(PHONE_CNTRY_NBR_1_CRM      ),'')
	 ||'|'||COALESCE(TRIM(WIN_KEY_CRM      ),'')
	 ||'|'||COALESCE(TRIM(DPEND_NAME_CRM      ),'')
	 ||'|'||COALESCE(TRIM(PET_NAME_CRM      ),'')
	 ||'|'||COALESCE(TRIM(REGIS_PRSNA_ID    ),'')
	 ||'|'||COALESCE(TRIM(LEGAL_ENT_PRSNA_ID        ),'')
         ||'|'||COALESCE(TRIM(HSHLD_PRSNA_ID            ),'')
	 ||'|'||COALESCE(TRIM(LEGAL_ENT_NBR),'')
    AS VARCHAR(2000)) CNSMR_TSS_MATCH_INPUT
  FROM MDM.CNSMR_TSS_MATCH_INPUT 
;

CREATE MULTISET TABLE MDM.TRILLIUM_OUTPUT_DUP1 ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      MKTNG_PGM_NBR INTEGER NOT NULL,
      REGIS_CNSMR_ID_VAL VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC NOT NULL,
      DR_ALIAS_CONTACT VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_FIRST_NAME VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_MIDDLE_NAME VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_LAST_NAME VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_MRMRS VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_NAME_GENER VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_NAME_SUFFIX VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_NAME_GENDER CHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_COUNTRY_NAME VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_REGION_NAME VARCHAR(40) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_CITY_NAME VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_POSTAL_CODE VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_STREET_NAME VARCHAR(60) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_HOUSE_NUMBER1 VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_HOUSE_NUMBER2 VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_POBOX_NUMBER VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_ADDRESS VARCHAR(150) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_ADDRESS2 VARCHAR(150) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_ADDRESS3 VARCHAR(150) CHARACTER SET UNICODE NOT CASESPECIFIC,
      CLEANSED_PHONE_1 VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC,
      CLEANSED_EMAIL_1 VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PR_REV_GROUP VARCHAR(3) CHARACTER SET UNICODE NOT CASESPECIFIC,
      GOUT_MATCH_LEVEL CHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      WINDOW_KEY_01 VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC FORMAT 'X(15)' NOT NULL,
      REFERENCE_HOUSEHOLD_ID VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC,
      REFERENCE_LEGALENTITYKEY VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC,
      REFERENCE_REGISTRATIONKEY VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC,
      LEGAL_ENT_NBR INTEGER,
      BRTH_DATE DATE FORMAT 'YYYY-MM-DD',
      LANG_CODE CHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      CNSMR_USER_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      STATUS VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
      FULL_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DPEND_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PET_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PR_NAME_FORM_01 CHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_ALIAS_ACCOUNT VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC,
      REFERENCE_MATCHED_LEV1_PATTERN VARCHAR(3) CHARACTER SET UNICODE NOT CASESPECIFIC,
      REFERENCE_MATCHED_LEV2_PATTERN VARCHAR(3) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_BUSINESS_NAME VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC,
      EMAIL_IND CHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      REGIS_DATE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC NOT NULL,
      RECORD_IND CHAR(3) CHARACTER SET LATIN NOT CASESPECIFIC,
      RECENT_IND CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC,
      DUP_REGIS_PRSNA_ID VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_TARGET_ID INTEGER,
      SYS_AUTH_ID VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_SOURCE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC DEFAULT 'BACKEND',
      SYS_CREATED_BY VARCHAR(70) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_CREATION_DATE TIMESTAMP(0),
      SYS_ENT_STATE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC CHECK ( SYS_ENT_STATE  IN ('ACTIVE','INACTIVE','NEW','DELETED') ),
      SYS_LAST_MODIFIED_BY VARCHAR(70) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_LAST_MODIFIED_DATE TIMESTAMP(0),
      SYS_NC_TYPE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_ERR_CODE VARCHAR(10000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_ERR_SVRTY VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC CHECK ( SYS_ERR_SVRTY  IN ('SEVERE_ERROR','ERROR','WARNING') ))
PRIMARY INDEX ( MKTNG_PGM_NBR ,REGIS_CNSMR_ID_VAL );

REPLACE VIEW MDM.TRILLIUM_OUTPUT_DUP (                                              
  MKTNG_PGM_NBR                                                                 
 ,REGIS_CNSMR_ID_VAL                                                            
 ,DR_ALIAS_CONTACT                                                              
 ,DR_FIRST_NAME                                                                 
 ,DR_MIDDLE_NAME                                                                
 ,DR_LAST_NAME                                                                  
 ,DR_MRMRS                                                                      
 ,DR_NAME_GENER                                                                 
 ,DR_NAME_SUFFIX                                                                
 ,DR_NAME_GENDER                                                                
 ,DR_COUNTRY_NAME                                                               
 ,DR_REGION_NAME                                                                
 ,DR_CITY_NAME                                                                  
 ,DR_POSTAL_CODE                                                                
 ,DR_STREET_NAME                                                                
 ,DR_HOUSE_NUMBER1                                                              
 ,DR_HOUSE_NUMBER2                                                              
 ,DR_POBOX_NUMBER                                                               
 ,DR_ADDRESS                                                                    
 ,DR_ADDRESS2                                                                   
 ,DR_ADDRESS3                                                                   
 ,CLEANSED_PHONE_1                                                              
 ,CLEANSED_EMAIL_1                                                              
 ,PR_REV_GROUP                                                                  
 ,GOUT_MATCH_LEVEL                                                              
 ,WINDOW_KEY_01                                                                 
 ,REFERENCE_HOUSEHOLD_ID                                                        
 ,REFERENCE_LEGALENTITYKEY                                                      
 ,REFERENCE_REGISTRATIONKEY                                                     
 ,LEGAL_ENT_NBR                                                                 
 ,BRTH_DATE                                                                     
 ,LANG_CODE                                                                     
 ,CNSMR_USER_NAME                                                               
 ,STATUS                                                                        
 ,FULL_NAME                                                                     
 ,DPEND_NAME                                                                    
 ,PET_NAME                                                                      
 ,PR_NAME_FORM_01                                                               
 ,DR_ALIAS_ACCOUNT                                                              
 ,REFERENCE_MATCHED_LEV1_PATTERN                                                
 ,REFERENCE_MATCHED_LEV2_PATTERN                                                
 ,DR_BUSINESS_NAME                                                              
 ,EMAIL_IND       
 ,REGIS_DATE
 ,RECORD_IND
 ,RECENT_IND
  ,DUP_REGIS_PRSNA_ID
 ,SYS_TARGET_ID                                                                 
 ,SYS_AUTH_ID                                                                   
 ,SYS_SOURCE                                                                    
 ,SYS_CREATED_BY                                                                
 ,SYS_CREATION_DATE                                                             
 ,SYS_ENT_STATE                                                                 
 ,SYS_LAST_MODIFIED_BY                                                          
 ,SYS_LAST_MODIFIED_DATE                                                        
 ,SYS_NC_TYPE                                                                   
 ,SYS_ERR_CODE                                                                  
 ,SYS_ERR_SVRTY                                                                 
) AS LOCKING ROW FOR ACCESS SELECT                                              
  MKTNG_PGM_NBR                                                                 
 ,REGIS_CNSMR_ID_VAL                                                            
 ,DR_ALIAS_CONTACT                                                              
 ,DR_FIRST_NAME                                                                 
 ,DR_MIDDLE_NAME                                                                
 ,DR_LAST_NAME                                                                  
 ,DR_MRMRS                                                                      
 ,DR_NAME_GENER                                                                 
 ,DR_NAME_SUFFIX                                                                
 ,DR_NAME_GENDER                                                                
 ,DR_COUNTRY_NAME                                                               
 ,DR_REGION_NAME                                                                
 ,DR_CITY_NAME                                                                  
 ,DR_POSTAL_CODE                                                                
 ,DR_STREET_NAME                                                                
 ,DR_HOUSE_NUMBER1                                                              
 ,DR_HOUSE_NUMBER2                                                              
 ,DR_POBOX_NUMBER                                                               
 ,DR_ADDRESS                                                                    
 ,DR_ADDRESS2                                                                   
 ,DR_ADDRESS3                                                                   
 ,CLEANSED_PHONE_1                                                              
 ,CLEANSED_EMAIL_1                                                              
 ,PR_REV_GROUP                                                                  
 ,GOUT_MATCH_LEVEL                                                              
 ,WINDOW_KEY_01                                                                 
 ,REFERENCE_HOUSEHOLD_ID                                                        
 ,REFERENCE_LEGALENTITYKEY                                                      
 ,REFERENCE_REGISTRATIONKEY                                                     
 ,LEGAL_ENT_NBR                                                                 
 ,BRTH_DATE                                                                     
 ,LANG_CODE                                                                     
 ,CNSMR_USER_NAME                                                               
 ,STATUS                                                                        
 ,FULL_NAME                                                                     
 ,DPEND_NAME                                                                    
 ,PET_NAME                                                                      
 ,PR_NAME_FORM_01                                                               
 ,DR_ALIAS_ACCOUNT                                                              
 ,REFERENCE_MATCHED_LEV1_PATTERN                                                
 ,REFERENCE_MATCHED_LEV2_PATTERN                                                
 ,DR_BUSINESS_NAME                                                              
 ,EMAIL_IND     
 ,REGIS_DATE
 ,RECORD_IND
 ,RECENT_IND 
 ,DUP_REGIS_PRSNA_ID
 ,SYS_TARGET_ID                                                                 
 ,SYS_AUTH_ID                                                                   
 ,SYS_SOURCE                                                                    
 ,SYS_CREATED_BY                                                                
 ,SYS_CREATION_DATE                                                             
 ,SYS_ENT_STATE                                                                 
 ,SYS_LAST_MODIFIED_BY                                                          
 ,SYS_LAST_MODIFIED_DATE                                                        
 ,SYS_NC_TYPE                                                                   
 ,SYS_ERR_CODE                                                                  
 ,SYS_ERR_SVRTY                                                                 
FROM MDM.TRILLIUM_OUTPUT_DUP1;



CREATE SET TABLE MDM.TRILLIUM_MDM_REFERENCE ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      MKTNG_PGM_NBR INTEGER NOT NULL,
      REGIS_CNSMR_ID_VAL VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC NOT NULL,
      REFERENCE_HOUSEHOLD_ID VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC NOT NULL,
      REFERENCE_LEGALENTITYKEY VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC NOT NULL,
      NEW_HOUSEHOLD_ID VARCHAR(16) CHARACTER SET UNICODE NOT CASESPECIFIC,
      NEW_LEGAL_ENTITY_KEY VARCHAR(16) CHARACTER SET UNICODE NOT CASESPECIFIC,
      REFERENCE_REGISTRATIONKEY VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC,
      NEW_REGISTRATION_KEY VARCHAR(16) CHARACTER SET UNICODE NOT CASESPECIFIC,
      LEGAL_ENT_NBR INTEGER,
      SYS_TARGET_ID INTEGER,
      SYS_AUTH_ID VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_SOURCE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC DEFAULT 'BACKEND',
      SYS_CREATED_BY VARCHAR(70) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_CREATION_DATE TIMESTAMP(0),
      SYS_ENT_STATE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC CHECK ( SYS_ENT_STATE  IN ('ACTIVE','INACTIVE','NEW','DELETED') ),
      SYS_LAST_MODIFIED_BY VARCHAR(70) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_LAST_MODIFIED_DATE TIMESTAMP(0),
      SYS_NC_TYPE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_ERR_CODE VARCHAR(10000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_ERR_SVRTY VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC CHECK ( SYS_ERR_SVRTY  IN ('SEVERE_ERROR','ERROR','WARNING') ))
PRIMARY INDEX ( MKTNG_PGM_NBR ,REGIS_CNSMR_ID_VAL );

CREATE SET TABLE MDM.WINKEY_TRIGGER ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      WINDOW_KEY_01 VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC NOT NULL,
      EMAIL_ADDR_TXT VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PHONE VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
      LEGAL_ENT_NBR INTEGER,
      SYS_TARGET_ID INTEGER,
      SYS_AUTH_ID VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_SOURCE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC DEFAULT 'BACKEND',
      SYS_CREATED_BY VARCHAR(70) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_CREATION_DATE TIMESTAMP(0),
      SYS_ENT_STATE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC CHECK ( SYS_ENT_STATE  IN ('ACTIVE','INACTIVE','NEW','DELETED') ),
      SYS_LAST_MODIFIED_BY VARCHAR(70) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_LAST_MODIFIED_DATE TIMESTAMP(0),
      SYS_NC_TYPE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_ERR_CODE VARCHAR(10000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_ERR_SVRTY VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC CHECK ( SYS_ERR_SVRTY  IN ('SEVERE_ERROR','ERROR','WARNING') ))
PRIMARY INDEX ( WINDOW_KEY_01,EMAIL_ADDR_TXT,PHONE,LEGAL_ENT_NBR );

CREATE MULTISET TABLE MDM.TRILLIUM_OUTPUT1 ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      MKTNG_PGM_NBR INTEGER NOT NULL,
      REGIS_CNSMR_ID_VAL VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_ALIAS_CONTACT VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_FIRST_NAME VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_MIDDLE_NAME VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_LAST_NAME VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_MRMRS VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_NAME_GENER VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_NAME_SUFFIX VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_NAME_GENDER CHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_COUNTRY_NAME VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_REGION_NAME VARCHAR(40) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_CITY_NAME VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_POSTAL_CODE VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_STREET_NAME VARCHAR(60) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_HOUSE_NUMBER1 VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_HOUSE_NUMBER2 VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_POBOX_NUMBER VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_ADDRESS VARCHAR(150) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_ADDRESS2 VARCHAR(150) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_ADDRESS3 VARCHAR(150) CHARACTER SET UNICODE NOT CASESPECIFIC,
      CLEANSED_PHONE_1 VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      CLEANSED_EMAIL_1 VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PR_REV_GROUP VARCHAR(10) CHARACTER SET UNICODE NOT CASESPECIFIC,
      GOUT_MATCH_LEVEL CHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      WINDOW_KEY_01 VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC,
      REFERENCE_HOUSEHOLD_ID VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC,
      REFERENCE_LEGALENTITYKEY VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC,
      REFERENCE_REGISTRATIONKEY VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC,
      LEGAL_ENT_NBR INTEGER,
      BRTH_DATE DATE FORMAT 'YYYY-MM-DD',
      LANG_CODE CHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      CNSMR_USER_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      STATUS VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
      FULL_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DPEND_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PET_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PR_NAME_FORM_01 CHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_ALIAS_ACCOUNT VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC,
      REFERENCE_MATCHED_LEV1_PATTERN VARCHAR(3) CHARACTER SET UNICODE NOT CASESPECIFIC,
      REFERENCE_MATCHED_LEV2_PATTERN VARCHAR(3) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_BUSINESS_NAME VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC,
      EMAIL_IND CHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      REGIS_DATE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      RECORD_IND VARCHAR(3) CHARACTER SET LATIN NOT CASESPECIFIC,
      RECENT_IND CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC,
      REGIS_PRSNA_ID INTEGER,
      HH_FLAG VARCHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      LE_FLAG VARCHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_TARGET_ID INTEGER,
      SYS_AUTH_ID VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_SOURCE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC DEFAULT 'BACKEND',
      SYS_CREATED_BY VARCHAR(70) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_CREATION_DATE TIMESTAMP(0),
      SYS_ENT_STATE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC CHECK ( SYS_ENT_STATE  IN ('ACTIVE','INACTIVE','NEW','DELETED') ),
      SYS_LAST_MODIFIED_BY VARCHAR(70) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_LAST_MODIFIED_DATE TIMESTAMP(0),
      SYS_NC_TYPE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_ERR_CODE VARCHAR(10000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_ERR_SVRTY VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC CHECK ( SYS_ERR_SVRTY  IN ('SEVERE_ERROR','ERROR','WARNING') ),
      ADDRESS_CONTACT VARCHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      ADDRESS_SUBSCRPTN VARCHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PHONE_CONTACT VARCHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PHONE_SUBSCRPTN VARCHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      EMAIL_CONTACT VARCHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      EMAIL_SUBSCRPTN VARCHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC)
PRIMARY INDEX ( MKTNG_PGM_NBR ,REGIS_CNSMR_ID_VAL ,SYS_SOURCE );

REPLACE VIEW MDM.TRILLIUM_OUTPUT (                                              
  MKTNG_PGM_NBR                                                                 
 ,REGIS_CNSMR_ID_VAL                                                            
 ,DR_ALIAS_CONTACT                                                              
 ,DR_FIRST_NAME                                                                 
 ,DR_MIDDLE_NAME                                                                
 ,DR_LAST_NAME                                                                  
 ,DR_MRMRS                                                                      
 ,DR_NAME_GENER                                                                 
 ,DR_NAME_SUFFIX                                                                
 ,DR_NAME_GENDER                                                                
 ,DR_COUNTRY_NAME                                                               
 ,DR_REGION_NAME                                                                
 ,DR_CITY_NAME                                                                  
 ,DR_POSTAL_CODE                                                                
 ,DR_STREET_NAME                                                                
 ,DR_HOUSE_NUMBER1                                                              
 ,DR_HOUSE_NUMBER2                                                              
 ,DR_POBOX_NUMBER                                                               
 ,DR_ADDRESS                                                                    
 ,DR_ADDRESS2                                                                   
 ,DR_ADDRESS3                                                            
 ,PR_REV_GROUP                                                                  
 ,GOUT_MATCH_LEVEL                                                              
 ,WINDOW_KEY_01                                                                 
 ,REFERENCE_HOUSEHOLD_ID                                                        
 ,REFERENCE_LEGALENTITYKEY                                                      
 ,REFERENCE_REGISTRATIONKEY                                                     
 ,LEGAL_ENT_NBR                                                                 
 ,BRTH_DATE                                                                     
 ,LANG_CODE                                                                     
 ,CNSMR_USER_NAME                                                               
 ,STATUS                                                                        
 ,FULL_NAME                                                                     
 ,PR_NAME_FORM_01                                                               
 ,DR_ALIAS_ACCOUNT                                                
 ,DR_BUSINESS_NAME 
 ,REGIS_DATE
 ,RECORD_IND
 ,RECENT_IND
 ,REGIS_PRSNA_ID 
 ,HH_FLAG
 ,LE_FLAG
 ,SYS_TARGET_ID                                                                 
 ,SYS_AUTH_ID                                                                   
 ,SYS_SOURCE                                                                    
 ,SYS_CREATED_BY                                                                
 ,SYS_CREATION_DATE                                                             
 ,SYS_ENT_STATE                                                                 
 ,SYS_LAST_MODIFIED_BY                                                          
 ,SYS_LAST_MODIFIED_DATE                                                        
 ,SYS_NC_TYPE                                                                   
 ,SYS_ERR_CODE                                                                  
 ,SYS_ERR_SVRTY              
 ,ADDRESS_CONTACT
 ,ADDRESS_SUBSCRPTN
 ,EMAIL_CONTACT
 ,EMAIL_SUBSCRPTN
 ,PHONE_CONTACT
,PHONE_SUBSCRPTN
) AS LOCKING ROW FOR ACCESS SELECT  
DISTINCT
  MKTNG_PGM_NBR                                                                 
 ,REGIS_CNSMR_ID_VAL                                                            
 ,DR_ALIAS_CONTACT                                                              
 ,DR_FIRST_NAME                                                                 
 ,DR_MIDDLE_NAME                                                                
 ,DR_LAST_NAME                                                                  
 ,DR_MRMRS                                                                      
 ,DR_NAME_GENER                                                                 
 ,DR_NAME_SUFFIX                                                                
 ,DR_NAME_GENDER                                                                
 ,DR_COUNTRY_NAME                                                               
 ,DR_REGION_NAME                                                                
 ,DR_CITY_NAME                                                                  
 ,DR_POSTAL_CODE                                                                
 ,DR_STREET_NAME                                                                
 ,DR_HOUSE_NUMBER1                                                              
 ,DR_HOUSE_NUMBER2                                                              
 ,DR_POBOX_NUMBER                                                               
 ,DR_ADDRESS                                                                    
 ,DR_ADDRESS2                                                                   
 ,DR_ADDRESS3                                                                 
 ,PR_REV_GROUP                                                                  
 ,GOUT_MATCH_LEVEL                                                              
 ,WINDOW_KEY_01                                                                 
 ,REFERENCE_HOUSEHOLD_ID                                                        
 ,REFERENCE_LEGALENTITYKEY                                                      
 ,REFERENCE_REGISTRATIONKEY                                                     
 ,LEGAL_ENT_NBR                                                                 
 ,BRTH_DATE                                                                     
 ,LANG_CODE                                                                     
 ,CNSMR_USER_NAME                                                               
 ,STATUS                                                                        
 ,FULL_NAME                                                                     
 ,PR_NAME_FORM_01                                                               
 ,DR_ALIAS_ACCOUNT                                            
 ,DR_BUSINESS_NAME  
 ,REGIS_DATE
 ,RECORD_IND
 ,RECENT_IND 
 ,REGIS_PRSNA_ID
 ,HH_FLAG
 ,LE_FLAG
 ,SYS_TARGET_ID                                                                 
 ,SYS_AUTH_ID                                                                   
 ,SYS_SOURCE                                                                    
 ,SYS_CREATED_BY                                                                
 ,SYS_CREATION_DATE                                                             
 ,SYS_ENT_STATE                                                                 
 ,SYS_LAST_MODIFIED_BY                                                          
 ,SYS_LAST_MODIFIED_DATE                                                        
 ,SYS_NC_TYPE                                                                   
 ,SYS_ERR_CODE                                                                  
 ,SYS_ERR_SVRTY     
 ,ADDRESS_CONTACT
 ,ADDRESS_SUBSCRPTN
 ,EMAIL_CONTACT
 ,EMAIL_SUBSCRPTN
 ,PHONE_CONTACT
,PHONE_SUBSCRPTN
FROM MDM.TRILLIUM_OUTPUT1;

REPLACE VIEW MDM.CNSMR_TSS_CLEANSE_INPUT_DEDUP
AS
LOCKING ROW FOR ACCESS
SELECT DISTINCT
  PRSNA_STG_1.LEGAL_ENT_NBR
 ,PRSNA_STG_1.MKTNG_PGM_NBR
 ,PRSNA_STG_1.REGIS_CNSMR_ID_VAL
 ,PRSNA_STG_1.NAME_PREFX_TXT
 ,PRSNA_STG_1.GVN_NAME
 ,PRSNA_STG_1.MID_NAME
 ,PRSNA_STG_1.FAMLY_NAME
 ,PRSNA_STG_1.NAME_SUFFX_TXT
 ,PRSNA_STG_1.FULL_NAME
 ,PRSNA_STG_1.GENDR_IND
 ,PRSNA_STG_1.BRTH_DATE
 ,PRSNA_POSTL_ADDR_STG_1.ADDR_LINE_1_TXT
 ,PRSNA_POSTL_ADDR_STG_1.ADDR_LINE_2_TXT
 ,PRSNA_POSTL_ADDR_STG_1.ADDR_LINE_3_TXT
 ,PRSNA_POSTL_ADDR_STG_1.STRET_NUM
 ,PRSNA_POSTL_ADDR_STG_1.STRET_NAME
 ,PRSNA_POSTL_ADDR_STG_1.APT_NUM
 ,PRSNA_POSTL_ADDR_STG_1.PO_BOX_NUM
 ,PRSNA_POSTL_ADDR_STG_1.CITY_NAME
 ,PRSNA_POSTL_ADDR_STG_1.POSTL_AREA_CODE
 ,PRSNA_POSTL_ADDR_STG_1.TERR_NAME TERR_NAME
 ,PRSNA_POSTL_ADDR_STG_1.CNTRY_NAME AS CNTRY_NAME
 ,DPEND_NAME
 ,PET_NAME
 ,'' WIN_KEY
 ,'' SYNC_STATUS
 ,PRSNA_STG_1.CNSMR_USER_NAME AS USER_NAME
 ,PRSNA_STG_1.LANG_CODE
 ,TRIM(CAST(LOAD_ID AS INTEGER)) AS SYS_SOURCE
 ,'UPDATE' SYS_NC_TYPE      
 ,CAST(CAST(CURRENT_TIMESTAMP AS TIMESTAMP(6)) AS VARCHAR(19)) SYS_CREATION_DATE
 ,PRSNA_EMAIL_ADDR_STG_1.EMAIL_ADDR_TXT 
 ,PRSNA_PHONE_STG_1.PHONE_EXTSN_NUM 
 ,PRSNA_PHONE_STG_1.FULL_PHONE_NUM  
 ,PRSNA_PHONE_STG_1.PHONE_LINE_NBR  
 ,PRSNA_PHONE_STG_1.PHONE_AREA_NBR  
 ,PRSNA_PHONE_STG_1.PHONE_EXCHG_NBR 
 ,PRSNA_PHONE_STG_1.PHONE_CNTRY_NBR 
 ,PRSNA_STG_1.REGIS_DATE AS PRSNA_REG_DT
  ,PRSNA_POSTL_ADDR_STG_1.CNTCT_POINT_CATEG_CODE AS ADDRESS_CONTACT
  ,CAST(TRIM(CAST(PRSNA_POSTL_ADDR_STG_1.SUBSCRPTN_OPT_NBR AS INTEGER)) AS VARCHAR(5)) AS ADDRESS_SUBSCRPTN
  ,PRSNA_EMAIL_ADDR_STG_1.CNTCT_POINT_CATEG_CODE EMAIL_CONTACT
  ,CAST(TRIM(CAST(PRSNA_EMAIL_ADDR_STG_1.SUBSCRPTN_OPT_NBR AS INTEGER)) AS VARCHAR(5)) EMAIL_SUBSCRPTN
  ,PRSNA_PHONE_STG_1.CNTCT_POINT_CATEG_CODE PHONE_CONTACT
  ,CAST(TRIM(CAST(PRSNA_PHONE_STG_1.SUBSCRPTN_OPT_NBR AS INTEGER)) AS VARCHAR(5)) PHONE_SUBSCRPTN 
  ,PRSNA_STG_1.SYS_TARGET_ID
  FROM MDM.REGIS_PRSNA PRSNA_STG_1
  
  INNER JOIN (SELECT MAX(LOAD_ID)+1 LOAD_ID FROM ETL_CTRL.LOAD_CONTROL A
  WHERE A.LOAD_TYPE = 'ETL'
    AND A.LOADSTATUS = 'SUCCESS'
    AND A.FORMAT_ID = 1
    AND A.MDM_PROCESS_DESC='COMPLETED'
    AND A.TARGETCNT > 0
 ) B
     ON 1=1

  LEFT OUTER JOIN MDM.PRSNA_POSTL_ADDR_ORIG PRSNA_POSTL_ADDR_STG_1
    ON PRSNA_STG_1.MKTNG_PGM_NBR = PRSNA_POSTL_ADDR_STG_1.MKTNG_PGM_NBR
   AND PRSNA_STG_1.LEGAL_ENT_NBR = PRSNA_POSTL_ADDR_STG_1.LEGAL_ENT_NBR
   AND PRSNA_STG_1.REGIS_PRSNA_ID = PRSNA_POSTL_ADDR_STG_1.REGIS_PRSNA_ID
   AND PRSNA_STG_1.REGIS_CNSMR_ID_VAL = PRSNA_POSTL_ADDR_STG_1.REGIS_CNSMR_ID_VAL

  LEFT OUTER JOIN MDM.PRSNA_PHONE_ORIG PRSNA_PHONE_STG_1
    ON PRSNA_STG_1.MKTNG_PGM_NBR = PRSNA_PHONE_STG_1.MKTNG_PGM_NBR
   AND PRSNA_STG_1.LEGAL_ENT_NBR = PRSNA_PHONE_STG_1.LEGAL_ENT_NBR
   AND PRSNA_STG_1.REGIS_PRSNA_ID = PRSNA_PHONE_STG_1.REGIS_PRSNA_ID
   AND PRSNA_STG_1.REGIS_CNSMR_ID_VAL = PRSNA_PHONE_STG_1.REGIS_CNSMR_ID_VAL
 
  LEFT OUTER JOIN MDM.PRSNA_EMAIL_ADDR_ORIG PRSNA_EMAIL_ADDR_STG_1
    ON PRSNA_STG_1.MKTNG_PGM_NBR = PRSNA_EMAIL_ADDR_STG_1.MKTNG_PGM_NBR
   AND PRSNA_STG_1.LEGAL_ENT_NBR = PRSNA_EMAIL_ADDR_STG_1.LEGAL_ENT_NBR
   AND PRSNA_STG_1.REGIS_PRSNA_ID = PRSNA_EMAIL_ADDR_STG_1.REGIS_PRSNA_ID
   AND PRSNA_STG_1.REGIS_CNSMR_ID_VAL = PRSNA_EMAIL_ADDR_STG_1.REGIS_CNSMR_ID_VAL
   
   LEFT OUTER JOIN MDM.DPEND DPEND_STG_1
     ON PRSNA_STG_1.MKTNG_PGM_NBR = DPEND_STG_1.MKTNG_PGM_NBR
    AND PRSNA_STG_1.REGIS_PRSNA_ID = DPEND_STG_1.REGIS_PRSNA_ID
    AND PRSNA_STG_1.LEGAL_ENT_NBR = DPEND_STG_1.LEGAL_ENT_NBR
 
   LEFT OUTER JOIN MDM.PET PET_STG_1
     ON PRSNA_STG_1.MKTNG_PGM_NBR = PET_STG_1.MKTNG_PGM_NBR
    AND PRSNA_STG_1.REGIS_PRSNA_ID = PET_STG_1.REGIS_PRSNA_ID
    AND PRSNA_STG_1.LEGAL_ENT_NBR = PET_STG_1.LEGAL_ENT_NBR;

CREATE MULTISET TABLE MDM.TRILLIUM_OUTPUT2 ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      MKTNG_PGM_NBR INTEGER NOT NULL,
      REGIS_CNSMR_ID_VAL VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_ALIAS_CONTACT VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_FIRST_NAME VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_MIDDLE_NAME VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_LAST_NAME VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_MRMRS VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_NAME_GENER VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_NAME_SUFFIX VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_NAME_GENDER CHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_COUNTRY_NAME VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_REGION_NAME VARCHAR(40) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_CITY_NAME VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_POSTAL_CODE VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_STREET_NAME VARCHAR(60) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_HOUSE_NUMBER1 VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_HOUSE_NUMBER2 VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_POBOX_NUMBER VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_ADDRESS VARCHAR(150) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_ADDRESS2 VARCHAR(150) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_ADDRESS3 VARCHAR(150) CHARACTER SET UNICODE NOT CASESPECIFIC,
      CLEANSED_PHONE_1 VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      CLEANSED_EMAIL_1 VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PR_REV_GROUP VARCHAR(10) CHARACTER SET UNICODE NOT CASESPECIFIC,
      GOUT_MATCH_LEVEL CHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      WINDOW_KEY_01 VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC,
      REFERENCE_HOUSEHOLD_ID VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC,
      REFERENCE_LEGALENTITYKEY VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC,
      REFERENCE_REGISTRATIONKEY VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC,
      LEGAL_ENT_NBR INTEGER,
      BRTH_DATE DATE FORMAT 'YYYY-MM-DD',
      LANG_CODE CHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      CNSMR_USER_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      STATUS VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
      FULL_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DPEND_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PET_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PR_NAME_FORM_01 CHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_ALIAS_ACCOUNT VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC,
      REFERENCE_MATCHED_LEV1_PATTERN VARCHAR(3) CHARACTER SET UNICODE NOT CASESPECIFIC,
      REFERENCE_MATCHED_LEV2_PATTERN VARCHAR(3) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_BUSINESS_NAME VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC,
      EMAIL_IND CHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      REGIS_DATE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      RECORD_IND VARCHAR(3) CHARACTER SET LATIN NOT CASESPECIFIC,
      RECENT_IND CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC,
      REGIS_PRSNA_ID INTEGER,
      HH_FLAG VARCHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      LE_FLAG VARCHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_TARGET_ID INTEGER,
      SYS_AUTH_ID VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_SOURCE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC DEFAULT 'BACKEND',
      SYS_CREATED_BY VARCHAR(70) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_CREATION_DATE TIMESTAMP(0),
      SYS_ENT_STATE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC CHECK ( SYS_ENT_STATE  IN ('ACTIVE','INACTIVE','NEW','DELETED') ),
      SYS_LAST_MODIFIED_BY VARCHAR(70) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_LAST_MODIFIED_DATE TIMESTAMP(0),
      SYS_NC_TYPE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_ERR_CODE VARCHAR(10000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_ERR_SVRTY VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC CHECK ( SYS_ERR_SVRTY  IN ('SEVERE_ERROR','ERROR','WARNING') ),
      ADDRESS_CONTACT VARCHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      ADDRESS_SUBSCRPTN VARCHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PHONE_CONTACT VARCHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PHONE_SUBSCRPTN VARCHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      EMAIL_CONTACT VARCHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      EMAIL_SUBSCRPTN VARCHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC)
PRIMARY INDEX ( MKTNG_PGM_NBR ,REGIS_CNSMR_ID_VAL ,SYS_SOURCE );


CREATE SET TABLE MDM.RPT_ADDR_QLTY ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      MKTNG_PGM_NBR INTEGER NOT NULL,
      LEGAL_ENT_NBR INTEGER,
      ACTV_RGSTRTN_CNT INTEGER,
      SUCCESS_PCT INTEGER,
      LCLTY_FAIL_PCT INTEGER,
      UNK_ADDR_PCT INTEGER,
      MULTIPLE_ADDR_MATCH_PCT INTEGER,
      CITY_TERR_FAIL_PCT INTEGER,
      STREET_NAME_FAIL_PCT INTEGER,
      HOUSE_NO_FAIL_PCT INTEGER,
      STREET_COMPT_FAIL_PCT INTEGER,
      MULTIPLE_STREET_ADDR_PCT INTEGER,      
      SYS_TARGET_ID INTEGER,
      SYS_AUTH_ID VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_SOURCE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC DEFAULT 'BACKEND',
      SYS_CREATED_BY VARCHAR(70) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_CREATION_DATE TIMESTAMP(0),
      SYS_ENT_STATE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC CHECK ( SYS_ENT_STATE  IN ('ACTIVE','INACTIVE','NEW','DELETED') ),
      SYS_LAST_MODIFIED_BY VARCHAR(70) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_LAST_MODIFIED_DATE TIMESTAMP(0),
      SYS_NC_TYPE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_ERR_CODE VARCHAR(10000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_ERR_SVRTY VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC CHECK ( SYS_ERR_SVRTY  IN ('SEVERE_ERROR','ERROR','WARNING') ))
PRIMARY INDEX ( MKTNG_PGM_NBR ,LEGAL_ENT_NBR );


REPLACE VIEW MDM.LOAD_CONTROL (
 LOAD_ID                       
,SOURCE_ID                     
,FORMAT_ID                     
,FILERECEIVEDTS                
,LOADSTARTTS                   
,LOADENDTS                     
,SOURCECNT                     
,TARGETCNT                     
,REJECTSCNT                    
,LOADSTATUS                    
,FILENAME                      
,FAILEDREASON                  
,ERROR_LIMIT                   
,MDM_PROCESS_DESC              
,LOAD_TYPE   
) AS LOCKING ROW FOR ACCESS SELECT
 LOAD_ID                       
,SOURCE_ID                     
,FORMAT_ID                     
,FILERECEIVEDTS                
,LOADSTARTTS                   
,LOADENDTS                     
,SOURCECNT                     
,TARGETCNT                     
,REJECTSCNT                    
,LOADSTATUS                    
,FILENAME                      
,FAILEDREASON                  
,ERROR_LIMIT                   
,MDM_PROCESS_DESC              
,LOAD_TYPE                         
FROM ETL_CTRL.LOAD_CONTROL;

REPLACE VIEW MDM.PRSNA_STG_CNT (                                             
  MKTNG_PGM_NBR                                                                 
 ,REGIS_CNSMR_ID_VAL                                                            
 ,USER_NAME                                                                     
 ,PRSNA_REG_DT                                                                  
 ,NAME_PREFX_TXT                                                                
 ,GVN_NAME                                                                      
 ,MID_NAME                                                                      
 ,FAMLY_NAME                                                                    
 ,NAME_SUFFX_TXT                                                                
 ,FULL_NAME                                                                     
 ,GENDR_IND                                                                     
 ,BRTH_DATE                                                                     
 ,LANG_CODE                                                                     
 ,PRSNA_STTUS_CODE                                                              
,CNTRY_NAME
 ,LOAD_ID                                                                       
 ,LOAD_TS                                                                       
 ,MDM_LOAD_IND                                                                  
 ,RECORD_IND                                                                    
) AS 

SELECT   MKTNG_PGM_NBR                                                                 
 ,REGIS_CNSMR_ID_VAL                                                            
 ,USER_NAME                                                                     
 ,PRSNA_REG_DT                                                                  
 ,NAME_PREFX_TXT                                                                
 ,GVN_NAME                                                                      
 ,MID_NAME                                                                      
 ,FAMLY_NAME                                                                    
 ,NAME_SUFFX_TXT                                                                
 ,FULL_NAME                                                                     
 ,GENDR_IND                                                                     
 ,BRTH_DATE                                                                     
 ,LANG_CODE                                                                     
 ,PRSNA_STTUS_CODE   
 ,CNTRY_NAME                                                           
 ,LOAD_ID                                                                       
 ,LOAD_TS                                                                       
 ,MDM_LOAD_IND                                                                  
 ,RECORD_IND   FROM ICRM_STAGE.PRSNA_STG


CREATE MULTISET TABLE MDM.CNSMR_DATA_RTNTN ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      REGIS_PRSNA_ID INTEGER NOT NULL,
      MKTNG_PGM_NBR INTEGER NOT NULL,
      LEGAL_ENT_NBR SMALLINT NOT NULL,
      REGIS_CNSMR_ID_VAL VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC NOT NULL,
      STATUS VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      CNSMR_ACTN_ID INTEGER ,      
      SALES_TRANX_NBR SMALLINT,
      TRANS_DATA VARCHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PII_DATA VARCHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      MISC_DATA VARCHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      REGIS_DATA VARCHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      REGIS_STATUS VARCHAR(10) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PII_STATUS VARCHAR(10) CHARACTER SET UNICODE NOT CASESPECIFIC,
      TRANS_STATUS VARCHAR(10) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_SOURCE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_TARGET_ID INTEGER,
      SYS_AUTH_ID VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_CREATED_BY VARCHAR(70) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_CREATION_DATE TIMESTAMP(0),
      SYS_LAST_MODIFIED_DATE TIMESTAMP(0),
      SYS_ENT_STATE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_LAST_MODIFIED_BY VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_NC_TYPE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_ERR_CODE VARCHAR(100) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_ERR_SVRTY VARCHAR(30) CHARACTER SET LATIN NOT CASESPECIFIC)
PRIMARY INDEX CNSMR_DATA_RTNTN_NUPI ( REGIS_PRSNA_ID ,MKTNG_PGM_NBR ,
LEGAL_ENT_NBR,REGIS_CNSMR_ID_VAL );

CREATE MULTISET TABLE MDM.DATA_RTNTN_REF ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      MKTNG_PGM_NBR INTEGER NOT NULL,
      LEGAL_ENT_NBR SMALLINT NOT NULL,
      TRANS_DATA INTEGER NOT NULL,
      OPERATION_TRANS VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      TRANS_STATUS VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PII_DATA INTEGER NOT NULL,
      OPERATION_PII VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PII_STATUS VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      STATUS INTEGER NOT NULL,
      STATUS_CHANGE VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      MISC_DATA INTEGER NOT NULL,
      OPERATION_MISC VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      USE_CASE VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_SOURCE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_TARGET_ID INTEGER,
      SYS_AUTH_ID VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_CREATED_BY VARCHAR(70) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_CREATION_DATE TIMESTAMP(0),
      SYS_LAST_MODIFIED_DATE TIMESTAMP(0),
      SYS_ENT_STATE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_LAST_MODIFIED_BY VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_NC_TYPE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_ERR_CODE VARCHAR(100) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_ERR_SVRTY VARCHAR(30) CHARACTER SET LATIN NOT CASESPECIFIC)
PRIMARY INDEX DATA_RTNTN_REF_NUPI ( MKTNG_PGM_NBR ,
LEGAL_ENT_NBR,USE_CASE );

REPLACE VIEW MDM.LH_REALIZED_LEAD
(
COMMUNICATION_ID              ,
COMM_PLAN_ID                  ,
REGIS_PRSNA_ID                ,
HSHLD_PRSNA_ID                ,
MATCHD_CNSMR_PRSNA_ID         ,
SELECTION_DTTM                ,
SELECTION_GROUP_ORD           ,
REFERENCE_TXT                 ,
LAST_CONTACT_DTTM             ,
TERMINATION_DTTM              ,
RECYCLED_DTTM                 ,
BUNDLE_LEAD_CNT               ,
LAST_REMINDER_DTTM            ,
LEAF_SEGMENT_ID               ,
FIRST_STEP_ID                 ,
FIRST_MESSAGE_ID              ,
CASCADE_IND                   ,
CREATE_DTTM                   ,
SEGMENT_RUN_ID                ,
DISPOSITION_CD                ,
SEED_IND                      
)
AS LOCKING ROW FOR ACCESS SELECT
COMMUNICATION_ID              ,
COMM_PLAN_ID                  ,
REGIS_PRSNA_ID                ,
HSHLD_PRSNA_ID                ,
MATCHD_CNSMR_PRSNA_ID         ,
SELECTION_DTTM                ,
SELECTION_GROUP_ORD           ,
REFERENCE_TXT                 ,
LAST_CONTACT_DTTM             ,
TERMINATION_DTTM              ,
RECYCLED_DTTM                 ,
BUNDLE_LEAD_CNT               ,
LAST_REMINDER_DTTM            ,
LEAF_SEGMENT_ID               ,
FIRST_STEP_ID                 ,
FIRST_MESSAGE_ID              ,
CASCADE_IND                   ,
CREATE_DTTM                   ,
SEGMENT_RUN_ID                ,
DISPOSITION_CD                ,
SEED_IND                      
FROM
TRM_LEAD_DB.LH_REALIZED_LEAD
;

CREATE MULTISET TABLE MDM.PRSNA_TRT_WORK ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      REGIS_PRSNA_ID INTEGER NOT NULL,
      MKTNG_PGM_NBR INTEGER NOT NULL,
      TRT_NBR SMALLINT NOT NULL,
      PRSNA_TRT_SEQ_NBR SMALLINT NOT NULL DEFAULT 1 ,
      LEGAL_ENT_NBR SMALLINT NOT NULL,
      PRSNA_TRT_DATE DATE FORMAT 'YYYY-MM-DD',
      PRSNA_TRT_TXT VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_SOURCE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_TARGET_ID INTEGER,
      SYS_AUTH_ID VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_CREATED_BY VARCHAR(70) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_CREATION_DATE TIMESTAMP(0),
      SYS_LAST_MODIFIED_DATE TIMESTAMP(0),
      SYS_ENT_STATE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_LAST_MODIFIED_BY VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_NC_TYPE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_ERR_CODE VARCHAR(100) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_ERR_SVRTY VARCHAR(30) CHARACTER SET LATIN NOT CASESPECIFIC)
PRIMARY INDEX PRSNA_TRT_NUPI ( LEGAL_ENT_NBR,MKTNG_PGM_NBR,REGIS_PRSNA_ID,TRT_NBR,PRSNA_TRT_SEQ_NBR,PRSNA_TRT_TXT );

CREATE MULTISET TABLE MDM.PRSNA_DPLCT ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      DUP_REGIS_PRSNA_ID INTEGER NOT NULL,
      MKTNG_PGM_NBR INTEGER NOT NULL,
      LEGAL_ENT_NBR INTEGER NOT NULL,
      REFERENCE_REGISTRATIONKEY INTEGER NOT NULL )
PRIMARY INDEX PRSNA_DPLCT_NUPI ( LEGAL_ENT_NBR,MKTNG_PGM_NBR,DUP_REGIS_PRSNA_ID,REFERENCE_REGISTRATIONKEY );

CREATE SET TABLE MDM.CNSMR_TSS_MATCH_INPUT1 ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      LEGAL_ENT_NBR SMALLINT NOT NULL,
      MKTNG_PGM_NBR INTEGER NOT NULL,
      REGIS_CNSMR_ID_VAL VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC NOT NULL,
      NAME_PREFX_TXT CHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      GVN_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      MID_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      FAMLY_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      NAME_SUFFX_TXT CHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      FULL_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      GENDR_IND CHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      BRTH_DATE DATE FORMAT 'YY/MM/DD',
      ADDR_LINE_1_TXT VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      ADDR_LINE_2_TXT VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      ADDR_LINE_3_TXT VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      STRET_NUM VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
      STRET_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      APT_NUM VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PO_BOX_NUM VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
      CITY_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      POSTL_AREA_CODE VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
      TERR_CODE VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      CNTRY_CODE VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DPEND_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PET_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      WIN_KEY VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYNC_STATUS VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      CNSMR_USER_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      LANG_CODE CHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_SOURCE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_NC_TYPE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_CREATION_DATE TIMESTAMP(0),
      EMAIL_ADDR_TXT VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PHONE_EXTSN_NUM VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      FULL_PHONE_NUM VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      PHONE_LINE_NBR INTEGER,
      PHONE_AREA_NBR INTEGER,
      PHONE_EXCHG_NBR INTEGER,
      PHONE_CNTRY_NBR INTEGER,
      REGIS_PRSNA_ID INTEGER,
      LEGAL_ENT_PRSNA_ID INTEGER,
      HSHLD_PRSNA_ID INTEGER)
PRIMARY INDEX ( LEGAL_ENT_NBR ,MKTNG_PGM_NBR ,REGIS_CNSMR_ID_VAL  );


CREATE SET TABLE MDM.CNTR_INTG_XREF ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      LEGAL_ENT_NBR SMALLINT NOT NULL,
      MKTNG_PGM_NBR INTEGER NOT NULL,
      REGIS_CNSMR_ID_VAL VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC NOT NULL,
      MATCHD_REGIS_PRSNA_ID INTEGER NOT NULL,
      MATCHD_CNSMR_PRSNA_ID INTEGER NOT NULL,
      MATCHD_HSHLD_PRSNA_ID INTEGER NOT NULL,
      SYS_SOURCE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_TARGET_ID INTEGER,
      SYS_AUTH_ID VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_CREATED_BY VARCHAR(70) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_CREATION_DATE TIMESTAMP(0),
      SYS_LAST_MODIFIED_DATE TIMESTAMP(0),
      SYS_ENT_STATE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_LAST_MODIFIED_BY VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_NC_TYPE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_ERR_CODE VARCHAR(100) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_ERR_SVRTY VARCHAR(30) CHARACTER SET LATIN NOT CASESPECIFIC)
PRIMARY INDEX ( LEGAL_ENT_NBR ,MKTNG_PGM_NBR ,REGIS_CNSMR_ID_VAL );

REPLACE VIEW MDM.MDM_LOAD_CONTROL_CI
AS
LOCKING ROW FOR ACCESS
SELECT DISTINCT A.LOAD_ID FROM ETL_CTRL.LOAD_CONTROL A
INNER JOIN (SEL LOAD_ID FROM ICRM_STAGE.PRSNA_STG
WHERE RECORD_IND='M'
GROUP BY 1
) A1
ON A1.LOAD_ID=A.LOAD_ID
LEFT OUTER JOIN ETL_CTRL.LOAD_CONTROL B
ON A.LOAD_ID = B.LOAD_ID
AND B.LOAD_TYPE = 'MDM'
WHERE
(B.LOAD_ID IS NULL OR B.LOADSTATUS = 'RESTART')
AND A.LOAD_TYPE = 'ETL'
AND A.LOADSTATUS = 'SUCCESS'
AND A.FORMAT_ID IN  (1, 99)
AND A.MDM_PROCESS_DESC='COMPLETED'
AND A.TARGETCNT > 0
AND A.SOURCE_ID IN (1001, 1003, 1078, 9909, 9960, 9932, 9905, 
9912, 9910, 9913, 1033, 1039, 1040, 1090, 1043, 9953, 9959, 
9933, 9962, 9963, 9964, 9965, 9968,9973,9975,9976,9979,9980,
9985, 9967,9907, 9992, 9938, 1058, 1059, 1060, 1061,1062,
1099, 1114, 1074, 1075, 1118, 1017,1021,1038,1044,1078, 
1112, 1113, 1084, 1018, 1097,1049,1092, 1070, 1071, 1072, 1073, 1087,
1101,1102,1098, 1026, 1047, 1041, 1048
);

CREATE MULTISET TABLE MDM.RPT_PROFILE_CHANGES,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      
      LEGAL_ENT_NBR SMALLINT NOT NULL,
      MKTNG_PGM_NBR INTEGER NOT NULL,
      USER_ID VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      MONTH_START VARCHAR(8) CHARACTER SET LATIN NOT CASESPECIFIC,
      PROFILE_CHANGE_NBR INTEGER,
      SYS_SOURCE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_TARGET_ID INTEGER,
      SYS_AUTH_ID VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_CREATED_BY VARCHAR(70) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_CREATION_DATE TIMESTAMP(0),
      SYS_LAST_MODIFIED_DATE TIMESTAMP(0),
      SYS_ENT_STATE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_LAST_MODIFIED_BY VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_NC_TYPE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_ERR_CODE VARCHAR(100) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_ERR_SVRTY VARCHAR(30) CHARACTER SET LATIN NOT CASESPECIFIC)
PRIMARY INDEX RPT_PROFILE_CHANGES_NUPI ( MKTNG_PGM_NBR ,
LEGAL_ENT_NBR );

REPLACE VIEW MDM.V_RPT_PROFILE_CHANGES
 AS
 LOCKING ROW FOR ACCESS
 SELECT 
       LEGAL_ENT_NBR,
      MKTNG_PGM_NBR,
      USER_ID,
      MONTH_START,
      PROFILE_CHANGE_NBR
 FROM
 MDM.RPT_PROFILE_CHANGES;

CREATE SET TABLE MDM.TSS_ERR_PRCS ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      LEGAL_ENT_NBR SMALLINT NOT NULL,
      MKTNG_PGM_NBR INTEGER NOT NULL,
      REGIS_CNSMR_ID_VAL VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC NOT NULL,
      REGIS_PRSNA_ID INTEGER,
      HSHLD_PRSNA_ID INTEGER,
      MATCHD_CNSMR_PRSNA_ID INTEGER,
      SYS_SOURCE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC)
PRIMARY INDEX ( REGIS_PRSNA_ID );

CREATE SET TABLE MDM.load_err_prcs ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      LOAD_ID INTEGER NOT NULL)
PRIMARY INDEX ( LOAD_ID );

REPLACE VIEW MDM.ERR_PRSNA_STG_VIEW1
as
LOCKING ROW FOR ACCESS
SEL MKTNG_PGM_NBR,
REGIS_CNSMR_ID_VAL FROM
MDM.ERR_PRSNA_STG ERR1
INNER JOIN MDM.MDM_LOAD_CONTROL1 LOAD
ON ERR1.LOAD_ID = LOAD.LOAD_ID
GROUP BY 1,2;

REPLACE VIEW MDM.MDM_LOAD_CONTROL1
AS
LOCKING ROW FOR ACCESS
SELECT DISTINCT A.LOAD_ID ,
CASE WHEN A.SOURCE_ID IN (1001,1003)
THEN 1
ELSE 2
END AS PRIORITY_NO,
A.SOURCE_ID
FROM ETL_CTRL.LOAD_CONTROL A
WHERE LOAD_ID IN (SEL LOAD_ID FROM LOAD_ERR_PRCS);

CREATE SET TABLE MDM.tss_load_prcs ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      MKTNG_PGM_NBR INTEGER NOT NULL,
      REGIS_CNSMR_ID_VAL VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC NOT NULL)
PRIMARY INDEX ( MKTNG_PGM_NBR ,REGIS_CNSMR_ID_VAL );

CREATE MULTISET TABLE MDM.REF_DATA_IGNORE ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      SYS_SOURCE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC)
PRIMARY INDEX ( SYS_SOURCE );

CREATE SET TABLE MDM.REF_EMAIL_DATA_IGNORE ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      EMAIL_ADDR_TXT VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC)
PRIMARY INDEX ( EMAIL_ADDR_TXT );

CREATE SET TABLE MDM.REF_PHONE_DATA_IGNORE ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      FULL_PHONE_NUM VARCHAR(100) CHARACTER SET LATIN NOT CASESPECIFIC)
PRIMARY INDEX ( FULL_PHONE_NUM );

CREATE SET TABLE MDM.REF_POSTL_DATA_IGNORE ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      WINKEY VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC)
PRIMARY INDEX ( WINKEY );

CREATE MULTISET TABLE MDM.TSS_LOAD_ORIG ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      LOAD_ID INTEGER)
PRIMARY INDEX ( LOAD_ID );

CREATE SET TABLE MDM_SIT.TSS_PRSNA_IDS ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      REGIS_CNSMR_ID_VAL VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC NOT NULL,
      MKTNG_PGM_NBR INTEGER NOT NULL,
      LEGAL_ENT_NBR INTEGER NOT NULL,
      REGIS_PRSNA_ID INTEGER NOT NULL,
      MATCHD_CNSMR_PRSNA_ID INTEGER NOT NULL,
      HSHLD_PRSNA_ID INTEGER NOT NULL,
      SYS_SOURCE VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC NOT NULL)
PRIMARY INDEX TSS_PRSNA_IDS_NUPI ( REGIS_CNSMR_ID_VAL ,MKTNG_PGM_NBR,SYS_SOURCE );

CREATE MULTISET TABLE MDM.ERR_PRSNA_STG ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      MKTNG_PGM_NBR INTEGER NOT NULL,
      REGIS_CNSMR_ID_VAL VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC NOT NULL,
      USER_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PRSNA_REG_DT TIMESTAMP(0),
      NAME_PREFX_TXT CHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      GVN_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      MID_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      FAMLY_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      NAME_SUFFX_TXT CHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      FULL_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      GENDR_IND CHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      BRTH_DATE DATE FORMAT 'YY/MM/DD',
      LANG_CODE CHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PRSNA_STTUS_CODE CHAR(2) CHARACTER SET UNICODE NOT CASESPECIFIC,
      RECORD_IND CHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      LYLTY_PGM_NBR SMALLINT,
      LYLTY_ACCT_NUM VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      LOYALTY_ACCT_ID VARCHAR(100) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'LOYALTY_ACCT_ID',
      LOAD_ID DECIMAL(18,0),
      LOAD_TS TIMESTAMP(0),
      MDM_LOAD_IND CHAR(2) CHARACTER SET UNICODE NOT CASESPECIFIC,
      WIN_KEY VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYNC_STATUS VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      CNTRY_CODE CHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_TARGET_ID INTEGER,
      SYS_AUTH_ID VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_SOURCE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC DEFAULT 'BackEnd',
      SYS_ERROR_ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY
           (START WITH 1 
            INCREMENT BY 2 
            MINVALUE 1 
            MAXVALUE 2147483647 
            NO CYCLE),
      SYS_ERROR_TIME TIMESTAMP(0),
      SYS_ERR_SVRTY VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC CHECK ( SYS_ERR_SVRTY  IN ('SEVERE_ERROR','ERROR','WARNING') ),
      SYS_NC_TYPE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_DOCUMENT VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC DEFAULT 'PRSNA_STG',
      SYS_LOAD_ID VARCHAR(32) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_WORKFLOW_ID VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_ERR_CODE VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC)
PRIMARY INDEX ( MKTNG_PGM_NBR ,REGIS_CNSMR_ID_VAL );

CREATE MULTISET TABLE MDM.ERR_PRSNA_STG_CURR_LOAD ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      MKTNG_PGM_NBR INTEGER NOT NULL,
      REGIS_CNSMR_ID_VAL VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC NOT NULL,
      USER_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PRSNA_REG_DT TIMESTAMP(0),
      NAME_PREFX_TXT CHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      GVN_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      MID_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      FAMLY_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      NAME_SUFFX_TXT CHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      FULL_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      GENDR_IND CHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      BRTH_DATE DATE FORMAT 'YY/MM/DD',
      LANG_CODE CHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PRSNA_STTUS_CODE CHAR(2) CHARACTER SET UNICODE NOT CASESPECIFIC,
      RECORD_IND CHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      LYLTY_PGM_NBR SMALLINT,
      LYLTY_ACCT_NUM VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      LOYALTY_ACCT_ID VARCHAR(100) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'LOYALTY_ACCT_ID',
      LOAD_ID DECIMAL(18,0),
      LOAD_TS TIMESTAMP(0),
      MDM_LOAD_IND CHAR(2) CHARACTER SET UNICODE NOT CASESPECIFIC,
      WIN_KEY VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYNC_STATUS VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      CNTRY_CODE CHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_TARGET_ID INTEGER,
      SYS_AUTH_ID VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_SOURCE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC DEFAULT 'BackEnd',
      SYS_ERROR_ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY
           (START WITH 1 
            INCREMENT BY 2 
            MINVALUE 1 
            MAXVALUE 2147483647 
            NO CYCLE),
      SYS_ERROR_TIME TIMESTAMP(0),
      SYS_ERR_SVRTY VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC CHECK ( SYS_ERR_SVRTY  IN ('SEVERE_ERROR','ERROR','WARNING') ),
      SYS_NC_TYPE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_DOCUMENT VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC DEFAULT 'PRSNA_STG',
      SYS_LOAD_ID VARCHAR(32) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_WORKFLOW_ID VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_ERR_CODE VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC)
PRIMARY INDEX ERR_PRSNA_STG_PK ( MKTNG_PGM_NBR ,REGIS_CNSMR_ID_VAL );

CREATE MULTISET TABLE MDM.PRSNA_DPLCT_MERGE ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      DUP_REGIS_PRSNA_ID INTEGER NOT NULL,
      MKTNG_PGM_NBR INTEGER NOT NULL,
      LEGAL_ENT_NBR INTEGER NOT NULL,
      REFERENCE_REGISTRATIONKEY INTEGER NOT NULL )
PRIMARY INDEX PRSNA_DPLCT_MERGE_NUPI ( LEGAL_ENT_NBR,MKTNG_PGM_NBR,DUP_REGIS_PRSNA_ID,REFERENCE_REGISTRATIONKEY );

CREATE MULTISET GLOBAL TEMPORARY TABLE MDM.TSS_MATCH_INPUT_TEMP ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      LEGAL_ENT_NBR SMALLINT NOT NULL,
      MKTNG_PGM_NBR INTEGER NOT NULL,
      EMAIL_ADDR_TXT VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PHONE_EXTSN_NUM VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      FULL_PHONE_NUM VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      PHONE_LINE_NBR INTEGER,
      PHONE_AREA_NBR INTEGER,
      PHONE_EXCHG_NBR INTEGER,
      PHONE_CNTRY_NBR INTEGER,
      REGIS_PRSNA_ID INTEGER)
PRIMARY INDEX ( REGIS_PRSNA_ID );ODE NOT CASESPECIFIC,
      DR_ADDRESS3 VARCHAR(150) CHARACTER SET UNICODE NOT CASESPECIFIC,
      CLEANSED_PHONE_1 VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC,
      CLEANSED_EMAIL_1 VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PR_REV_GROUP VARCHAR(3) CHARACTER SET UNICODE NOT CASESPECIFIC,
      GOUT_MATCH_LEVEL CHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      WINDOW_KEY_01 VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC FORMAT 'X(15)' NOT NULL,
      REFERENCE_HOUSEHOLD_ID VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC,
      REFERENCE_LEGALENTITYKEY VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC,
      REFERENCE_REGISTRATIONKEY VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC,
      LEGAL_ENT_NBR INTEGER,
      BRTH_DATE DATE FORMAT 'YYYY-MM-DD',
      LANG_CODE CHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      CNSMR_USER_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      STATUS VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
      FULL_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DPEND_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PET_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PR_NAME_FORM_01 CHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_ALIAS_ACCOUNT VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC,
      REFERENCE_MATCHED_LEV1_PATTERN VARCHAR(3) CHARACTER SET UNICODE NOT CASESPECIFIC,
      REFERENCE_MATCHED_LEV2_PATTERN VARCHAR(3) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_BUSINESS_NAME VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC,
      EMAIL_IND CHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      REGIS_DATE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC NOT NULL,
      RECORD_IND CHAR(3) CHARACTER SET LATIN NOT CASESPECIFIC,
      RECENT_IND CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC,
      DUP_REGIS_PRSNA_ID VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_TARGET_ID INTEGER,
      SYS_AUTH_ID VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_SOURCE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC DEFAULT 'BACKEND',
      SYS_CREATED_BY VARCHAR(70) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_CREATION_DATE TIMESTAMP(0),
      SYS_ENT_STATE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC CHECK ( SYS_ENT_STATE  IN ('ACTIVE','INACTIVE','NEW','DELETED') ),
      SYS_LAST_MODIFIED_BY VARCHAR(70) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_LAST_MODIFIED_DATE TIMESTAMP(0),
      SYS_NC_TYPE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_ERR_CODE VARCHAR(10000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_ERR_SVRTY VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC CHECK ( SYS_ERR_SVRTY  IN ('SEVERE_ERROR','ERROR','WARNING') ))
PRIMARY INDEX ( MKTNG_PGM_NBR ,REGIS_CNSMR_ID_VAL );

REPLACE VIEW MDM.TRILLIUM_OUTPUT_DUP (                                              
  MKTNG_PGM_NBR                                                                 
 ,REGIS_CNSMR_ID_VAL                                                            
 ,DR_ALIAS_CONTACT                                                              
 ,DR_FIRST_NAME                                                                 
 ,DR_MIDDLE_NAME                                                                
 ,DR_LAST_NAME                                                                  
 ,DR_MRMRS                                                                      
 ,DR_NAME_GENER                                                                 
 ,DR_NAME_SUFFIX                                                                
 ,DR_NAME_GENDER                                                                
 ,DR_COUNTRY_NAME                                                               
 ,DR_REGION_NAME                                                                
 ,DR_CITY_NAME                                                                  
 ,DR_POSTAL_CODE                                                                
 ,DR_STREET_NAME                                                                
 ,DR_HOUSE_NUMBER1                                                              
 ,DR_HOUSE_NUMBER2                                                              
 ,DR_POBOX_NUMBER                                                               
 ,DR_ADDRESS                                                                    
 ,DR_ADDRESS2                                                                   
 ,DR_ADDRESS3                                                                   
 ,CLEANSED_PHONE_1                                                              
 ,CLEANSED_EMAIL_1                                                              
 ,PR_REV_GROUP                                                                  
 ,GOUT_MATCH_LEVEL                                                              
 ,WINDOW_KEY_01                                                                 
 ,REFERENCE_HOUSEHOLD_ID                                                        
 ,REFERENCE_LEGALENTITYKEY                                                      
 ,REFERENCE_REGISTRATIONKEY                                                     
 ,LEGAL_ENT_NBR                                                                 
 ,BRTH_DATE                                                                     
 ,LANG_CODE                                                                     
 ,CNSMR_USER_NAME                                                               
 ,STATUS                                                                        
 ,FULL_NAME                                                                     
 ,DPEND_NAME                                                                    
 ,PET_NAME                                                                      
 ,PR_NAME_FORM_01                                                               
 ,DR_ALIAS_ACCOUNT                                                              
 ,REFERENCE_MATCHED_LEV1_PATTERN                                                
 ,REFERENCE_MATCHED_LEV2_PATTERN                                                
 ,DR_BUSINESS_NAME                                                              
 ,EMAIL_IND       
 ,REGIS_DATE
 ,RECORD_IND
 ,RECENT_IND
  ,DUP_REGIS_PRSNA_ID
 ,SYS_TARGET_ID                                                                 
 ,SYS_AUTH_ID                                                                   
 ,SYS_SOURCE                                                                    
 ,SYS_CREATED_BY                                                                
 ,SYS_CREATION_DATE                                                             
 ,SYS_ENT_STATE                                                                 
 ,SYS_LAST_MODIFIED_BY                                                          
 ,SYS_LAST_MODIFIED_DATE                                                        
 ,SYS_NC_TYPE                                                                   
 ,SYS_ERR_CODE                                                                  
 ,SYS_ERR_SVRTY                                                                 
) AS LOCKING ROW FOR ACCESS SELECT                                              
  MKTNG_PGM_NBR                                                                 
 ,REGIS_CNSMR_ID_VAL                                                            
 ,DR_ALIAS_CONTACT                                                              
 ,DR_FIRST_NAME                                                                 
 ,DR_MIDDLE_NAME                                                                
 ,DR_LAST_NAME                                                                  
 ,DR_MRMRS                                                                      
 ,DR_NAME_GENER                                                                 
 ,DR_NAME_SUFFIX                                                                
 ,DR_NAME_GENDER                                                                
 ,DR_COUNTRY_NAME                                                               
 ,DR_REGION_NAME                                                                
 ,DR_CITY_NAME                                                                  
 ,DR_POSTAL_CODE                                                                
 ,DR_STREET_NAME                                                                
 ,DR_HOUSE_NUMBER1                                                              
 ,DR_HOUSE_NUMBER2                                                              
 ,DR_POBOX_NUMBER                                                               
 ,DR_ADDRESS                                                                    
 ,DR_ADDRESS2                                                                   
 ,DR_ADDRESS3                                                                   
 ,CLEANSED_PHONE_1                                                              
 ,CLEANSED_EMAIL_1                                                              
 ,PR_REV_GROUP                                                                  
 ,GOUT_MATCH_LEVEL                                                              
 ,WINDOW_KEY_01                                                                 
 ,REFERENCE_HOUSEHOLD_ID                                                        
 ,REFERENCE_LEGALENTITYKEY                                                      
 ,REFERENCE_REGISTRATIONKEY                                                     
 ,LEGAL_ENT_NBR                                                                 
 ,BRTH_DATE                                                                     
 ,LANG_CODE                                                                     
 ,CNSMR_USER_NAME                                                               
 ,STATUS                                                                        
 ,FULL_NAME                                                                     
 ,DPEND_NAME                                                                    
 ,PET_NAME                                                                      
 ,PR_NAME_FORM_01                                                               
 ,DR_ALIAS_ACCOUNT                                                              
 ,REFERENCE_MATCHED_LEV1_PATTERN                                                
 ,REFERENCE_MATCHED_LEV2_PATTERN                                                
 ,DR_BUSINESS_NAME                                                              
 ,EMAIL_IND     
 ,REGIS_DATE
 ,RECORD_IND
 ,RECENT_IND 
 ,DUP_REGIS_PRSNA_ID
 ,SYS_TARGET_ID                                                                 
 ,SYS_AUTH_ID                                                                   
 ,SYS_SOURCE                                                                    
 ,SYS_CREATED_BY                                                                
 ,SYS_CREATION_DATE                                                             
 ,SYS_ENT_STATE                                                                 
 ,SYS_LAST_MODIFIED_BY                                                          
 ,SYS_LAST_MODIFIED_DATE                                                        
 ,SYS_NC_TYPE                                                                   
 ,SYS_ERR_CODE                                                                  
 ,SYS_ERR_SVRTY                                                                 
FROM MDM.TRILLIUM_OUTPUT_DUP1;



CREATE SET TABLE MDM.TRILLIUM_MDM_REFERENCE ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      MKTNG_PGM_NBR INTEGER NOT NULL,
      REGIS_CNSMR_ID_VAL VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC NOT NULL,
      REFERENCE_HOUSEHOLD_ID VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC NOT NULL,
      REFERENCE_LEGALENTITYKEY VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC NOT NULL,
      NEW_HOUSEHOLD_ID VARCHAR(16) CHARACTER SET UNICODE NOT CASESPECIFIC,
      NEW_LEGAL_ENTITY_KEY VARCHAR(16) CHARACTER SET UNICODE NOT CASESPECIFIC,
      REFERENCE_REGISTRATIONKEY VARCHAR(50) CHARACTER SET UNICODE NOT CASESPECIFIC,
      NEW_REGISTRATION_KEY VARCHAR(16) CHARACTER SET UNICODE NOT CASESPECIFIC,
      LEGAL_ENT_NBR INTEGER,
      SYS_TARGET_ID INTEGER,
      SYS_AUTH_ID VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_SOURCE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC DEFAULT 'BACKEND',
      SYS_CREATED_BY VARCHAR(70) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_CREATION_DATE TIMESTAMP(0),
      SYS_ENT_STATE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC CHECK ( SYS_ENT_STATE  IN ('ACTIVE','INACTIVE','NEW','DELETED') ),
      SYS_LAST_MODIFIED_BY VARCHAR(70) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_LAST_MODIFIED_DATE TIMESTAMP(0),
      SYS_NC_TYPE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_ERR_CODE VARCHAR(10000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_ERR_SVRTY VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC CHECK ( SYS_ERR_SVRTY  IN ('SEVERE_ERROR','ERROR','WARNING') ))
PRIMARY INDEX ( MKTNG_PGM_NBR ,REGIS_CNSMR_ID_VAL );

CREATE SET TABLE MDM.WINKEY_TRIGGER ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      WINDOW_KEY_01 VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC NOT NULL,
      EMAIL_ADDR_TXT VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PHONE VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
      LEGAL_ENT_NBR INTEGER,
      SYS_TARGET_ID INTEGER,
      SYS_AUTH_ID VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_SOURCE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC DEFAULT 'BACKEND',
      SYS_CREATED_BY VARCHAR(70) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_CREATION_DATE TIMESTAMP(0),
      SYS_ENT_STATE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC CHECK ( SYS_ENT_STATE  IN ('ACTIVE','INACTIVE','NEW','DELETED') ),
      SYS_LAST_MODIFIED_BY VARCHAR(70) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_LAST_MODIFIED_DATE TIMESTAMP(0),
      SYS_NC_TYPE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_ERR_CODE VARCHAR(10000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_ERR_SVRTY VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC CHECK ( SYS_ERR_SVRTY  IN ('SEVERE_ERROR','ERROR','WARNING') ))
PRIMARY INDEX ( WINDOW_KEY_01,EMAIL_ADDR_TXT,PHONE,LEGAL_ENT_NBR );

CREATE MULTISET TABLE MDM.TRILLIUM_OUTPUT1 ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      MKTNG_PGM_NBR INTEGER NOT NULL,
      REGIS_CNSMR_ID_VAL VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_ALIAS_CONTACT VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_FIRST_NAME VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_MIDDLE_NAME VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_LAST_NAME VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_MRMRS VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_NAME_GENER VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      DR_NAME_SUFFIX VARCHAR(15) CHARACTER SET UNICODE NOT CA
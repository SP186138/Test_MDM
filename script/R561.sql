.logon $TDPID/$TDUSER,$TDPWD


.SET ERROROUT STDOUT;
.SET SESSION CHARSET 'UTF8';

DATABASE MDM;
.GOTO $Step


.LABEL L0
CREATE SET TABLE DEPLOY_WORK.ERR_PRSNA_STG_561 ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      MKTNG_PGM_NBR INTEGER,
	  REGIS_PRSNA_ID INTEGER NOT NULL,
      REGIS_CNSMR_ID_VAL VARCHAR(1000) CHARACTER SET LATIN NOT CASESPECIFIC,
      USER_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PRSNA_REG_DT TIMESTAMP(0),
      GVN_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      MID_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      FAMLY_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      NAME_SUFFX_TXT CHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      FULL_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      GENDR_IND CHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      BRTH_DATE DATE FORMAT 'YY/MM/DD',
      LANG_CODE CHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PRSNA_STTUS_CODE CHAR(2) CHARACTER SET UNICODE NOT CASESPECIFIC,
      RECORD_IND CHAR(1) CHARACTER SET UNICODE NOT CASESPECIFIC,
      LOAD_ID DECIMAL(18,0),
      LOAD_TS TIMESTAMP(0),
      MDM_LOAD_IND CHAR(2) CHARACTER SET UNICODE NOT CASESPECIFIC,
      WIN_KEY VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYNC_STATUS VARCHAR(15) CHARACTER SET UNICODE NOT CASESPECIFIC,
      CNTRY_CODE CHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_TARGET_ID INTEGER,
      SYS_AUTH_ID VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_SOURCE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC DEFAULT 'BackEnd',
      SYS_ERROR_ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY
           (START WITH 1 
            INCREMENT BY 2 
            MINVALUE 1 
            MAXVALUE 2147483647 
            NO CYCLE),
      SYS_ERROR_TIME TIMESTAMP(0),
      SYS_ERR_SVRTY VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC CHECK ( SYS_ERR_SVRTY  IN ('SEVERE_ERROR','ERROR','WARNING') ),
      SYS_NC_TYPE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_DOCUMENT VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC DEFAULT 'PRSNA_STG',
      SYS_LOAD_ID VARCHAR(32) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_WORKFLOW_ID VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_ERR_CODE VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      LYLTY_ACCT_NUM VARCHAR(100) CHARACTER SET LATIN NOT CASESPECIFIC,
      LYLTY_PGM_NBR SMALLINT,
      NAME_PREFX_TXT VARCHAR(40) CHARACTER SET UNICODE NOT CASESPECIFIC)
PRIMARY INDEX ( MKTNG_PGM_NBR ,REGIS_CNSMR_ID_VAL );

.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
	  
.LABEL L1
CREATE SET TABLE DEPLOY_WORK.REGIS_PRSNA_DUP1 ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      REGIS_PRSNA_ID INTEGER NOT NULL,
      MKTNG_PGM_NBR INTEGER NOT NULL,
      LEGAL_ENT_NBR SMALLINT COMPRESS (1 ,2 ,3 ,4 ,5 ,6 ,7 ,8 ,10 ,11 ,12 ,13 ,14 ,15 ,16 ,17 ,18 ,19 ),
      MATCHD_CNSMR_PRSNA_ID INTEGER COMPRESS (8876033 ,7470081 ,11273730 ,11419141 ,12412935 ,874504 ,1236488 ,11578889 ,6616841 ,7828234 ,11503370 ,12932107 ,10912013 ,11266061 ,20398352 ,11579664 ,7310610 ,12424722 ,12705554 ,11417107 ,7831059 ,10765845 ,7004694 ,12391447 ,7762199 ,11419161 ,7560985 ,11391769 ,1630745 ,12425242 ,8099611 ,8797212 ,13045277 ,13046046 ,10634270 ,7245088 ,22455840 ,12396065 ,10778914 ,8809251 ,11403045 ,11266086 ,12733992 ,10645288 ,11417129 ,823593 ,11578921 ,11093034 ,1174827 ,11025196 ,13022252 ,6609964 ,7828014 ,12511535 ,9660720 ,11579696 ,10802481 ,12391475 ,10061107 ,398645 ,27128373 ,1878326 ,12384566 ,12459831 ,10634040 ,20970553 ,11418683 ,10069819 ,13554747 ,8695102 ,11266110 ,11417151 ,11031615 ,13200192 ,9096770 ,10919235 ,12636995 ,11586377 ,7344714 ,2837834 ,12402763 ,12405579 ,34124 ,10803020 ,2903121 ,12650066 ,11345234 ,10941011 ,10753620 ,12448854 ,12483928 ,11419482 ,13287258 ,11358299 ,11578972 ,12465248 ,22456161 ,9096801 ,11535971 ,22032484 ,12396133 ,1649255 ,11417192 ,12733800 ,12417128 ,13171560 ,12876137 ,11266409 ,3121514 ,11624043 ,11011180 ,2837612 ,13014380 ,8516205 ,373102 ,10633839 ,11358320 ,20038256 ,12416625 ,13581426 ,7434873 ,11410042 ,10758779 ,381307 ,8731260 ,12685180 ,10803068 ,10189694 ,12473471 ,11093376 ,9840769 ,7484547 ,12435587 ,9865092 ,11093125 ,8438662 ,8787848 ,10801288 ,11801482 ,12453003 ,9325708 ,12416656 ,11568784 ,11420305 ,11421329 ,9193106 ,12684946 ,13221524 ,11474581 ,7301527 ,11456407 ,11405210 ,13051292 ,13200284 ,9485212 ,4902557 ,11265693 ,8777631 ,20658336 ,2746786 ,11420581 ,12752037 ,9018790 ,11560871 ,10776231 ,11031465 ,10801321 ,381353 ,6047658 ,12456619 ,11345323 ,7770795 ,1630635 ,6793132 ,12637101 ,33285038 ,2837679 ,12546484 ,11456438 ,9725367 ,8083130 ,10205114 ,10843324 ,11417277 ,9660606 ,11461567 ,22032065 ,11093185 ,11259841 ,381377 ,25501634 ,11093442 ,11031492 ,12935108 ,11419077 ,1397701 ,10835909 ,12699845 ,6374342 ,11356360 ,10771144 ,12379080 ,11363529 ,7434953 ,3534025 ,8865226 ,13432012 ,6621645 ,12865229 ,11583693 ,11615697 ,12544979 ,12693971 ,8787156 ,403412 ,11265748 ,25503446 ,7357400 ,945624 ,1895897 ,11103194 ,11259866 ,11092958 ,2837726 ,11112670 ,10939871 ,11419360 ,12546529 ,1563105 ,10232803 ,10061027 ,6047717 ,11418854 ,7364070 ,12890090 ,22455533 ,11583725 ,12709613 ,12134894 ,1900014 ,11045872 ,10072560 ,9660657 ,11064306 ,11558644 ,7180789 ,8055542 ,11228919 ,12620281 ,5168635 ,7364093 ,11111677 ,3121406 ,12655871 ,8898559 ),
      REFERAL_MKTNG_PGM_NBR VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC COMPRESS ' ',
      TRM_LEAD_KEY VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ' ',
      NAME_PREFX_TXT VARCHAR(32) CHARACTER SET UNICODE NOT CASESPECIFIC COMPRESS ('MISS','MR','MS','Mr.','Mrs','Mrs.','Ms.'),
      GVN_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC COMPRESS ' ',
      MID_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC COMPRESS ' ',
      FAMLY_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC COMPRESS ' ',
      NAME_SUFFX_TXT CHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC COMPRESS '     ',
      FULL_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC COMPRESS ('lili','123','duL','Jenny','bb','twrteq','lele','duNB','baobao','DFS','tiantian','DFD','yangxinhua','?? ??','dd','Cat','kaka','MEIMEI','Lucy','BOB','ZHANGYUELING','moon','geg','??? ??','111','TONGXINYU','IOW','ZHENGHUIQIAN','mm','MAMA','Eko','JAMES','JIANGZHI','aa','queena','betty','ZHAOJIN','baoabo','haoxuebin','JIANGMINGJIE','null','qq','ALLIE','ZHANGYUN','HUIMLIE','11111','duM','JHU','df','yangyuanju','renee xu','Clare','nency','hanhan','kelly','nancy','liangjie','JHUI','shenm','candy','Linda','bella','rong','zhaoying','you.yi.xiang','you.qiao.min','zhanghui','A','??? ???','sdf','zhu','angelina','A3','CHENLINGIN','Text3','ZHAGNMI12','nn','a123456','ww','darywen','?????? ???','DSF','ivy','morrow','xiaozhu','SFDS','a5','a6','a4','ADHF','PIEE','ZHAGNFAN','zou.yan.yun','APPLE','lily','vivian','? ??','YOYO','ff','iris_yi0609','1111','zhuweitian','psl','BDR','a1','a2','a7','a9','VDR','151','A8','lilywu','yangjianjun','HGYU','IWEE','YUANYUN','li529184456','QINQIN','gechunlin','zhangjingjing','cand99','QZW','duanyu251342','jessica','sarah','JUI','kevin','Michelle','linlanfang','mashizeng','mi1982','yangshuo0231','lulu','JOY','baby','YY','?? ???','NJU','tiffany','tracy','asdasd','mengmeng','fgd','bu','KJI','maiyuxia','KJIO','JHJK','MAOLILI','tgb','ZHENGHUIQIANG'),
      GENDR_IND CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC NOT NULL DEFAULT 'U' COMPRESS (' ','F','M','U'),
      BRTH_DATE DATE FORMAT 'yyyy-mm-dd' COMPRESS (DATE '1979-05-28',DATE '1986-09-28',DATE '1988-01-28',DATE '1970-09-28',DATE '1972-01-28',DATE '1973-06-28',DATE '1980-10-28',DATE '1982-02-28',DATE '1974-11-28',DATE '1976-03-28',DATE '1983-07-28',DATE '1986-04-28',DATE '1968-12-28',DATE '1970-04-28',DATE '1977-08-28',DATE '1984-12-28',DATE '1973-01-28',DATE '1980-05-28',DATE '1987-09-28',DATE '1971-09-28',DATE '1974-06-28',DATE '1981-10-28',DATE '1983-02-28',DATE '1968-07-28',DATE '1975-11-28',DATE '1977-03-28',DATE '1984-07-28',DATE '1987-04-28',DATE '1969-12-28',DATE '1971-04-28',DATE '1978-08-28',DATE '1985-12-28',DATE '1972-09-28',DATE '1974-01-28',DATE '1981-05-28',DATE '1988-09-28',DATE '1975-06-28',DATE '1982-10-28',DATE '1984-02-28',DATE '1969-07-28',DATE '1976-11-28',DATE '1978-03-28',DATE '1985-07-28',DATE '1979-08-28',DATE '1986-12-28',DATE '1988-04-28',DATE '1970-12-28',DATE '1972-04-28',DATE '1973-09-28',DATE '1975-01-28',DATE '1982-05-28',DATE '1967-10-28',DATE '1976-06-28',DATE '1983-10-28',DATE '1985-02-28',DATE '1979-03-28',DATE '1986-07-28',DATE '1970-07-28',DATE '1977-11-28',DATE '1973-04-28',DATE '1980-08-28',DATE '1987-12-28',DATE '1971-12-28',DATE '1974-09-28',DATE '1976-01-28',DATE '1983-05-28',DATE '1986-02-28',DATE '1968-10-28',DATE '1970-02-28',DATE '1977-06-28',DATE '1984-10-28',DATE '1980-03-28',DATE '1987-07-28',DATE '1971-07-28',DATE '1978-11-28',DATE '1972-12-28',DATE '1974-04-28',DATE '1981-08-28',DATE '1965-08-28',DATE '1975-09-28',DATE '1977-01-28',DATE '1984-05-28',DATE '1987-02-28',DATE '1969-10-28',DATE '1971-02-28',DATE '1978-06-28',DATE '1985-10-28',DATE '1979-11-28',DATE '1981-03-28',DATE '1988-07-28',DATE '1972-07-28',DATE '1973-12-28',DATE '1975-04-28',DATE '1982-08-28',DATE '1969-05-28',DATE '1976-09-28',DATE '1978-01-28',DATE '1985-05-28',DATE '1979-06-28',DATE '1986-10-28',DATE '1970-10-28',DATE '1972-02-28',DATE '1900-01-01',DATE '1980-01-01',DATE '1973-07-28',DATE '1980-11-28',DATE '1982-03-28',DATE '1974-12-28',DATE '1976-04-28',DATE '1983-08-28',DATE '1979-01-28',DATE '1986-05-28',DATE '1970-05-28',DATE '1977-09-28',DATE '1973-02-28',DATE '1980-06-28',DATE '1987-10-28',DATE '1971-10-28',DATE '1901-01-01',DATE '1981-01-01',DATE '1974-07-28',DATE '1981-11-28',DATE '1983-03-28',DATE '1968-08-28',DATE '1975-12-28',DATE '1977-04-28',DATE '1984-08-28',DATE '1980-01-28',DATE '1987-05-28',DATE '1971-05-28',DATE '1978-09-28',DATE '1972-10-28',DATE '1974-02-28',DATE '1981-06-28',DATE '1982-01-01',DATE '1975-07-28',DATE '1982-11-28',DATE '1984-03-28',DATE '1969-08-28',DATE '1976-12-28',DATE '1978-04-28',DATE '1985-08-28',DATE '1979-09-28',DATE '1981-01-28',DATE '1988-05-28',DATE '1972-05-28',DATE '1973-10-28',DATE '1975-02-28',DATE '1982-06-28',DATE '1969-03-28',DATE '1976-07-28',DATE '1983-11-28',DATE '1985-03-28',DATE '1979-04-28',DATE '1986-08-28',DATE '1970-08-28',DATE '1977-12-28',DATE '1973-05-28',DATE '1980-09-28',DATE '1982-01-28',DATE '1964-09-28',DATE '1974-10-28',DATE '1976-02-28',DATE '1983-06-28',DATE '1986-03-28',DATE '1968-11-28',DATE '1970-03-28',DATE '1977-07-28',DATE '1984-11-28',DATE '1980-04-28',DATE '1987-08-28',DATE '1971-08-28',DATE '1978-12-28',DATE '1974-05-28',DATE '1981-09-28',DATE '1983-01-28',DATE '1975-10-28',DATE '1977-02-28',DATE '1984-06-28',DATE '1987-03-28',DATE '1969-11-28',DATE '1971-03-28',DATE '1978-07-28',DATE '1985-11-28',DATE '1979-12-28',DATE '1981-04-28',DATE '1988-08-28',DATE '1972-08-28',DATE '1975-05-28',DATE '1982-09-28',DATE '1984-01-28',DATE '1969-06-28',DATE '1976-10-28',DATE '1978-02-28',DATE '1985-06-28',DATE '1970-01-01',DATE '1979-07-28',DATE '1986-11-28',DATE '1988-03-28',DATE '1970-11-28',DATE '1972-03-28',DATE '1973-08-28',DATE '1980-12-28',DATE '1982-04-28',DATE '1967-09-28',DATE '1969-01-28',DATE '1976-05-28',DATE '1983-09-28',DATE '1985-01-28',DATE '1979-02-28',DATE '1986-06-28',DATE '1970-06-28',DATE '1977-10-28',DATE '1973-03-28',DATE '1980-07-28',DATE '1987-11-28',DATE '1971-11-28',DATE '1974-08-28',DATE '1981-12-28',DATE '1983-04-28',DATE '1986-01-28',DATE '1968-09-28',DATE '1970-01-28',DATE '1977-05-28',DATE '1984-09-28',DATE '1980-02-28',DATE '1987-06-28',DATE '1971-06-28',DATE '1978-10-28',DATE '1972-11-28',DATE '1974-03-28',DATE '1981-07-28',DATE '1966-12-28',DATE '1975-08-28',DATE '1982-12-28',DATE '1984-04-28',DATE '1987-01-28',DATE '1969-09-28',DATE '1971-01-28',DATE '1978-05-28',DATE '1985-09-28',DATE '1979-10-28',DATE '1981-02-28',DATE '1988-06-28',DATE '1972-06-28',DATE '1959-03-28',DATE '1973-11-28',DATE '1975-03-28',DATE '1982-07-28',DATE '1948-10-17',DATE '1969-04-28',DATE '1976-08-28',DATE '1983-12-28',DATE '1985-04-28',DATE '9999-12-31'),
      LANG_CODE CHAR(5) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ('     ','CH   ','CHN  ','EN   ','ES   ','FR   ','HI   ','JA   ','KO   ','PT   ','TC   ','TH   ','TR   ','TW   ','UNKN ','ZH   ','ZN   ','en_CA','en_US','es_AR','es_CL','es_CO','es_CR','es_GT','es_HN','es_MX','es_NI','es_PA','es_PE','es_SV','es_US','es_VE','fr_CA','pt_BR'),
      CNTRY_CODE CHAR(5) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ('     ','?    ','ARG  ','AU   ','AUS  ','BRA  ','CAN  ','CHL  ','CHN  ','COL  ','CRI  ','ECU  ','GTM  ','HKG  ','HND  ','IN   ','IND  ','JAP  ','JPN  ','KOR  ','KR   ','LAO  ','LAT  ','MEX  ','MYS  ','NIC  ','NZL  ','PAN  ','PER  ','PHL  ','SGP  ','SLV  ','THA  ','TUR  ','TWN  ','URY  ','USA  ','VEN  '),
      EMAIL_SUPRSN_IND CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS 'Y',
      POSTL_SUPRSN_IND CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS 'Y',
      PHONE_SUPRSN_IND CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS 'Y',
      SOCL_NETWK_SUPRSN_IND CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ' ',
      NATIONAL_ID_NBR VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ,
      CNSMR_SENTIMENT VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC COMPRESS ,
      LATST_ACTVY_DATE DATE FORMAT 'yyyy-mm-dd' COMPRESS (DATE '2011-05-28',DATE '2011-05-29',DATE '2011-05-30',DATE '2011-05-31',DATE '2008-11-02',DATE '2012-05-28',DATE '2011-08-01',DATE '2011-08-02',DATE '2011-08-03',DATE '2011-08-04',DATE '2011-08-05',DATE '2011-08-06',DATE '2007-01-03',DATE '2011-08-07',DATE '2011-08-08',DATE '2011-08-09',DATE '2011-08-10',DATE '2011-08-11',DATE '2011-08-12',DATE '2011-08-14',DATE '2011-08-15',DATE '2011-08-16',DATE '2011-08-17',DATE '2011-08-18',DATE '2011-08-19',DATE '2011-08-20',DATE '2011-08-21',DATE '2011-08-22',DATE '2011-08-23',DATE '2011-08-24',DATE '2011-08-25',DATE '2011-08-26',DATE '2011-08-27',DATE '2011-08-29',DATE '2011-08-30',DATE '2009-06-09',DATE '2009-06-11',DATE '2009-06-12',DATE '2010-06-02',DATE '2010-06-03',DATE '2010-06-05',DATE '2010-11-17',DATE '2011-11-01',DATE '2010-06-06',DATE '2010-06-07',DATE '2011-11-03',DATE '2010-06-08',DATE '2011-11-04',DATE '2011-11-05',DATE '2010-06-10',DATE '2011-11-06',DATE '2012-03-23',DATE '2010-06-12',DATE '2011-11-08',DATE '2010-01-01',DATE '2009-06-30',DATE '2010-06-17',DATE '2011-06-01',DATE '2010-06-18',DATE '2011-06-02',DATE '2011-06-03',DATE '2011-06-04',DATE '2011-11-16',DATE '2011-06-05',DATE '2011-11-17',DATE '2011-06-06',DATE '2011-11-18',DATE '2011-06-07',DATE '2011-11-19',DATE '2011-06-08',DATE '2011-11-20',DATE '2009-01-29',DATE '2011-06-10',DATE '2011-11-23',DATE '2011-06-12',DATE '2011-06-13',DATE '2011-06-14',DATE '2011-06-15',DATE '2007-04-24',DATE '2011-06-17',DATE '2011-06-18',DATE '2011-06-19',DATE '2011-01-08',DATE '2011-06-20',DATE '2011-06-21',DATE '2011-06-22',DATE '2011-06-23',DATE '2011-06-24',DATE '2011-06-27',DATE '2011-06-28',DATE '1900-01-01',DATE '2012-06-13',DATE '2011-06-29',DATE '2011-01-20',DATE '2012-01-05',DATE '2012-01-06',DATE '2012-01-07',DATE '2012-01-08',DATE '2012-06-20',DATE '2012-01-09',DATE '2011-01-27',DATE '2011-01-28',DATE '2012-01-13',DATE '2012-01-18',DATE '2011-09-02',DATE '2012-01-19',DATE '2011-09-03',DATE '2012-01-20',DATE '2011-09-04',DATE '2012-01-21',DATE '2008-12-09',DATE '2011-09-05',DATE '2012-01-22',DATE '2008-12-10',DATE '2011-09-06',DATE '2012-01-23',DATE '2008-12-11',DATE '2011-09-07',DATE '2012-01-24',DATE '2008-12-12',DATE '2011-09-08',DATE '2012-01-25',DATE '2012-01-26',DATE '2010-09-26',DATE '2012-01-27',DATE '2011-09-11',DATE '2012-01-28',DATE '2011-09-12',DATE '2012-01-29',DATE '2011-09-13',DATE '2012-01-30',DATE '2011-09-14',DATE '2012-01-31',DATE '2011-09-15',DATE '2011-09-16',DATE '2011-04-05',DATE '2011-04-06',DATE '2011-04-07',DATE '2011-04-12',DATE '2009-07-01',DATE '2011-04-13',DATE '2008-07-18',DATE '2009-07-02',DATE '2011-04-14',DATE '2009-07-03',DATE '2009-07-04',DATE '2009-12-16',DATE '2011-09-28',DATE '2009-07-05',DATE '2009-12-17',DATE '2009-07-06',DATE '2009-12-18',DATE '2011-04-18',DATE '2009-07-07',DATE '2009-12-19',DATE '2009-07-08',DATE '2009-12-20',DATE '2009-07-09',DATE '2009-12-21',DATE '2011-04-21',DATE '2009-07-10',DATE '2011-04-22',DATE '2009-07-11',DATE '2009-12-23',DATE '2012-09-20',DATE '2009-07-12',DATE '2009-07-13',DATE '2009-12-25',DATE '2009-07-14',DATE '2009-12-26',DATE '2009-12-29',DATE '2011-12-02',DATE '2012-04-19',DATE '2009-07-23',DATE '2011-12-03',DATE '2011-12-05',DATE '2011-12-06',DATE '2012-04-25',DATE '2011-07-03',DATE '2011-07-05',DATE '2011-07-06',DATE '2011-07-07',DATE '2011-07-08',DATE '2011-07-09',DATE '2011-07-11',DATE '2008-10-19',DATE '2011-12-29',DATE '2011-12-30',DATE '2007-05-27',DATE '2011-02-07',DATE '2011-02-11',DATE '2011-07-24',DATE '2011-07-25',DATE '2011-02-14',DATE '2012-02-01',DATE '2012-02-02',DATE '2012-02-03',DATE '2012-02-04',DATE '2012-02-05',DATE '2012-02-06',DATE '2012-02-07',DATE '2012-07-19',DATE '2011-02-23',DATE '2012-02-08',DATE '2012-07-20',DATE '2011-02-24',DATE '2012-02-09',DATE '2012-02-10',DATE '2012-07-23',DATE '2012-07-25',DATE '2012-07-26',DATE '2012-07-27',DATE '2012-02-16',DATE '2012-02-17',DATE '2012-02-20',DATE '2010-10-20',DATE '2012-02-22',DATE '2012-02-23',DATE '2012-02-24',DATE '2012-02-25',DATE '2012-02-26',DATE '2012-02-27',DATE '2011-10-11',DATE '2012-02-28',DATE '2011-10-13',DATE '2011-10-14',DATE '2011-05-03',DATE '2011-10-15',DATE '2011-10-16',DATE '2011-10-17',DATE '2011-05-06',DATE '2011-10-18',DATE '2011-10-19',DATE '2010-05-24',DATE '2010-05-25',DATE '2010-05-26',DATE '2011-05-10',DATE '2010-05-27',DATE '2010-05-28',DATE '2011-10-24',DATE '2010-05-29',DATE '2010-05-30',DATE '2010-05-31',DATE '2011-10-27',DATE '2011-05-17',DATE '2011-05-18',DATE '2011-05-19',DATE '2011-05-22',DATE '2011-05-23',DATE '2011-05-24',DATE '2012-05-09',DATE '2011-05-25',DATE '2012-05-10',DATE '2011-05-26',DATE '2011-05-27'),
      REGIS_CNSMR_ID_VAL VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC NOT NULL COMPRESS ('921634','543935','432156','433095','432076','717817','1472235','817658','479871','633792','431700','432305','483230','152337','489931','154798','598052','153869','430447','462376','696725','574881','586740','476109','586461','446139','1350154','452953','689916','1344842','1344791','1331895','1349798','1352172','1323930','1331232','474918','575046','582784','453217','1430773','613556','613921','2123770','613019','1976230','1208806','2073153','522909','471756','745199','750152','446329','618456','654491','714258','436913','469562','170699','632846','1339137','451880','2106339','190282','1095757','595656','531180','1545884','473077','326788','230351','442321','645228','665980','456880','554164','838618','472775','567224','691147','682246','462419','687149','701785','953394','480467','753894','549082','623670','1033451','441098','876820','474243','572708','601536','726369','1104143','435259','565512','749648','447577','438159','624044','589556','462683','761708','624637','711508','435370','580589','844624','458998','643748','466763','1033082','558866','542823','757642','610644','1356436','665891','470420','458268','581530','673669','627124','814079','474213','757304','553774','1396289','656413','637327','758481','691157','686179','465318','481174','621744','590705','612369','722685','844646','542301','592997','550825','546637','617951','610202','606312','532377','937806','1343105','1326900','985476','1355509','725489','754327','1133795','2077863','726244','447613','694537','1341665','685341','623624','752843','691219','746610','635772','1307053','1360492','1347603','1306482','441945','1332496','1340934','691889','435776','531218','556630','507008','627156','631135','745746','635685','1353785','1332373','495505','577322','441572','1160697','1609757','1266562','449039','436743','549596','684418','1132592','612379','2062668','1421099','1944482','743574','1588760','502895','495379','603914','1880651','465270','571973','503587','1690800','745826','685836','2008373','464238','546163','594861','595275','621209','131974','236368','633809','1360515','612958','468718','10706640','1723178','1722629','1722580','1726985','1723287','1727241','11008507','226271','11329237','922496','922926','922915','922740','922769','923077','922681','922763','922937','922666','10688250','32324624','11275848','11185239','10023617','11500094','11299516','11128977'),
      CNSMR_USER_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC COMPRESS ' ',
      REGIS_DATETM TIMESTAMP(6),
      PRSNA_STATUS_CODE CHAR(2) CHARACTER SET LATIN NOT CASESPECIFIC NOT NULL COMPRESS ('AC','DP','ID','IN','XX','YY','ZZ'),
      LYLTY_PGM_NBR SMALLINT COMPRESS 1 ,
      LYLTY_ACCT_NUM VARCHAR(100) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ' ',
      DATA_SRCE_NBR INTEGER COMPRESS (1280 ,1281 ,1026 ,1029 ,1030 ,1286 ,1287 ,1290 ,1297 ,1298 ,1043 ,1299 ,1044 ,1300 ,1302 ,1047 ,1303 ,1049 ,1306 ,1307 ,1308 ,1053 ,1309 ,1310 ,1314 ,1315 ,1060 ,1061 ,1318 ,1319 ,1071 ,1327 ,1328 ,1329 ,1330 ,1075 ,1076 ,1332 ,1077 ,1333 ,1078 ,1334 ,1335 ,1336 ,1082 ,1339 ,1084 ,1343 ,1347 ,1092 ,1097 ,1098 ,1099 ,1100 ,1101 ,1357 ,1102 ,1103 ,1105 ,1106 ,1108 ,1109 ,1365 ,1366 ,1111 ,1112 ,1368 ,1113 ,1115 ,1116 ,1117 ,1121 ,1135 ,1136 ,1139 ,1142 ,1148 ,1149 ,1150 ,1151 ,1152 ,1153 ,1155 ,1156 ,1157 ,1158 ,1164 ,1167 ,1172 ,1175 ,1176 ,1177 ,1178 ,1179 ,1180 ,1181 ,1182 ,1183 ,1184 ,1185 ,1186 ,1188 ,1189 ,1192 ,1194 ,1196 ,1197 ,1198 ,1199 ,1200 ,1201 ,1202 ,1203 ,1204 ,1205 ,1206 ,1208 ,1211 ,1212 ,1213 ,1214 ,1217 ,1218 ,1222 ,1224 ,1225 ,1226 ,1228 ,9933 ,1230 ,1231 ,1232 ,1233 ,1234 ,1236 ,1239 ,1240 ,1241 ,1242 ,1243 ,1244 ,1245 ,1246 ,1247 ,1250 ,1251 ,1253 ,1254 ,1255 ,1257 ,1258 ,1259 ,1260 ,1263 ,1017 ,1018 ,1019 ,1020 ,1021 ,1279 ),
      DATA_ORIGIN_SRCE_NBR INTEGER COMPRESS 0 ,
      DATA_OP_SRCE_NAME VARCHAR(100) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ,
      PII_DATA_MINIMIZE_DATETM TIMESTAMP(0) COMPRESS ,
      GVN_NAME_ALIAS VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC COMPRESS ' ',
      FAMLY_NAME_ALIAS VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC COMPRESS ' ',
      SYS_SOURCE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ,
      SYS_TARGET_ID INTEGER COMPRESS (1280 ,1281 ,6393601 ,1026 ,1029 ,6109701 ,6346501 ,1030 ,1286 ,1287 ,1290 ,6413 ,1297 ,6109201 ,6390801 ,1298 ,1043 ,1299 ,1044 ,1302 ,1047 ,1303 ,1049 ,6392601 ,1306 ,1307 ,1308 ,1053 ,6095901 ,1309 ,1310 ,1058 ,1315 ,1060 ,1061 ,6097701 ,4088101 ,1318 ,1319 ,6345001 ,7213 ,1071 ,1327 ,1328 ,1329 ,6110001 ,6391601 ,6346801 ,1074 ,1330 ,1075 ,1076 ,1332 ,6094901 ,1077 ,1333 ,6344501 ,6350901 ,1078 ,1334 ,1335 ,1336 ,6393401 ,1082 ,1339 ,1084 ,1085 ,6109501 ,6391101 ,1086 ,1087 ,1343 ,1347 ,1092 ,6098501 ,6111301 ,1097 ,10313 ,6109001 ,1098 ,1099 ,1100 ,1101 ,1357 ,1102 ,1103 ,1105 ,5713 ,6110801 ,4088401 ,6392401 ,1106 ,1108 ,1109 ,1365 ,6345301 ,6351701 ,1366 ,1111 ,1112 ,1368 ,1113 ,1115 ,1116 ,1117 ,6097501 ,4087901 ,1121 ,6344801 ,6109801 ,6346601 ,6094701 ,1135 ,6513 ,4210801 ,6393201 ,1139 ,1140 ,6109301 ,1142 ,1148 ,1149 ,4088701 ,1150 ,1151 ,1152 ,1153 ,10113 ,6390401 ,1154 ,1155 ,1156 ,1157 ,1158 ,5513 ,6392201 ,1164 ,6095501 ,6345101 ,1167 ,7313 ,1172 ,6097301 ,6110101 ,6346901 ,1175 ,1176 ,1177 ,6389401 ,6344601 ,1179 ,1180 ,1181 ,1182 ,1183 ,1184 ,1185 ,6109601 ,6346401 ,1186 ,1188 ,1189 ,1192 ,6313 ,6111401 ,6393001 ,1194 ,1197 ,10413 ,1198 ,1199 ,1200 ,1201 ,1202 ,1203 ,1204 ,1205 ,6098101 ,5813 ,6110901 ,1206 ,1208 ,6345401 ,6351801 ,1211 ,1212 ,1213 ,1214 ,1217 ,6392001 ,1218 ,6344901 ,1222 ,1224 ,1225 ,7113 ,6393801 ,1226 ,1228 ,9933 ,6391501 ,6346701 ,1230 ,1231 ,1232 ,1233 ,4238801 ,6344401 ,1234 ,1236 ,6613 ,1239 ,1240 ,1241 ,6109401 ,6346201 ,1242 ,1243 ,1244 ,1245 ,1246 ,6111201 ,6392801 ,6341601 ,1250 ,1251 ,1253 ,6096101 ,10213 ,1254 ,1255 ,1001 ,1257 ,1002 ,1258 ,1003 ,1259 ,1260 ,6097901 ,5613 ,4088301 ,1263 ,6345201 ,7413 ,1017 ,6110201 ,4087801 ,6391801 ,1018 ,1019 ,1020 ,1021 ,6344701 ,1279 ),
      SYS_AUTH_ID VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS '1092',
      SYS_CREATED_BY VARCHAR(70) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ,
      SYS_CREATION_DATE TIMESTAMP(0),
      SYS_LAST_MODIFIED_DATE TIMESTAMP(0),
      SYS_ENT_STATE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ('AC','12/19/2011 9:37','12/29/2011 9:06','12/16/2011 6:26','12/16/2011 9:13','DP','12/19/2011 3:17','3/11/2012 16:21','ACTIVE'),
      SYS_LAST_MODIFIED_BY VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS 'EtlUser',
      SYS_NC_TYPE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ('INSERT','UPDATE'),
      SYS_ERR_CODE VARCHAR(100) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ('DUP','INSERT','UPDATE','REQ0012893'),
      SYS_ERR_SVRTY VARCHAR(30) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS 'REQ0012861-0918FIX')
PRIMARY INDEX REGIS_PRSNA_NUPI ( REGIS_PRSNA_ID ,MKTNG_PGM_NBR )
PARTITION BY MKTNG_PGM_NBR 
INDEX CNSMRIdx ( LEGAL_ENT_NBR ,MATCHD_CNSMR_PRSNA_ID ,PRSNA_STATUS_CODE )
INDEX REGIS_PRSNA_NUSI_1 ( FAMLY_NAME )
INDEX REGIS_PRSNA_NUSI_2 ( NATIONAL_ID_NBR )
INDEX REGIS_PRSNA_NUSI_3 ( LYLTY_ACCT_NUM )
INDEX REGIS_PRSNA_NUSI_4 ( REGIS_CNSMR_ID_VAL );

.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L2
INSERT INTO MDM.ATTRIBUTE_VALUES 
sel max(av_id)+1,(sel ATTRIBUTE_TYPE_ID from ATTRIBUTE_TYPES where ATTRIBUTE_TYPE='Status'),'Y','Status','NV','Status',NULL,NULL,'BackEnd','Rel 5.6.1',current_date,'ACTIVE',NULL,NULL,NULL,NULL,NULL 
from ATTRIBUTE_VALUES;

.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
	  	  
.LABEL L3
UPDATE MDM.ID_SQR
FROM (SEL MAX(AV_ID)+1 AS SEQ_NBR FROM MDM.ATTRIBUTE_VALUES) B
SET SEQ_NR=B.SEQ_NBR
WHERE DOC_NAME='AVID_SEQ_ID';

 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L4
INSERT INTO DEPLOY_WORK.ERR_PRSNA_STG_561
(
REGIS_PRSNA_ID,
MKTNG_PGM_NBR,
REGIS_CNSMR_ID_VAL,
LOAD_ID,
SYS_NC_TYPE,
SYS_ERROR_TIME,
SYS_ERR_CODE
)
SEL RP.REGIS_PRSNA_ID,DP.MKTNG_PGM_NBR,RP.REGIS_CNSMR_ID_VAL,TRIM(DP.SYS_SOURCE),
SUBSTR(DP.SYS_NC_TYPE,1,1) SYS_NC_TYPE_1,
CAST(CAST(CURRENT_TIMESTAMP AS VARCHAR(19)) AS TIMESTAMP(0)),
'Vulgar Name found in registration data (DPEND)' 
FROM DPEND DP
INNER JOIN (SEL MKTNG_PGM_NBR, CASE WHEN SUBSTR(MKTNG_PGM_NAME,INDEX(MKTNG_PGM_NAME,'-')+1,3) IN ('IDN','THA','VNM')
THEN 'OTH'
WHEN LEGAL_ENT_NBR=17
THEN 'LA'
WHEN LEGAL_ENT_NBR=60
THEN 'ARB'
WHEN LEGAL_ENT_NBR=46
THEN 'AFR'
ELSE SUBSTR(MKTNG_PGM_NAME,INDEX(MKTNG_PGM_NAME,'-')+1,3)
END CNTRY_CODE 
FROM MKTNG_PGM) MP
ON DP.MKTNG_PGM_NBR=MP.MKTNG_PGM_NBR
INNER JOIN REGIS_PRSNA RP
ON DP.REGIS_PRSNA_ID=RP.REGIS_PRSNA_ID
AND DP.MKTNG_PGM_NBR=RP.MKTNG_PGM_NBR
AND DP.SYS_SOURCE=RP.SYS_SOURCE
WHERE  (((DPEND_NAME,MP.CNTRY_CODE) IN (SEL TRIM(REJECT_STRING),CNTRY_CODE FROM REJECT_STRING
WHERE REJECT_TYPE='NAME' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='EXACT' ))
OR
(((MP.CNTRY_CODE) IN (SEL CNTRY_CODE FROM REJECT_STRING
WHERE REJECT_TYPE='NAME' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='Partial') 
AND DPEND_NAME LIKE ANY (SEL TRIM('%'||TRIM(REJECT_STRING)||'%') FROM REJECT_STRING
WHERE REJECT_TYPE='NAME' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='Partial'))
));

 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L5
INSERT INTO DEPLOY_WORK.ERR_PRSNA_STG_561
(
REGIS_PRSNA_ID,
MKTNG_PGM_NBR,
REGIS_CNSMR_ID_VAL,
LOAD_ID,
SYS_NC_TYPE,
SYS_ERROR_TIME,
SYS_ERR_CODE
)
SEL RP.REGIS_PRSNA_ID,RP.MKTNG_PGM_NBR,RP.REGIS_CNSMR_ID_VAL,TRIM(RP.SYS_SOURCE),
SUBSTR(RP.SYS_NC_TYPE,1,1) SYS_NC_TYPE_1,
CAST(CAST(CURRENT_TIMESTAMP AS VARCHAR(19)) AS TIMESTAMP(0)),
'Vulgar Name found in registration data (PRSNA)'
FROM REGIS_PRSNA RP
INNER JOIN (SEL MKTNG_PGM_NBR, CASE WHEN SUBSTR(MKTNG_PGM_NAME,INDEX(MKTNG_PGM_NAME,'-')+1,3) IN ('IDN','THA','VNM')
THEN 'OTH'
WHEN LEGAL_ENT_NBR=17
THEN 'LA'
WHEN LEGAL_ENT_NBR=60
THEN 'ARB'
WHEN LEGAL_ENT_NBR=46
THEN 'AFR'
ELSE SUBSTR(MKTNG_PGM_NAME,INDEX(MKTNG_PGM_NAME,'-')+1,3)
END CNTRY_CODE 
FROM MKTNG_PGM) MP
ON RP.MKTNG_PGM_NBR=MP.MKTNG_PGM_NBR
WHERE
((MP.CNTRY_CODE IN (SEL CNTRY_CODE FROM REJECT_STRING
WHERE REJECT_TYPE='NAME' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='Partial') 
AND (FULL_NAME LIKE ANY (SEL TRIM('%'||TRIM(REJECT_STRING)||'%') FROM REJECT_STRING
WHERE REJECT_TYPE='NAME' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='Partial' )
OR GVN_NAME LIKE ANY (SEL TRIM('%'||TRIM(REJECT_STRING)||'%') FROM REJECT_STRING
WHERE REJECT_TYPE='NAME' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='Partial')
OR FAMLY_NAME LIKE ANY (SEL TRIM('%'||TRIM(REJECT_STRING)||'%') FROM REJECT_STRING
WHERE REJECT_TYPE='NAME' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='Partial')))
OR 
((FULL_NAME,MP.CNTRY_CODE) IN (SEL TRIM(REJECT_STRING),CNTRY_CODE FROM REJECT_STRING
WHERE REJECT_TYPE='NAME' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='EXACT')
OR (GVN_NAME,MP.CNTRY_CODE) IN (SEL TRIM(REJECT_STRING),CNTRY_CODE FROM REJECT_STRING
WHERE REJECT_TYPE='NAME' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='EXACT') 
OR (FAMLY_NAME,MP.CNTRY_CODE) IN (SEL TRIM(REJECT_STRING),CNTRY_CODE FROM REJECT_STRING
WHERE REJECT_TYPE='NAME' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='EXACT' )));

 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L6
INSERT INTO DEPLOY_WORK.ERR_PRSNA_STG_561
(
REGIS_PRSNA_ID,
MKTNG_PGM_NBR,
REGIS_CNSMR_ID_VAL,
LOAD_ID,
SYS_NC_TYPE,
SYS_ERROR_TIME,
SYS_ERR_CODE
)
SEL RP.REGIS_PRSNA_ID,PO.MKTNG_PGM_NBR,RP.REGIS_CNSMR_ID_VAL,TRIM(PO.SYS_SOURCE),
SUBSTR(PO.SYS_NC_TYPE,1,1) SYS_NC_TYPE_1,
CAST(CAST(CURRENT_TIMESTAMP AS VARCHAR(19)) AS TIMESTAMP(0)),
'Vulgar Name found in registration data (GUARDN)' 
FROM REGIS_PRSNA_POSTL_ADDR PO
INNER JOIN (SEL MKTNG_PGM_NBR, CASE WHEN SUBSTR(MKTNG_PGM_NAME,INDEX(MKTNG_PGM_NAME,'-')+1,3) IN ('IDN','THA','VNM')
THEN 'OTH'
WHEN LEGAL_ENT_NBR=17
THEN 'LA'
WHEN LEGAL_ENT_NBR=60
THEN 'ARB'
WHEN LEGAL_ENT_NBR=46
THEN 'AFR'
ELSE SUBSTR(MKTNG_PGM_NAME,INDEX(MKTNG_PGM_NAME,'-')+1,3)
END CNTRY_CODE 
FROM MKTNG_PGM) MP
ON PO.MKTNG_PGM_NBR=MP.MKTNG_PGM_NBR
INNER JOIN REGIS_PRSNA RP
ON PO.REGIS_PRSNA_ID=RP.REGIS_PRSNA_ID
AND PO.MKTNG_PGM_NBR=RP.MKTNG_PGM_NBR
AND PO.SYS_SOURCE=RP.SYS_SOURCE
WHERE (((GUARDN_NAME,MP.CNTRY_CODE) IN (SEL TRIM(REJECT_STRING),CNTRY_CODE FROM REJECT_STRING
WHERE REJECT_TYPE='NAME' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='EXACT'))
OR
(((MP.CNTRY_CODE) IN (SEL CNTRY_CODE FROM REJECT_STRING
WHERE REJECT_TYPE='NAME' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='Partial') 
AND GUARDN_NAME LIKE ANY (SEL TRIM('%'||TRIM(REJECT_STRING)||'%') FROM REJECT_STRING
WHERE REJECT_TYPE='NAME' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='Partial' ))
));
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;


.LABEL L7
INSERT INTO DEPLOY_WORK.ERR_PRSNA_STG_561
(
REGIS_PRSNA_ID,
MKTNG_PGM_NBR,
REGIS_CNSMR_ID_VAL,
LOAD_ID,
SYS_NC_TYPE,
SYS_ERROR_TIME,
SYS_ERR_CODE
)
SEL RP.REGIS_PRSNA_ID,EA.MKTNG_PGM_NBR,RP.REGIS_CNSMR_ID_VAL,TRIM(EA.SYS_SOURCE),
SUBSTR(EA.SYS_NC_TYPE,1,1) SYS_NC_TYPE_1,
CAST(CAST(CURRENT_TIMESTAMP AS VARCHAR(19)) AS TIMESTAMP(0)),
'Vulgar Name found in registration data (GUARDN)' 
FROM REGIS_PRSNA_EMAIL_ADDR EA
INNER JOIN (SEL MKTNG_PGM_NBR, CASE WHEN SUBSTR(MKTNG_PGM_NAME,INDEX(MKTNG_PGM_NAME,'-')+1,3) IN ('IDN','THA','VNM')
THEN 'OTH'
WHEN LEGAL_ENT_NBR=17
THEN 'LA'
WHEN LEGAL_ENT_NBR=60
THEN 'ARB'
WHEN LEGAL_ENT_NBR=46
THEN 'AFR'
ELSE SUBSTR(MKTNG_PGM_NAME,INDEX(MKTNG_PGM_NAME,'-')+1,3)
END CNTRY_CODE 
FROM MKTNG_PGM) MP
ON EA.MKTNG_PGM_NBR=MP.MKTNG_PGM_NBR
INNER JOIN REGIS_PRSNA RP
ON EA.REGIS_PRSNA_ID=RP.REGIS_PRSNA_ID
AND EA.MKTNG_PGM_NBR=RP.MKTNG_PGM_NBR
AND EA.SYS_SOURCE=RP.SYS_SOURCE
WHERE (((GUARDN_NAME,MP.CNTRY_CODE) IN (SEL TRIM(REJECT_STRING),CNTRY_CODE FROM REJECT_STRING
WHERE REJECT_TYPE='NAME' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='EXACT'))
OR
(((MP.CNTRY_CODE) IN (SEL CNTRY_CODE FROM REJECT_STRING
WHERE REJECT_TYPE='NAME' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='Partial' ) 
AND GUARDN_NAME LIKE ANY (SEL TRIM('%'||TRIM(REJECT_STRING)||'%') FROM REJECT_STRING
WHERE REJECT_TYPE='NAME' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='Partial'))
));

 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;


.LABEL L8
INSERT INTO DEPLOY_WORK.ERR_PRSNA_STG_561
(
REGIS_PRSNA_ID,
MKTNG_PGM_NBR,
REGIS_CNSMR_ID_VAL,
LOAD_ID,
SYS_NC_TYPE,
SYS_ERROR_TIME,
SYS_ERR_CODE
)
SEL RP.REGIS_PRSNA_ID,PH.MKTNG_PGM_NBR,RP.REGIS_CNSMR_ID_VAL,TRIM(PH.SYS_SOURCE),
SUBSTR(PH.SYS_NC_TYPE,1,1) SYS_NC_TYPE_1,
CAST(CAST(CURRENT_TIMESTAMP AS VARCHAR(19)) AS TIMESTAMP(0)),
'Vulgar Name found in registration data (GUARDN)' 
FROM REGIS_PRSNA_PHONE PH
INNER JOIN (SEL MKTNG_PGM_NBR, CASE WHEN SUBSTR(MKTNG_PGM_NAME,INDEX(MKTNG_PGM_NAME,'-')+1,3) IN ('IDN','THA','VNM')
THEN 'OTH'
WHEN LEGAL_ENT_NBR=17
THEN 'LA'
WHEN LEGAL_ENT_NBR=60
THEN 'ARB'
WHEN LEGAL_ENT_NBR=46
THEN 'AFR'
ELSE SUBSTR(MKTNG_PGM_NAME,INDEX(MKTNG_PGM_NAME,'-')+1,3)
END CNTRY_CODE 
FROM MKTNG_PGM) MP
ON PH.MKTNG_PGM_NBR=MP.MKTNG_PGM_NBR
INNER JOIN REGIS_PRSNA RP
ON PH.REGIS_PRSNA_ID=RP.REGIS_PRSNA_ID
AND PH.MKTNG_PGM_NBR=RP.MKTNG_PGM_NBR
AND PH.SYS_SOURCE=RP.SYS_SOURCE
WHERE (((GUARDN_NAME,MP.CNTRY_CODE) IN (SEL TRIM(REJECT_STRING),CNTRY_CODE FROM REJECT_STRING
WHERE REJECT_TYPE='NAME' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='EXACT' ))
OR
(((MP.CNTRY_CODE) IN (SEL CNTRY_CODE FROM REJECT_STRING
WHERE REJECT_TYPE='NAME' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='Partial') 
AND GUARDN_NAME LIKE ANY (SEL TRIM('%'||TRIM(REJECT_STRING)||'%') FROM REJECT_STRING
WHERE REJECT_TYPE='NAME' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='Partial'))
));

 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;


.LABEL L9
INSERT INTO DEPLOY_WORK.ERR_PRSNA_STG_561
(
REGIS_PRSNA_ID,
MKTNG_PGM_NBR,
REGIS_CNSMR_ID_VAL,
LOAD_ID,
SYS_NC_TYPE,
SYS_ERROR_TIME,
SYS_ERR_CODE
)
SEL RP.REGIS_PRSNA_ID,PH.MKTNG_PGM_NBR,RP.REGIS_CNSMR_ID_VAL,TRIM(PH.SYS_SOURCE),
SUBSTR(PH.SYS_NC_TYPE,1,1) SYS_NC_TYPE_1,
CAST(CAST(CURRENT_TIMESTAMP AS VARCHAR(19)) AS TIMESTAMP(0)),
'Vulgar Name found in registration data (GUARDN)' 
FROM REGIS_PRSNA_SOC_NET_ACCT PH
INNER JOIN (SEL MKTNG_PGM_NBR, CASE WHEN SUBSTR(MKTNG_PGM_NAME,INDEX(MKTNG_PGM_NAME,'-')+1,3) IN ('IDN','THA','VNM')
THEN 'OTH'
WHEN LEGAL_ENT_NBR=17
THEN 'LA'
WHEN LEGAL_ENT_NBR=60
THEN 'ARB'
WHEN LEGAL_ENT_NBR=46
THEN 'AFR'
ELSE SUBSTR(MKTNG_PGM_NAME,INDEX(MKTNG_PGM_NAME,'-')+1,3)
END CNTRY_CODE 
FROM MKTNG_PGM) MP
ON PH.MKTNG_PGM_NBR=MP.MKTNG_PGM_NBR
INNER JOIN REGIS_PRSNA RP
ON PH.REGIS_PRSNA_ID=RP.REGIS_PRSNA_ID
AND PH.MKTNG_PGM_NBR=RP.MKTNG_PGM_NBR
AND PH.SYS_SOURCE=RP.SYS_SOURCE
WHERE (((GUARDN_NAME,MP.CNTRY_CODE) IN (SEL TRIM(REJECT_STRING),CNTRY_CODE FROM REJECT_STRING
WHERE REJECT_TYPE='NAME' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='EXACT' ))
OR
(((MP.CNTRY_CODE) IN (SEL CNTRY_CODE FROM REJECT_STRING
WHERE REJECT_TYPE='NAME' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='Partial') 
AND GUARDN_NAME LIKE ANY (SEL TRIM('%'||TRIM(REJECT_STRING)||'%') FROM REJECT_STRING
WHERE REJECT_TYPE='NAME' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='Partial'))
));

 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L10
INSERT INTO DEPLOY_WORK.ERR_PRSNA_STG_561
(
REGIS_PRSNA_ID,
MKTNG_PGM_NBR,
REGIS_CNSMR_ID_VAL,
LOAD_ID,
SYS_NC_TYPE,
SYS_ERROR_TIME,
SYS_ERR_CODE
)
SEL RP.REGIS_PRSNA_ID,PO.MKTNG_PGM_NBR,RP.REGIS_CNSMR_ID_VAL,TRIM(PO.SYS_SOURCE),
SUBSTR(PO.SYS_NC_TYPE,1,1) SYS_NC_TYPE_1,
CAST(CAST(CURRENT_TIMESTAMP AS VARCHAR(19)) AS TIMESTAMP(0)),
'Data Reject String found in registration address data (POSTL)' 
FROM REGIS_PRSNA_POSTL_ADDR PO
INNER JOIN (SEL MKTNG_PGM_NBR, CASE WHEN SUBSTR(MKTNG_PGM_NAME,INDEX(MKTNG_PGM_NAME,'-')+1,3) IN ('IDN','THA','VNM')
THEN 'OTH'
WHEN LEGAL_ENT_NBR=17
THEN 'LA'
WHEN LEGAL_ENT_NBR=60
THEN 'ARB'
WHEN LEGAL_ENT_NBR=46
THEN 'AFR'
ELSE SUBSTR(MKTNG_PGM_NAME,INDEX(MKTNG_PGM_NAME,'-')+1,3)
END CNTRY_CODE 
FROM MKTNG_PGM) MP
ON PO.MKTNG_PGM_NBR=MP.MKTNG_PGM_NBR
INNER JOIN REGIS_PRSNA RP
ON PO.REGIS_PRSNA_ID=RP.REGIS_PRSNA_ID
AND PO.MKTNG_PGM_NBR=RP.MKTNG_PGM_NBR
AND PO.SYS_SOURCE=RP.SYS_SOURCE
WHERE ((MP.CNTRY_CODE IN (SEL CNTRY_CODE FROM REJECT_STRING
WHERE REJECT_TYPE='Address' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='Partial' ) 
AND (ADDR_LINE_1_TXT LIKE ANY (SEL TRIM('%'||TRIM(REJECT_STRING)||'%') FROM REJECT_STRING
WHERE REJECT_TYPE='Address' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='Partial' )
OR ADDR_LINE_2_TXT LIKE ANY (SEL TRIM('%'||TRIM(REJECT_STRING)||'%') FROM REJECT_STRING
WHERE REJECT_TYPE='Address' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='Partial' )
OR ADDR_LINE_3_TXT LIKE ANY (SEL TRIM('%'||TRIM(REJECT_STRING)||'%') FROM REJECT_STRING
WHERE REJECT_TYPE='Address' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='Partial')))
OR 
((ADDR_LINE_1_TXT,MP.CNTRY_CODE) IN (SEL TRIM(REJECT_STRING),CNTRY_CODE FROM REJECT_STRING
WHERE REJECT_TYPE='Address' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='EXACT' )
OR (ADDR_LINE_2_TXT,MP.CNTRY_CODE) IN (SEL TRIM(REJECT_STRING),CNTRY_CODE FROM REJECT_STRING
WHERE REJECT_TYPE='Address' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='EXACT') 
OR (ADDR_LINE_3_TXT,MP.CNTRY_CODE) IN (SEL TRIM(REJECT_STRING),CNTRY_CODE FROM REJECT_STRING
WHERE REJECT_TYPE='Address' AND COALESCE(SYS_ENT_STATE,'') = 'ACTIVE' AND MATCH_TYPE='EXACT' )));


 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

 .LABEL L11
 
 DELETE FROM REGIS_PRSNA_EMAIL_ADDR
 WHERE (MKTNG_PGM_NBR,REGIS_PRSNA_ID) IN (SELECT MKTNG_PGM_NBR,REGIS_PRSNA_ID FROM DEPLOY_WORK.ERR_PRSNA_STG_561);
  .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
  
   .LABEL L12
   DELETE FROM REGIS_PRSNA_PHONE
  WHERE (MKTNG_PGM_NBR,REGIS_PRSNA_ID) IN (SELECT MKTNG_PGM_NBR,REGIS_PRSNA_ID FROM DEPLOY_WORK.ERR_PRSNA_STG_561);
     
	  .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
	  
	   .LABEL L13
	   
	 
	  DELETE FROM REGIS_PRSNA_SOC_NET_ACCT
 WHERE (MKTNG_PGM_NBR,REGIS_PRSNA_ID) IN (SELECT MKTNG_PGM_NBR,REGIS_PRSNA_ID FROM DEPLOY_WORK.ERR_PRSNA_STG_561);
	  .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
	 
	  .LABEL L14
	  DELETE FROM REGIS_PRSNA_POSTL_ADDR
  WHERE (MKTNG_PGM_NBR,REGIS_PRSNA_ID) IN (SELECT MKTNG_PGM_NBR,REGIS_PRSNA_ID FROM DEPLOY_WORK.ERR_PRSNA_STG_561);
	  .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
	 
	  .LABEL L15
	  DELETE FROM PET
  WHERE (MKTNG_PGM_NBR,REGIS_PRSNA_ID) IN (SELECT MKTNG_PGM_NBR,REGIS_PRSNA_ID FROM DEPLOY_WORK.ERR_PRSNA_STG_561);
	  .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
	 
	  .LABEL L16
	  DELETE FROM PET_TRT
  WHERE (MKTNG_PGM_NBR,REGIS_PRSNA_ID) IN (SELECT MKTNG_PGM_NBR,REGIS_PRSNA_ID FROM DEPLOY_WORK.ERR_PRSNA_STG_561);
	 
	  .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
	 
	  .LABEL L17
	  DELETE FROM DPEND
  WHERE (MKTNG_PGM_NBR,REGIS_PRSNA_ID) IN (SELECT MKTNG_PGM_NBR,REGIS_PRSNA_ID FROM DEPLOY_WORK.ERR_PRSNA_STG_561);
	  .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
	 
	  .LABEL L18
	  DELETE FROM DPEND_TRT
 WHERE (MKTNG_PGM_NBR,REGIS_PRSNA_ID) IN (SELECT MKTNG_PGM_NBR,REGIS_PRSNA_ID FROM DEPLOY_WORK.ERR_PRSNA_STG_561);
	  .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
	 
	  .LABEL L19
	  DELETE FROM PRSNA_TRT
  WHERE (MKTNG_PGM_NBR,REGIS_PRSNA_ID) IN (SELECT MKTNG_PGM_NBR,REGIS_PRSNA_ID FROM DEPLOY_WORK.ERR_PRSNA_STG_561);
  .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
	 
	  .LABEL L20
	  DELETE FROM CNSMR_AFFLTN
  WHERE (MKTNG_PGM_NBR,REGIS_PRSNA_ID) IN (SELECT MKTNG_PGM_NBR,REGIS_PRSNA_ID FROM DEPLOY_WORK.ERR_PRSNA_STG_561);
	  .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
	 
	  .LABEL L21
	 	  DELETE FROM REGIS_PRSNA RP
 WHERE (MKTNG_PGM_NBR,REGIS_PRSNA_ID) IN (SELECT MKTNG_PGM_NBR,REGIS_PRSNA_ID FROM DEPLOY_WORK.ERR_PRSNA_STG_561);
	 
	  .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
	  
	  
	  .LABEL L22
	  INSERT into ERR_PRSNA_STG
	  (
	  MKTNG_PGM_NBR  ,               
REGIS_CNSMR_ID_VAL    ,        
USER_NAME,          
PRSNA_REG_DT,                  
GVN_NAME ,                     
MID_NAME  ,                    
FAMLY_NAME ,                   
NAME_SUFFX_TXT,                
FULL_NAME  ,                   
GENDR_IND   ,                  
BRTH_DATE   ,                  
LANG_CODE    ,                 
PRSNA_STTUS_CODE,              
RECORD_IND  ,                  
LOAD_ID      ,                 
LOAD_TS       ,                
MDM_LOAD_IND   ,               
WIN_KEY        ,              
SYNC_STATUS    ,             
CNTRY_CODE     ,            
SYS_TARGET_ID  ,           
SYS_AUTH_ID    ,          
SYS_SOURCE     ,              
SYS_ERROR_ID   ,             
SYS_ERROR_TIME ,            
SYS_ERR_SVRTY  ,           
SYS_NC_TYPE    ,          
SYS_DOCUMENT   ,         
SYS_LOAD_ID     ,        
SYS_WORKFLOW_ID ,       
SYS_ERR_CODE ,      
LYLTY_ACCT_NUM,     
LYLTY_PGM_NBR,    
NAME_PREFX_TXT    
	  )
	  select DISTINCT
	  MKTNG_PGM_NBR  ,               
REGIS_CNSMR_ID_VAL    ,        
USER_NAME,          
PRSNA_REG_DT,                  
GVN_NAME ,                     
MID_NAME  ,                    
FAMLY_NAME ,                   
NAME_SUFFX_TXT,                
FULL_NAME  ,                   
GENDR_IND   ,                  
BRTH_DATE   ,                  
LANG_CODE    ,                 
PRSNA_STTUS_CODE,              
RECORD_IND  ,                  
LOAD_ID      ,                 
LOAD_TS       ,                
MDM_LOAD_IND   ,               
WIN_KEY        ,              
SYNC_STATUS    ,             
CNTRY_CODE     ,            
SYS_TARGET_ID  ,           
SYS_AUTH_ID    ,          
SYS_SOURCE     ,              
SYS_ERROR_ID   ,             
SYS_ERROR_TIME ,            
SYS_ERR_SVRTY  ,           
SYS_NC_TYPE    ,          
SYS_DOCUMENT   ,         
SYS_LOAD_ID     ,        
SYS_WORKFLOW_ID ,       
SYS_ERR_CODE ,      
LYLTY_ACCT_NUM,     
LYLTY_PGM_NBR,    
NAME_PREFX_TXT  
from DEPLOY_WORK.ERR_PRSNA_STG_561;

.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
	  
.LABEL L23
INSERT INTO DEPLOY_WORK.REGIS_PRSNA_DUP1(REGIS_PRSNA_ID
,MKTNG_PGM_NBR
,LEGAL_ENT_NBR
,MATCHD_CNSMR_PRSNA_ID
,REFERAL_MKTNG_PGM_NBR
,TRM_LEAD_KEY
,NAME_PREFX_TXT
,GVN_NAME
,MID_NAME
,FAMLY_NAME
,NAME_SUFFX_TXT
,FULL_NAME
,GENDR_IND
,BRTH_DATE
,LANG_CODE
,CNTRY_CODE
,EMAIL_SUPRSN_IND
,POSTL_SUPRSN_IND
,PHONE_SUPRSN_IND
,SOCL_NETWK_SUPRSN_IND
,NATIONAL_ID_NBR
,CNSMR_SENTIMENT
,LATST_ACTVY_DATE
,REGIS_CNSMR_ID_VAL
,CNSMR_USER_NAME
,REGIS_DATETM
,PRSNA_STATUS_CODE
,LYLTY_PGM_NBR
,LYLTY_ACCT_NUM
,SYS_SOURCE
,SYS_TARGET_ID
,SYS_AUTH_ID
,SYS_CREATED_BY
,SYS_CREATION_DATE
,SYS_LAST_MODIFIED_DATE
,SYS_ENT_STATE
,SYS_LAST_MODIFIED_BY
,SYS_NC_TYPE
,SYS_ERR_CODE
,SYS_ERR_SVRTY
,data_srce_nbr
,DATA_ORIGIN_SRCE_NBR
,DATA_OP_SRCE_NAME
,PII_DATA_MINIMIZE_DATETM
,GVN_NAME_ALIAS
,FAMLY_NAME_ALIAS)
SELECT REGIS_PRSNA_ID
,MKTNG_PGM_NBR
,LEGAL_ENT_NBR
,MATCHD_CNSMR_PRSNA_ID
,REFERAL_MKTNG_PGM_NBR
,TRM_LEAD_KEY
,NAME_PREFX_TXT
,GVN_NAME
,MID_NAME
,FAMLY_NAME
,NAME_SUFFX_TXT
,FULL_NAME
,GENDR_IND
,BRTH_DATE
,LANG_CODE
,CNTRY_CODE
,EMAIL_SUPRSN_IND
,POSTL_SUPRSN_IND
,PHONE_SUPRSN_IND
,SOCL_NETWK_SUPRSN_IND
,NATIONAL_ID_NBR
,CNSMR_SENTIMENT
,LATST_ACTVY_DATE
,REGIS_CNSMR_ID_VAL
,CNSMR_USER_NAME
,REGIS_DATE
,PRSNA_STATUS_CODE
,LYLTY_PGM_NBR
,LYLTY_ACCT_NUM
,SYS_SOURCE
,SYS_TARGET_ID
,SYS_AUTH_ID
,SYS_CREATED_BY
,SYS_CREATION_DATE
,SYS_LAST_MODIFIED_DATE
,SYS_ENT_STATE
,SYS_LAST_MODIFIED_BY
,SYS_NC_TYPE
,SYS_ERR_CODE
,SYS_ERR_SVRTY
,data_srce_nbr
,DATA_ORIGIN_SRCE_NBR
,DATA_OP_SRCE_NAME
,PII_DATA_MINIMIZE_DATETM
,GVN_NAME_ALIAS
,FAMLY_NAME_ALIAS FROM MDM.REGIS_PRSNA
WHERE (MKTNG_PGM_NBR,REGIS_PRSNA_ID) IN (SEL MKTNG_PGM_NBR,REGIS_PRSNA_ID
FROM MDM.REGIS_PRSNA
GROUP BY 1,2
HAVING COUNT(*) > 1)
QUALIFY RANK() OVER (PARTITION BY MKTNG_PGM_NBR,REGIS_PRSNA_ID
ORDER BY FAMLY_NAME DESC,GVN_NAME DESC, GVN_NAME_ALIAS DESC, BRTH_DATE DESC,LYLTY_ACCT_NUM DESC, DATA_SRCE_NBR DESC)=1;
	  
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L23A
INSERT INTO DEPLOY_WORK.REGIS_PRSNA_DUP1(REGIS_PRSNA_ID
,MKTNG_PGM_NBR
,LEGAL_ENT_NBR
,MATCHD_CNSMR_PRSNA_ID
,REFERAL_MKTNG_PGM_NBR
,TRM_LEAD_KEY
,NAME_PREFX_TXT
,GVN_NAME
,MID_NAME
,FAMLY_NAME
,NAME_SUFFX_TXT
,FULL_NAME
,GENDR_IND
,BRTH_DATE
,LANG_CODE
,CNTRY_CODE
,EMAIL_SUPRSN_IND
,POSTL_SUPRSN_IND
,PHONE_SUPRSN_IND
,SOCL_NETWK_SUPRSN_IND
,NATIONAL_ID_NBR
,CNSMR_SENTIMENT
,LATST_ACTVY_DATE
,REGIS_CNSMR_ID_VAL
,CNSMR_USER_NAME
,REGIS_DATETM
,PRSNA_STATUS_CODE
,LYLTY_PGM_NBR
,LYLTY_ACCT_NUM
,SYS_SOURCE
,SYS_TARGET_ID
,SYS_AUTH_ID
,SYS_CREATED_BY
,SYS_CREATION_DATE
,SYS_LAST_MODIFIED_DATE
,SYS_ENT_STATE
,SYS_LAST_MODIFIED_BY
,SYS_NC_TYPE
,SYS_ERR_CODE
,SYS_ERR_SVRTY
,data_srce_nbr
,DATA_ORIGIN_SRCE_NBR
,DATA_OP_SRCE_NAME
,PII_DATA_MINIMIZE_DATETM
,GVN_NAME_ALIAS
,FAMLY_NAME_ALIAS)
SELECT REGIS_PRSNA_ID
,MKTNG_PGM_NBR
,LEGAL_ENT_NBR
,MATCHD_CNSMR_PRSNA_ID
,REFERAL_MKTNG_PGM_NBR
,TRM_LEAD_KEY
,NAME_PREFX_TXT
,GVN_NAME
,MID_NAME
,FAMLY_NAME
,NAME_SUFFX_TXT
,FULL_NAME
,GENDR_IND
,BRTH_DATE
,LANG_CODE
,CNTRY_CODE
,EMAIL_SUPRSN_IND
,POSTL_SUPRSN_IND
,PHONE_SUPRSN_IND
,SOCL_NETWK_SUPRSN_IND
,NATIONAL_ID_NBR
,CNSMR_SENTIMENT
,LATST_ACTVY_DATE
,REGIS_CNSMR_ID_VAL
,CNSMR_USER_NAME
,REGIS_DATE
,PRSNA_STATUS_CODE
,LYLTY_PGM_NBR
,LYLTY_ACCT_NUM
,SYS_SOURCE
,SYS_TARGET_ID
,SYS_AUTH_ID
,SYS_CREATED_BY
,SYS_CREATION_DATE
,SYS_LAST_MODIFIED_DATE
,SYS_ENT_STATE
,SYS_LAST_MODIFIED_BY
,SYS_NC_TYPE
,SYS_ERR_CODE
,SYS_ERR_SVRTY
,data_srce_nbr
,DATA_ORIGIN_SRCE_NBR
,DATA_OP_SRCE_NAME
,PII_DATA_MINIMIZE_DATETM
,GVN_NAME_ALIAS
,FAMLY_NAME_ALIAS FROM MDM.REGIS_PRSNA
WHERE (MKTNG_PGM_NBR,REGIS_CNSMR_ID_VAL,SYS_TARGET_ID) IN (SEL MKTNG_PGM_NBR,REGIS_CNSMR_ID_VAL,SYS_TARGET_ID
FROM MDM.REGIS_PRSNA
GROUP BY 1,2,3
HAVING COUNT(*) > 1)
QUALIFY RANK() OVER (PARTITION BY MKTNG_PGM_NBR,REGIS_CNSMR_ID_VAL,SYS_TARGET_ID
ORDER BY FAMLY_NAME DESC,GVN_NAME DESC, GVN_NAME_ALIAS DESC, BRTH_DATE DESC,LYLTY_ACCT_NUM DESC, DATA_SRCE_NBR DESC)=1;
	  
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
	   
.LABEL L24
DELETE FROM MDM.REGIS_PRSNA
WHERE (MKTNG_PGM_NBR,REGIS_PRSNA_ID) IN 
(SEL MKTNG_PGM_NBR,REGIS_PRSNA_ID FROM DEPLOY_WORK.REGIS_PRSNA_DUP1);
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L24A
DELETE FROM MDM.REGIS_PRSNA
WHERE (MKTNG_PGM_NBR,REGIS_CNSMR_ID_VAL,SYS_TARGET_ID) IN 
(SEL MKTNG_PGM_NBR,REGIS_CNSMR_ID_VAL,SYS_TARGET_ID FROM DEPLOY_WORK.REGIS_PRSNA_DUP1)
AND (MKTNG_PGM_NBR,CNTRY_CODE) NOT IN (
SEL MKTNG_PGM_NBR,SUBSTR(MP.MKTNG_PGM_NAME,INDEX(MP.MKTNG_PGM_NAME,'-')+1,3) CNTRY_CODE
FROM MDM.MKTNG_PGM MP);
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
	   
.LABEL L25

INSERT INTO MDM.REGIS_PRSNA(REGIS_PRSNA_ID
,MKTNG_PGM_NBR
,LEGAL_ENT_NBR
,MATCHD_CNSMR_PRSNA_ID
,REFERAL_MKTNG_PGM_NBR
,TRM_LEAD_KEY
,NAME_PREFX_TXT
,GVN_NAME
,MID_NAME
,FAMLY_NAME
,NAME_SUFFX_TXT
,FULL_NAME
,GENDR_IND
,BRTH_DATE
,LANG_CODE
,CNTRY_CODE
,EMAIL_SUPRSN_IND
,POSTL_SUPRSN_IND
,PHONE_SUPRSN_IND
,SOCL_NETWK_SUPRSN_IND
,NATIONAL_ID_NBR
,CNSMR_SENTIMENT
,LATST_ACTVY_DATE
,REGIS_CNSMR_ID_VAL
,CNSMR_USER_NAME
,REGIS_DATE
,PRSNA_STATUS_CODE
,LYLTY_PGM_NBR
,LYLTY_ACCT_NUM
,SYS_SOURCE
,SYS_TARGET_ID
,SYS_AUTH_ID
,SYS_CREATED_BY
,SYS_CREATION_DATE
,SYS_LAST_MODIFIED_DATE
,SYS_ENT_STATE
,SYS_LAST_MODIFIED_BY
,SYS_NC_TYPE
,SYS_ERR_CODE
,SYS_ERR_SVRTY
,data_srce_nbr
,DATA_ORIGIN_SRCE_NBR
,DATA_OP_SRCE_NAME
,PII_DATA_MINIMIZE_DATETM
,GVN_NAME_ALIAS
,FAMLY_NAME_ALIAS)
SELECT REGIS_PRSNA_ID
,MKTNG_PGM_NBR
,LEGAL_ENT_NBR
,MATCHD_CNSMR_PRSNA_ID
,REFERAL_MKTNG_PGM_NBR
,TRM_LEAD_KEY
,NAME_PREFX_TXT
,GVN_NAME
,MID_NAME
,FAMLY_NAME
,NAME_SUFFX_TXT
,FULL_NAME
,GENDR_IND
,BRTH_DATE
,LANG_CODE
,CNTRY_CODE
,EMAIL_SUPRSN_IND
,POSTL_SUPRSN_IND
,PHONE_SUPRSN_IND
,SOCL_NETWK_SUPRSN_IND
,NATIONAL_ID_NBR
,CNSMR_SENTIMENT
,LATST_ACTVY_DATE
,REGIS_CNSMR_ID_VAL
,CNSMR_USER_NAME
,REGIS_DATETM
,PRSNA_STATUS_CODE
,LYLTY_PGM_NBR
,LYLTY_ACCT_NUM
,SYS_SOURCE
,SYS_TARGET_ID
,SYS_AUTH_ID
,SYS_CREATED_BY
,SYS_CREATION_DATE
,SYS_LAST_MODIFIED_DATE
,SYS_ENT_STATE
,SYS_LAST_MODIFIED_BY
,SYS_NC_TYPE
,SYS_ERR_CODE
,SYS_ERR_SVRTY
,data_srce_nbr
,DATA_ORIGIN_SRCE_NBR
,DATA_OP_SRCE_NAME
,PII_DATA_MINIMIZE_DATETM
,GVN_NAME_ALIAS
,FAMLY_NAME_ALIAS FROM DEPLOY_WORK.REGIS_PRSNA_DUP1;
	   
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L23A
DELETE FROM DEPLOY_WORK.REGIS_PRSNA_DUP1 ALL;
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L23AB

INSERT INTO DEPLOY_WORK.REGIS_PRSNA_DUP1(REGIS_PRSNA_ID
,MKTNG_PGM_NBR
,LEGAL_ENT_NBR
,MATCHD_CNSMR_PRSNA_ID
,REFERAL_MKTNG_PGM_NBR
,TRM_LEAD_KEY
,NAME_PREFX_TXT
,GVN_NAME
,MID_NAME
,FAMLY_NAME
,NAME_SUFFX_TXT
,FULL_NAME
,GENDR_IND
,BRTH_DATE
,LANG_CODE
,CNTRY_CODE
,EMAIL_SUPRSN_IND
,POSTL_SUPRSN_IND
,PHONE_SUPRSN_IND
,SOCL_NETWK_SUPRSN_IND
,NATIONAL_ID_NBR
,CNSMR_SENTIMENT
,LATST_ACTVY_DATE
,REGIS_CNSMR_ID_VAL
,CNSMR_USER_NAME
,REGIS_DATETM
,PRSNA_STATUS_CODE
,LYLTY_PGM_NBR
,LYLTY_ACCT_NUM
,SYS_SOURCE
,SYS_TARGET_ID
,SYS_AUTH_ID
,SYS_CREATED_BY
,SYS_CREATION_DATE
,SYS_LAST_MODIFIED_DATE
,SYS_ENT_STATE
,SYS_LAST_MODIFIED_BY
,SYS_NC_TYPE
,SYS_ERR_CODE
,SYS_ERR_SVRTY
,data_srce_nbr
,DATA_ORIGIN_SRCE_NBR
,DATA_OP_SRCE_NAME
,PII_DATA_MINIMIZE_DATETM
,GVN_NAME_ALIAS
,FAMLY_NAME_ALIAS)
SELECT REGIS_PRSNA_ID
,MKTNG_PGM_NBR
,LEGAL_ENT_NBR
,MATCHD_CNSMR_PRSNA_ID
,REFERAL_MKTNG_PGM_NBR
,TRM_LEAD_KEY
,NAME_PREFX_TXT
,GVN_NAME
,MID_NAME
,FAMLY_NAME
,NAME_SUFFX_TXT
,FULL_NAME
,GENDR_IND
,BRTH_DATE
,LANG_CODE
,CNTRY_CODE
,EMAIL_SUPRSN_IND
,POSTL_SUPRSN_IND
,PHONE_SUPRSN_IND
,SOCL_NETWK_SUPRSN_IND
,NATIONAL_ID_NBR
,CNSMR_SENTIMENT
,LATST_ACTVY_DATE
,REGIS_CNSMR_ID_VAL
,CNSMR_USER_NAME
,REGIS_DATE
,PRSNA_STATUS_CODE
,LYLTY_PGM_NBR
,LYLTY_ACCT_NUM
,SYS_SOURCE
,SYS_TARGET_ID
,SYS_AUTH_ID
,SYS_CREATED_BY
,SYS_CREATION_DATE
,SYS_LAST_MODIFIED_DATE
,SYS_ENT_STATE
,SYS_LAST_MODIFIED_BY
,SYS_NC_TYPE
,SYS_ERR_CODE
,SYS_ERR_SVRTY
,data_srce_nbr
,DATA_ORIGIN_SRCE_NBR
,DATA_OP_SRCE_NAME
,PII_DATA_MINIMIZE_DATETM
,GVN_NAME_ALIAS
,FAMLY_NAME_ALIAS FROM MDM.REGIS_PRSNA
WHERE (REGIS_PRSNA_ID) IN (SEL REGIS_PRSNA_ID
FROM MDM.REGIS_PRSNA
GROUP BY 1
HAVING COUNT(*) > 1)
QUALIFY RANK() OVER (PARTITION BY REGIS_PRSNA_ID
ORDER BY MKTNG_PGM_NBR)=1;		  
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
	   
.LABEL L24A
INSERT TRILLIUM_MDM_REFERENCE_RG 
(
 REFERENCE_REGISTRATIONKEY     
,SYS_CREATION_DATE             
,SYS_ENT_STATE   
,SYS_SOURCE
,SYS_TARGET_ID
,SYS_ERR_CODE
)
SELECT DISTINCT
 A.REGIS_PRSNA_ID     
,CURRENT_TIMESTAMP(0)             
,'ACTIVE'  
,'-999'
,A.MKTNG_PGM_NBR
,A.REGIS_CNSMR_ID_VAL
FROM
DEPLOY_WORK.REGIS_PRSNA_DUP1 A
;
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L24C
ALTER TABLE DEPLOY_WORK.REGIS_PRSNA_DUP1
ADD NEW_REGIS_PRSNA_ID INTEGER;
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L24D
UPDATE DEPLOY_WORK.REGIS_PRSNA_DUP1
FROM (SEL REFERENCE_REGISTRATIONKEY,SYS_SOURCE,SYS_TARGET_ID,SYS_ERR_CODE,MAX(NEW_REGISTRATION_KEY) NEW_REGISTRATION_KEY
FROM TRILLIUM_MDM_REFERENCE_RG
WHERE SYS_ERR_CODE IS NOT NULL
AND SYS_SOURCE = '-999'
GROUP BY REFERENCE_REGISTRATIONKEY,SYS_SOURCE,SYS_TARGET_ID,SYS_ERR_CODE) B
SET NEW_REGIS_PRSNA_ID = CAST(TRIM(B.NEW_REGISTRATION_KEY) AS INTEGER)
WHERE DEPLOY_WORK.REGIS_PRSNA_DUP1.REGIS_PRSNA_ID=CAST(TRIM(B.REFERENCE_REGISTRATIONKEY) AS INTEGER)
AND DEPLOY_WORK.REGIS_PRSNA_DUP1.MKTNG_PGM_NBR=CAST(TRIM(B.SYS_TARGET_ID) AS INTEGER)
AND DEPLOY_WORK.REGIS_PRSNA_DUP1.REGIS_CNSMR_ID_VAL=B.SYS_ERR_CODE;
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
.LABEL L24E
COLLECT STATS DEPLOY_WORK.REGIS_PRSNA_DUP1
COLUMN MKTNG_PGM_NBR;
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
.LABEL L24F
COLLECT STATS DEPLOY_WORK.REGIS_PRSNA_DUP1
COLUMN REGIS_PRSNA_ID;
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L25A

UPDATE MDM.REGIS_PRSNA 
FROM DEPLOY_WORK.REGIS_PRSNA_DUP1 A
SET REGIS_PRSNA_ID=A.NEW_REGIS_PRSNA_ID
WHERE MDM.REGIS_PRSNA.REGIS_PRSNA_ID=A.REGIS_PRSNA_ID
AND MDM.REGIS_PRSNA.MKTNG_PGM_NBR=A.MKTNG_PGM_NBR;
	   
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L25B

UPDATE MDM.REGIS_PRSNA_PHONE 
FROM DEPLOY_WORK.REGIS_PRSNA_DUP1 A
SET REGIS_PRSNA_ID=A.NEW_REGIS_PRSNA_ID
WHERE MDM.REGIS_PRSNA_PHONE.REGIS_PRSNA_ID=A.REGIS_PRSNA_ID
AND MDM.REGIS_PRSNA_PHONE.MKTNG_PGM_NBR=A.MKTNG_PGM_NBR;
	   
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L25C

UPDATE MDM.REGIS_PRSNA_POSTL_ADDR 
FROM DEPLOY_WORK.REGIS_PRSNA_DUP1 A
SET REGIS_PRSNA_ID=A.NEW_REGIS_PRSNA_ID
WHERE MDM.REGIS_PRSNA_POSTL_ADDR.REGIS_PRSNA_ID=A.REGIS_PRSNA_ID
AND MDM.REGIS_PRSNA_POSTL_ADDR.MKTNG_PGM_NBR=A.MKTNG_PGM_NBR;
	   
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L25D

UPDATE MDM.REGIS_PRSNA_EMAIL_ADDR 
FROM DEPLOY_WORK.REGIS_PRSNA_DUP1 A
SET REGIS_PRSNA_ID=A.NEW_REGIS_PRSNA_ID
WHERE MDM.REGIS_PRSNA_EMAIL_ADDR.REGIS_PRSNA_ID=A.REGIS_PRSNA_ID
AND MDM.REGIS_PRSNA_EMAIL_ADDR.MKTNG_PGM_NBR=A.MKTNG_PGM_NBR;
	   
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L25E

UPDATE MDM.REGIS_PRSNA_SOC_NET_ACCT
FROM DEPLOY_WORK.REGIS_PRSNA_DUP1 A
SET REGIS_PRSNA_ID=A.NEW_REGIS_PRSNA_ID
WHERE MDM.REGIS_PRSNA_SOC_NET_ACCT.REGIS_PRSNA_ID=A.REGIS_PRSNA_ID
AND MDM.REGIS_PRSNA_SOC_NET_ACCT.MKTNG_PGM_NBR=A.MKTNG_PGM_NBR;
	   
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L25F

UPDATE MDM.PET 
FROM DEPLOY_WORK.REGIS_PRSNA_DUP1 A
SET REGIS_PRSNA_ID=A.NEW_REGIS_PRSNA_ID
WHERE MDM.PET.REGIS_PRSNA_ID=A.REGIS_PRSNA_ID
AND MDM.PET.MKTNG_PGM_NBR=A.MKTNG_PGM_NBR;
	   
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L25G

UPDATE MDM.PET_TRT 
FROM DEPLOY_WORK.REGIS_PRSNA_DUP1 A
SET REGIS_PRSNA_ID=A.NEW_REGIS_PRSNA_ID
WHERE MDM.PET_TRT.REGIS_PRSNA_ID=A.REGIS_PRSNA_ID
AND MDM.PET_TRT.MKTNG_PGM_NBR=A.MKTNG_PGM_NBR;
	   
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L25H

UPDATE MDM.DPEND
FROM DEPLOY_WORK.REGIS_PRSNA_DUP1 A
SET REGIS_PRSNA_ID=A.NEW_REGIS_PRSNA_ID
WHERE MDM.DPEND.REGIS_PRSNA_ID=A.REGIS_PRSNA_ID
AND MDM.DPEND.MKTNG_PGM_NBR=A.MKTNG_PGM_NBR;
	   
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L25I

UPDATE MDM.DPEND_TRT 
FROM DEPLOY_WORK.REGIS_PRSNA_DUP1 A
SET REGIS_PRSNA_ID=A.NEW_REGIS_PRSNA_ID
WHERE MDM.DPEND_TRT.REGIS_PRSNA_ID=A.REGIS_PRSNA_ID
AND MDM.DPEND_TRT.MKTNG_PGM_NBR=A.MKTNG_PGM_NBR;
	   
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L25J

UPDATE MDM.PRSNA_TRT 
FROM DEPLOY_WORK.REGIS_PRSNA_DUP1 A
SET REGIS_PRSNA_ID=A.NEW_REGIS_PRSNA_ID
WHERE MDM.PRSNA_TRT.REGIS_PRSNA_ID=A.REGIS_PRSNA_ID
AND MDM.PRSNA_TRT.MKTNG_PGM_NBR=A.MKTNG_PGM_NBR;
	   
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L25K

UPDATE MDM.CNSMR_AFFLTN
FROM DEPLOY_WORK.REGIS_PRSNA_DUP1 A
SET REGIS_PRSNA_ID=A.NEW_REGIS_PRSNA_ID
WHERE MDM.CNSMR_AFFLTN.REGIS_PRSNA_ID=A.REGIS_PRSNA_ID
AND MDM.CNSMR_AFFLTN.MKTNG_PGM_NBR=A.MKTNG_PGM_NBR;
	   
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L26

DEL FROM REGIS_PRSNA_EMAIL_ADDR
WHERE (REGIS_PRSNA_ID,MKTNG_PGM_NBR,CNTCT_POINT_CATEG_CODE)
IN (SEL REGIS_PRSNA_ID,MKTNG_PGM_NBR,CNTCT_POINT_CATEG_CODE
FROM REGIS_PRSNA_EMAIL_ADDR
WHERE SUBSCRPTN_OPT_IND IS NOT NULL
AND MKTNG_PGM_NBR IN (SELECT
       AV_CODE
  FROM ATTRIBUTE_VALUES
 WHERE AV_DESCRIPTION='Merge') 
GROUP BY 1,2,3)
AND SUBSCRPTN_OPT_IND IS NULL;
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L27

DEL FROM REGIS_PRSNA_POSTL_ADDR
WHERE (REGIS_PRSNA_ID,MKTNG_PGM_NBR,CNTCT_POINT_CATEG_CODE)
IN (SEL REGIS_PRSNA_ID,MKTNG_PGM_NBR,CNTCT_POINT_CATEG_CODE
FROM REGIS_PRSNA_POSTL_ADDR
WHERE SUBSCRPTN_OPT_IND IS NOT NULL
AND MKTNG_PGM_NBR IN (SELECT
       AV_CODE
  FROM ATTRIBUTE_VALUES
 WHERE AV_DESCRIPTION='Merge') 
GROUP BY 1,2,3)
AND SUBSCRPTN_OPT_IND IS NULL;
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L28

DEL FROM REGIS_PRSNA_PHONE
WHERE (REGIS_PRSNA_ID,MKTNG_PGM_NBR,CNTCT_POINT_CATEG_CODE)
IN (SEL REGIS_PRSNA_ID,MKTNG_PGM_NBR,CNTCT_POINT_CATEG_CODE
FROM REGIS_PRSNA_PHONE
WHERE SUBSCRPTN_OPT_IND IS NOT NULL
AND MKTNG_PGM_NBR IN (SELECT
       AV_CODE
  FROM ATTRIBUTE_VALUES
 WHERE AV_DESCRIPTION='Merge') 
GROUP BY 1,2,3)
AND SUBSCRPTN_OPT_IND IS NULL;
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L29

DEL FROM REGIS_PRSNA_SOC_NET_ACCT
WHERE (REGIS_PRSNA_ID,MKTNG_PGM_NBR,CNTCT_POINT_CATEG_CODE)
IN (SEL REGIS_PRSNA_ID,MKTNG_PGM_NBR,CNTCT_POINT_CATEG_CODE
FROM REGIS_PRSNA_SOC_NET_ACCT
WHERE SUBSCRPTN_OPT_IND IS NOT NULL
AND MKTNG_PGM_NBR IN (SELECT
       AV_CODE
  FROM ATTRIBUTE_VALUES
 WHERE AV_DESCRIPTION='Merge') 
GROUP BY 1,2,3)
AND SUBSCRPTN_OPT_IND IS NULL;
	   
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
	   
.LABEL L30	   
UPDATE REGIS_PRSNA_SOC_NET_ACCT
FROM LOAD_CONTROL B
SET SYS_CREATION_DATE=B.LOADENDTS,
SYS_LAST_MODIFIED_DATE=B.LOADENDTS
WHERE SYS_SOURCE='-10'
AND CAST(REGIS_PRSNA_SOC_NET_ACCT.SYS_SOURCE AS INTEGER)=B.LOAD_ID
AND LOAD_TYPE='MDM';	   
	   
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;	    

.LABEL L31

DEL FROM REGIS_PRSNA_EMAIL_ADDR
WHERE SYS_CREATION_DATE IS NULL 
AND SYS_LAST_MODIFIED_DATE IS NULL;
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L32

DEL FROM REGIS_PRSNA_POSTL_ADDR
WHERE SYS_CREATION_DATE IS NULL 
AND SYS_LAST_MODIFIED_DATE IS NULL;
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L33

DEL FROM REGIS_PRSNA_PHONE
WHERE SYS_CREATION_DATE IS NULL 
AND SYS_LAST_MODIFIED_DATE IS NULL;
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L34

DEL FROM REGIS_PRSNA_SOC_NET_ACCT
WHERE SYS_CREATION_DATE IS NULL 
AND SYS_LAST_MODIFIED_DATE IS NULL;
	   
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L35

REPLACE VIEW MDM.MKTNG_PGM (
MKTNG_PGM_NBR
,LEGAL_ENT_NBR
,MKTNG_PGM_NAME
,MKTNG_PGM_SHORT_NAME
,MKTNG_PGM_DESC
,MKTNG_PGM_STATUS
,MKTNG_PGM_BUSN_NAME
,SYS_SOURCE
,SYS_TARGET_ID
,SYS_AUTH_ID
,SYS_CREATED_BY
,SYS_CREATION_DATE
,SYS_LAST_MODIFIED_DATE
,SYS_ENT_STATE
,SYS_LAST_MODIFIED_BY
,SYS_NC_TYPE
,SYS_ERR_CODE
,SYS_ERR_SVRTY
) AS LOCKING ROW FOR ACCESS SEQUENCED  TRANSACTIONTIME SELECT
MKTNG_PGM_NBR
,LEGAL_ENT_NBR
,MKTNG_PGM_NAME
,MKTNG_PGM_SHORT_NAME
,MKTNG_PGM_DESC
,MKTNG_PGM_STATUS
,MKTNG_PGM_BUSN_NAME
,SYS_SOURCE
,SYS_TARGET_ID
,SYS_AUTH_ID
,SYS_CREATED_BY
,SYS_CREATION_DATE
,SYS_LAST_MODIFIED_DATE
,SYS_ENT_STATE
,SYS_LAST_MODIFIED_BY
,SYS_NC_TYPE
,SYS_ERR_CODE
,SYS_ERR_SVRTY
FROM iCRM_TBL.MKTNG_PGM;

.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L36
	REPLACE	VIEW MDM.V_CAMPAIGN	
		AS	
		LOCKING ROW FOR ACCESS	
		SELECT	
		A.REGIS_PRSNA_ID	
		,A.CAMPAIGN_ID	
		,A.PROMOTION_EMAIL_ADDR_TXT	
		,A.MKTNG_PGM_NBR	
		,C.MKTNG_PGM_DESC	
		,B.CAMPAIGN_NAME	
		,B.CAMPAIGN_CREATION_DT CAMPAIGN_EXEC_DATE	
		,NULL (INTEGER)   AS  SYS_TARGET_ID	
		 ,NULL (VARCHAR(25))  AS SYS_AUTH_ID	
		 ,NULL (VARCHAR(25))  AS SYS_SOURCE	
		 ,NULL (VARCHAR(70))  AS SYS_CREATED_BY	
		 ,NULL (TIMESTAMP(0))  AS SYS_CREATION_DATE	
		 ,'ACTIVE'  (VARCHAR(25))  AS  SYS_ENT_STATE	
		 ,NULL (VARCHAR(70))  AS SYS_LAST_MODIFIED_BY	
		 ,NULL (TIMESTAMP(0))  AS SYS_LAST_MODIFIED_DATE	
		 ,NULL (VARCHAR(25))  AS SYS_NC_TYPE	
		 ,NULL (VARCHAR(10000))  AS SYS_ERR_CODE	
		 ,NULL (VARCHAR(30))  AS SYS_ERR_SVRTY   	
			FROM CNSMR_PROMOTION A INNER JOIN CAMPAIGN B 
		ON	TRIM(A.CAMPAIGN_ID) = B.CAMPAIGN_ID 
		AND	A.MKTNG_PGM_NBR = B.MKTNG_PGM_NBR INNER JOIN MKTNG_PGM C 
		ON	A.MKTNG_PGM_NBR = C.MKTNG_PGM_NBR;

.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L37

REPLACE	VIEW MDM.V_LEGACY_CAMPAIGN
	AS		
	LOCKING ROW FOR ACCESS		
	SELECT		
	 A.REGIS_PRSNA_ID		
    ,A.CAMPAIGN_RUN_DTTM as SELECTION_DATE			
	,B.CAMPAIGN_NAME as CAMPAIGN_NAME		
    ,A.MKTNG_PGM_NBR			
    ,D.COMM_CHNL_NAME as CAMPAIGN_CHANNEL			
    ,E.MKTNG_PGM_NAME			
	,NULL (INTEGER)   AS  SYS_TARGET_ID		
	 ,NULL (VARCHAR(25))  AS SYS_AUTH_ID		
	 ,NULL (VARCHAR(25))  AS SYS_SOURCE		
	 ,NULL (VARCHAR(70))  AS SYS_CREATED_BY		
	 ,NULL (TIMESTAMP(0))  AS SYS_CREATION_DATE		
	 ,'ACTIVE'  (VARCHAR(25))  AS  SYS_ENT_STATE		
	 ,NULL (VARCHAR(70))  AS SYS_LAST_MODIFIED_BY		
	 ,NULL (TIMESTAMP(0))  AS SYS_LAST_MODIFIED_DATE		
	 ,NULL (VARCHAR(25))  AS SYS_NC_TYPE		
	 ,NULL (VARCHAR(10000))  AS SYS_ERR_CODE		
	 ,NULL (VARCHAR(30))  AS SYS_ERR_SVRTY   		
		FROM 	
		 MDM.CAMPAIGN_SGMNT_CNSMR   A 	 
        INNER JOIN MDM.CAMPAIGN B 			
	ON	A.CAMPAIGN_ID = B.CAMPAIGN_ID	
	INNER JOIN MDM.COMM_CHNL D		
	ON A.COMM_CHNL_CODE=D.COMM_CHNL_CODE		
	INNER JOIN MDM.MKTNG_PGM E		
	ON A.MKTNG_PGM_NBR=E.MKTNG_PGM_NBR	;
	
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
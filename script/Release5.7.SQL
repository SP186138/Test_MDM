.logon $TDPID/$TDUSER,$TDPWD


.SET ERROROUT STDOUT ;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
.SET SESSION CHARSET 'UTF8' ;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.GOTO $Step

.LABEL L0
 ALTER TABLE MDM.PRSNA_STG    ADD  PRSNA_STATUS_CODE VARCHAR(2) CHARACTER SET LATIN NOT CASESPECIFIC ;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 .LABEL L1
  ALTER TABLE MDM.PRSNA_POSTL_ADDR_STG    ADD  POSTL_ADDR_ID INTEGER,
ADD   CITY_CODE INTEGER,
ADD TERR_CODE CHAR(8) CHARACTER SET LATIN NOT CASESPECIFIC,
ADD PR_GEOCODE_FAIL VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
ADD TQ_GOUT_MATCH_LEVEL VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
ADD PR_REV_GROUP VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
ADD LAT_MEAS DECIMAL(8,6),
ADD LONG_MEAS DECIMAL(9,6),
ADD GL_ACCURACY BYTEINT,
ADD GL_MATCH_FLG VARCHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC,
ADD DR_CLEANSE_LVL BYTEINT,
ADD VALID_ADDR_IND CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 .LABEL L2
 ALTER TABLE MDM.RPT_LOAD_NBR
ADD WEBSITE_REGIS_NBR INTEGER;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
.LABEL L3
INSERT INTO MDM.ATTRIBUTE_VALUES 
sel max(av_id)+1,(sel ATTRIBUTE_TYPE_ID from ATTRIBUTE_TYPES where ATTRIBUTE_TYPE='Status'),'Y','Status','WR','Status',NULL,NULL,'BackEnd','Rel 5.7',current_date,'ACTIVE',NULL,NULL,NULL,NULL,NULL 
from ATTRIBUTE_VALUES;

.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
	  	  
.LABEL L4
UPDATE MDM.ID_SQR
FROM (SEL MAX(AV_ID)+1 AS SEQ_NBR FROM MDM.ATTRIBUTE_VALUES) B
SET SEQ_NR=B.SEQ_NBR
WHERE DOC_NAME='AVID_SEQ_ID';

 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE; 
 .LABEL L5
 CREATE SET TABLE MDM.POSTL_ADDR_ID_GEN ,NO FALLBACK ,
      NO BEFORE JOURNAL,
      NO AFTER JOURNAL,
      CHECKSUM = DEFAULT,
      DEFAULT MERGEBLOCKRATIO
      (
       POSTL_ADDR_ID INTEGER GENERATED ALWAYS AS IDENTITY
           (START WITH 1 
            INCREMENT BY 1 
            MINVALUE -2147483647 
            MAXVALUE 2147483647 
            NO CYCLE),
       ADDR_LINE_1_TXT VARCHAR(500) CHARACTER SET UNICODE NOT CASESPECIFIC,
       ADDR_LINE_2_TXT VARCHAR(500) CHARACTER SET UNICODE NOT CASESPECIFIC,
       ADDR_LINE_3_TXT VARCHAR(500) CHARACTER SET UNICODE NOT CASESPECIFIC,
       STRET_NUM VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
       STRET_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
       APT_NUM VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
       PO_BOX_NUM VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
       CITY_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
       POSTL_AREA_CODE VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
       TERR_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
       CNTRY_INFO_TXT VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
       CNTRY_CODE CHAR(5)  CHARACTER SET UNICODE NOT CASESPECIFIC,
       SYS_TARGET_ID INTEGER,
      SYS_AUTH_ID VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_SOURCE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC DEFAULT 'BACKEND',
      SYS_CREATED_BY VARCHAR(70) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_CREATION_DATE TIMESTAMP(0),
      SYS_ENT_STATE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_LAST_MODIFIED_BY VARCHAR(70) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_LAST_MODIFIED_DATE TIMESTAMP(0),
      SYS_NC_TYPE VARCHAR(25) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_ERR_CODE VARCHAR(10000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SYS_ERR_SVRTY VARCHAR(30) CHARACTER SET UNICODE NOT CASESPECIFIC)
UNIQUE PRIMARY INDEX ( ADDR_LINE_1_TXT,ADDR_LINE_2_TXT,ADDR_LINE_3_TXT,STRET_NUM,STRET_NAME,
APT_NUM,PO_BOX_NUM,CITY_NAME,POSTL_AREA_CODE,TERR_NAME,CNTRY_INFO_TXT );
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE; 
 
 .LABEL L6
 INS ATTRIBUTE_types
 (ATTRIBUTE_TYPE_ID             ,
 ATTRIBUTE_TYPE                ,
 DISPLAY_NAME                  ,
 DATA_TYPE                     ,
 DATA_FORMAT                   ,
 DATA_LENGTH                   ,
 SELECTION_METHOD              ,
 AV_CODE_FLAG                  ,
 AV_SHORT_NAME_FLAG            ,
 USER_MANAGED_FLAG             ,
 API                           ,
 SYS_TARGET_ID                 ,
 SYS_AUTH_ID                   ,
 SYS_SOURCE                    ,
 SYS_CREATED_BY                ,
 SYS_CREATION_DATE             ,
 SYS_ENT_STATE                 ,
 SYS_LAST_MODIFIED_BY          ,
 SYS_LAST_MODIFIED_DATE        ,
 SYS_NC_TYPE                   ,
 SYS_ERR_CODE                  ,
 SYS_ERR_SVRTY                 )
 SEL
 MAX(attribute_type_id)+1,
 'External Standardization',
 'External Standardization',
 'Text',
 'YYYY-MM-DD',
 5,
 'Default',
 'Y',
 'Y',
 'C',
 NULL,
 NULL,
 NULL,
 'BackEnd',
 NULL,
 CURRENT_TIMESTAMP(0),
 'ACTIVE',
 'RELEASE 5.7',
 CURRENT_TIMESTAMP(0),
 NULL,
 NULL,
 NULL
 FROM ATTRIBUTE_types;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 
  .LABEL L6A
  INS ATTRIBUTE_types
  (ATTRIBUTE_TYPE_ID             ,
  ATTRIBUTE_TYPE                ,
  DISPLAY_NAME                  ,
  DATA_TYPE                     ,
  DATA_FORMAT                   ,
  DATA_LENGTH                   ,
  SELECTION_METHOD              ,
  AV_CODE_FLAG                  ,
  AV_SHORT_NAME_FLAG            ,
  USER_MANAGED_FLAG             ,
  API                           ,
  SYS_TARGET_ID                 ,
  SYS_AUTH_ID                   ,
  SYS_SOURCE                    ,
  SYS_CREATED_BY                ,
  SYS_CREATION_DATE             ,
  SYS_ENT_STATE                 ,
  SYS_LAST_MODIFIED_BY          ,
  SYS_LAST_MODIFIED_DATE        ,
  SYS_NC_TYPE                   ,
  SYS_ERR_CODE                  ,
  SYS_ERR_SVRTY                 )
  SEL
  MAX(attribute_type_id)+1,
  'External Standardization-Country',
  'External Standardization-Country',
  'Text',
  'YYYY-MM-DD',
  5,
  'Default',
  'Y',
  'Y',
  'C',
  NULL,
  NULL,
  NULL,
  'BackEnd',
  NULL,
  CURRENT_TIMESTAMP(0),
  'ACTIVE',
  'RELEASE 5.7',
  CURRENT_TIMESTAMP(0),
  NULL,
  NULL,
  NULL
  FROM ATTRIBUTE_types;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 
 .LABEL L7
 INSERT INTO MDM.ATTRIBUTE_VALUES 
 sel max(av_id)+1,(sel ATTRIBUTE_TYPE_ID from ATTRIBUTE_TYPES where ATTRIBUTE_TYPE='External Standardization'),'Y','External Standardization','35','External',NULL,NULL,'BackEnd','Rel 5.7',current_date,'ACTIVE',NULL,NULL,NULL,NULL,NULL 
 from ATTRIBUTE_VALUES;
 
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 
  .LABEL L7A
  INSERT INTO MDM.ATTRIBUTE_VALUES 
  sel max(av_id)+1,(sel ATTRIBUTE_TYPE_ID from ATTRIBUTE_TYPES where ATTRIBUTE_TYPE='External Standardization-Country'),'Y','External Standardization-Country','PRT','CNTRY',NULL,NULL,'BackEnd','Rel 5.7',current_date,'ACTIVE',NULL,NULL,NULL,NULL,NULL 
  from ATTRIBUTE_VALUES;
  
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 
  .LABEL L8
  INSERT INTO MDM.ATTRIBUTE_VALUES 
  sel max(av_id)+1,(sel ATTRIBUTE_TYPE_ID from ATTRIBUTE_TYPES where ATTRIBUTE_TYPE='External Standardization'),'Y','External Standardization','22','External',NULL,NULL,'BackEnd','Rel 5.7',current_date,'ACTIVE',NULL,NULL,NULL,NULL,NULL 
  from ATTRIBUTE_VALUES;
  
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 
   .LABEL L8A
   INSERT INTO MDM.ATTRIBUTE_VALUES 
   sel max(av_id)+1,(sel ATTRIBUTE_TYPE_ID from ATTRIBUTE_TYPES where ATTRIBUTE_TYPE='External Standardization-Country'),'Y','External Standardization-Country','ESP','CNTRY',NULL,NULL,'BackEnd','Rel 5.7',current_date,'ACTIVE',NULL,NULL,NULL,NULL,NULL 
   from ATTRIBUTE_VALUES;
   
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 	  	  
 .LABEL L9
 UPDATE MDM.ID_SQR
 FROM (SEL MAX(AV_ID)+1 AS SEQ_NBR FROM MDM.ATTRIBUTE_VALUES) B
 SET SEQ_NR=B.SEQ_NBR
WHERE DOC_NAME='AVID_SEQ_ID';
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
  .LABEL L10
 ALTER TABLE MDM.ADDR_INPUT
 ADD  POSTL_ADDR_ID INTEGER; 
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE; 
  .LABEL L11 
 REPLACE VIEW MDM.POSTL_ADDR
AS LOCKING ROW FOR ACCESS
SEL * FROM  icrm_tbl.POSTL_ADDR;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 .LABEL L12
 REPLACE VIEW MDM.REGIS_PRSNA_OPT_HIST 
 AS
 LOCKING ROW FOR ACCESS
 SELECT
 REGIS_PRSNA_ID                ,
 MKTNG_PGM_NBR                 ,
 LEGAL_ENT_NBR                 ,
 DATA_SRCE_NBR                 ,
 SUBSCRIPTION_NBR              ,
 FIRST_NAME                    ,
 LAST_NAME                     ,
 EMAIL_ADDR_TEXT               ,
 CONTACT_PHONE_NBR             ,
 SRC_ADDR_LINE_1_TXT           ,
 SRC_ADDR_LINE_2_TXT           ,
 SRC_ADDR_LINE_3_TXT           ,
 SRC_CITY_NAME                 ,
 SRC_STATE                     ,
 SRC_ZIP                       ,
 SRC_CNTRY_NAME                ,
 ADDR_LINE_1_TXT               ,
 ADDR_LINE_2_TXT               ,
 ADDR_LINE_3_TXT               ,
 CITY_NAME                     ,
 TERR_NAME                     ,
 POSTL_AREA_CODE               ,
 CNTRY_NAME                    ,
 OPT_IND                       ,
 OPT_TIME                  ,
 OPT_REASN_TXT             ,
 OPT_TYPE_CODE,
 LAST_ACTIVITY_TM              ,
 LOG_SOURCE_ID                 ,
 LOG_UPDATE_USER               ,
 LOG_LOAD_ID                  ,
 PE_OPTOUT_ID              ,
 NATIONAL_ID_NBR           ,
 CHANNEL_IND               ,
 OPT_LEVEL_IND             ,
 POSTL_ADDR_ID
FROM ICRM_TBL.REGIS_PRSNA_OPT_HIST ;
  .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 .LABEL L13
 REPLACE VIEW MDM.MATCHD_CNSMR_POSTL_ADDR (
 MATCHD_CNSMR_PRSNA_ID
 ,LEGAL_ENT_NBR
 ,CNTCT_POINT_CATEG_CODE
 ,VALID_CNTCT_POINT_IND
 ,PREF_CNTCT_POINT_IND
 ,ADDR_LINE_1_TXT
 ,ADDR_LINE_2_TXT
 ,ADDR_LINE_3_TXT
 ,STRET_NUM
 ,STRET_NAME
 ,APT_NUM
 ,PO_BOX_NUM
 ,CITY_NAME
 ,CITY_CODE
 ,POSTL_AREA_CODE
 ,LAT_MEAS
 ,LONG_MEAS
 ,TERR_NAME
 ,TERR_CODE
 ,CNTRY_CODE
,POSTL_ADDR_ID
 ,SYS_SOURCE
 ,SYS_TARGET_ID
 ,SYS_AUTH_ID
 ,SYS_CREATED_BY
 ,SYS_CREATION_DATE
 ,SYS_LAST_MODIFIED_DATE
 ,SYS_ENT_STATE
 ,SYS_LAST_MODIFIED_BY
 ,SYS_NC_TYPE
 ,SYS_ERR_CODE
 ,SYS_ERR_SVRTY
 ) AS LOCKING ROW FOR ACCESS SEQUENCED  TRANSACTIONTIME SELECT
 MATCHD_CNSMR_PRSNA_ID
 ,LEGAL_ENT_NBR
 ,CNTCT_POINT_CATEG_CODE
 ,VALID_CNTCT_POINT_IND
 ,PREF_CNTCT_POINT_IND
 ,ADDR_LINE_1_TXT
 ,ADDR_LINE_2_TXT
 ,ADDR_LINE_3_TXT
 ,STRET_NUM
 ,STRET_NAME
 ,APT_NUM
 ,PO_BOX_NUM
 ,CITY_NAME
 ,CITY_CODE
 ,POSTL_AREA_CODE
 ,LAT_MEAS
 ,LONG_MEAS
 ,TERR_NAME
 ,TERR_CODE
 ,CNTRY_CODE
,POSTL_ADDR_ID
 ,SYS_SOURCE
 ,SYS_TARGET_ID
 ,SYS_AUTH_ID
 ,SYS_CREATED_BY
 ,SYS_CREATION_DATE
 ,SYS_LAST_MODIFIED_DATE
 ,SYS_ENT_STATE
 ,SYS_LAST_MODIFIED_BY
 ,SYS_NC_TYPE
 ,SYS_ERR_CODE
 ,SYS_ERR_SVRTY
FROM iCRM_TBL.MATCHD_CNSMR_POSTL_ADDR;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 .LABEL L14
REPLACE VIEW MDM.REGIS_PRSNA_POSTL_ADDR (
CNTCT_POINT_CATEG_CODE
,REGIS_PRSNA_ID
,MKTNG_PGM_NBR
,LEGAL_ENT_NBR
,WIN_KEY
,SUBSCRPTN_OPT_NBR
,SUBSCRPTN_OPT_IND
,CNSMR_CHCE_DATETM
,PREF_CNTCT_POINT_IND
,ADDR_LINE_1_TXT
,ADDR_LINE_2_TXT
,ADDR_LINE_3_TXT
,STRET_NUM
,STRET_NAME
,APT_NUM
,PO_BOX_NUM
,CITY_NAME
,CITY_CODE
,POSTL_AREA_CODE
,TERR_CODE
,CNTRY_CODE
,LAT_MEAS
,LONG_MEAS
,GL_ACCURACY
,GL_MATCH_FLG
,DR_CLEANSE_LVL
,VALID_CNTCT_POINT_IND
,GUARDN_NAME
,GUARDN_EMAIL_ADDR_TXT
,GUARDN_CNSNT_IND
,ACNLGMT_DATE
,POSTL_STATUS_CODE
,PR_GEOCODE_FAIL
,TQ_GOUT_MATCH_LEVEL
,PR_REV_GROUP
,DATA_SRCE_NBR
,TERR_NAME
,POSTL_ADDR_ID
,SYS_SOURCE
,SYS_TARGET_ID
,SYS_AUTH_ID
,SYS_CREATED_BY
,SYS_CREATION_DATE
,SYS_LAST_MODIFIED_DATE
,SYS_ENT_STATE
,SYS_LAST_MODIFIED_BY
,SYS_NC_TYPE
,SYS_ERR_CODE
,SYS_ERR_SVRTY
,LAST_RTN_DATETM
) AS LOCKING ROW FOR ACCESS SEQUENCED  TRANSACTIONTIME SELECT
CNTCT_POINT_CATEG_CODE
,REGIS_PRSNA_ID
,MKTNG_PGM_NBR
,LEGAL_ENT_NBR
,WIN_KEY
,SUBSCRPTN_OPT_NBR
,SUBSCRPTN_OPT_IND
,CNSMR_CHCE_DATETM
,PREF_CNTCT_POINT_IND
,ADDR_LINE_1_TXT
,ADDR_LINE_2_TXT
,ADDR_LINE_3_TXT
,STRET_NUM
,STRET_NAME
,APT_NUM
,PO_BOX_NUM
,CITY_NAME
,CITY_CODE
,POSTL_AREA_CODE
,TERR_CODE
,CNTRY_CODE
,LAT_MEAS
,LONG_MEAS
,GL_ACCURACY
,GL_MATCH_FLG
,DR_CLEANSE_LVL
,VALID_CNTCT_POINT_IND
,GUARDN_NAME
,GUARDN_EMAIL_ADDR_TXT
,GUARDN_CNSNT_IND
,ACNLGMT_DATE
,POSTL_STATUS_CODE
,PR_GEOCODE_FAIL
,TQ_GOUT_MATCH_LEVEL
,PR_REV_GROUP
,DATA_SRCE_NBR
,TERR_NAME
,POSTL_ADDR_ID
,SYS_SOURCE
,SYS_TARGET_ID
,SYS_AUTH_ID
,SYS_CREATED_BY
,SYS_CREATION_DATE
,SYS_LAST_MODIFIED_DATE
,SYS_ENT_STATE
,SYS_LAST_MODIFIED_BY
,SYS_NC_TYPE
,SYS_ERR_CODE
,SYS_ERR_SVRTY
,LAST_RTN_DATETM
FROM iCRM_TBL.REGIS_PRSNA_POSTL_ADDR;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 .LABEL L15
REPLACE VIEW MDM.REGIS_PRSNA_OPT_OUT_HIST 
AS
LOCKING ROW FOR ACCESS
SELECT
REGIS_PRSNA_ID                ,
MKTNG_PGM_NBR                 ,
LEGAL_ENT_NBR                 ,
DATA_SRCE_NBR                 ,
SUBSCRIPTION_NBR              ,
FIRST_NAME                    ,
LAST_NAME                     ,
EMAIL_ADDR_TEXT               ,
CONTACT_PHONE_NBR             ,
SRC_ADDR_LINE_1_TXT           ,
SRC_ADDR_LINE_2_TXT           ,
SRC_ADDR_LINE_3_TXT           ,
SRC_CITY_NAME                 ,
SRC_STATE                     ,
SRC_ZIP                       ,
SRC_CNTRY_NAME                ,
ADDR_LINE_1_TXT               ,
ADDR_LINE_2_TXT               ,
ADDR_LINE_3_TXT               ,
CITY_NAME                     ,
TERR_NAME                     ,
POSTL_AREA_CODE               ,
CNTRY_NAME                    ,
OPT_IND                       ,
OPT_TIME                  ,
OPT_REASN_TXT             ,
OPT_TYPE_CODE,
LAST_ACTIVITY_TM              ,
LOG_SOURCE_ID                 ,
LOG_UPDATE_USER               ,
LOG_LOAD_ID                  ,
PE_OPTOUT_ID              ,
NATIONAL_ID_NBR           ,
CHANNEL_IND               ,
OPT_LEVEL_IND             ,
POSTL_ADDR_ID
FROM ICRM_TBL.REGIS_PRSNA_OPT_HIST 
;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 .LABEL L16
REPLACE VIEW MDM.STORE 
AS LOCKING ROW FOR ACCESS 
SELECT
STORE_NBR
,RETLR_NBR
,STORE_NAME
,STORE_NAME_NTV
,STORE_STATUS_CD
,STORE_TYPE_CODE
,ADDR_LINE_1_TXT
,ADDR_LINE_2_TXT
,ADDR_LINE_3_TXT
,STRET_NUM
,STRET_NAME
,APT_NUM
,PO_BOX_NUM
,CITY_CODE
,CITY_NAME
,TERR_CODE
,TERR_NAME
,CNTRY_CODE
,POSTL_AREA_CODE
,LAT_MEAS
,LONG_MEAS
,GL_ACCURACY
,GL_MATCH_FLG
,DR_CLEANSE_LVL
,DATA_SRCE_NBR
,ALT_STORE_ID
,STORE_PHN_NBR
,VALID_CNTCT_POINT_IND
,PR_GEOCODE_FAIL
,TQ_GOUT_MATCH_LEVEL
,PR_REV_GROUP
,POSTL_ADDR_ID
,LOG_SOURCE_ID
,LOG_UPDATE_USER
,LOG_LOAD_ID
,SYS_SOURCE
,SYS_TARGET_ID
,SYS_AUTH_ID
,SYS_CREATED_BY
,SYS_CREATION_DATE
,SYS_LAST_MODIFIED_DATE
,SYS_ENT_STATE
,SYS_LAST_MODIFIED_BY
,SYS_NC_TYPE
,SYS_ERR_CODE
,SYS_ERR_SVRTY
FROM iCRM_TBL.STORE;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 .LABEL L17
 REPLACE VIEW MDM.NCOA_ADDR_STG (
 
 MATCHD_CNSMR_PRSNA_ID,
 MKTNG_PGM_NBR,
 REGIS_PRSNA_ID,
 NEW_ADDRESS1,
 NEW_ADDRESS2,
 NEW_CITY,
 NEW_STATE,
 NEW_ZIP,
 NEW_COUNTRY,
 NCOA_DROP,
 DECEASED,
 DMA_DO_NOT_MAIL,
 NEW_ADDRESS_PRESENT,
 ADDR_LINE_1_TXT,
 ADDR_LINE_2_TXT,
 ADDR_LINE_3_TXT,
 STRET_NAME,
 STRET_NUM,
 APT_NUM,
 CITY_NAME,
 TERR_NAME,
 POSTL_AREA_CODE,
 CNTRY_NAME,
 WIN_KEY,
 LOAD_ID,
 LOAD_TS,
 MDM_LOAD_IND
 ,GL_ACCURACY  
 ,GL_MATCH_FLG  
 ,GL_LATITUDE  
 ,GL_LONGITUDE  
 ,DR_CLEANSE_LVL 
 ,VALID_CNTCT_POINT_IND
 ,PR_GEOCODE_FAIL 
 ,PR_REV_GROUP
 ,POSTL_ADDR_ID
 ) AS LOCKING ROW FOR ACCESS SELECT
 MATCHD_CNSMR_PRSNA_ID,
 MKTNG_PGM_NBR,
 REGIS_PRSNA_ID,
 NEW_ADDRESS1,
 NEW_ADDRESS2,
 NEW_CITY,
 NEW_STATE,
 NEW_ZIP,
 NEW_COUNTRY,
 NCOA_DROP,
 DECEASED,
 DMA_DO_NOT_MAIL,
 NEW_ADDRESS_PRESENT,
 ADDR_LINE_1_TXT,
 ADDR_LINE_2_TXT,
 ADDR_LINE_3_TXT,
 STRET_NAME,
 STRET_NUM,
 APT_NUM,
 CITY_NAME,
 TERR_NAME,
 POSTL_AREA_CODE,
 CNTRY_NAME,
 WIN_KEY,
 LOAD_ID,
 LOAD_TS,
 MDM_LOAD_IND
 ,GL_ACCURACY  
 ,GL_MATCH_FLG  
 ,GL_LATITUDE  
 ,GL_LONGITUDE  
 ,DR_CLEANSE_LVL 
 ,VALID_CNTCT_POINT_IND
 ,PR_GEOCODE_FAIL 
 ,PR_REV_GROUP
 ,POSTL_ADDR_ID
FROM  ICRM_STAGE_TBL.NCOA_ADDR_STG;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 .LABEL L18
 REPLACE VIEW MDM.STORE_STG (
 RETLR_NAME, RETLR_NAME_NTV, PARENT_RETLR_NAME, PARENT_RETLR_NAME_NTV,
                                 STORE_NAME, STORE_NAME_NTV, STORE_PHN_NBR, STORE_TYPE_CODE, ALT_STORE_ID,
                                 DATA_SRCE_NBR, ADDR_LINE_1_TEXT, ADDR_LINE_2_TEXT, ADDR_LINE_3_TEXT,
                                 CITY_NAME, CITY_CODE, TERR_NAME, TERR_CODE, POSTL_AREA_CODE,
                                 CNTRY_CODE, ADDR_LINE_1, ADDR_LINE_2, ADDR_LINE_3, CITY, TERR,
                                 POSTL_AREA_CD, CNTRY_CD, STORE_STATUS_CD, LONG_MEAS, LAT_MEAS,
                                 GL_ACCURACY, GL_MATCH_FLG, DR_CLEANSE_LVL, LOAD_ID, LOAD_TS,
                                 MDM_LOAD_IND,POSTL_ADDR_ID
 
 ) AS LOCKING ROW FOR ACCESS SELECT                RETLR_NAME, RETLR_NAME_NTV, PARENT_RETLR_NAME, PARENT_RETLR_NAME_NTV,
                                 STORE_NAME, STORE_NAME_NTV, STORE_PHN_NBR, STORE_TYPE_CODE, ALT_STORE_ID,
                                 DATA_SRCE_NBR, ADDR_LINE_1_TEXT, ADDR_LINE_2_TEXT, ADDR_LINE_3_TEXT,
                                 CITY_NAME, CITY_CODE, TERR_NAME, TERR_CODE, POSTL_AREA_CODE,
                                 CNTRY_CODE, ADDR_LINE_1, ADDR_LINE_2, ADDR_LINE_3, CITY, TERR,
                                 POSTL_AREA_CD, CNTRY_CD, STORE_STATUS_CD, LONG_MEAS, LAT_MEAS,
                                 GL_ACCURACY, GL_MATCH_FLG, DR_CLEANSE_LVL, LOAD_ID, LOAD_TS,
                                 MDM_LOAD_IND,POSTL_ADDR_ID
FROM   ICRM_STAGE_TBL.STORE_STG;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 .LABEL L19
 REPLACE VIEW MDM.REG_OPT_OUT_STG 
 AS LOCKING ROW FOR ACCESS
 SELECT
 OPTOUT_ID                     ,
 MKTNG_PGM_NBR                 ,
 SUBSCRPTN_OPT_NBR             ,
 FNAME                         ,
 LNAME                         ,
 EMAIL                         ,
 PHONE                         ,
 S_ADD1                        ,
 S_ADD2                        ,
 S_ADD3                        ,
 S_CITY                        ,
 S_STATE                       ,
 S_ZIP                         ,
 S_COUNTRY                     ,
 OPT_OUT_DTTIME                ,
 ADDR_LINE_1_TXT               ,
 ADDR_LINE_2_TXT               ,
 ADDR_LINE_3_TXT               ,
 CITY_NAME                     ,
 TERR_NAME                     ,
 POSTL_AREA_CODE               ,
 CNTRY_CODE                    ,
 LOAD_ID                       ,
 LOAD_TS                       ,
 MDM_LOAD_IND                  ,
 POSTL_ADDR_ID,
 LEGAL_ENT_NBR
 FROM ICRM_STAGE_TBL.REG_OPT_OUT_STG
;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 .LABEL L20
 INS MDM.CNTCT_POINT_CATEG
 (CNTCT_POINT_CATEG_CODE,CNTCT_POINT_CATEG_NAME,CNTCT_POINT_TYPE_CODE,INTRN_NETWK_IND,LOG_SOURCE_ID,LOG_UPDATE_USER,LOG_LOAD_ID)
VALUES('PN','Pull channel non PII','W',,,'dba','1'); 
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 .LABEL L21
 INS MDM.CNTCT_CHANL_TYPE
 (CNTCT_CHANL_TYPE_CODE,CNTCT_CHANL_TYPE_NAME,LOG_SOURCE_ID,LOG_UPDATE_USER,LOG_LOAD_ID)
VALUES('W','Website Pull',,'ETL','1');
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 .LABEL L22
 INS MDM.SUBSCRPTN_OPT
 (SUBSCRPTN_OPT_NBR,MKTNG_PGM_NBR,LEGAL_ENT_NBR,SUBSCRPTN_OPT_NAME,SUBSCRPTN_OPT_STMT_TXT,SUBSCRPTN_VERSION_NBR,PARNTL_CNSNT_IND,SYS_SOURCE,SYS_TARGET_ID,SYS_AUTH_ID,SYS_CREATED_BY,SYS_CREATION_DATE,SYS_LAST_MODIFIED_DATE,SYS_ENT_STATE,SYS_LAST_MODIFIED_BY,SYS_NC_TYPE,SYS_ERR_CODE,SYS_ERR_SVRTY)
VALUES(-99,9999,99,'Pull channel non PII','Pull channel non PII',1,,'Backend',,,'Release 5.7',CURRENT_TIMESTAMP(0),CURRENT_TIMESTAMP(0),'ACTIVE','Release 5.7','INSERT',,);
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 .LABEL L23
  INS ATTRIBUTE_types
  (ATTRIBUTE_TYPE_ID             ,
  ATTRIBUTE_TYPE                ,
  DISPLAY_NAME                  ,
  DATA_TYPE                     ,
  DATA_FORMAT                   ,
  DATA_LENGTH                   ,
  SELECTION_METHOD              ,
  AV_CODE_FLAG                  ,
  AV_SHORT_NAME_FLAG            ,
  USER_MANAGED_FLAG             ,
  API                           ,
  SYS_TARGET_ID                 ,
  SYS_AUTH_ID                   ,
  SYS_SOURCE                    ,
  SYS_CREATED_BY                ,
  SYS_CREATION_DATE             ,
  SYS_ENT_STATE                 ,
  SYS_LAST_MODIFIED_BY          ,
  SYS_LAST_MODIFIED_DATE        ,
  SYS_NC_TYPE                   ,
  SYS_ERR_CODE                  ,
  SYS_ERR_SVRTY                 )
  SEL
  MAX(attribute_type_id)+1,
  'Ignore Channel Class',
  'Ignore Channel Class',
  'Text',
  'YYYY-MM-DD',
  5,
  'Default',
  'Y',
  'Y',
  'C',
  NULL,
  NULL,
  NULL,
  'BackEnd',
  NULL,
  CURRENT_TIMESTAMP(0),
  'ACTIVE',
  'RELEASE 5.7',
  CURRENT_TIMESTAMP(0),
  NULL,
  NULL,
  NULL
  FROM ATTRIBUTE_types;
  .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
  
  .LABEL L24
  INSERT INTO MDM.ATTRIBUTE_VALUES 
  sel max(av_id)+1,(sel ATTRIBUTE_TYPE_ID from ATTRIBUTE_TYPES where ATTRIBUTE_TYPE='Ignore Channel Class'),'Y','Pull PII','Ignore Channel Class','Ignore Channel Class',NULL,NULL,'BackEnd','Rel 5.7',current_date,'ACTIVE',NULL,NULL,NULL,NULL,NULL 
  from ATTRIBUTE_VALUES;
  
  .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
  
   .LABEL L25
   INSERT INTO MDM.ATTRIBUTE_VALUES 
   sel max(av_id)+1,(sel ATTRIBUTE_TYPE_ID from ATTRIBUTE_TYPES where ATTRIBUTE_TYPE='Ignore Channel Class'),'Y','Pull non PII','Ignore Channel Class','Ignore Channel Class',NULL,NULL,'BackEnd','Rel 5.7',current_date,'ACTIVE',NULL,NULL,NULL,NULL,NULL 
   from ATTRIBUTE_VALUES;
   
  .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
  
   .LABEL L26
   INSERT INTO MDM.ATTRIBUTE_VALUES 
   sel max(av_id)+1,(sel ATTRIBUTE_TYPE_ID from ATTRIBUTE_TYPES where ATTRIBUTE_TYPE='Ignore Channel Class'),'Y','Pull Channel Class','Ignore Channel Class','Ignore Channel Class',NULL,NULL,'BackEnd','Rel 5.7',current_date,'ACTIVE',NULL,NULL,NULL,NULL,NULL 
   from ATTRIBUTE_VALUES;
   
  .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;  
  	  	  
  .LABEL L27
  UPDATE MDM.ID_SQR
  FROM (SEL MAX(AV_ID)+1 AS SEQ_NBR FROM MDM.ATTRIBUTE_VALUES) B
  SET SEQ_NR=B.SEQ_NBR
 WHERE DOC_NAME='AVID_SEQ_ID';
 
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 
 .LABEL L28
 
 REPLACE VIEW MDM.REQSTD_INCTV (
  CNSMR_ACTN_ID
 ,TRM_LEAD_KEY
 ,INCTV_NBR
 ,MKTNG_PGM_NBR
 ,PROD_ITEM_UPC
 ,ORDER_NUM
 ,ORDER_STATUS
 ,SHIPPED_DATE
 ,COURIER_URL
 ,TRACKING_NUM
 ,LOG_SOURCE_ID
 ,LOG_UPDATE_USER
 ,LOG_LOAD_ID
) AS LOCKING ROW FOR ACCESS SELECT
  CNSMR_ACTN_ID
 ,TRM_LEAD_KEY
 ,INCTV_NBR
 ,MKTNG_PGM_NBR
 ,PROD_ITEM_UPC
 ,ORDER_NUM
 ,ORDER_STATUS
 ,SHIPPED_DATE
 ,COURIER_URL
 ,TRACKING_NUM
 ,LOG_SOURCE_ID
 ,LOG_UPDATE_USER
 ,LOG_LOAD_ID
FROM iCRM_TBL.REQSTD_INCTV;

 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 
  .LABEL L29
  
  REPLACE VIEW MDM.V_SAMPLE 
(MKTNG_PGM_NBR   
,REGIS_PRSNA_ID   
,CNSMR_ACTN_TYPE_CODE   
,CNSMR_ACTN_NUM   
,LEGAL_ENT_NBR   
,CNSMR_ACTN_ID   
,INCTV_NBR   
,PROD_ITEM_NUM   
,ORDER_NUM   
,ORDER_STATUS   
,SHIPPED_DATE   
,COURIER_URL   
,TRACKING_NBR   
 ,SYS_TARGET_ID,   
 SYS_AUTH_ID,   
 SYS_SOURCE,   
 SYS_CREATED_BY,   
 SYS_CREATION_DATE,   
 SYS_ENT_STATE,   
 SYS_LAST_MODIFIED_BY,   
 SYS_LAST_MODIFIED_DATE,   
 SYS_NC_TYPE,   
 SYS_ERR_CODE,   
 SYS_ERR_SVRTY   
)AS LOCKING ROW FOR ACCESS   
SELECT   
CA.MKTNG_PGM_NBR   
,CA.REGIS_PRSNA_ID   
,CA.CNSMR_ACTN_TYPE_CODE   
,CA.CNSMR_ACTN_NUM   
,CA.LEGAL_ENT_NBR   
,RQI.CNSMR_ACTN_ID   
,RQI.INCTV_NBR   
,RQI.PROD_ITEM_UPC   
,RQI.ORDER_NUM   
,RQI.ORDER_STATUS   
,RQI.SHIPPED_DATE   
,RQI.COURIER_URL   
,RQI.TRACKING_NUM   
,NULL (INTEGER)   AS  SYS_TARGET_ID,   
NULL (VARCHAR(25))  AS SYS_AUTH_ID,   
NULL (VARCHAR(25))  AS SYS_SOURCE,   
NULL (VARCHAR(70))  AS SYS_CREATED_BY,   
NULL (TIMESTAMP(0))  AS SYS_CREATION_DATE,   
'ACTIVE'  (VARCHAR(25))  AS  SYS_ENT_STATE,   
NULL (VARCHAR(70))  AS SYS_LAST_MODIFIED_BY,   
NULL (TIMESTAMP(0))  AS SYS_LAST_MODIFIED_DATE,    
NULL (VARCHAR(25))  AS SYS_NC_TYPE,   
NULL (VARCHAR(10000))  AS SYS_ERR_CODE,   
NULL (VARCHAR(30))  AS SYS_ERR_SVRTY                                                              
FROM REQSTD_INCTV RQI   
LEFT JOIN   
CNSMR_ACTN CA   
ON   
RQI.CNSMR_ACTN_ID=CA.CNSMR_ACTN_ID
AND RQI.MKTNG_PGM_NBR=CA.MKTNG_PGM_NBR
WHERE CA.CNSMR_ACTN_TYPE_CODE = 'RS'   
AND RQI.ORDER_STATUS = 'D'   
;
  .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
  
    .LABEL L30
	
	DROP VIEW V_COMMUNICATIONS;
	
  .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
  
    .LABEL L31
	
	DROP VIEW V_CAMPAIGN;
	
  .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
  
    .LABEL L32
	
	RENAME VIEW V_LEGACY_CAMPAIGN TO V_CAMPAIGN;
	
  .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
  
    .LABEL L33
	
REPLACE VIEW MDM.V_CAMPAIGN
	AS		
	LOCKING ROW FOR ACCESS		
	SELECT		
	 A.REGIS_PRSNA_ID
	 ,A.CAMPAIGN_ID			
   	,B.CAMPAIGN_NAME AS CAMPAIGN_NAME		
    ,A.MKTNG_PGM_NBR			
    ,D.COMM_CHNL_NAME AS CAMPAIGN_CHANNEL			
 	,A.CAMPAIGN_RUN_DTTM AS CAMPAIGN_EXEC_DATE
	,E.MKTNG_PGM_NAME AS MKTNG_PGM_DESC
	,D.COMM_CHNL_NAME AS PROMOTION_EMAIL_ADDR_TXT	
	,NULL (INTEGER)   AS  SYS_TARGET_ID		
	 ,NULL (VARCHAR(25))  AS SYS_AUTH_ID		
	 ,NULL (VARCHAR(25))  AS SYS_SOURCE		
	 ,NULL (VARCHAR(70))  AS SYS_CREATED_BY		
	 ,NULL (TIMESTAMP(0))  AS SYS_CREATION_DATE		
	 ,'ACTIVE'  (VARCHAR(25))  AS  SYS_ENT_STATE		
	 ,NULL (VARCHAR(70))  AS SYS_LAST_MODIFIED_BY		
	 ,NULL (TIMESTAMP(0))  AS SYS_LAST_MODIFIED_DATE		
	 ,NULL (VARCHAR(25))  AS SYS_NC_TYPE		
	 ,NULL (VARCHAR(10000))  AS SYS_ERR_CODE		
	 ,NULL (VARCHAR(30))  AS SYS_ERR_SVRTY   		
		FROM 	
		 MDM.CAMPAIGN_SGMNT_CNSMR   A 	 
        INNER JOIN MDM.CAMPAIGN B 			
	ON	A.CAMPAIGN_ID = B.CAMPAIGN_ID	
	INNER JOIN MDM.COMM_CHNL D		
	ON A.COMM_CHNL_CODE=D.COMM_CHNL_CODE
AND D.COMM_CHNL_NAME NOT IN (SEL AV_DESCRIPTION FROM ATTRIBUTE_VALUES
 WHERE SYS_ENT_STATE='ACTIVE' AND ATTRIBUTE_TYPE_ID IN
 (SEL ATTRIBUTE_TYPE_ID 
 FROM ATTRIBUTE_TYPES
 WHERE ATTRIBUTE_TYPE='Ignore Channel Class'))	
	INNER JOIN MDM.MKTNG_PGM E		
	ON A.MKTNG_PGM_NBR=E.MKTNG_PGM_NBR;
	
  .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
  
   .LABEL L34
   
  REPLACE VIEW MDM.V_REGIS_PRSNA                  
AS                                           
LOCKING ROW FOR ACCESS                                        
SELECT
MATCHD_CNSMR_PRSNA_1.HSHLD_PRSNA_ID                                                
,REGIS_PRSNA_1.REGIS_PRSNA_ID                                        
,REGIS_PRSNA_1.MKTNG_PGM_NBR                                   
,REGIS_PRSNA_1.REGIS_CNSMR_ID_VAL                                            
,REGIS_PRSNA_1.GVN_NAME                                  
,REGIS_PRSNA_1.MID_NAME                                   
,REGIS_PRSNA_1.FAMLY_NAME                                              
,REGIS_PRSNA_1.FAMLY_NAME ||','|| REGIS_PRSNA_1.GVN_NAME AS FULL_NAME                                  
,REGIS_PRSNA_1.BRTH_DATE                                    
,REGIS_PRSNA_1.CNTRY_CODE AS CNTRY_NAME                                            
,REGIS_PRSNA_1.NATIONAL_ID_NBR                                    
,TRIM(REGIS_PRSNA_1.NAME_PREFX_TXT) AS NAME_PREFX_TXT                                          
,TRIM(REGIS_PRSNA_1.NAME_SUFFX_TXT) AS NAME_SUFFX_TXT                                         
,REGIS_PRSNA_1.CNSMR_USER_NAME                                               
,REGIS_PRSNA_1.GENDR_IND                                   
,REGIS_PRSNA_1.LEGAL_ENT_NBR                                         
,REGIS_PRSNA_1.LANG_CODE AS LANG_CODE                                 
,REGIS_PRSNA_1.LANG_CODE AS LANG_NAME                                               
,REGIS_PRSNA_1.MATCHD_CNSMR_PRSNA_ID                                                
,REGIS_PRSNA_1.DATA_ORIGIN_SRCE_NBR                                      
,REGIS_PRSNA_1.DATA_OP_SRCE_NAME                                           
,REGIS_PRSNA_1.PRSNA_STATUS_CODE                                             
,PRSNA_POSTL_ADDR_1.ADDR_LINE_1_TXT                                      
,PRSNA_POSTL_ADDR_1.ADDR_LINE_2_TXT                                      
,PRSNA_POSTL_ADDR_1.ADDR_LINE_3_TXT                                      
,PRSNA_POSTL_ADDR_1.STRET_NUM                                   
,PRSNA_POSTL_ADDR_1.STRET_NAME                                 
,PRSNA_POSTL_ADDR_1.APT_NUM                                       
,PRSNA_POSTL_ADDR_1.PO_BOX_NUM                                              
,PRSNA_POSTL_ADDR_1.CITY_NAME                                    
,PRSNA_POSTL_ADDR_1.TERR_CODE                                     
,PRSNA_POSTL_ADDR_1.TERR_CODE AS TERR_NAME                                    
,PRSNA_POSTL_ADDR_1.POSTL_AREA_CODE                                    
,PRSNA_POSTL_ADDR_1.WIN_KEY                                          
,COALESCE(PRSNA_POSTL_ADDR_1.ADDR_LINE_1_TXT,'') ||  ' ' ||                                           
COALESCE(PRSNA_POSTL_ADDR_1.ADDR_LINE_2_TXT,'') ||   ' ' ||                                           
COALESCE(PRSNA_POSTL_ADDR_1.CITY_NAME,'') ||  ' ' ||                                          
COALESCE(PRSNA_POSTL_ADDR_1.POSTL_AREA_CODE,'') AS FULL_ADDRESS                                    
,MKTNG_PGM_1.MKTNG_PGM_NAME                                               
,NULL (INTEGER)   AS  SYS_TARGET_ID                                   
,NULL (VARCHAR(25))  AS SYS_AUTH_ID                                               
,NULL (VARCHAR(25))  AS SYS_SOURCE                                 
,NULL (VARCHAR(70))  AS SYS_CREATED_BY                                        
,NULL (TIMESTAMP(0))  AS SYS_CREATION_DATE                                             
,'ACTIVE'  (VARCHAR(25))  AS  SYS_ENT_STATE                                   
,NULL (VARCHAR(70))  AS SYS_LAST_MODIFIED_BY                                         
,NULL (TIMESTAMP(0))  AS SYS_LAST_MODIFIED_DATE                                                
,NULL (VARCHAR(25))  AS SYS_NC_TYPE                                               
,NULL (VARCHAR(10000))  AS SYS_ERR_CODE                                     
,NULL (VARCHAR(30))  AS SYS_ERR_SVRTY                                           
,PRSNA_EMAIL_ADDR_1.EMAIL_ADDR_TXT AS EMAIL_ADDR_TXT_1                                     
,PRSNA_PHONE_1.PHONE_CNTRY_NBR AS PHONE_CNTRY_NBR_1                                         
,PRSNA_PHONE_1.PHONE_AREA_NBR  AS PHONE_AREA_NBR_1                                            
,PRSNA_PHONE_1.PHONE_EXCHG_NBR AS PHONE_EXCHG_NBR_1                                       
,PRSNA_PHONE_1.PHONE_LINE_NBR  AS PHONE_LINE_NBR_1                                                
,PRSNA_PHONE_1.PHONE_EXTSN_NUM AS PHONE_EXTSN_NUM_1                                     
,PRSNA_PHONE_1.FULL_PHONE_NUM  AS FULL_PHONE_NUM_1                                          
FROM MDM.REGIS_PRSNA REGIS_PRSNA_1                                      
LEFT OUTER JOIN MDM.REGIS_PRSNA_POSTL_ADDR PRSNA_POSTL_ADDR_1                                   
ON REGIS_PRSNA_1.REGIS_PRSNA_ID = PRSNA_POSTL_ADDR_1.REGIS_PRSNA_ID                                       
AND REGIS_PRSNA_1.MKTNG_PGM_NBR = PRSNA_POSTL_ADDR_1.MKTNG_PGM_NBR                                           
LEFT OUTER JOIN MDM.REGIS_PRSNA_PHONE PRSNA_PHONE_1                                            
ON REGIS_PRSNA_1.REGIS_PRSNA_ID = PRSNA_PHONE_1.REGIS_PRSNA_ID                                    
AND REGIS_PRSNA_1.MKTNG_PGM_NBR = PRSNA_PHONE_1.MKTNG_PGM_NBR                                        
LEFT OUTER JOIN MDM.REGIS_PRSNA_EMAIL_ADDR PRSNA_EMAIL_ADDR_1                                   
ON REGIS_PRSNA_1.REGIS_PRSNA_ID = PRSNA_EMAIL_ADDR_1.REGIS_PRSNA_ID                                       
AND REGIS_PRSNA_1.MKTNG_PGM_NBR = PRSNA_EMAIL_ADDR_1.MKTNG_PGM_NBR                                           
INNER JOIN MDM.MKTNG_PGM MKTNG_PGM_1                                          
ON REGIS_PRSNA_1.MKTNG_PGM_NBR = MKTNG_PGM_1.MKTNG_PGM_NBR
INNER JOIN MDM.MATCHD_CNSMR_PRSNA MATCHD_CNSMR_PRSNA_1
ON REGIS_PRSNA_1.MATCHD_CNSMR_PRSNA_ID=MATCHD_CNSMR_PRSNA_1.MATCHD_CNSMR_PRSNA_ID
AND REGIS_PRSNA_1.LEGAL_ENT_NBR=MATCHD_CNSMR_PRSNA_1.LEGAL_ENT_NBR                               
QUALIFY RANK() OVER(PARTITION BY REGIS_PRSNA_1.REGIS_PRSNA_ID,REGIS_PRSNA_1.MKTNG_PGM_NBR                                                
ORDER BY REGIS_PRSNA_1.PRSNA_STATUS_CODE ASC,PRSNA_EMAIL_ADDR_1.PREF_CNTCT_POINT_IND DESC, PRSNA_PHONE_1.PREF_CNTCT_POINT_IND DESC,PRSNA_POSTL_ADDR_1.PREF_CNTCT_POINT_IND DESC,PRSNA_EMAIL_ADDR_1.EMAIL_ADDR_TXT DESC,PRSNA_PHONE_1.FULL_PHONE_NUM DESC,PRSNA_EMAIL_ADDR_1.SUBSCRPTN_OPT_NBR DESC,PRSNA_PHONE_1.SUBSCRPTN_OPT_NBR DESC,PRSNA_POSTL_ADDR_1.SUBSCRPTN_OPT_NBR DESC,PRSNA_EMAIL_ADDR_1.CNTCT_POINT_CATEG_CODE DESC,PRSNA_PHONE_1.CNTCT_POINT_CATEG_CODE DESC,PRSNA_POSTL_ADDR_1.CNTCT_POINT_CATEG_CODE DESC) = 1;

 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 
   .LABEL L35
   
   REPLACE VIEW MDM.V_MATCHD_CNSMR_PRSNA
AS
LOCKING ROW FOR ACCESS
SELECT 
REGIS_PRSNA_1.MATCHD_CNSMR_PRSNA_ID
,MATCHD_CNSMR_PRSNA_1.HSHLD_PRSNA_ID 
,REGIS_PRSNA_1.REGIS_PRSNA_ID 
,REGIS_PRSNA_1.MKTNG_PGM_NBR  
,REGIS_PRSNA_1.REGIS_CNSMR_ID_VAL
,REGIS_PRSNA_1.GVN_NAME
,REGIS_PRSNA_1.MID_NAME
,REGIS_PRSNA_1.FAMLY_NAME
,REGIS_PRSNA_1.FAMLY_NAME ||','|| REGIS_PRSNA_1.GVN_NAME AS FULL_NAME
,REGIS_PRSNA_1.BRTH_DATE
,REGIS_PRSNA_1.CNTRY_CODE AS CNTRY_NAME
,REGIS_PRSNA_1.NATIONAL_ID_NBR
,REGIS_PRSNA_1.PRSNA_STATUS_CODE
,TRIM(REGIS_PRSNA_1.NAME_PREFX_TXT) AS NAME_PREFX_TXT
,TRIM(REGIS_PRSNA_1.NAME_SUFFX_TXT) AS NAME_SUFFX_TXT
,REGIS_PRSNA_1.CNSMR_USER_NAME
,REGIS_PRSNA_1.GENDR_IND
,REGIS_PRSNA_1.LEGAL_ENT_NBR
,REGIS_PRSNA_1.LANG_CODE AS LANG_CODE
,REGIS_PRSNA_1.LANG_CODE AS LANG_NAME
,REGIS_PRSNA_1.DATA_ORIGIN_SRCE_NBR 
,PRSNA_POSTL_ADDR_1.ADDR_LINE_1_TXT
,PRSNA_POSTL_ADDR_1.ADDR_LINE_2_TXT
,PRSNA_POSTL_ADDR_1.ADDR_LINE_3_TXT
,PRSNA_POSTL_ADDR_1.STRET_NUM
,PRSNA_POSTL_ADDR_1.STRET_NAME
,PRSNA_POSTL_ADDR_1.APT_NUM
,PRSNA_POSTL_ADDR_1.PO_BOX_NUM
,PRSNA_POSTL_ADDR_1.CITY_NAME
,PRSNA_POSTL_ADDR_1.TERR_CODE
,PRSNA_POSTL_ADDR_1.TERR_CODE AS TERR_NAME
,PRSNA_POSTL_ADDR_1.POSTL_AREA_CODE
,PRSNA_POSTL_ADDR_1.WIN_KEY
,COALESCE(PRSNA_POSTL_ADDR_1.ADDR_LINE_1_TXT,'') ||  ' ' ||
COALESCE(PRSNA_POSTL_ADDR_1.ADDR_LINE_2_TXT,'') ||   ' ' ||
COALESCE(PRSNA_POSTL_ADDR_1.CITY_NAME,'') ||  ' ' ||
COALESCE(PRSNA_POSTL_ADDR_1.POSTL_AREA_CODE,'') AS FULL_ADDRESS
,MKTNG_PGM_1.MKTNG_PGM_NAME
,NULL (INTEGER)   AS  SYS_TARGET_ID
,NULL (VARCHAR(25))  AS SYS_AUTH_ID
,NULL (VARCHAR(25))  AS SYS_SOURCE
,NULL (VARCHAR(70))  AS SYS_CREATED_BY
,NULL (TIMESTAMP(0))  AS SYS_CREATION_DATE
,'ACTIVE'  (VARCHAR(25))  AS  SYS_ENT_STATE
,NULL (VARCHAR(70))  AS SYS_LAST_MODIFIED_BY
,NULL (TIMESTAMP(0))  AS SYS_LAST_MODIFIED_DATE
,NULL (VARCHAR(25))  AS SYS_NC_TYPE
,NULL (VARCHAR(10000))  AS SYS_ERR_CODE
,NULL (VARCHAR(30))  AS SYS_ERR_SVRTY   
,NULL (VARCHAR(200))  AS EMAIL_ADDR_TXT_1 
,NULL (SMALLINT) AS PHONE_CNTRY_NBR_1
,NULL (SMALLINT) AS PHONE_AREA_NBR_1
,NULL (SMALLINT) AS PHONE_EXCHG_NBR_1
,NULL  (BIGINT) AS PHONE_LINE_NBR_1
,NULL (VARCHAR(20)) AS PHONE_EXTSN_NUM_1
,NULL  (VARCHAR(20))  AS FULL_PHONE_NUM_1
,PRSNA_POSTL_ADDR_1.SUBSCRPTN_OPT_NBR AS SUBSCRPTN_OPT_NBR
,PRSNA_POSTL_ADDR_1.SUBSCRPTN_OPT_IND AS SUBSCRPTN_OPT_IND
,PRSNA_POSTL_ADDR_1.CNSMR_CHCE_DATETM  AS CNSMR_CHCE_DATETM
,'A'  CNTCT_POINT_TYPE_CODE
,'ADDRESS'  CNTCT_POINT_TYPE
,PRSNA_POSTL_ADDR_1.CNTCT_POINT_CATEG_CODE  AS CNTCT_POINT_CATEG_CODE
,CNTCT_POINT_CATEG_1.CNTCT_POINT_CATEG_NAME  AS CNTCT_POINT_CATEG_NAME
,SUBSCRPTN_OPT_1.SUBSCRPTN_OPT_NAME
FROM REGIS_PRSNA REGIS_PRSNA_1
JOIN REGIS_PRSNA_POSTL_ADDR PRSNA_POSTL_ADDR_1
ON REGIS_PRSNA_1.REGIS_PRSNA_ID = PRSNA_POSTL_ADDR_1.REGIS_PRSNA_ID
AND REGIS_PRSNA_1.MKTNG_PGM_NBR = PRSNA_POSTL_ADDR_1.MKTNG_PGM_NBR
JOIN MKTNG_PGM MKTNG_PGM_1
ON REGIS_PRSNA_1.MKTNG_PGM_NBR = MKTNG_PGM_1.MKTNG_PGM_NBR
JOIN SUBSCRPTN_OPT SUBSCRPTN_OPT_1
ON PRSNA_POSTL_ADDR_1.SUBSCRPTN_OPT_NBR=SUBSCRPTN_OPT_1.SUBSCRPTN_OPT_NBR
AND PRSNA_POSTL_ADDR_1.MKTNG_PGM_NBR = SUBSCRPTN_OPT_1.MKTNG_PGM_NBR
JOIN CNTCT_POINT_CATEG CNTCT_POINT_CATEG_1
ON PRSNA_POSTL_ADDR_1.CNTCT_POINT_CATEG_CODE=CNTCT_POINT_CATEG_1.CNTCT_POINT_CATEG_CODE
JOIN MATCHD_CNSMR_PRSNA MATCHD_CNSMR_PRSNA_1
ON REGIS_PRSNA_1.MATCHD_CNSMR_PRSNA_ID=MATCHD_CNSMR_PRSNA_1.MATCHD_CNSMR_PRSNA_ID
AND REGIS_PRSNA_1.LEGAL_ENT_NBR=MATCHD_CNSMR_PRSNA_1.LEGAL_ENT_NBR
UNION ALL
SELECT 
REGIS_PRSNA_1.MATCHD_CNSMR_PRSNA_ID
,MATCHD_CNSMR_PRSNA_1.HSHLD_PRSNA_ID 
,REGIS_PRSNA_1.REGIS_PRSNA_ID 
,REGIS_PRSNA_1.MKTNG_PGM_NBR  
,REGIS_PRSNA_1.REGIS_CNSMR_ID_VAL
,REGIS_PRSNA_1.GVN_NAME
,REGIS_PRSNA_1.MID_NAME
,REGIS_PRSNA_1.FAMLY_NAME
,REGIS_PRSNA_1.FAMLY_NAME ||','|| REGIS_PRSNA_1.GVN_NAME AS FULL_NAME
,REGIS_PRSNA_1.BRTH_DATE
,REGIS_PRSNA_1.CNTRY_CODE AS CNTRY_NAME
,REGIS_PRSNA_1.NATIONAL_ID_NBR
,REGIS_PRSNA_1.PRSNA_STATUS_CODE
,TRIM(REGIS_PRSNA_1.NAME_PREFX_TXT) AS NAME_PREFX_TXT
,TRIM(REGIS_PRSNA_1.NAME_SUFFX_TXT) AS NAME_SUFFX_TXT
,REGIS_PRSNA_1.CNSMR_USER_NAME
,REGIS_PRSNA_1.GENDR_IND
,REGIS_PRSNA_1.LEGAL_ENT_NBR
,REGIS_PRSNA_1.LANG_CODE AS LANG_CODE
,REGIS_PRSNA_1.LANG_CODE AS LANG_NAME
,REGIS_PRSNA_1.DATA_ORIGIN_SRCE_NBR 
, NULL (VARCHAR(500) ) AS ADDR_LINE_1_TXT
,NULL  (VARCHAR(500) )AS ADDR_LINE_2_TXT
,NULL  (VARCHAR(500) )AS ADDR_LINE_3_TXT
,NULL (VARCHAR(20))AS STRET_NUM
,NULL ( VARCHAR(100) )AS STRET_NAME
,NULL (VARCHAR(20) )AS APT_NUM
,NULL (VARCHAR(20) )AS PO_BOX_NUM
,NULL ( VARCHAR(100) )AS CITY_NAME
,NULL ( CHAR(8) )AS TERR_CODE
,NULL ( VARCHAR(100))AS  TERR_NAME
,NULL (VARCHAR(20)) AS POSTL_AREA_CODE
,NULL ( VARCHAR(100) )AS WIN_KEY
,NULL  (VARCHAR(10000))  AS FULL_ADDRESS
,MKTNG_PGM_1.MKTNG_PGM_NAME
,NULL (INTEGER)   AS  SYS_TARGET_ID
,NULL (VARCHAR(25))  AS SYS_AUTH_ID
,NULL (VARCHAR(25))  AS SYS_SOURCE
,NULL (VARCHAR(70))  AS SYS_CREATED_BY
,NULL (TIMESTAMP(0))  AS SYS_CREATION_DATE
,'ACTIVE'  (VARCHAR(25))  AS  SYS_ENT_STATE
,NULL (VARCHAR(70))  AS SYS_LAST_MODIFIED_BY
,NULL (TIMESTAMP(0))  AS SYS_LAST_MODIFIED_DATE
,NULL (VARCHAR(25))  AS SYS_NC_TYPE
,NULL (VARCHAR(10000))  AS SYS_ERR_CODE
,NULL (VARCHAR(30))  AS SYS_ERR_SVRTY   
,NULL (VARCHAR(200))  AS EMAIL_ADDR_TXT_1 
,PRSNA_PHONE_1.PHONE_CNTRY_NBR AS PHONE_CNTRY_NBR_1
,PRSNA_PHONE_1.PHONE_AREA_NBR  AS PHONE_AREA_NBR_1
,PRSNA_PHONE_1.PHONE_EXCHG_NBR AS PHONE_EXCHG_NBR_1
,PRSNA_PHONE_1.PHONE_LINE_NBR  AS PHONE_LINE_NBR_1
,PRSNA_PHONE_1.PHONE_EXTSN_NUM AS PHONE_EXTSN_NUM_1
,PRSNA_PHONE_1.FULL_PHONE_NUM  AS FULL_PHONE_NUM_1
,PRSNA_PHONE_1.SUBSCRPTN_OPT_NBR AS SUBSCRPTN_OPT_NBR
,PRSNA_PHONE_1.SUBSCRPTN_OPT_IND AS SUBSCRPTN_OPT_IND
,PRSNA_PHONE_1.CNSMR_CHCE_DATETM  AS CNSMR_CHCE_DATETM
,'P'  CNTCT_POINT_TYPE_CODE
,'PHONE'  CNTCT_POINT_TYPE
,PRSNA_PHONE_1.CNTCT_POINT_CATEG_CODE  AS CNTCT_POINT_CATEG_CODE
,CNTCT_POINT_CATEG_1.CNTCT_POINT_CATEG_NAME  AS CNTCT_POINT_CATEG_NAME
,SUBSCRPTN_OPT_1.SUBSCRPTN_OPT_NAME
FROM REGIS_PRSNA REGIS_PRSNA_1
JOIN REGIS_PRSNA_PHONE PRSNA_PHONE_1
ON REGIS_PRSNA_1.REGIS_PRSNA_ID = PRSNA_PHONE_1.REGIS_PRSNA_ID
AND REGIS_PRSNA_1.MKTNG_PGM_NBR = PRSNA_PHONE_1.MKTNG_PGM_NBR
JOIN MKTNG_PGM MKTNG_PGM_1
ON REGIS_PRSNA_1.MKTNG_PGM_NBR = MKTNG_PGM_1.MKTNG_PGM_NBR
JOIN SUBSCRPTN_OPT SUBSCRPTN_OPT_1
ON PRSNA_PHONE_1.SUBSCRPTN_OPT_NBR=SUBSCRPTN_OPT_1.SUBSCRPTN_OPT_NBR
AND PRSNA_PHONE_1.MKTNG_PGM_NBR = SUBSCRPTN_OPT_1.MKTNG_PGM_NBR
JOIN CNTCT_POINT_CATEG CNTCT_POINT_CATEG_1
ON PRSNA_PHONE_1.CNTCT_POINT_CATEG_CODE=CNTCT_POINT_CATEG_1.CNTCT_POINT_CATEG_CODE
JOIN MATCHD_CNSMR_PRSNA MATCHD_CNSMR_PRSNA_1
ON REGIS_PRSNA_1.MATCHD_CNSMR_PRSNA_ID=MATCHD_CNSMR_PRSNA_1.MATCHD_CNSMR_PRSNA_ID
AND REGIS_PRSNA_1.LEGAL_ENT_NBR=MATCHD_CNSMR_PRSNA_1.LEGAL_ENT_NBR
UNION ALL
SELECT 
REGIS_PRSNA_1.MATCHD_CNSMR_PRSNA_ID
,MATCHD_CNSMR_PRSNA_1.HSHLD_PRSNA_ID 
,REGIS_PRSNA_1.REGIS_PRSNA_ID 
,REGIS_PRSNA_1.MKTNG_PGM_NBR  
,REGIS_PRSNA_1.REGIS_CNSMR_ID_VAL
,REGIS_PRSNA_1.GVN_NAME
,REGIS_PRSNA_1.MID_NAME
,REGIS_PRSNA_1.FAMLY_NAME
,REGIS_PRSNA_1.FAMLY_NAME ||','|| REGIS_PRSNA_1.GVN_NAME AS FULL_NAME
,REGIS_PRSNA_1.BRTH_DATE
,REGIS_PRSNA_1.CNTRY_CODE AS CNTRY_NAME
,REGIS_PRSNA_1.NATIONAL_ID_NBR
,REGIS_PRSNA_1.PRSNA_STATUS_CODE
,TRIM(REGIS_PRSNA_1.NAME_PREFX_TXT) AS NAME_PREFX_TXT
,TRIM(REGIS_PRSNA_1.NAME_SUFFX_TXT) AS NAME_SUFFX_TXT
,REGIS_PRSNA_1.CNSMR_USER_NAME
,REGIS_PRSNA_1.GENDR_IND
,REGIS_PRSNA_1.LEGAL_ENT_NBR
,REGIS_PRSNA_1.LANG_CODE AS LANG_CODE
,REGIS_PRSNA_1.LANG_CODE AS LANG_NAME
,REGIS_PRSNA_1.DATA_ORIGIN_SRCE_NBR 
, NULL (VARCHAR(500) ) AS ADDR_LINE_1_TXT
,NULL  (VARCHAR(500) )AS ADDR_LINE_2_TXT
,NULL  (VARCHAR(500) )AS ADDR_LINE_3_TXT
,NULL (VARCHAR(20))AS STRET_NUM
,NULL ( VARCHAR(100) )AS STRET_NAME
,NULL (VARCHAR(20) )AS APT_NUM
,NULL (VARCHAR(20) )AS PO_BOX_NUM
,NULL ( VARCHAR(100) )AS CITY_NAME
,NULL ( CHAR(8) )AS TERR_CODE
,NULL ( VARCHAR(100))AS  TERR_NAME
,NULL (VARCHAR(20)) AS POSTL_AREA_CODE
,NULL ( VARCHAR(100) )AS WIN_KEY
,NULL  (VARCHAR(10000))  AS FULL_ADDRESS
,MKTNG_PGM_1.MKTNG_PGM_NAME
,NULL (INTEGER)   AS  SYS_TARGET_ID
,NULL (VARCHAR(25))  AS SYS_AUTH_ID
,NULL (VARCHAR(25))  AS SYS_SOURCE
,NULL (VARCHAR(70))  AS SYS_CREATED_BY
,NULL (TIMESTAMP(0))  AS SYS_CREATION_DATE
,'ACTIVE'  (VARCHAR(25))  AS  SYS_ENT_STATE
,NULL (VARCHAR(70))  AS SYS_LAST_MODIFIED_BY
,NULL (TIMESTAMP(0))  AS SYS_LAST_MODIFIED_DATE
,NULL (VARCHAR(25))  AS SYS_NC_TYPE
,NULL (VARCHAR(10000))  AS SYS_ERR_CODE
,NULL (VARCHAR(30))  AS SYS_ERR_SVRTY   
,PRSNA_EMAIL_ADDR_1.EMAIL_ADDR_TXT AS EMAIL_ADDR_TXT_1 
,NULL (SMALLINT) AS PHONE_CNTRY_NBR_1
,NULL (SMALLINT) AS PHONE_AREA_NBR_1
,NULL (SMALLINT) AS PHONE_EXCHG_NBR_1
,NULL  (BIGINT) AS PHONE_LINE_NBR_1
,NULL (VARCHAR(20)) AS PHONE_EXTSN_NUM_1
,NULL  (VARCHAR(20))  AS FULL_PHONE_NUM_1
,PRSNA_EMAIL_ADDR_1.SUBSCRPTN_OPT_NBR AS SUBSCRPTN_OPT_NBR
,PRSNA_EMAIL_ADDR_1.SUBSCRPTN_OPT_IND AS SUBSCRPTN_OPT_IND
,PRSNA_EMAIL_ADDR_1.CNSMR_CHCE_DATETM  AS CNSMR_CHCE_DATETM
,'E'  CNTCT_POINT_TYPE_CODE
,'EMAIL'  CNTCT_POINT_TYPE
,PRSNA_EMAIL_ADDR_1.CNTCT_POINT_CATEG_CODE  AS CNTCT_POINT_CATEG_CODE
,CNTCT_POINT_CATEG_1.CNTCT_POINT_CATEG_NAME  AS CNTCT_POINT_CATEG_NAME
,SUBSCRPTN_OPT_1.SUBSCRPTN_OPT_NAME
FROM REGIS_PRSNA REGIS_PRSNA_1
JOIN REGIS_PRSNA_EMAIL_ADDR PRSNA_EMAIL_ADDR_1
ON REGIS_PRSNA_1.REGIS_PRSNA_ID = PRSNA_EMAIL_ADDR_1.REGIS_PRSNA_ID
AND REGIS_PRSNA_1.MKTNG_PGM_NBR = PRSNA_EMAIL_ADDR_1.MKTNG_PGM_NBR
JOIN MKTNG_PGM MKTNG_PGM_1
ON REGIS_PRSNA_1.MKTNG_PGM_NBR = MKTNG_PGM_1.MKTNG_PGM_NBR
JOIN SUBSCRPTN_OPT SUBSCRPTN_OPT_1
ON PRSNA_EMAIL_ADDR_1.SUBSCRPTN_OPT_NBR=SUBSCRPTN_OPT_1.SUBSCRPTN_OPT_NBR
AND PRSNA_EMAIL_ADDR_1.MKTNG_PGM_NBR = SUBSCRPTN_OPT_1.MKTNG_PGM_NBR
JOIN CNTCT_POINT_CATEG CNTCT_POINT_CATEG_1
ON PRSNA_EMAIL_ADDR_1.CNTCT_POINT_CATEG_CODE=CNTCT_POINT_CATEG_1.CNTCT_POINT_CATEG_CODE
JOIN MATCHD_CNSMR_PRSNA MATCHD_CNSMR_PRSNA_1
ON REGIS_PRSNA_1.MATCHD_CNSMR_PRSNA_ID=MATCHD_CNSMR_PRSNA_1.MATCHD_CNSMR_PRSNA_ID
AND REGIS_PRSNA_1.LEGAL_ENT_NBR=MATCHD_CNSMR_PRSNA_1.LEGAL_ENT_NBR;

    .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 
   .LABEL L36 
 CREATE SET TABLE MDM.EXTRN_PRSNA_IDS ,NO FALLBACK ,
      NO BEFORE JOURNAL,
      NO AFTER JOURNAL,
      CHECKSUM = DEFAULT,
      DEFAULT MERGEBLOCKRATIO
      (
       MKTNG_PGM_NBR INTEGER NOT NULL,
       REGIS_PRSNA_ID INTEGER NOT NULL,
       LEGAL_ENT_NBR INTEGER,
       CNTRY_CODE VARCHAR(3) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS,
       SYS_SOURCE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS,
       REGIS_CNSMR_ID_VAL VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
       SYS_TARGET_ID INTEGER COMPRESS
       )
 PRIMARY INDEX EXTRN_PRSNA_IDS_NUPI ( REGIS_PRSNA_ID ,MKTNG_PGM_NBR)
PARTITION BY MKTNG_PGM_NBR
INDEX (CNTRY_CODE)
INDEX (SYS_SOURCE);
    .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
    
 .LABEL L37
 INS ATTRIBUTE_types
 (ATTRIBUTE_TYPE_ID             ,
 ATTRIBUTE_TYPE                ,
 DISPLAY_NAME                  ,
 DATA_TYPE                     ,
 DATA_FORMAT                   ,
 DATA_LENGTH                   ,
 SELECTION_METHOD              ,
 AV_CODE_FLAG                  ,
 AV_SHORT_NAME_FLAG            ,
 USER_MANAGED_FLAG             ,
 API                           ,
 SYS_TARGET_ID                 ,
 SYS_AUTH_ID                   ,
 SYS_SOURCE                    ,
 SYS_CREATED_BY                ,
 SYS_CREATION_DATE             ,
 SYS_ENT_STATE                 ,
 SYS_LAST_MODIFIED_BY          ,
 SYS_LAST_MODIFIED_DATE        ,
 SYS_NC_TYPE                   ,
 SYS_ERR_CODE                  ,
 SYS_ERR_SVRTY                 )
 SEL
 MAX(attribute_type_id)+1,
 'i2 Format',
 'i2 Format',
 'Text',
 'YYYY-MM-DD',
 5,
 'Default',
 'Y',
 'Y',
 'C',
 NULL,
 NULL,
 NULL,
 'BackEnd',
 NULL,
 CURRENT_TIMESTAMP(0),
 'ACTIVE',
 'RELEASE 5.7',
 CURRENT_TIMESTAMP(0),
 NULL,
 NULL,
 NULL
 FROM ATTRIBUTE_types;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 
  .LABEL L38
  INS ATTRIBUTE_types
  (ATTRIBUTE_TYPE_ID             ,
  ATTRIBUTE_TYPE                ,
  DISPLAY_NAME                  ,
  DATA_TYPE                     ,
  DATA_FORMAT                   ,
  DATA_LENGTH                   ,
  SELECTION_METHOD              ,
  AV_CODE_FLAG                  ,
  AV_SHORT_NAME_FLAG            ,
  USER_MANAGED_FLAG             ,
  API                           ,
  SYS_TARGET_ID                 ,
  SYS_AUTH_ID                   ,
  SYS_SOURCE                    ,
  SYS_CREATED_BY                ,
  SYS_CREATION_DATE             ,
  SYS_ENT_STATE                 ,
  SYS_LAST_MODIFIED_BY          ,
  SYS_LAST_MODIFIED_DATE        ,
  SYS_NC_TYPE                   ,
  SYS_ERR_CODE                  ,
  SYS_ERR_SVRTY                 )
  SEL
  MAX(attribute_type_id)+1,
  'i20b Format',
  'i20b Format',
  'Text',
  'YYYY-MM-DD',
  5,
  'Default',
  'Y',
  'Y',
  'C',
  NULL,
  NULL,
  NULL,
  'BackEnd',
  NULL,
  CURRENT_TIMESTAMP(0),
  'ACTIVE',
  'RELEASE 5.7',
  CURRENT_TIMESTAMP(0),
  NULL,
  NULL,
  NULL
  FROM ATTRIBUTE_types;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 
 .LABEL L39
 INSERT INTO MDM.ATTRIBUTE_VALUES 
 sel max(av_id)+1,(sel ATTRIBUTE_TYPE_ID from ATTRIBUTE_TYPES where ATTRIBUTE_TYPE='i2 Format'),'Y','i2 Format','1','i2 Format',NULL,NULL,'BackEnd','Rel 5.7',current_date,'ACTIVE',NULL,NULL,NULL,NULL,NULL 
 from ATTRIBUTE_VALUES;
 
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 
  .LABEL L40
  INSERT INTO MDM.ATTRIBUTE_VALUES 
  sel max(av_id)+1,(sel ATTRIBUTE_TYPE_ID from ATTRIBUTE_TYPES where ATTRIBUTE_TYPE='i2 Format'),'Y','i2 Format','91','i2 Format',NULL,NULL,'BackEnd','Rel 5.7',current_date,'ACTIVE',NULL,NULL,NULL,NULL,NULL 
  from ATTRIBUTE_VALUES;
  
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 
  .LABEL L41
  INSERT INTO MDM.ATTRIBUTE_VALUES 
  sel max(av_id)+1,(sel ATTRIBUTE_TYPE_ID from ATTRIBUTE_TYPES where ATTRIBUTE_TYPE='i20b Format'),'Y','i20b Format','23','i20b Format',NULL,NULL,'BackEnd','Rel 5.7',current_date,'ACTIVE',NULL,NULL,NULL,NULL,NULL 
  from ATTRIBUTE_VALUES;
  
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 	  	  
 .LABEL L42
 UPDATE MDM.ID_SQR
 FROM (SEL MAX(AV_ID)+1 AS SEQ_NBR FROM MDM.ATTRIBUTE_VALUES) B
 SET SEQ_NR=B.SEQ_NBR
WHERE DOC_NAME='AVID_SEQ_ID';
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;    
 
  .LABEL L43
  
 REPLACE VIEW MDM.V_COUPON_REDEEMED (                                                                                         
 MKTNG_PGM_NBR         
 ,REGIS_PRSNA_ID         
 ,CNSMR_ACTN_TYPE_CODE   
 ,CNSMR_ACTN_NUM   
 ,LEGAL_ENT_NBR   
 ,CNSMR_ACTN_ID   
 ,COUPN_SERL_NUM   
 ,RDMPT_DATETM   
 ,COUPN_STATUS_CODE   
 ,STORE_NAME   
 ,REDEMPTN_VALUE   
 ,INCTV_NBR   
 ,SYS_TARGET_ID,   
 SYS_AUTH_ID,   
 SYS_SOURCE,   
 SYS_CREATED_BY,   
 SYS_CREATION_DATE,   
 SYS_ENT_STATE,   
 SYS_LAST_MODIFIED_BY,   
 SYS_LAST_MODIFIED_DATE,   
 SYS_NC_TYPE,   
 SYS_ERR_CODE,   
 SYS_ERR_SVRTY   
 )   
 AS LOCKING ROW FOR ACCESS    
 SELECT   
 CA.MKTNG_PGM_NBR   
 ,CA.REGIS_PRSNA_ID   
 ,CA.CNSMR_ACTN_TYPE_CODE   
 ,CA.CNSMR_ACTN_NUM   
 ,CA.LEGAL_ENT_NBR   
 ,RDM.CNSMR_ACTN_ID   
 ,RDM.COUPN_SERL_NUM   
 ,RDM.RDMPT_DATETM   
 ,RDM.COUPN_STATUS_CODE   
 ,RDM.ALT_STORE_NAME   
 ,RDM.REDEMPTN_VALUE   
 ,RDM.INCTV_NBR   
 ,NULL (INTEGER)   AS  SYS_TARGET_ID,   
 NULL (VARCHAR(25))  AS SYS_AUTH_ID,   
 NULL (VARCHAR(25))  AS SYS_SOURCE,   
 NULL (VARCHAR(70))  AS SYS_CREATED_BY,   
 NULL (TIMESTAMP(0))  AS SYS_CREATION_DATE,   
 'ACTIVE'  (VARCHAR(25))  AS  SYS_ENT_STATE,   
 NULL (VARCHAR(70))  AS SYS_LAST_MODIFIED_BY,   
 NULL (TIMESTAMP(0))  AS SYS_LAST_MODIFIED_DATE,    
 NULL (VARCHAR(25))  AS SYS_NC_TYPE,   
 NULL (VARCHAR(10000))  AS SYS_ERR_CODE,   
 NULL (VARCHAR(30))  AS SYS_ERR_SVRTY                                                            
 FROM MDM.COUPN_INSTN_REDEMPTN RDM   
 LEFT JOIN   
 MDM.CNSMR_ACTN CA   
 ON   
 RDM.CNSMR_ACTN_ID=CA.CNSMR_ACTN_ID   
AND RDM.MKTNG_PGM_NBR=CA. MKTNG_PGM_NBR
AND RDM.LEGAL_ENT_NBR=CA. LEGAL_ENT_NBR
 WHERE COUPN_STATUS_CODE = 'RM'    
;
   .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
   
     .LABEL L44
REPLACE VIEW MDM.V_RPT_LOAD_NBR  
AS   
LOCKING ROW FOR ACCESS   
SELECT    
A.LOAD_ID,   
B.SOURCE_ID,   
B.REQ_MAIL_ID,   
B.DATA_SOURCE,   
A.MKTNG_PGM_NBR,   
A.LEGAL_ENT_NBR,   
M.MKTNG_PGM_NAME,   
L.LEGAL_ENT_NAME,   
STAGING_NBR,   
C.STG_REJECT_CNT,   
C.STG_REJECT_DESC,   
ERROR_NBR,   
ACTIVE_NBR,   
DUPLICATE_NBR,   
WEBSITE_REGIS_NBR,
PHONE_OPT_IN,   
PHONE_OPT_OUT,   
EMAIL_OPT_IN,   
EMAIL_OPT_OUT,   
POSTAL_OPT_IN,   
POSTAL_OPT_OUT,   
SOCIAL_OPT_IN,   
SOCIAL_OPT_OUT,   
LOADSTATUS AS LOAD_SUCCESS,    
CAST(LOADSTARTTS AS DATE FORMAT 'mm/dd/yyyy') AS START_DATE,   
CAST(LOADENDTS AS DATE FORMAT 'mm/dd/yyyy') AS END_DATE   
FROM RPT_LOAD_NBR A   
LEFT OUTER JOIN (   
SELECT b.SOURCE_ID,   
b.DATA_SOURCE,   
b.REQ_MAIL_ID,   
a.LOAD_ID,   
LOADSTATUS,   
MIN(LOADSTARTTS) LOADSTARTTS,   
MAX(LOADENDTS) LOADENDTS   
FROM   
ETL_CTRL.LOAD_CONTROL a   
INNER JOIN ETL_CTRL.SOURCE_CONTROL b   
ON b.SOURCE_ID=a.SOURCE_ID   
AND LOADSTATUS='Success'   
GROUP BY 1,2,3,4,5   
) B   
ON A.LOAD_ID=B.LOAD_ID   
LEFT OUTER JOIN   
(SELECT LOAD_ID,   
 (CASE WHEN SOURCECNT = TARGETCNT   
   THEN 0
   ELSE  REJECTSCNT END)AS STG_REJECT_CNT,
FailedReason AS STG_REJECT_DESC   
FROM   
 ETL_CTRL.LOAD_CONTROL  
WHERE LOAD_TYPE='ETL'   
)C   
ON B.LOAD_ID=C.LOAD_ID   
LEFT OUTER JOIN MKTNG_PGM M   
ON M.MKTNG_PGM_NBR = A.MKTNG_PGM_NBR   
LEFT OUTER JOIN LEGAL_ENT L   
ON L.LEGAL_ENT_NBR = A.LEGAL_ENT_NBR   
;     
   .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

     .LABEL L45   
INS MDM.RTN_RULES 
(RTN_RULE_ID,RTN_RULE_NAME,SYS_ENT_STATE,SYS_CREATION_DATE,SYS_CREATED_BY)
VALUES(21,'Rule for Retentioning out Website Registrations','Active',CURRENT_TIMESTAMP(0),'Release 5.7');
   .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
     .LABEL L46   
DEL FROM ICRM_TBL.STORE_LAT_LONG_GEO WHERE CNTRY_CODE IN ('ESP','PRT');
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
     .LABEL L47
DEL FROM ICRM_TBL.CNSMR_LAT_LONG_GEO WHERE CNTRY_CODE IN ('ESP','PRT');
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
     .LABEL L48
DEL FROM ICRM_TBL.STORE_CNSMR_DIST WHERE CNTRY_CODE IN ('ESP','PRT');
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
     .LABEL L49
DEL FROM ICRM_TBL.LAT_LONG_STR_DIST_RNK WHERE CNTRY_CODE IN ('ESP','PRT');
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
     .LABEL L50
DEL FROM ICRM_TBL.REGIS_PRSNA_STR_DIST_RNK WHERE CNTRY_CODE IN ('ESP','PRT');   
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
.LABEL L51
REPLACE VIEW MDM.PRSNA_STG_CNT (                                             
  MKTNG_PGM_NBR                                                                 
 ,REGIS_CNSMR_ID_VAL                                                            
 ,USER_NAME                                                                     
 ,PRSNA_REG_DT                                                                  
 ,NAME_PREFX_TXT                                                                
 ,GVN_NAME                                                                      
 ,MID_NAME                                                                      
 ,FAMLY_NAME                                                                    
 ,NAME_SUFFX_TXT                                                                
 ,FULL_NAME                                                                     
 ,GENDR_IND                                                                     
 ,BRTH_DATE                                                                     
 ,LANG_CODE                                                                     
 ,PRSNA_STTUS_CODE                                                              
,CNTRY_NAME
 ,LOAD_ID                                                                       
 ,LOAD_TS                                                                       
 ,MDM_LOAD_IND                                                                  
 ,RECORD_IND                                                                    
) AS 
LOCK ROW FOR ACCESS
SELECT   MKTNG_PGM_NBR                                                                 
 ,REGIS_CNSMR_ID_VAL                                                            
 ,USER_NAME                                                                     
 ,PRSNA_REG_DT                                                                  
 ,NAME_PREFX_TXT                                                                
 ,GVN_NAME                                                                      
 ,MID_NAME                                                                      
 ,FAMLY_NAME                                                                    
 ,NAME_SUFFX_TXT                                                                
 ,FULL_NAME                                                                     
 ,GENDR_IND                                                                     
 ,BRTH_DATE                                                                     
 ,LANG_CODE                                                                     
 ,PRSNA_STTUS_CODE   
 ,CNTRY_NAME                                                           
 ,LOAD_ID                                                                       
 ,LOAD_TS                                                                       
 ,MDM_LOAD_IND                                                                  
 ,RECORD_IND   FROM iCRM_STAGE.PRSNA_STG
UNION ALL
SELECT   MKTNG_PGM_NBR                                                                 
 ,REGIS_CNSMR_ID_VAL                                                            
 ,USER_NAME                                                                     
 ,PRSNA_REG_DT                                                                  
 ,NAME_PREFX_TXT                                                                
 ,GVN_NAME                                                                      
 ,MID_NAME                                                                      
 ,FAMLY_NAME                                                                    
 ,NAME_SUFFX_TXT                                                                
 ,FULL_NAME                                                                     
 ,GENDR_IND                                                                     
 ,BRTH_DATE                                                                     
 ,LANG_CODE                                                                     
 ,PRSNA_STTUS_CODE   
 ,CNTRY_CODE                                                           
 ,LOAD_ID                                                                       
 ,LOAD_TS                                                                       
 ,MDM_LOAD_IND                                                                  
 ,RECORD_IND   FROM MDM.PRSNA_STG 
 WHERE LOAD_ID MOD 100 =23
;
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
.LABEL L52
DROP  TABLE MDM.ADDR_INPUT;
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
.LABEL L53
CREATE SET GLOBAL TEMPORARY TABLE MDM.addr_input ,NO FALLBACK ,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO,
     LOG
     (
      REGIS_PRSNA_ID INTEGER NOT NULL,
      MKTNG_PGM_NBR INTEGER NOT NULL,
      LEGAL_ENT_NBR SMALLINT,
      CNTCT_POINT_CATEG_CODE CHAR(2) CHARACTER SET LATIN NOT CASESPECIFIC NOT NULL,
      WIN_KEY VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      SUBSCRPTN_OPT_NBR INTEGER,
      SUBSCRPTN_OPT_IND CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC,
      CNSMR_CHCE_DATETM TIMESTAMP(6),
      PREF_CNTCT_POINT_IND CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC NOT NULL DEFAULT 'Y',
      ADDR_LINE_1_TXT VARCHAR(500) CHARACTER SET UNICODE NOT CASESPECIFIC,
      ADDR_LINE_2_TXT VARCHAR(500) CHARACTER SET UNICODE NOT CASESPECIFIC,
      ADDR_LINE_3_TXT VARCHAR(500) CHARACTER SET UNICODE NOT CASESPECIFIC,
      STRET_NUM VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
      STRET_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      APT_NUM VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
      PO_BOX_NUM VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
      CITY_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      POSTL_AREA_CODE VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC,
      TERR_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      CITY_CODE INTEGER,
      TERR_CODE CHAR(8) CHARACTER SET UNICODE NOT CASESPECIFIC,
      CNTRY_CODE CHAR(5) CHARACTER SET LATIN NOT CASESPECIFIC,
      LAT_MEAS DECIMAL(18,6),
      LONG_MEAS DECIMAL(18,6),
      VALID_CNTCT_POINT_IND CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC NOT NULL DEFAULT 'Y',
      GUARDN_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,
      GUARDN_EMAIL_ADDR_TXT VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      GUARDN_CNSNT_IND CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC,
      ACNLGMT_DATE DATE FORMAT 'YYYY-MM-DD',
      POSTL_STATUS_CODE CHAR(2) CHARACTER SET LATIN NOT CASESPECIFIC,
      PR_GEOCODE_FAIL VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      TQ_GOUT_MATCH_LEVEL VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      PR_REV_GROUP VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      DATA_SRCE_NBR SMALLINT,
      SYS_SOURCE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_TARGET_ID INTEGER,
      SYS_AUTH_ID VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_CREATED_BY VARCHAR(70) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_CREATION_DATE TIMESTAMP(0),
      SYS_LAST_MODIFIED_DATE TIMESTAMP(0),
      SYS_ENT_STATE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_LAST_MODIFIED_BY VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_NC_TYPE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_ERR_CODE VARCHAR(100) CHARACTER SET LATIN NOT CASESPECIFIC,
      SYS_ERR_SVRTY VARCHAR(30) CHARACTER SET LATIN NOT CASESPECIFIC,
      NATIONAL_ID_NBR VARCHAR(50) CHARACTER SET LATIN NOT CASESPECIFIC,
      GL_ACCURACY VARCHAR(50) CHARACTER SET LATIN NOT CASESPECIFIC,
      GL_MATCH_FLAG VARCHAR(50) CHARACTER SET LATIN NOT CASESPECIFIC,
      GL_LATITUDE VARCHAR(50) CHARACTER SET LATIN NOT CASESPECIFIC,
      GL_LONGITUDE VARCHAR(50) CHARACTER SET LATIN NOT CASESPECIFIC,
      DR_CLEANSE_LEVEL VARCHAR(50) CHARACTER SET LATIN NOT CASESPECIFIC,
      POSTL_ADDR_ID INTEGER)
PRIMARY INDEX REGIS_PRSNA_POSTL_ADDR_NUPI ( REGIS_PRSNA_ID ,MKTNG_PGM_NBR )
PARTITION BY MKTNG_PGM_NBR 
ON COMMIT PRESERVE ROWS;
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
.LABEL L54
ALTER TABLE MDM.TSS_PRSNA_IDS_AFR             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_ARB             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_AUS             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_AUT             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_BEL             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_BGR             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_BRA             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_CAN             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_CHE             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_CHN             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_CZE             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_DEU             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_DNK             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_EGY             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_ESP             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_FIN             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_FRA             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_GBR             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_GRC             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_HKG             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_HRV             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_HUN             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_IND             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_IRL             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_ISR             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_ITA             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_JPN             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_KOR             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_LA              ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_LUX             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_MYS             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_NLD             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_NOR             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_NZL             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_OTH             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_PAK             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_PHL             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_POL             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_PRT             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_ROU             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_RUS             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_SGP             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_SWE             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_TUR             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_TWN             ADD SYS_TARGET_ID INTEGER COMPRESS;
ALTER TABLE MDM.TSS_PRSNA_IDS_USA             ADD SYS_TARGET_ID INTEGER COMPRESS;
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
.LABEL L55
UPDATE MDM.REGIS_PRSNA_POSTL_ADDR
FROM MDM.LEGAL_ENT B
SET CNTRY_CODE=SUBSTR(B.LEGAL_ENT_SHORT_NAME,1,3)
WHERE MDM.REGIS_PRSNA_POSTL_ADDR.LEGAL_ENT_NBR=B.LEGAL_ENT_NBR
AND MDM.REGIS_PRSNA_POSTL_ADDR.CNTRY_CODE IS NULL;
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
.LABEL L56
 ALTER TABLE MDM.REGIS_PRSNA_OPT_HISTTEMP    ADD  POSTL_ADDR_ID INTEGER ;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 .LABEL L57
REPLACE VIEW MDM.CAMPAIGN AS LOCKING ROW FOR ACCESS SELECT * FROM ICRM_TBL.CAMPAIGN;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

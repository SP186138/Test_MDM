.logon $TDPID/$TDUSER,$TDPWD


.SET ERROROUT STDOUT;
.SET SESSION CHARSET 'UTF8';

DATABASE MDM;
.GOTO $Step





 .LABEL L0
 CREATE SET TABLE USER_WORK.MATCHD_CNSMR_PRSNA_DUP1 ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      MATCHD_CNSMR_PRSNA_ID INTEGER NOT NULL,
      LEGAL_ENT_NBR SMALLINT NOT NULL,
      HSHLD_PRSNA_ID INTEGER COMPRESS (83380304 ,75577687 ,83385190 ,83154796 ,75577714 ,75577753 ,29439913 ,75577534 ,104781248 ,83381197 ,13454817 ,83624937 ,86385135 ,47597041 ,105629941 ),
      HEAD_OF_HSHLD_IND CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ('N','Y'),
      UNIVERSAL_OPT_OUT CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ' ',
      NAME_PREFX_TXT VARCHAR(32) CHARACTER SET UNICODE NOT CASESPECIFIC COMPRESS ('MISS','MR','MS','Mr.','Mrs','Mrs.','Ms.'),
      GVN_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC COMPRESS ('','Amanda','Amy','Andrea','Angela','Ashley','Barbara','Carol','Christina','Christine','Cindy','Debbie','Donna','Elizabeth','Heather','Jennifer','Jessica','Julie','Karen','Kathy','Kelly','Kim','Kimberly','Laura','Linda','Lisa','Maria','Mary','Melissa','Michelle','nancy','Nicole','Patricia','Rebecca','Sandra','sarah','Sharon','Stephanie','Susan'),
      MID_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC COMPRESS '',
      FAMLY_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC COMPRESS ('','Anderson','Brown','Clark','Costa','Davis','Ferreira','Garcia','Gonzalez','Hall','Harris','Hernandez','Jackson','Johnson','Jones','Kumar','Lee','Lewis','Lima','Lopez','Martin','Martinez','Miller','Moore','Oliveira','Patel','Pereira','rodriguez','Santos','Silva','Smith','Souza','Taylor','Thomas','Thompson','Walker','White','Williams','Wilson'),
      NAME_SUFFX_TXT CHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC COMPRESS '     ',
      FULL_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC COMPRESS '',
      GENDR_IND CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ('F','M','U'),
      BRTH_DATE DATE FORMAT 'yyyy-mm-dd' COMPRESS (DATE '1979-05-28',DATE '1986-09-28',DATE '1988-01-28',DATE '1970-09-28',DATE '1972-01-28',DATE '1973-06-28',DATE '1980-10-28',DATE '1982-02-28',DATE '1989-06-28',DATE '1974-11-28',DATE '1976-03-28',DATE '1983-07-28',DATE '1986-04-28',DATE '1968-12-28',DATE '1970-04-28',DATE '1977-08-28',DATE '1984-12-28',DATE '1973-01-28',DATE '1980-05-28',DATE '1987-09-28',DATE '1989-01-28',DATE '1971-09-28',DATE '1974-06-28',DATE '1981-10-28',DATE '1983-02-28',DATE '1975-11-28',DATE '1977-03-28',DATE '1984-07-28',DATE '1987-04-28',DATE '1969-12-28',DATE '1971-04-28',DATE '1978-08-28',DATE '1985-12-28',DATE '1972-09-28',DATE '1974-01-28',DATE '1981-05-28',DATE '1988-09-28',DATE '1990-01-28',DATE '1975-06-28',DATE '1982-10-28',DATE '1984-02-28',DATE '1969-07-28',DATE '1976-11-28',DATE '1978-03-28',DATE '1985-07-28',DATE '1979-08-28',DATE '1986-12-28',DATE '1988-04-28',DATE '1970-12-28',DATE '1972-04-28',DATE '1973-09-28',DATE '1975-01-28',DATE '1982-05-28',DATE '1989-09-28',DATE '1976-06-28',DATE '1983-10-28',DATE '1985-02-28',DATE '1979-03-28',DATE '1986-07-28',DATE '1970-07-28',DATE '1977-11-28',DATE '1973-04-28',DATE '1980-08-28',DATE '1987-12-28',DATE '1971-12-28',DATE '1974-09-28',DATE '1976-01-28',DATE '1983-05-28',DATE '1990-09-28',DATE '1986-02-28',DATE '1970-02-28',DATE '1977-06-28',DATE '1984-10-28',DATE '1980-03-28',DATE '1987-07-28',DATE '1971-07-28',DATE '1978-11-28',DATE '1972-12-28',DATE '1974-04-28',DATE '1981-08-28',DATE '1988-12-28',DATE '1975-09-28',DATE '1977-01-28',DATE '1984-05-28',DATE '1987-02-28',DATE '1969-10-28',DATE '1971-02-28',DATE '1978-06-28',DATE '1985-10-28',DATE '1979-11-28',DATE '1981-03-28',DATE '1988-07-28',DATE '1972-07-28',DATE '1973-12-28',DATE '1975-04-28',DATE '1982-08-28',DATE '1976-09-28',DATE '1978-01-28',DATE '1985-05-28',DATE '1979-06-28',DATE '1986-10-28',DATE '1988-02-28',DATE '1970-10-28',DATE '1972-02-28',DATE '1900-01-01',DATE '1980-01-01',DATE '1973-07-28',DATE '1980-11-28',DATE '1982-03-28',DATE '1989-07-28',DATE '1974-12-28',DATE '1976-04-28',DATE '1983-08-28',DATE '1979-01-28',DATE '1986-05-28',DATE '1970-05-28',DATE '1977-09-28',DATE '1973-02-28',DATE '1980-06-28',DATE '1987-10-28',DATE '1971-10-28',DATE '1901-01-01',DATE '1981-01-01',DATE '1974-07-28',DATE '1981-11-28',DATE '1983-03-28',DATE '1990-07-28',DATE '1975-12-28',DATE '1977-04-28',DATE '1984-08-28',DATE '1980-01-28',DATE '1987-05-28',DATE '1971-05-28',DATE '1978-09-28',DATE '1972-10-28',DATE '1974-02-28',DATE '1981-06-28',DATE '1988-10-28',DATE '1975-07-28',DATE '1982-11-28',DATE '1984-03-28',DATE '1969-08-28',DATE '1976-12-28',DATE '1978-04-28',DATE '1985-08-28',DATE '1979-09-28',DATE '1981-01-28',DATE '1988-05-28',DATE '1972-05-28',DATE '1973-10-28',DATE '1975-02-28',DATE '1982-06-28',DATE '1976-07-28',DATE '1983-11-28',DATE '1985-03-28',DATE '1979-04-28',DATE '1986-08-28',DATE '1970-08-28',DATE '1977-12-28',DATE '1973-05-28',DATE '1980-09-28',DATE '1982-01-28',DATE '1989-05-28',DATE '1974-10-28',DATE '1976-02-28',DATE '1983-06-28',DATE '1986-03-28',DATE '1970-03-28',DATE '1977-07-28',DATE '1984-11-28',DATE '1980-04-28',DATE '1987-08-28',DATE '1962-12-28',DATE '1971-08-28',DATE '1978-12-28',DATE '1974-05-28',DATE '1981-09-28',DATE '1983-01-28',DATE '1990-05-28',DATE '1975-10-28',DATE '1977-02-28',DATE '1984-06-28',DATE '0001-01-01',DATE '1987-03-28',DATE '1971-03-28',DATE '1978-07-28',DATE '1985-11-28',DATE '1979-12-28',DATE '1981-04-28',DATE '1988-08-28',DATE '1972-08-28',DATE '1975-05-28',DATE '1982-09-28',DATE '1984-01-28',DATE '1976-10-28',DATE '1978-02-28',DATE '1985-06-28',DATE '1979-07-28',DATE '1986-11-28',DATE '1988-03-28',DATE '1970-11-28',DATE '1972-03-28',DATE '1973-08-28',DATE '1980-12-28',DATE '1982-04-28',DATE '1989-08-28',DATE '1969-01-28',DATE '1976-05-28',DATE '1983-09-28',DATE '1985-01-28',DATE '1979-02-28',DATE '1986-06-28',DATE '1970-06-28',DATE '1977-10-28',DATE '1973-03-28',DATE '1980-07-28',DATE '1987-11-28',DATE '1989-03-28',DATE '1971-11-28',DATE '1974-08-28',DATE '1981-12-28',DATE '1983-04-28',DATE '1990-08-28',DATE '1986-01-28',DATE '1970-01-28',DATE '1977-05-28',DATE '1984-09-28',DATE '1980-02-28',DATE '1987-06-28',DATE '1971-06-28',DATE '1978-10-28',DATE '1972-11-28',DATE '1974-03-28',DATE '1981-07-28',DATE '1988-11-28',DATE '1990-03-28',DATE '1975-08-28',DATE '1982-12-28',DATE '1984-04-28',DATE '1987-01-28',DATE '1969-09-28',DATE '1971-01-28',DATE '1978-05-28',DATE '1985-09-28',DATE '1979-10-28',DATE '1981-02-28',DATE '1988-06-28',DATE '1972-06-28',DATE '1973-11-28',DATE '1975-03-28',DATE '1982-07-28',DATE '1976-08-28',DATE '1983-12-28',DATE '1985-04-28'),
      NOTE_TXT VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      LATST_ACTVY_DATE DATE FORMAT 'yyyy-mm-dd' COMPRESS (DATE '2011-05-28',DATE '2012-10-25',DATE '2011-05-29',DATE '2011-05-30',DATE '2011-05-31',DATE '2012-05-22',DATE '2012-05-24',DATE '2008-11-02',DATE '2007-06-07',DATE '2012-05-28',DATE '2011-08-02',DATE '2011-08-03',DATE '2011-08-04',DATE '2006-06-30',DATE '2007-01-03',DATE '2011-08-07',DATE '2011-08-08',DATE '2011-08-09',DATE '2011-08-10',DATE '2011-08-11',DATE '2011-08-12',DATE '2011-08-15',DATE '2012-08-01',DATE '2012-08-02',DATE '2011-08-19',DATE '2011-08-20',DATE '2012-08-05',DATE '2011-08-21',DATE '2012-08-06',DATE '2011-08-22',DATE '2012-08-07',DATE '2011-08-23',DATE '2011-08-24',DATE '2012-08-09',DATE '2011-08-25',DATE '2012-08-10',DATE '2012-03-01',DATE '2012-08-13',DATE '2012-08-14',DATE '2011-08-30',DATE '2012-08-16',DATE '2012-03-05',DATE '2012-08-17',DATE '2012-03-07',DATE '2012-03-08',DATE '2012-08-20',DATE '2012-08-21',DATE '2012-08-22',DATE '2012-08-23',DATE '2012-03-12',DATE '2010-11-12',DATE '2012-08-27',DATE '2012-08-28',DATE '2010-11-17',DATE '2011-11-01',DATE '2012-03-22',DATE '2012-03-23',DATE '2013-03-07',DATE '2013-03-08',DATE '2010-11-24',DATE '2011-11-08',DATE '2010-11-26',DATE '2011-06-01',DATE '2013-03-14',DATE '2011-06-02',DATE '2011-06-03',DATE '2011-11-15',DATE '2011-06-04',DATE '2011-11-16',DATE '2011-06-05',DATE '2011-11-17',DATE '2011-06-06',DATE '2011-11-18',DATE '2011-06-07',DATE '2011-11-19',DATE '2011-06-08',DATE '2011-11-20',DATE '2009-01-29',DATE '2011-06-09',DATE '2011-06-10',DATE '2011-06-11',DATE '2011-11-23',DATE '2011-06-12',DATE '2010-06-29',DATE '2011-06-13',DATE '2011-06-14',DATE '2011-06-15',DATE '2011-06-16',DATE '2005-02-01',DATE '2012-06-01',DATE '2011-06-17',DATE '2011-06-18',DATE '2011-06-19',DATE '2011-06-20',DATE '2011-06-21',DATE '2011-06-22',DATE '2012-06-07',DATE '2010-01-27',DATE '2011-06-23',DATE '2012-06-08',DATE '2011-06-24',DATE '2011-06-25',DATE '2011-06-26',DATE '2011-06-27',DATE '2011-06-28',DATE '1900-01-01',DATE '2011-06-29',DATE '2011-06-30',DATE '2012-01-04',DATE '2012-01-05',DATE '2012-01-06',DATE '2012-06-20',DATE '2010-09-08',DATE '2007-07-01',DATE '2011-01-27',DATE '2012-06-27',DATE '2012-01-16',DATE '2011-09-06',DATE '2011-09-07',DATE '2011-09-08',DATE '2013-01-09',DATE '2010-09-26',DATE '2011-09-15',DATE '2011-09-16',DATE '2012-09-02',DATE '2012-09-03',DATE '2012-09-04',DATE '2012-09-05',DATE '2012-09-06',DATE '2013-01-22',DATE '2011-04-12',DATE '2012-09-09',DATE '2012-09-10',DATE '2008-07-18',DATE '2011-04-14',DATE '2012-09-11',DATE '2012-09-12',DATE '2011-09-28',DATE '2010-12-01',DATE '2011-04-18',DATE '2011-09-30',DATE '2011-04-19',DATE '2011-04-20',DATE '2012-09-17',DATE '2011-04-21',DATE '2012-09-18',DATE '2011-04-22',DATE '2012-09-19',DATE '2012-09-20',DATE '2010-12-08',DATE '2011-04-24',DATE '2012-09-21',DATE '2011-04-25',DATE '2012-04-10',DATE '2012-09-22',DATE '2012-09-23',DATE '2008-07-31',DATE '2011-04-27',DATE '2011-04-28',DATE '2012-09-26',DATE '2012-09-27',DATE '2009-12-31',DATE '2012-09-28',DATE '2009-07-21',DATE '2012-09-30',DATE '2009-07-23',DATE '2012-04-23',DATE '2010-12-23',DATE '2012-04-25',DATE '2011-12-12',DATE '2011-07-02',DATE '2010-12-31',DATE '2011-07-03',DATE '2011-07-04',DATE '2011-07-05',DATE '2007-05-14',DATE '2011-07-10',DATE '2011-12-22',DATE '2008-10-16',DATE '2011-07-12',DATE '2008-10-17',DATE '2011-07-13',DATE '2012-12-10',DATE '2008-10-18',DATE '2008-10-19',DATE '2005-08-12',DATE '2011-12-29',DATE '2012-07-03',DATE '2012-12-15',DATE '2011-12-31',DATE '2011-07-21',DATE '2012-12-19',DATE '2011-02-11',DATE '2011-07-24',DATE '2012-07-09',DATE '2011-07-25',DATE '2012-07-10',DATE '2011-02-14',DATE '2011-07-26',DATE '2003-11-12',DATE '2012-02-02',DATE '2012-07-15',DATE '2012-07-17',DATE '2012-07-19',DATE '2012-12-31',DATE '2011-02-23',DATE '2012-07-20',DATE '2011-02-24',DATE '2012-07-23',DATE '2012-07-24',DATE '2012-07-25',DATE '2012-07-26',DATE '2012-07-27',DATE '2012-02-16',DATE '2009-05-20',DATE '2012-02-17',DATE '2012-07-30',DATE '2012-07-31',DATE '2010-10-20',DATE '2013-02-05',DATE '2012-02-23',DATE '2011-10-11',DATE '2012-02-29',DATE '2011-05-03',DATE '2011-05-04',DATE '2012-10-01',DATE '2011-05-05',DATE '2012-10-02',DATE '2011-05-06',DATE '2012-10-03',DATE '2012-10-04',DATE '2012-10-05',DATE '2011-05-09',DATE '2012-10-08',DATE '2011-10-24',DATE '2012-10-09',DATE '2012-10-10',DATE '2011-05-15',DATE '2011-05-16',DATE '2011-05-17',DATE '2012-10-14',DATE '2011-05-18',DATE '2012-10-15',DATE '2011-05-19',DATE '2012-10-16',DATE '2012-10-17',DATE '2011-05-22',DATE '2011-05-23',DATE '2011-05-24',DATE '2007-11-01',DATE '2011-05-25',DATE '2012-05-10',DATE '2007-11-02',DATE '2011-05-26',DATE '2011-05-27'),
      PRSNA_STATUS_CODE CHAR(2) CHARACTER SET LATIN NOT CASESPECIFIC NOT NULL COMPRESS 'AC',
      CNSMR_USER_NAME VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC COMPRESS '',
      LANG_CODE CHAR(5) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ('     ','EN   ','ES   ','JA   ','KO   ','PT   ','TW   ','UNKN ','ZH   ','en_CA','en_US','es_CL','es_MX','pt_BR'),
      REGIS_DATETM TIMESTAMP(6),
      SYS_SOURCE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ,
      SYS_TARGET_ID INTEGER COMPRESS (1280 ,1281 ,1029 ,1043 ,1299 ,1047 ,1049 ,1307 ,1053 ,1061 ,1318 ,1075 ,1332 ,1333 ,1078 ,1334 ,1335 ,1336 ,1085 ,1092 ,1100 ,1108 ,1109 ,1111 ,1112 ,1113 ,1115 ,1117 ,1121 ,1140 ,1142 ,1148 ,1153 ,1156 ,1164 ,1167 ,1172 ,1175 ,1177 ,1179 ,1182 ,1188 ,1197 ,1200 ,1204 ,1212 ,1213 ,1217 ,1222 ,1224 ,1228 ,9933 ,1230 ,1233 ,1239 ,1241 ,1242 ,1251 ,1255 ,1001 ,1018 ,1019 ,1279 ),
      SYS_AUTH_ID VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ,
      SYS_CREATED_BY VARCHAR(70) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ,
      SYS_CREATION_DATE TIMESTAMP(0),
      SYS_LAST_MODIFIED_DATE TIMESTAMP(0),
      SYS_ENT_STATE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ,
      SYS_LAST_MODIFIED_BY VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS 'EtlUser',
      SYS_NC_TYPE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ('INSERT','UPDATE'),
      SYS_ERR_CODE VARCHAR(100) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ('REQ0012830','REQ0012861-0918FIX','REQ0012893'),
      SYS_ERR_SVRTY VARCHAR(30) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS)
PRIMARY INDEX MATCHD_CNSMR_PRSNA_NUPI ( MATCHD_CNSMR_PRSNA_ID ,
LEGAL_ENT_NBR )
PARTITION BY LEGAL_ENT_NBR ;

.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;


.LABEL L1

CREATE SET TABLE USER_WORK.MATCHD_CNSMR_PRSNA_DUP2 ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT,
     DEFAULT MERGEBLOCKRATIO
     (
      MATCHD_CNSMR_PRSNA_ID INTEGER NOT NULL,
      LEGAL_ENT_NBR SMALLINT NOT NULL,
      HSHLD_PRSNA_ID INTEGER COMPRESS (83380304 ,75577687 ,83385190 ,83154796 ,75577714 ,75577753 ,29439913 ,75577534 ,104781248 ,83381197 ,13454817 ,83624937 ,86385135 ,47597041 ,105629941 ),
      HEAD_OF_HSHLD_IND CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ('N','Y'),
      UNIVERSAL_OPT_OUT CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ' ',
      NAME_PREFX_TXT VARCHAR(32) CHARACTER SET UNICODE NOT CASESPECIFIC COMPRESS ('MISS','MR','MS','Mr.','Mrs','Mrs.','Ms.'),
      GVN_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC COMPRESS ('','Amanda','Amy','Andrea','Angela','Ashley','Barbara','Carol','Christina','Christine','Cindy','Debbie','Donna','Elizabeth','Heather','Jennifer','Jessica','Julie','Karen','Kathy','Kelly','Kim','Kimberly','Laura','Linda','Lisa','Maria','Mary','Melissa','Michelle','nancy','Nicole','Patricia','Rebecca','Sandra','sarah','Sharon','Stephanie','Susan'),
      MID_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC COMPRESS '',
      FAMLY_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC COMPRESS ('','Anderson','Brown','Clark','Costa','Davis','Ferreira','Garcia','Gonzalez','Hall','Harris','Hernandez','Jackson','Johnson','Jones','Kumar','Lee','Lewis','Lima','Lopez','Martin','Martinez','Miller','Moore','Oliveira','Patel','Pereira','rodriguez','Santos','Silva','Smith','Souza','Taylor','Thomas','Thompson','Walker','White','Williams','Wilson'),
      NAME_SUFFX_TXT CHAR(5) CHARACTER SET UNICODE NOT CASESPECIFIC COMPRESS '     ',
      FULL_NAME VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC COMPRESS '',
      GENDR_IND CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ('F','M','U'),
      BRTH_DATE DATE FORMAT 'yyyy-mm-dd' COMPRESS (DATE '1979-05-28',DATE '1986-09-28',DATE '1988-01-28',DATE '1970-09-28',DATE '1972-01-28',DATE '1973-06-28',DATE '1980-10-28',DATE '1982-02-28',DATE '1989-06-28',DATE '1974-11-28',DATE '1976-03-28',DATE '1983-07-28',DATE '1986-04-28',DATE '1968-12-28',DATE '1970-04-28',DATE '1977-08-28',DATE '1984-12-28',DATE '1973-01-28',DATE '1980-05-28',DATE '1987-09-28',DATE '1989-01-28',DATE '1971-09-28',DATE '1974-06-28',DATE '1981-10-28',DATE '1983-02-28',DATE '1975-11-28',DATE '1977-03-28',DATE '1984-07-28',DATE '1987-04-28',DATE '1969-12-28',DATE '1971-04-28',DATE '1978-08-28',DATE '1985-12-28',DATE '1972-09-28',DATE '1974-01-28',DATE '1981-05-28',DATE '1988-09-28',DATE '1990-01-28',DATE '1975-06-28',DATE '1982-10-28',DATE '1984-02-28',DATE '1969-07-28',DATE '1976-11-28',DATE '1978-03-28',DATE '1985-07-28',DATE '1979-08-28',DATE '1986-12-28',DATE '1988-04-28',DATE '1970-12-28',DATE '1972-04-28',DATE '1973-09-28',DATE '1975-01-28',DATE '1982-05-28',DATE '1989-09-28',DATE '1976-06-28',DATE '1983-10-28',DATE '1985-02-28',DATE '1979-03-28',DATE '1986-07-28',DATE '1970-07-28',DATE '1977-11-28',DATE '1973-04-28',DATE '1980-08-28',DATE '1987-12-28',DATE '1971-12-28',DATE '1974-09-28',DATE '1976-01-28',DATE '1983-05-28',DATE '1990-09-28',DATE '1986-02-28',DATE '1970-02-28',DATE '1977-06-28',DATE '1984-10-28',DATE '1980-03-28',DATE '1987-07-28',DATE '1971-07-28',DATE '1978-11-28',DATE '1972-12-28',DATE '1974-04-28',DATE '1981-08-28',DATE '1988-12-28',DATE '1975-09-28',DATE '1977-01-28',DATE '1984-05-28',DATE '1987-02-28',DATE '1969-10-28',DATE '1971-02-28',DATE '1978-06-28',DATE '1985-10-28',DATE '1979-11-28',DATE '1981-03-28',DATE '1988-07-28',DATE '1972-07-28',DATE '1973-12-28',DATE '1975-04-28',DATE '1982-08-28',DATE '1976-09-28',DATE '1978-01-28',DATE '1985-05-28',DATE '1979-06-28',DATE '1986-10-28',DATE '1988-02-28',DATE '1970-10-28',DATE '1972-02-28',DATE '1900-01-01',DATE '1980-01-01',DATE '1973-07-28',DATE '1980-11-28',DATE '1982-03-28',DATE '1989-07-28',DATE '1974-12-28',DATE '1976-04-28',DATE '1983-08-28',DATE '1979-01-28',DATE '1986-05-28',DATE '1970-05-28',DATE '1977-09-28',DATE '1973-02-28',DATE '1980-06-28',DATE '1987-10-28',DATE '1971-10-28',DATE '1901-01-01',DATE '1981-01-01',DATE '1974-07-28',DATE '1981-11-28',DATE '1983-03-28',DATE '1990-07-28',DATE '1975-12-28',DATE '1977-04-28',DATE '1984-08-28',DATE '1980-01-28',DATE '1987-05-28',DATE '1971-05-28',DATE '1978-09-28',DATE '1972-10-28',DATE '1974-02-28',DATE '1981-06-28',DATE '1988-10-28',DATE '1975-07-28',DATE '1982-11-28',DATE '1984-03-28',DATE '1969-08-28',DATE '1976-12-28',DATE '1978-04-28',DATE '1985-08-28',DATE '1979-09-28',DATE '1981-01-28',DATE '1988-05-28',DATE '1972-05-28',DATE '1973-10-28',DATE '1975-02-28',DATE '1982-06-28',DATE '1976-07-28',DATE '1983-11-28',DATE '1985-03-28',DATE '1979-04-28',DATE '1986-08-28',DATE '1970-08-28',DATE '1977-12-28',DATE '1973-05-28',DATE '1980-09-28',DATE '1982-01-28',DATE '1989-05-28',DATE '1974-10-28',DATE '1976-02-28',DATE '1983-06-28',DATE '1986-03-28',DATE '1970-03-28',DATE '1977-07-28',DATE '1984-11-28',DATE '1980-04-28',DATE '1987-08-28',DATE '1962-12-28',DATE '1971-08-28',DATE '1978-12-28',DATE '1974-05-28',DATE '1981-09-28',DATE '1983-01-28',DATE '1990-05-28',DATE '1975-10-28',DATE '1977-02-28',DATE '1984-06-28',DATE '0001-01-01',DATE '1987-03-28',DATE '1971-03-28',DATE '1978-07-28',DATE '1985-11-28',DATE '1979-12-28',DATE '1981-04-28',DATE '1988-08-28',DATE '1972-08-28',DATE '1975-05-28',DATE '1982-09-28',DATE '1984-01-28',DATE '1976-10-28',DATE '1978-02-28',DATE '1985-06-28',DATE '1979-07-28',DATE '1986-11-28',DATE '1988-03-28',DATE '1970-11-28',DATE '1972-03-28',DATE '1973-08-28',DATE '1980-12-28',DATE '1982-04-28',DATE '1989-08-28',DATE '1969-01-28',DATE '1976-05-28',DATE '1983-09-28',DATE '1985-01-28',DATE '1979-02-28',DATE '1986-06-28',DATE '1970-06-28',DATE '1977-10-28',DATE '1973-03-28',DATE '1980-07-28',DATE '1987-11-28',DATE '1989-03-28',DATE '1971-11-28',DATE '1974-08-28',DATE '1981-12-28',DATE '1983-04-28',DATE '1990-08-28',DATE '1986-01-28',DATE '1970-01-28',DATE '1977-05-28',DATE '1984-09-28',DATE '1980-02-28',DATE '1987-06-28',DATE '1971-06-28',DATE '1978-10-28',DATE '1972-11-28',DATE '1974-03-28',DATE '1981-07-28',DATE '1988-11-28',DATE '1990-03-28',DATE '1975-08-28',DATE '1982-12-28',DATE '1984-04-28',DATE '1987-01-28',DATE '1969-09-28',DATE '1971-01-28',DATE '1978-05-28',DATE '1985-09-28',DATE '1979-10-28',DATE '1981-02-28',DATE '1988-06-28',DATE '1972-06-28',DATE '1973-11-28',DATE '1975-03-28',DATE '1982-07-28',DATE '1976-08-28',DATE '1983-12-28',DATE '1985-04-28'),
      NOTE_TXT VARCHAR(1000) CHARACTER SET UNICODE NOT CASESPECIFIC,
      LATST_ACTVY_DATE DATE FORMAT 'yyyy-mm-dd' COMPRESS (DATE '2011-05-28',DATE '2012-10-25',DATE '2011-05-29',DATE '2011-05-30',DATE '2011-05-31',DATE '2012-05-22',DATE '2012-05-24',DATE '2008-11-02',DATE '2007-06-07',DATE '2012-05-28',DATE '2011-08-02',DATE '2011-08-03',DATE '2011-08-04',DATE '2006-06-30',DATE '2007-01-03',DATE '2011-08-07',DATE '2011-08-08',DATE '2011-08-09',DATE '2011-08-10',DATE '2011-08-11',DATE '2011-08-12',DATE '2011-08-15',DATE '2012-08-01',DATE '2012-08-02',DATE '2011-08-19',DATE '2011-08-20',DATE '2012-08-05',DATE '2011-08-21',DATE '2012-08-06',DATE '2011-08-22',DATE '2012-08-07',DATE '2011-08-23',DATE '2011-08-24',DATE '2012-08-09',DATE '2011-08-25',DATE '2012-08-10',DATE '2012-03-01',DATE '2012-08-13',DATE '2012-08-14',DATE '2011-08-30',DATE '2012-08-16',DATE '2012-03-05',DATE '2012-08-17',DATE '2012-03-07',DATE '2012-03-08',DATE '2012-08-20',DATE '2012-08-21',DATE '2012-08-22',DATE '2012-08-23',DATE '2012-03-12',DATE '2010-11-12',DATE '2012-08-27',DATE '2012-08-28',DATE '2010-11-17',DATE '2011-11-01',DATE '2012-03-22',DATE '2012-03-23',DATE '2013-03-07',DATE '2013-03-08',DATE '2010-11-24',DATE '2011-11-08',DATE '2010-11-26',DATE '2011-06-01',DATE '2013-03-14',DATE '2011-06-02',DATE '2011-06-03',DATE '2011-11-15',DATE '2011-06-04',DATE '2011-11-16',DATE '2011-06-05',DATE '2011-11-17',DATE '2011-06-06',DATE '2011-11-18',DATE '2011-06-07',DATE '2011-11-19',DATE '2011-06-08',DATE '2011-11-20',DATE '2009-01-29',DATE '2011-06-09',DATE '2011-06-10',DATE '2011-06-11',DATE '2011-11-23',DATE '2011-06-12',DATE '2010-06-29',DATE '2011-06-13',DATE '2011-06-14',DATE '2011-06-15',DATE '2011-06-16',DATE '2005-02-01',DATE '2012-06-01',DATE '2011-06-17',DATE '2011-06-18',DATE '2011-06-19',DATE '2011-06-20',DATE '2011-06-21',DATE '2011-06-22',DATE '2012-06-07',DATE '2010-01-27',DATE '2011-06-23',DATE '2012-06-08',DATE '2011-06-24',DATE '2011-06-25',DATE '2011-06-26',DATE '2011-06-27',DATE '2011-06-28',DATE '1900-01-01',DATE '2011-06-29',DATE '2011-06-30',DATE '2012-01-04',DATE '2012-01-05',DATE '2012-01-06',DATE '2012-06-20',DATE '2010-09-08',DATE '2007-07-01',DATE '2011-01-27',DATE '2012-06-27',DATE '2012-01-16',DATE '2011-09-06',DATE '2011-09-07',DATE '2011-09-08',DATE '2013-01-09',DATE '2010-09-26',DATE '2011-09-15',DATE '2011-09-16',DATE '2012-09-02',DATE '2012-09-03',DATE '2012-09-04',DATE '2012-09-05',DATE '2012-09-06',DATE '2013-01-22',DATE '2011-04-12',DATE '2012-09-09',DATE '2012-09-10',DATE '2008-07-18',DATE '2011-04-14',DATE '2012-09-11',DATE '2012-09-12',DATE '2011-09-28',DATE '2010-12-01',DATE '2011-04-18',DATE '2011-09-30',DATE '2011-04-19',DATE '2011-04-20',DATE '2012-09-17',DATE '2011-04-21',DATE '2012-09-18',DATE '2011-04-22',DATE '2012-09-19',DATE '2012-09-20',DATE '2010-12-08',DATE '2011-04-24',DATE '2012-09-21',DATE '2011-04-25',DATE '2012-04-10',DATE '2012-09-22',DATE '2012-09-23',DATE '2008-07-31',DATE '2011-04-27',DATE '2011-04-28',DATE '2012-09-26',DATE '2012-09-27',DATE '2009-12-31',DATE '2012-09-28',DATE '2009-07-21',DATE '2012-09-30',DATE '2009-07-23',DATE '2012-04-23',DATE '2010-12-23',DATE '2012-04-25',DATE '2011-12-12',DATE '2011-07-02',DATE '2010-12-31',DATE '2011-07-03',DATE '2011-07-04',DATE '2011-07-05',DATE '2007-05-14',DATE '2011-07-10',DATE '2011-12-22',DATE '2008-10-16',DATE '2011-07-12',DATE '2008-10-17',DATE '2011-07-13',DATE '2012-12-10',DATE '2008-10-18',DATE '2008-10-19',DATE '2005-08-12',DATE '2011-12-29',DATE '2012-07-03',DATE '2012-12-15',DATE '2011-12-31',DATE '2011-07-21',DATE '2012-12-19',DATE '2011-02-11',DATE '2011-07-24',DATE '2012-07-09',DATE '2011-07-25',DATE '2012-07-10',DATE '2011-02-14',DATE '2011-07-26',DATE '2003-11-12',DATE '2012-02-02',DATE '2012-07-15',DATE '2012-07-17',DATE '2012-07-19',DATE '2012-12-31',DATE '2011-02-23',DATE '2012-07-20',DATE '2011-02-24',DATE '2012-07-23',DATE '2012-07-24',DATE '2012-07-25',DATE '2012-07-26',DATE '2012-07-27',DATE '2012-02-16',DATE '2009-05-20',DATE '2012-02-17',DATE '2012-07-30',DATE '2012-07-31',DATE '2010-10-20',DATE '2013-02-05',DATE '2012-02-23',DATE '2011-10-11',DATE '2012-02-29',DATE '2011-05-03',DATE '2011-05-04',DATE '2012-10-01',DATE '2011-05-05',DATE '2012-10-02',DATE '2011-05-06',DATE '2012-10-03',DATE '2012-10-04',DATE '2012-10-05',DATE '2011-05-09',DATE '2012-10-08',DATE '2011-10-24',DATE '2012-10-09',DATE '2012-10-10',DATE '2011-05-15',DATE '2011-05-16',DATE '2011-05-17',DATE '2012-10-14',DATE '2011-05-18',DATE '2012-10-15',DATE '2011-05-19',DATE '2012-10-16',DATE '2012-10-17',DATE '2011-05-22',DATE '2011-05-23',DATE '2011-05-24',DATE '2007-11-01',DATE '2011-05-25',DATE '2012-05-10',DATE '2007-11-02',DATE '2011-05-26',DATE '2011-05-27'),
      PRSNA_STATUS_CODE CHAR(2) CHARACTER SET LATIN NOT CASESPECIFIC NOT NULL COMPRESS 'AC',
      CNSMR_USER_NAME VARCHAR(20) CHARACTER SET UNICODE NOT CASESPECIFIC COMPRESS '',
      LANG_CODE CHAR(5) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ('     ','EN   ','ES   ','JA   ','KO   ','PT   ','TW   ','UNKN ','ZH   ','en_CA','en_US','es_CL','es_MX','pt_BR'),
      REGIS_DATETM TIMESTAMP(6),
      SYS_SOURCE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ,
      SYS_TARGET_ID INTEGER COMPRESS (1280 ,1281 ,1029 ,1043 ,1299 ,1047 ,1049 ,1307 ,1053 ,1061 ,1318 ,1075 ,1332 ,1333 ,1078 ,1334 ,1335 ,1336 ,1085 ,1092 ,1100 ,1108 ,1109 ,1111 ,1112 ,1113 ,1115 ,1117 ,1121 ,1140 ,1142 ,1148 ,1153 ,1156 ,1164 ,1167 ,1172 ,1175 ,1177 ,1179 ,1182 ,1188 ,1197 ,1200 ,1204 ,1212 ,1213 ,1217 ,1222 ,1224 ,1228 ,9933 ,1230 ,1233 ,1239 ,1241 ,1242 ,1251 ,1255 ,1001 ,1018 ,1019 ,1279 ),
      SYS_AUTH_ID VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ,
      SYS_CREATED_BY VARCHAR(70) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ,
      SYS_CREATION_DATE TIMESTAMP(0),
      SYS_LAST_MODIFIED_DATE TIMESTAMP(0),
      SYS_ENT_STATE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ,
      SYS_LAST_MODIFIED_BY VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS 'EtlUser',
      SYS_NC_TYPE VARCHAR(20) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ('INSERT','UPDATE'),
      SYS_ERR_CODE VARCHAR(100) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS ('REQ0012830','REQ0012861-0918FIX','REQ0012893'),
      SYS_ERR_SVRTY VARCHAR(30) CHARACTER SET LATIN NOT CASESPECIFIC COMPRESS)
PRIMARY INDEX MATCHD_CNSMR_PRSNA_NUPI ( MATCHD_CNSMR_PRSNA_ID ,
LEGAL_ENT_NBR )
PARTITION BY LEGAL_ENT_NBR ;

.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;



.LABEL L2

INSERT INTO USER_WORK.MATCHD_CNSMR_PRSNA_dup1
SEL * from MDM.MATCHD_CNSMR_PRSNA
where MATCHD_CNSMR_PRSNA_ID in(
SEL MATCHD_CNSMR_PRSNA_ID  
FROM MDM.MATCHD_CNSMR_PRSNA
GROUP BY 1
HAVING COUNT (MATCHD_CNSMR_PRSNA_ID) > 1);

.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;


.LABEL L3

INSERT INTO USER_WORK.MATCHD_CNSMR_PRSNA_DUP2
SEL * FROM USER_WORK.MATCHD_CNSMR_PRSNA_DUP1
QUALIFY RANK() OVER(PARTITION BY MATCHD_CNSMR_PRSNA_ID, LEGAL_ENT_NBR ORDER BY LATST_ACTVY_DATE DESC,REGIS_DATETM DESC, SYS_SOURCE DESC,
SYS_LAST_MODIFIED_DATE DESC,PRSNA_STATUS_CODE ASC, NAME_PREFX_TXT ASC,HSHLD_PRSNA_ID DESC,HEAD_OF_HSHLD_IND ASC,UNIVERSAL_OPT_OUT ASC,
GVN_NAME ASC,MID_NAME ASC,FAMLY_NAME ASC,NAME_SUFFX_TXT ASC,
FULL_NAME ASC,GENDR_IND ASC,BRTH_DATE DESC,NOTE_TXT ASC,
CNSMR_USER_NAME ASC,LANG_CODE ASC,SYS_TARGET_ID DESC,
SYS_AUTH_ID ASC,SYS_CREATED_BY ASC,SYS_CREATION_DATE DESC,
SYS_ENT_STATE ASC,SYS_LAST_MODIFIED_BY ASC,SYS_NC_TYPE ASC,SYS_ERR_CODE ASC,SYS_ERR_SVRTY ASC)=1;

.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L4

DEL  FROM MDM.MATCHD_CNSMR_PRSNA WHERE MATCHD_CNSMR_PRSNA_ID IN (SEL DISTINCT MATCHD_CNSMR_PRSNA_ID FROM USER_WORK.MATCHD_CNSMR_PRSNA_dup1);

.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L5

INSERT INTO MDM.MATCHD_CNSMR_PRSNA
SEL * FROM USER_WORK.MATCHD_CNSMR_PRSNA_DUP2;

.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;



 .LABEL L6
 
 DEL FROM SALES_TRANX 
WHERE CNSMR_ACTN_ID NOT IN 
(SELECT DISTINCT CNSMR_ACTN_ID 
FROM CNSMR_ACTN);

.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L7

DEL FROM REQSTD_INCTV 
WHERE CNSMR_ACTN_ID NOT IN 
(SELECT DISTINCT CNSMR_ACTN_ID 
FROM CNSMR_ACTN);

.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L8

DEL FROM THIRD_PARTY_RESULTS 
WHERE CNSMR_ACTN_ID NOT IN 
(SELECT DISTINCT CNSMR_ACTN_ID 
FROM CNSMR_ACTN);

.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L9

DEL FROM COUPN_INSTN_REDEMPTN 
WHERE CNSMR_ACTN_ID NOT IN 
(SELECT DISTINCT CNSMR_ACTN_ID 
FROM CNSMR_ACTN);

.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L10

DEL FROM EMAIL_CMPGN_RESP
WHERE CNSMR_ACTN_ID NOT IN 
(SELECT DISTINCT CNSMR_ACTN_ID 
FROM CNSMR_ACTN);

.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L11

DEL FROM SMS_CMPGN_RESP
WHERE CNSMR_ACTN_ID NOT IN 
(SELECT DISTINCT CNSMR_ACTN_ID 
FROM CNSMR_ACTN);

.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L12

DEL FROM POSTL_CMPGN_RESP
WHERE CNSMR_ACTN_ID NOT IN 
(SELECT DISTINCT CNSMR_ACTN_ID 
FROM CNSMR_ACTN);

.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L13

DEL FROM CNSMR_ACTN_PROD_HIER_ASSOC
WHERE CNSMR_ACTN_ID NOT IN 
(SELECT DISTINCT CNSMR_ACTN_ID 
FROM CNSMR_ACTN);

.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L14

DEL FROM SALES_TRANX_LINE 
WHERE SALES_TRANX_NBR NOT IN 
(SELECT DISTINCT TRIM(SALES_TRANX_NBR) 
FROM SALES_TRANX);

.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

.LABEL L15

REPLACE VIEW MDM.V_REGIS_PRSNA
AS
LOCKING ROW FOR ACCESS
SELECT 
REGIS_PRSNA_1.REGIS_PRSNA_ID 
,REGIS_PRSNA_1.MKTNG_PGM_NBR  
,REGIS_PRSNA_1.REGIS_CNSMR_ID_VAL
,REGIS_PRSNA_1.GVN_NAME
,REGIS_PRSNA_1.MID_NAME
,REGIS_PRSNA_1.FAMLY_NAME
,REGIS_PRSNA_1.FAMLY_NAME ||','|| REGIS_PRSNA_1.GVN_NAME AS FULL_NAME
,REGIS_PRSNA_1.BRTH_DATE
,REGIS_PRSNA_1.CNTRY_CODE AS CNTRY_NAME
,REGIS_PRSNA_1.NATIONAL_ID_NBR
,TRIM(REGIS_PRSNA_1.NAME_PREFX_TXT) AS NAME_PREFX_TXT
,TRIM(REGIS_PRSNA_1.NAME_SUFFX_TXT) AS NAME_SUFFX_TXT
,REGIS_PRSNA_1.CNSMR_USER_NAME
,REGIS_PRSNA_1.GENDR_IND
,REGIS_PRSNA_1.LEGAL_ENT_NBR
,REGIS_PRSNA_1.LANG_CODE AS LANG_CODE
,REGIS_PRSNA_1.LANG_CODE AS LANG_NAME
,REGIS_PRSNA_1.MATCHD_CNSMR_PRSNA_ID 
,REGIS_PRSNA_1.DATA_ORIGIN_SRCE_NBR 
,REGIS_PRSNA_1.DATA_OP_SRCE_NAME
,REGIS_PRSNA_1.PRSNA_STATUS_CODE
,PRSNA_POSTL_ADDR_1.ADDR_LINE_1_TXT
,PRSNA_POSTL_ADDR_1.ADDR_LINE_2_TXT
,PRSNA_POSTL_ADDR_1.ADDR_LINE_3_TXT
,PRSNA_POSTL_ADDR_1.STRET_NUM
,PRSNA_POSTL_ADDR_1.STRET_NAME
,PRSNA_POSTL_ADDR_1.APT_NUM
,PRSNA_POSTL_ADDR_1.PO_BOX_NUM
,PRSNA_POSTL_ADDR_1.CITY_NAME
,PRSNA_POSTL_ADDR_1.TERR_CODE
,PRSNA_POSTL_ADDR_1.TERR_CODE AS TERR_NAME
,PRSNA_POSTL_ADDR_1.POSTL_AREA_CODE
,PRSNA_POSTL_ADDR_1.WIN_KEY
,COALESCE(PRSNA_POSTL_ADDR_1.ADDR_LINE_1_TXT,'') ||  ' ' ||
COALESCE(PRSNA_POSTL_ADDR_1.ADDR_LINE_2_TXT,'') ||   ' ' ||
COALESCE(PRSNA_POSTL_ADDR_1.CITY_NAME,'') ||  ' ' ||
COALESCE(PRSNA_POSTL_ADDR_1.POSTL_AREA_CODE,'') AS FULL_ADDRESS
,MKTNG_PGM_1.MKTNG_PGM_NAME
,NULL (INTEGER)   AS  SYS_TARGET_ID
,NULL (VARCHAR(25))  AS SYS_AUTH_ID
,NULL (VARCHAR(25))  AS SYS_SOURCE
,NULL (VARCHAR(70))  AS SYS_CREATED_BY
,NULL (TIMESTAMP(0))  AS SYS_CREATION_DATE
,'ACTIVE'  (VARCHAR(25))  AS  SYS_ENT_STATE
,NULL (VARCHAR(70))  AS SYS_LAST_MODIFIED_BY
,NULL (TIMESTAMP(0))  AS SYS_LAST_MODIFIED_DATE
,NULL (VARCHAR(25))  AS SYS_NC_TYPE
,NULL (VARCHAR(10000))  AS SYS_ERR_CODE
,NULL (VARCHAR(30))  AS SYS_ERR_SVRTY   
,PRSNA_EMAIL_ADDR_1.EMAIL_ADDR_TXT AS EMAIL_ADDR_TXT_1 
,PRSNA_PHONE_1.PHONE_CNTRY_NBR AS PHONE_CNTRY_NBR_1
,PRSNA_PHONE_1.PHONE_AREA_NBR  AS PHONE_AREA_NBR_1
,PRSNA_PHONE_1.PHONE_EXCHG_NBR AS PHONE_EXCHG_NBR_1
,PRSNA_PHONE_1.PHONE_LINE_NBR  AS PHONE_LINE_NBR_1
,PRSNA_PHONE_1.PHONE_EXTSN_NUM AS PHONE_EXTSN_NUM_1
,PRSNA_PHONE_1.FULL_PHONE_NUM  AS FULL_PHONE_NUM_1
FROM MDM.REGIS_PRSNA REGIS_PRSNA_1
LEFT OUTER JOIN MDM.REGIS_PRSNA_POSTL_ADDR PRSNA_POSTL_ADDR_1
ON REGIS_PRSNA_1.REGIS_PRSNA_ID = PRSNA_POSTL_ADDR_1.REGIS_PRSNA_ID
AND REGIS_PRSNA_1.MKTNG_PGM_NBR = PRSNA_POSTL_ADDR_1.MKTNG_PGM_NBR
LEFT OUTER JOIN MDM.REGIS_PRSNA_PHONE PRSNA_PHONE_1
ON REGIS_PRSNA_1.REGIS_PRSNA_ID = PRSNA_PHONE_1.REGIS_PRSNA_ID
AND REGIS_PRSNA_1.MKTNG_PGM_NBR = PRSNA_PHONE_1.MKTNG_PGM_NBR
LEFT OUTER JOIN MDM.REGIS_PRSNA_EMAIL_ADDR PRSNA_EMAIL_ADDR_1
ON REGIS_PRSNA_1.REGIS_PRSNA_ID = PRSNA_EMAIL_ADDR_1.REGIS_PRSNA_ID
AND REGIS_PRSNA_1.MKTNG_PGM_NBR = PRSNA_EMAIL_ADDR_1.MKTNG_PGM_NBR
INNER JOIN MDM.MKTNG_PGM MKTNG_PGM_1
ON REGIS_PRSNA_1.MKTNG_PGM_NBR = MKTNG_PGM_1.MKTNG_PGM_NBR
QUALIFY RANK() OVER(PARTITION BY REGIS_PRSNA_1.REGIS_PRSNA_ID,REGIS_PRSNA_1.MKTNG_PGM_NBR
ORDER BY REGIS_PRSNA_1.PRSNA_STATUS_CODE ASC,PRSNA_EMAIL_ADDR_1.PREF_CNTCT_POINT_IND DESC, PRSNA_PHONE_1.PREF_CNTCT_POINT_IND DESC,PRSNA_POSTL_ADDR_1.PREF_CNTCT_POINT_IND DESC,PRSNA_EMAIL_ADDR_1.EMAIL_ADDR_TXT DESC,PRSNA_PHONE_1.FULL_PHONE_NUM DESC,PRSNA_EMAIL_ADDR_1.SUBSCRPTN_OPT_NBR DESC,PRSNA_PHONE_1.SUBSCRPTN_OPT_NBR DESC,PRSNA_POSTL_ADDR_1.SUBSCRPTN_OPT_NBR DESC,PRSNA_EMAIL_ADDR_1.CNTCT_POINT_CATEG_CODE DESC,PRSNA_PHONE_1.CNTCT_POINT_CATEG_CODE DESC,PRSNA_POSTL_ADDR_1.CNTCT_POINT_CATEG_CODE DESC) = 1;
.IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;













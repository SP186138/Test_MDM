.logon $TDPID/$TDUSER,$TDPWD
 
.SET ERROROUT STDOUT ;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
.SET SESSION CHARSET 'UTF8' ;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;

#For updating REGIS_PRSNA_EMAIL_ADDR
UPDATE REGIS_PRSNA_EMAIL_ADDR 
SET EMAIL_ADDR_TXT_MD5_HASH=CONVERTHASH(TRIM(EMAIL_ADDR_TXT),'MD5','UTF-8'),
EMAIL_ADDR_TXT_SHA1_HASH=CONVERTHASH(TRIM(EMAIL_ADDR_TXT),'SHA-1','UTF-8')
WHERE MKTNG_PGM_NBR IN (
SEL MKTNG_PGM_NBR FROM MKTNG_PGM
WHERE LEGAL_ENT_NBR IN ($Step)
AND LEGAL_ENT_NBR IN (
SELECT
  CAST(TRIM(AV_CODE) AS INTEGER) AS LEGAL_ENT_NBR
  FROM ATTRIBUTE_VALUES
 WHERE ATTRIBUTE_TYPE_ID IN
 (SEL ATTRIBUTE_TYPE_ID 
 FROM ATTRIBUTE_TYPES
 WHERE ATTRIBUTE_TYPE='Channel Hash')
 AND SYS_ENT_STATE='Active'
 AND ACTIVE_FLAG='Y'));
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 
 #For updating REGIS_PRSNA_PHONE
 UPDATE REGIS_PRSNA_PHONE
 SET FULL_PHONE_NUM_MD5_HASH=CONVERTHASH(TRIM(FULL_PHONE_NUM),'MD5','UTF-8'),
 FULL_PHONE_NUM_SHA1_HASH=CONVERTHASH(TRIM(FULL_PHONE_NUM),'SHA-1','UTF-8')
 WHERE MKTNG_PGM_NBR IN (
 SEL MKTNG_PGM_NBR FROM MKTNG_PGM
 WHERE LEGAL_ENT_NBR IN ($Step)
 AND LEGAL_ENT_NBR IN (
SELECT
       CAST(TRIM(AV_CODE) AS INTEGER) AS LEGAL_ENT_NBR
  FROM ATTRIBUTE_VALUES
 WHERE ATTRIBUTE_TYPE_ID IN
 (SEL ATTRIBUTE_TYPE_ID 
 FROM ATTRIBUTE_TYPES
 WHERE ATTRIBUTE_TYPE='Channel Hash')
 AND SYS_ENT_STATE='Active'
 AND ACTIVE_FLAG='Y'));
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 
  #For updating REGIS_PRSNA_SOC_NET_ACCT
 UPDATE REGIS_PRSNA_SOC_NET_ACCT
 SET SOCIAL_NETWK_ACCT_ID_VAL_MD5_HASH=CONVERTHASH(TRIM(SOCIAL_NETWK_ACCT_ID_VAL),'MD5','UTF-8'),
 SOCIAL_NETWK_ACCT_ID_VAL_SHA1_HASH=CONVERTHASH(TRIM(SOCIAL_NETWK_ACCT_ID_VAL),'SHA-1','UTF-8')
 WHERE MKTNG_PGM_NBR IN (
 SEL MKTNG_PGM_NBR FROM MKTNG_PGM
 WHERE LEGAL_ENT_NBR IN ($Step)
 AND LEGAL_ENT_NBR IN (
SELECT
 CAST(TRIM(AV_CODE) AS INTEGER) AS LEGAL_ENT_NBR
  FROM ATTRIBUTE_VALUES
 WHERE ATTRIBUTE_TYPE_ID IN
 (SEL ATTRIBUTE_TYPE_ID 
 FROM ATTRIBUTE_TYPES
 WHERE ATTRIBUTE_TYPE='Channel Hash')
 AND SYS_ENT_STATE='Active'
 AND ACTIVE_FLAG='Y'));
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;


.logon $TDPID/$TDUSER,$TDPWD


.SET ERROROUT STDOUT;
.SET SESSION CHARSET 'UTF8';

.GOTO $Step
 .LABEL L234

COLLECT STATS MDM.ALIAS_NAME_RECODE
COLUMN LEGAL_ENT_NBR
 ;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 .LABEL L235
COLLECT STATS MDM.ALIAS_NAME_RECODE
COLUMN RECODE_TYPE
 ;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 .LABEL L236
COLLECT STATS MDM.ALIAS_NAME_RECODE
COLUMN GVN_NAME
 ;
 COLLECT STATS MDM.ALIAS_NAME_RECODE
 COLUMN FAMLY_NAME
 ;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 .LABEL L237
 
 REPLACE VIEW MDM.REGIS_PRSNA (
 	  REGIS_PRSNA_ID
 	 ,MKTNG_PGM_NBR
 	 ,LEGAL_ENT_NBR
 	 ,MATCHD_CNSMR_PRSNA_ID
 	 ,REFERAL_MKTNG_PGM_NBR
 	 ,TRM_LEAD_KEY
 	 ,NAME_PREFX_TXT
 	 ,GVN_NAME
 	 ,MID_NAME
 	 ,FAMLY_NAME
 	 ,NAME_SUFFX_TXT
 	 ,FULL_NAME
 	 ,GENDR_IND
 	 ,BRTH_DATE
 	 ,LANG_CODE
 	 ,CNTRY_CODE
 	 ,EMAIL_SUPRSN_IND
 	 ,POSTL_SUPRSN_IND
 	 ,PHONE_SUPRSN_IND
 	 ,SOCL_NETWK_SUPRSN_IND
 	 ,NATIONAL_ID_NBR
 	 ,CNSMR_SENTIMENT
 	 ,LATST_ACTVY_DATE
 	 ,REGIS_CNSMR_ID_VAL
 	 ,CNSMR_USER_NAME
 	 ,REGIS_DATE
 	 ,PRSNA_STATUS_CODE
 	 ,LYLTY_PGM_NBR
 	 ,LYLTY_ACCT_NUM
 	 ,SYS_SOURCE
 	 ,SYS_TARGET_ID
 	 ,SYS_AUTH_ID
 	 ,SYS_CREATED_BY
 	 ,SYS_CREATION_DATE
 	 ,SYS_LAST_MODIFIED_DATE
 	 ,SYS_ENT_STATE
 	 ,SYS_LAST_MODIFIED_BY
 	 ,SYS_NC_TYPE
 	 ,SYS_ERR_CODE
 	 ,SYS_ERR_SVRTY
 	 ,data_srce_nbr
 	 ,DATA_ORIGIN_SRCE_NBR
 	 ,DATA_OP_SRCE_NAME
 	 ,PII_DATA_MINIMIZE_DATETM
 	 ,GVN_NAME_ALIAS
 	 ,FAMLY_NAME_ALIAS
 	) AS LOCKING ROW FOR ACCESS SEQUENCED  TRANSACTIONTIME SELECT
 	  REGIS_PRSNA_ID
 	 ,MKTNG_PGM_NBR
 	 ,LEGAL_ENT_NBR
 	 ,MATCHD_CNSMR_PRSNA_ID
 	 ,REFERAL_MKTNG_PGM_NBR
 	 ,TRM_LEAD_KEY
 	 ,NAME_PREFX_TXT
 	 ,GVN_NAME
 	 ,MID_NAME
 	 ,FAMLY_NAME
 	 ,NAME_SUFFX_TXT
 	 ,FULL_NAME
 	 ,GENDR_IND
 	 ,BRTH_DATE
 	 ,LANG_CODE
 	 ,CNTRY_CODE
 	 ,EMAIL_SUPRSN_IND
 	 ,POSTL_SUPRSN_IND
 	 ,PHONE_SUPRSN_IND
 	 ,SOCL_NETWK_SUPRSN_IND
 	 ,NATIONAL_ID_NBR
 	 ,CNSMR_SENTIMENT
 	 ,LATST_ACTVY_DATE
 	 ,REGIS_CNSMR_ID_VAL
 	 ,CNSMR_USER_NAME
 	 ,REGIS_DATETM
 	 ,PRSNA_STATUS_CODE
 	 ,LYLTY_PGM_NBR
 	 ,LYLTY_ACCT_NUM
 	 ,SYS_SOURCE
 	 ,SYS_TARGET_ID
 	 ,SYS_AUTH_ID
 	 ,SYS_CREATED_BY
 	 ,SYS_CREATION_DATE
 	 ,SYS_LAST_MODIFIED_DATE
 	 ,SYS_ENT_STATE
 	 ,SYS_LAST_MODIFIED_BY
 	 ,SYS_NC_TYPE
 	 ,SYS_ERR_CODE
 	 ,SYS_ERR_SVRTY
 	 ,data_srce_nbr
 	 ,DATA_ORIGIN_SRCE_NBR
 	 ,DATA_OP_SRCE_NAME
 	 ,PII_DATA_MINIMIZE_DATETM
 	 ,GVN_NAME_ALIAS
 	 ,FAMLY_NAME_ALIAS
	FROM iCRM_TBL.REGIS_PRSNA;

 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 .LABEL L238

UPDATE MDM.REGIS_PRSNA
SET GVN_NAME_ALIAS=GVN_NAME
,FAMLY_NAME_ALIAS=FAMLY_NAME
 ;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 .LABEL L239

UPDATE MDM.REGIS_PRSNA
FROM MDM.ALIAS_NAME_RECODE A
SET GVN_NAME_ALIAS=A.GVN_NAME_ALIAS
WHERE (MDM.REGIS_PRSNA.LEGAL_ENT_NBR=A.LEGAL_ENT_NBR
OR (MDM.REGIS_PRSNA.LEGAL_ENT_NBR=15
AND A.LEGAL_ENT_NBR=42)
OR (MDM.REGIS_PRSNA.LEGAL_ENT_NBR=25
AND A.LEGAL_ENT_NBR=40)
)
AND MDM.REGIS_PRSNA.GVN_NAME=A.GVN_NAME
AND A.RECODE_TYPE='F'
 ;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 .LABEL L240

UPDATE MDM.REGIS_PRSNA
FROM MDM.ALIAS_NAME_RECODE A
SET FAMLY_NAME_ALIAS=A.FAMLY_NAME_ALIAS
WHERE (MDM.REGIS_PRSNA.LEGAL_ENT_NBR=A.LEGAL_ENT_NBR
OR (MDM.REGIS_PRSNA.LEGAL_ENT_NBR=15
AND A.LEGAL_ENT_NBR=42)
OR (MDM.REGIS_PRSNA.LEGAL_ENT_NBR=25
AND A.LEGAL_ENT_NBR=40)
)
AND MDM.REGIS_PRSNA.FAMLY_NAME=A.FAMLY_NAME
AND A.RECODE_TYPE='L'
 ;
 .IF ERRORLEVEL > 0 THEN .QUIT ERRORCODE;
 .LABEL L250
Microsoft (R) Windows Script Host Version 5.7
Copyright (C) Microsoft Corporation. All rights reserved.

BTEQ 13.10.00.03 Tue Feb 21 13:28:13 2012
 
+---------+---------+---------+---------+---------+---------+---------+----
/***********************************************************************************************************
SCRIPT:               TSS_WINKEY_CLEANUP.BTEQ 
DESCRIPTION:          THIS SCRIPT CLEANS UP FASTLOAD ERROR TABLES
DEPENDENCY:           
INPUT:                WINKEY_TRIGGER
OUTPUT:               WINKEY_TRIGGER
ERRORS:
SPECIAL INSTRUCTIONS:

CHANGE LOG:
VERSION              DATE                 AUTHOR                          CHANGES
1.00                 01/21/2011           TERADATA                        INITIAL VERSION
***********************************************************************************************************/

.RUN FILE \\10.36.32.4\Teradata\MDM\3.04.01.00\custom\pngrelease3\logon\LOGON.
txt;
+---------+---------+---------+---------+---------+---------+---------+----
.LOGON 10.36.32.14/mdm,

 *** Logon successfully completed.
 *** Teradata Database Release is 13.10.01.01                   
 *** Teradata Database Version is 13.10.01.01                     
 *** Transaction Semantics are BTET.
 *** Session Character Set Name is 'ASCII'.
 
 *** Total elapsed time was 1 second.
 
+---------+---------+---------+---------+---------+---------+---------+----
.SET ERROROUT STDOUT;
 *** Error messages now directed to STDOUT.
+---------+---------+---------+---------+---------+---------+---------+----
.SET SESSION CHARSET 'UTF8';
+---------+---------+---------+---------+---------+---------+---------+----

DATABASE MDM;

 *** New default database accepted. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+----

INSERT INTO MDM.LOAD_INFO
(
LOAD_ID,
PROCESS_NAME,
PROCESS_START_TIME,
PROCESS_END_TIME,
STATUS,
SYS_CREATION_DATE,
SYS_LAST_MODIFIED_DATE,
CNTRY_NAME,
BATCH_ID) 
SELECT
LOAD.LOAD_ID,
'Winkey Load',
CAST(CURRENT_TIMESTAMP(0) AS VARCHAR(19)),
CAST(CURRENT_TIMESTAMP(0) AS VARCHAR(19)),
'In Progress',
CAST(CURRENT_TIMESTAMP(0) AS VARCHAR(19)),
CAST(CURRENT_TIMESTAMP(0) AS VARCHAR(19)),
'TWN',
LI.BATCH_ID
FROM MDM.MDM_LOAD_CONTROL LOAD
INNER JOIN LOAD_INFO LI
ON LOAD.LOAD_ID = LI.LOAD_ID
AND LI.PROCESS_NAME='Cleanse Input Load'
AND LI.STATUS = 'Success'
AND LI.CNTRY_NAME = 'TWN'

LEFT OUTER JOIN LOAD_INFO LII
ON LOAD.LOAD_ID = LII.LOAD_ID
AND LII.PROCESS_NAME='Wrapper'

WHERE LII.LOAD_ID IS NULL
GROUP BY
LOAD.LOAD_ID,
LI.BATCH_ID
;

 *** Insert completed. One row added. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+----
.IF ERRORLEVEL > 0 THEN .GOTO EXIT;
+---------+---------+---------+---------+---------+---------+---------+----

CALL MDM.FLDCLEANUP(0,'WINKEY_TRIGGER_TWN','MDM');

 *** Procedure has been executed. 
 *** Total elapsed time was 1 second.

   0
----
   0

+---------+---------+---------+---------+---------+---------+---------+----

.LABEL EXIT
+---------+---------+---------+---------+---------+---------+---------+----

.IF ERRORLEVEL > 4 THEN .GOTO ERR ;
+---------+---------+---------+---------+---------+---------+---------+----
.IF ERRORLEVEL <= 4 THEN .GOTO WARN;
.GOTO WARN;
+---------+---------+---------+---------+---------+---------+---------+----

.LABEL ERR
+---------+---------+---------+---------+---------+---------+---------+----
.QUIT 1
 *** Skipped.
+---------+---------+---------+---------+---------+---------+---------+----

.LABEL WARN
+---------+---------+---------+---------+---------+---------+---------+----
.QUIT 0
 *** You are now logged off from the DBC.
 *** Exiting BTEQ...
 *** RC (return code) = 0 
Microsoft (R) Windows Script Host Version 5.7
Copyright (C) Microsoft Corporation. All rights reserved.

     ===================================================================
     =                                                                 =
     =          FASTLOAD UTILITY     VERSION 13.10.00.007              =
     =          PLATFORM WIN32                                         =
     =                                                                 =
     ===================================================================

     ===================================================================
     =                                                                 =
     =          Copyright 1984-2010, Teradata Corporation.             =
     =          ALL RIGHTS RESERVED.                                   =
     =                                                                 =
     ===================================================================

**** 13:28:16 Processing starting at: Tue Feb 21 13:28:15 2012
**** 13:28:16 Character set has been set to: UTF-8

     /***********************************************************************************************************
     SCRIPT:               CNSMR_TSS_WINKEY_STG.FLD
     DESCRIPTION:          This script loads the WINKEY TRIGGER table from the trigger file that is given by
                           Trillium
     DEPENDENCY:           TRILLIUM WINKEY SCRIPT
     INPUT:                TRILLIUM WINKEY FILE
     OUTPUT:               WINKEY TRIGGER
     ERRORS:
     SPECIAL INSTRUCTIONS: In case of failure, fast load cleanup needs to be performed and script to restart from top.

     CHANGE LOG:
     VERSION              DATE                 AUTHOR                          CHANGES
     1.00                 01/21/2011           TERADATA                        INITIAL VERSION
     ***********************************************************************************************************/

0001 SESSIONS 10;

**** 13:28:16 FDL4866 SESSIONS command accepted

0002 ERRLIMIT 2500;

**** 13:28:16 Error limit set to: 2500

0003 .RUN \\10.36.32.4\Teradata\MDM\3.04.01.00\custom\pngrelease3\logon\LOGON.txt;


     ===================================================================
     =                                                                 =
     =          Logon/Connection                                       =
     =                                                                 =
     ===================================================================

0004 .LOGON 10.36.32.14/mdm,

**** 13:28:16 Teradata Database Release: 13.10.01.01
**** 13:28:16 Teradata Database Version: 13.10.01.01
**** 13:28:16 Current CLI or RDBMS allows maximum row size: 64K
**** 13:28:16 Character set for this job: UTF-8

**** 13:28:16 Warning: EOF on INPUT stream.


0005 DELETE FROM MDM.WINKEY_TRIGGER_TWN ALL;

**** 13:28:16 Command completed successfully


0006 .SET RECORD VARTEXT;

**** 13:28:16 Now set to read 'Variable-Length Text' records
**** 13:28:16 Delimiter character(s) is set to '|'
**** 13:28:16 Command completed successfully

0007 DEFINE
           WIN_KEY (VARCHAR(1000)),
           EMAIL_ADDR_TXT (VARCHAR(1000))	,
           FULL_PHONE_NUM (VARCHAR(2000)),
           LEGAL_ENT_NBR (VARCHAR(200))
     FILE=\\10.36.32.4\Teradata\MDM\3.04.01.00\custom\pngrelease3\data\TSS_WINKEY_
     OUTPUT_TWN.DAT;

**** 13:28:16 FDL4803 DEFINE statement processed


0008 .BEGIN LOADING MDM.WINKEY_TRIGGER_TWN ERRORFILES MDM.WINKEY_TRIGGER_TWN_ERR
     1, MDM.WINKEY_TRIGGER_TWN_ERR2;

**** 13:28:17 Number of FastLoad sessions requested = 10
**** 13:28:17 Number of FastLoad sessions connected = 10
**** 13:28:17 FDL4808 LOGON successful
**** 13:28:18 Number of AMPs available: 24
**** 13:28:18 BEGIN LOADING COMPLETE


     ===================================================================
     =                                                                 =
     =          Insert Phase                                           =
     =                                                                 =
     ===================================================================

0009 INSERT INTO MDM.WINKEY_TRIGGER_TWN (
      WINDOW_KEY_01
     ,EMAIL_ADDR_TXT
     ,PHONE
     ,LEGAL_ENT_NBR
     )
     VALUES
     (
      :WIN_KEY
     ,:EMAIL_ADDR_TXT
     ,:FULL_PHONE_NUM
     ,:LEGAL_ENT_NBR
     );

**** 13:28:18 Number of recs/msg: 15
**** 13:28:18 Starting to send to RDBMS with record 1
**** 13:28:18 Sending row 1
**** 13:28:18 Finished sending rows to the RDBMS

     ===================================================================
     =                                                                 =
     =          End Loading Phase                                      =
     =                                                                 =
     ===================================================================

0010 .END LOADING;

**** 13:28:18 END LOADING COMPLETE

     Total Records Read              =  1
     Total Error Table 1             =  0  ---- Table has been dropped
     Total Error Table 2             =  0  ---- Table has been dropped
     Total Inserts Applied           =  1
     Total Duplicate Rows            =  0

     Start:   Tue Feb 21 13:28:18 2012
     End  :   Tue Feb 21 13:28:18 2012


0011 .LOGOFF &SYSRC;

     ===================================================================
     =                                                                 =
     =          Logoff/Disconnect                                      =
     =                                                                 =
     ===================================================================

**** 13:28:18 Logging off all sessions
**** 13:28:19 Total processor time used = '0.765625 Seconds'
     .        Start : Tue Feb 21 13:28:15 2012
     .        End   : Tue Feb 21 13:28:19 2012
     .        Highest return code encountered = '0'.
**** 13:28:19 FDL4818 FastLoad Terminated
Microsoft (R) Windows Script Host Version 5.7
Copyright (C) Microsoft Corporation. All rights reserved.

BTEQ 13.10.00.03 Tue Feb 21 13:28:20 2012
 
+---------+---------+---------+---------+---------+---------+---------+----
/***********************************************************************************************************
SCRIPT:               CNSMR_TSS_WINKEY_STG.BTEQ 
DESCRIPTION:          This script loads the WINKEY TRIGGER table from the trigger file that is given by 
                      Trillium
DEPENDENCY:           TRILLIUM WINKEY SCRIPT
INPUT:                TRILLIUM WINKEY FILE
OUTPUT:               WINKEY TRIGGER
ERRORS:
SPECIAL INSTRUCTIONS: In case of failure, fast load cleanup needs to be performed and script to restart from top.

CHANGE LOG:
VERSION              DATE                 AUTHOR                          CHANGES
1.00                 01/21/2011           TERADATA                        INITIAL VERSION
***********************************************************************************************************/

.RUN FILE \\10.36.32.4\Teradata\MDM\3.04.01.00\custom\pngrelease3\logon\LOGON.
txt;
+---------+---------+---------+---------+---------+---------+---------+----
.LOGON 10.36.32.14/mdm,

 *** Logon successfully completed.
 *** Teradata Database Release is 13.10.01.01                   
 *** Teradata Database Version is 13.10.01.01                     
 *** Transaction Semantics are BTET.
 *** Session Character Set Name is 'ASCII'.
 
 *** Total elapsed time was 1 second.
 
+---------+---------+---------+---------+---------+---------+---------+----
.SET ERROROUT STDOUT;
 *** Error messages now directed to STDOUT.
+---------+---------+---------+---------+---------+---------+---------+----
.SET SESSION CHARSET 'UTF8';
+---------+---------+---------+---------+---------+---------+---------+----

COLLECT STATS ON WINKEY_TRIGGER_TWN
COLUMN WINDOW_KEY_01;

 *** Update completed. One row changed. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+----
.IF ERRORLEVEL > 0 THEN .GOTO EXIT;
+---------+---------+---------+---------+---------+---------+---------+----
COLLECT STATS ON WINKEY_TRIGGER_TWN
COLUMN EMAIL_ADDR_TXT;

 *** Update completed. One row changed. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+----
.IF ERRORLEVEL > 0 THEN .GOTO EXIT;
+---------+---------+---------+---------+---------+---------+---------+----
COLLECT STATS ON WINKEY_TRIGGER_TWN
COLUMN PHONE;

 *** Update completed. One row changed. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+----
.IF ERRORLEVEL > 0 THEN .GOTO EXIT;
+---------+---------+---------+---------+---------+---------+---------+----

UPDATE LOAD_INFO
SET STATUS = 'Success'
,PROCESS_END_TIME = CAST(CURRENT_TIMESTAMP(0) AS VARCHAR(19))
WHERE LOAD_INFO.PROCESS_NAME='Winkey Load'
AND LOAD_INFO.STATUS = 'In Progress'
AND LOAD_INFO.CNTRY_NAME = 'TWN'
;

 *** Update completed. One row changed. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+----
.IF ERRORLEVEL > 0 THEN .GOTO EXIT;
+---------+---------+---------+---------+---------+---------+---------+----

INSERT INTO LOAD_INFO
(
LOAD_ID,
PROCESS_NAME,
PROCESS_START_TIME,
PROCESS_END_TIME,
STATUS,
SYS_CREATION_DATE,
SYS_LAST_MODIFIED_DATE,
CNTRY_NAME,
BATCH_ID) 
SELECT
LOAD.LOAD_ID,
'Match Input Load',
CAST(CURRENT_TIMESTAMP(0) AS VARCHAR(19)),
CAST(CURRENT_TIMESTAMP(0) AS VARCHAR(19)),
'In Progress',
CAST(CURRENT_TIMESTAMP(0) AS VARCHAR(19)),
CAST(CURRENT_TIMESTAMP(0) AS VARCHAR(19)),
'TWN',
LI.BATCH_ID
FROM MDM_LOAD_CONTROL LOAD
INNER JOIN LOAD_INFO LI
ON LOAD.LOAD_ID = LI.LOAD_ID
AND LI.PROCESS_NAME='Trillium'
AND LI.STATUS = 'In Progress'
AND LI.CNTRY_NAME = 'TWN'

LEFT OUTER JOIN LOAD_INFO LII
ON LOAD.LOAD_ID = LII.LOAD_ID
AND LII.PROCESS_NAME='Wrapper'

WHERE LII.LOAD_ID IS NULL
GROUP BY
LOAD.LOAD_ID,
LI.BATCH_ID
;

 *** Insert completed. One row added. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+----
.IF ERRORLEVEL > 0 THEN .GOTO EXIT;
+---------+---------+---------+---------+---------+---------+---------+----

INS TSS_MATCH_INPUT_TEMP
(
LEGAL_ENT_NBR,
MKTNG_PGM_NBR,
REGIS_PRSNA_ID,
PHONE_EXTSN_NUM,
FULL_PHONE_NUM,
PHONE_LINE_NBR,
PHONE_AREA_NBR,
PHONE_EXCHG_NBR,
PHONE_CNTRY_NBR,
EMAIL_ADDR_TXT
)

SELECT 
COALESCE(A.LEGAL_ENT_NBR,B.LEGAL_ENT_NBR) LEGAL_ENT_NBR,
COALESCE(A.MKTNG_PGM_NBR,B.MKTNG_PGM_NBR) MKTNG_PGM_NBR,
COALESCE(A.REGIS_PRSNA_ID,B.REGIS_PRSNA_ID) REGIS_PRSNA_ID,
A.PHONE_EXTSN_NUM,
A.FULL_PHONE_NUM,
A.PHONE_LINE_NBR,
A.PHONE_AREA_NBR,
A.PHONE_EXCHG_NBR,
A.PHONE_CNTRY_NBR,
B.EMAIL_ADDR_TXT

FROM 

(SELECT
MKTNG_PGM_NBR,
LEGAL_ENT_NBR,
REGIS_PRSNA_ID,
PHONE_EXTSN_NUM,
CASE WHEN IGN2.FULL_PHONE_NUM IS NOT NULL
             THEN ''
             ELSE A.FULL_PHONE_NUM
       END AS FULL_PHONE_NUM,
PHONE_LINE_NBR,
PHONE_AREA_NBR,
PHONE_EXCHG_NBR,
PHONE_CNTRY_NBR,
RANK() OVER(PARTITION BY MKTNG_PGM_NBR,
REGIS_PRSNA_ID
ORDER BY A.FULL_PHONE_NUM DESC  ) AS RNK
FROM 
REGIS_PRSNA_PHONE A
  LEFT OUTER JOIN REF_PHONE_DATA_IGNORE IGN2
    ON IGN2.FULL_PHONE_NUM = A.FULL_PHONE_NUM  
WHERE (A.FULL_PHONE_NUM,LEGAL_ENT_NBR) IN
         (
            SEL PHONE,LEGAL_ENT_NBR
            FROM
            WINKEY_TRIGGER_TWN WINKEY
            WHERE 
            WINKEY.PHONE <> ''
            AND WINKEY.PHONE IS NOT NULL
         )) A

FULL OUTER JOIN 
(SELECT
MKTNG_PGM_NBR,
LEGAL_ENT_NBR,
REGIS_PRSNA_ID,
CASE WHEN IGN1.EMAIL_ADDR_TXT IS NOT NULL
             THEN ''
             ELSE A.EMAIL_ADDR_TXT
       END AS EMAIL_ADDR_TXT,
RANK() OVER(PARTITION BY MKTNG_PGM_NBR,
REGIS_PRSNA_ID
ORDER BY A.EMAIL_ADDR_TXT DESC  ) AS RNK
FROM 
REGIS_PRSNA_EMAIL_ADDR A
  LEFT OUTER JOIN REF_EMAIL_DATA_IGNORE IGN1
    ON IGN1.EMAIL_ADDR_TXT = A.EMAIL_ADDR_TXT
WHERE A.EMAIL_ADDR_TXT IN
         (
            SEL EMAIL_ADDR_TXT
            FROM
            WINKEY_TRIGGER_TWN WINKEY
            WHERE 
            WINKEY.EMAIL_ADDR_TXT <> ''
            AND WINKEY.EMAIL_ADDR_TXT IS NOT NULL
         )    ) B
     ON A.MKTNG_PGM_NBR = B.MKTNG_PGM_NBR
    AND A.REGIS_PRSNA_ID = B.REGIS_PRSNA_ID
     AND A.RNK = B.RNK
;

 *** Insert completed. No rows added. 
 *** Total elapsed time was 24 seconds.


+---------+---------+---------+---------+---------+---------+---------+----
.IF ERRORLEVEL > 0 THEN .GOTO EXIT;
+---------+---------+---------+---------+---------+---------+---------+----

COLLECT STATS ON TEMPORARY TSS_MATCH_INPUT_TEMP
COLUMN REGIS_PRSNA_ID;

 *** Update completed. 2 rows changed. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+----
.IF ERRORLEVEL > 0 THEN .GOTO EXIT;
+---------+---------+---------+---------+---------+---------+---------+----
COLLECT STATS ON TEMPORARY TSS_MATCH_INPUT_TEMP
COLUMN FULL_PHONE_NUM;

 *** Update completed. 2 rows changed. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+----
.IF ERRORLEVEL > 0 THEN .GOTO EXIT;
+---------+---------+---------+---------+---------+---------+---------+----
COLLECT STATS ON TEMPORARY TSS_MATCH_INPUT_TEMP
COLUMN EMAIL_ADDR_TXT;

 *** Update completed. 2 rows changed. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+----
.IF ERRORLEVEL > 0 THEN .GOTO EXIT;
+---------+---------+---------+---------+---------+---------+---------+----

DEL FROM TSS_MATCH_INPUT_TWN ALL;

 *** Delete completed. 28011 rows removed. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+----
.IF ERRORLEVEL > 0 THEN .GOTO EXIT;
+---------+---------+---------+---------+---------+---------+---------+----

INS TSS_MATCH_INPUT_TWN
(
MKTNG_PGM_NBR
,REGIS_CNSMR_ID_VAL
,NAME_PREFX_TXT
,GVN_NAME
,MID_NAME
,FAMLY_NAME
,NAME_SUFFX_TXT
,FULL_NAME
,GENDR_IND
,BRTH_DATE
,CNSMR_USER_NAME
,LANG_CODE
,ADDR_LINE_1_TXT
,ADDR_LINE_2_TXT
,ADDR_LINE_3_TXT
,STRET_NUM
,STRET_NAME
,APT_NUM
,PO_BOX_NUM
,CITY_NAME
,POSTL_AREA_CODE
,TERR_CODE
,CNTRY_CODE
,EMAIL_ADDR_TXT 
,PHONE_CNTRY_NBR
,PHONE_AREA_NBR 
,PHONE_EXCHG_NBR
,PHONE_LINE_NBR 
,PHONE_EXTSN_NUM
,FULL_PHONE_NUM 
,WIN_KEY
,DPEND_NAME
,PET_NAME
,REGIS_PRSNA_ID 
,LEGAL_ENT_PRSNA_ID
,HSHLD_PRSNA_ID
,LEGAL_ENT_NBR
)
SELECT
      REGIS_PRSNA_1.MKTNG_PGM_NBR
     ,REGIS_PRSNA_1.REGIS_CNSMR_ID_VAL
     ,REGIS_PRSNA_1.NAME_PREFX_TXT
     ,REGIS_PRSNA_1.GVN_NAME
     ,REGIS_PRSNA_1.MID_NAME
     ,REGIS_PRSNA_1.FAMLY_NAME
     ,REGIS_PRSNA_1.NAME_SUFFX_TXT
     ,REGIS_PRSNA_1.FULL_NAME
     ,REGIS_PRSNA_1.GENDR_IND
     ,REGIS_PRSNA_1.BRTH_DATE
     ,REGIS_PRSNA_1.CNSMR_USER_NAME
     ,REGIS_PRSNA_1.LANG_CODE
     ,PRSNA_POSTL_ADDR_1.ADDR_LINE_1_TXT
     ,PRSNA_POSTL_ADDR_1.ADDR_LINE_2_TXT
     ,PRSNA_POSTL_ADDR_1.ADDR_LINE_3_TXT
     ,PRSNA_POSTL_ADDR_1.STRET_NUM
     ,PRSNA_POSTL_ADDR_1.STRET_NAME
     ,PRSNA_POSTL_ADDR_1.APT_NUM
     ,PRSNA_POSTL_ADDR_1.PO_BOX_NUM
     ,PRSNA_POSTL_ADDR_1.CITY_NAME
     ,PRSNA_POSTL_ADDR_1.POSTL_AREA_CODE
     ,PRSNA_POSTL_ADDR_1.TERR_CODE
     ,PRSNA_POSTL_ADDR_1.CNTRY_CODE
     ,PRSNA_PHONE_1.EMAIL_ADDR_TXT AS EMAIL_ADDR_TXT_1_CRM 
     ,PRSNA_PHONE_1.PHONE_CNTRY_NBR AS PHONE_CNTRY_NBR_1
     ,PRSNA_PHONE_1.PHONE_AREA_NBR  AS PHONE_AREA_NBR_1
     ,PRSNA_PHONE_1.PHONE_EXCHG_NBR AS PHONE_EXCHG_NBR_1
     ,PRSNA_PHONE_1.PHONE_LINE_NBR  AS PHONE_LINE_NBR_1
     ,PRSNA_PHONE_1.PHONE_EXTSN_NUM AS PHONE_EXTSN_NUM_1
     ,PRSNA_PHONE_1.FULL_PHONE_NUM AS FULL_PHONE_NUM_1_CRM 
     ,CASE WHEN IGN3.WINKEY IS NOT NULL
           THEN ''
           ELSE PRSNA_POSTL_ADDR_1.WIN_KEY
       END AS WIN_KEY_CRM      
     ,DPEND_1.DPEND_NAME
     ,PET_1.PET_NAME
     ,REGIS_PRSNA_1.REGIS_PRSNA_ID 
     ,LEGAL_ENT_PRSNA_1.MATCHD_CNSMR_PRSNA_ID
     ,LEGAL_ENT_PRSNA_1.HSHLD_PRSNA_ID
     ,REGIS_PRSNA_1.LEGAL_ENT_NBR
    
      FROM (SEL LEGAL_ENT_NBR FROM TSS_CLEANSE_INPUT1_TWN GROUP BY 1) C
      
  INNER JOIN REGIS_PRSNA REGIS_PRSNA_1
     ON REGIS_PRSNA_1.LEGAL_ENT_NBR = C.LEGAL_ENT_NBR
    AND REGIS_PRSNA_1.PRSNA_STATUS_CODE = 'AC'
    AND REGIS_PRSNA_1.CNTRY_CODE IN 'TWN'
    
  INNER JOIN MATCHD_CNSMR_PRSNA LEGAL_ENT_PRSNA_1
     ON REGIS_PRSNA_1.MATCHD_CNSMR_PRSNA_ID = LEGAL_ENT_PRSNA_1.MATCHD_CNS
MR_PRSNA_ID
    AND REGIS_PRSNA_1.LEGAL_ENT_NBR = LEGAL_ENT_PRSNA_1.LEGAL_ENT_NBR
    AND LEGAL_ENT_PRSNA_1.PRSNA_STATUS_CODE = 'AC'
       
  LEFT OUTER JOIN REGIS_PRSNA_POSTL_ADDR PRSNA_POSTL_ADDR_1
    ON REGIS_PRSNA_1.REGIS_PRSNA_ID = PRSNA_POSTL_ADDR_1.REGIS_PRSNA_ID
   AND REGIS_PRSNA_1.MKTNG_PGM_NBR = PRSNA_POSTL_ADDR_1.MKTNG_PGM_NBR

  LEFT OUTER JOIN TSS_MATCH_INPUT_TEMP PRSNA_PHONE_1
    ON REGIS_PRSNA_1.REGIS_PRSNA_ID = PRSNA_PHONE_1.REGIS_PRSNA_ID

  LEFT OUTER JOIN DPEND DPEND_1
    ON REGIS_PRSNA_1.REGIS_PRSNA_ID = DPEND_1.REGIS_PRSNA_ID
   AND REGIS_PRSNA_1.MKTNG_PGM_NBR = DPEND_1.MKTNG_PGM_NBR

  LEFT OUTER JOIN PET PET_1
    ON REGIS_PRSNA_1.REGIS_PRSNA_ID = PET_1.REGIS_PRSNA_ID
   AND REGIS_PRSNA_1.MKTNG_PGM_NBR = PET_1.MKTNG_PGM_NBR
     
  LEFT OUTER JOIN REF_POSTL_DATA_IGNORE IGN3
    ON IGN3.WINKEY = PRSNA_POSTL_ADDR_1.WIN_KEY
     
 WHERE PRSNA_POSTL_ADDR_1.WIN_KEY IN 
         (
            SEL WINDOW_KEY_01 
            FROM
            WINKEY_TRIGGER_TWN WINKEY
            WHERE 
            WINKEY.WINDOW_KEY_01 NOT IN ('','IN        1','JA         ',' 
      1','CN     ','AU       1','CN','JP')
         )
  ;

 *** Insert completed. 4 rows added. 
 *** Total elapsed time was 13 seconds.


+---------+---------+---------+---------+---------+---------+---------+----
.IF ERRORLEVEL > 0 THEN .GOTO EXIT;
+---------+---------+---------+---------+---------+---------+---------+----

COLLECT STATS TSS_MATCH_INPUT_TWN
COLUMN (LEGAL_ENT_NBR ,MKTNG_PGM_NBR ,REGIS_CNSMR_ID_VAL);

 *** Update completed. One row changed. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+----
.IF ERRORLEVEL > 0 THEN .GOTO EXIT;
+---------+---------+---------+---------+---------+---------+---------+----

UPDATE LOAD_INFO
SET STATUS = 'Success'
,PROCESS_END_TIME = CAST(CURRENT_TIMESTAMP(0) AS VARCHAR(19))
WHERE LOAD_INFO.PROCESS_NAME='Match Input Load'
AND LOAD_INFO.STATUS = 'In Progress'
AND LOAD_INFO.CNTRY_NAME = 'TWN'
;

 *** Update completed. One row changed. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+----
.IF ERRORLEVEL > 0 THEN .GOTO EXIT;
+---------+---------+---------+---------+---------+---------+---------+----

.LABEL EXIT
+---------+---------+---------+---------+---------+---------+---------+----

.IF ERRORLEVEL > 4 THEN .GOTO ERR ;
+---------+---------+---------+---------+---------+---------+---------+----
.IF ERRORLEVEL <= 4 THEN .GOTO WARN;
.GOTO WARN;
+---------+---------+---------+---------+---------+---------+---------+----

.LABEL ERR
+---------+---------+---------+---------+---------+---------+---------+----

UPDATE LOAD_INFO
SET STATUS = 'Failure'
,PROCESS_END_TIME = CAST(CURRENT_TIMESTAMP(0) AS VARCHAR(19))
WHERE LOAD_INFO.PROCESS_NAME='Match Input Load'
AND LOAD_INFO.STATUS = 'In Progress'
AND LOAD_INFO.CNTRY_NAME = 'TWN'
;
 *** Skipped.
+---------+---------+---------+---------+---------+---------+---------+----

.QUIT 1
 *** Skipped.
+---------+---------+---------+---------+---------+---------+---------+----

.LABEL WARN
+---------+---------+---------+---------+---------+---------+---------+----
.QUIT 0
 *** You are now logged off from the DBC.
 *** Exiting BTEQ...
 *** RC (return code) = 0 

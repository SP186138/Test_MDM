Microsoft (R) Windows Script Host Version 5.7
Copyright (C) Microsoft Corporation. All rights reserved.

BTEQ 13.10.00.03 Tue Feb 21 14:25:14 2012
 
+---------+---------+---------+---------+---------+---------+---------+----
/***********************************************************************************************************
SCRIPT:               Cleanse Input.BTEQ 
DESCRIPTION:          This script moves the valid records received from ETL Staging to Cleanse Input.
DEPENDENCY:           
INPUT:                ETL Staging
OUTPUT:               Cleanse Input
ERRORS:
SPECIAL INSTRUCTIONS:

CHANGE LOG:
VERSION              DATE                 AUTHOR                          CHANGES
1.00                 10/31/2011           TERADATA                        INITIAL VERSION
***********************************************************************************************************/

.RUN FILE \\10.36.32.4\Teradata\MDM\3.04.01.00\custom\pngrelease3\logon\LOGON.
txt;
+---------+---------+---------+---------+---------+---------+---------+----
.LOGON 10.36.32.14/mdm,

 *** Logon successfully completed.
 *** Teradata Database Release is 13.10.01.01                   
 *** Teradata Database Version is 13.10.01.01                     
 *** Transaction Semantics are BTET.
 *** Session Character Set Name is 'ASCII'.
 
 *** Total elapsed time was 1 second.
 
+---------+---------+---------+---------+---------+---------+---------+----
.SET ERROROUT STDOUT;
 *** Error messages now directed to STDOUT.
+---------+---------+---------+---------+---------+---------+---------+----
.SET SESSION CHARSET 'UTF8';
+---------+---------+---------+---------+---------+---------+---------+----

UPDATE MDM.LOAD_INFO
SET STATUS = 'In Progress'
,PROCESS_END_TIME = CAST(CURRENT_TIMESTAMP(0) AS VARCHAR(19))
WHERE MDM.LOAD_INFO.PROCESS_NAME='Trillium'
AND MDM.LOAD_INFO.STATUS = 'Ready to Process'
AND MDM.LOAD_INFO.CNTRY_NAME = 'CHN'
;

 *** Update completed. 2 rows changed. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+----
.IF ERRORLEVEL > 0 THEN .GOTO EXIT;
+---------+---------+---------+---------+---------+---------+---------+----

CREATE VOLATILE TABLE TSS_CLEANSE_LOAD_NBR
AS 
(

SELECT LC.LOAD_ID
FROM MDM_LOAD_CONTROL LC

INNER JOIN LOAD_INFO LII
ON LC.LOAD_ID = LII.LOAD_ID
AND LII.PROCESS_NAME='Trillium'
AND LII.STATUS = 'In Progress'
AND LII.CNTRY_NAME = 'CHN'
GROUP BY 1
)
WITH DATA
PRIMARY INDEX ( LOAD_ID )
ON COMMIT PRESERVE ROWS
;

 *** Table has been created. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+----
.IF ERRORLEVEL > 0 THEN .GOTO EXIT;
+---------+---------+---------+---------+---------+---------+---------+----

INSERT INTO MDM.LOAD_INFO
(
LOAD_ID,
PROCESS_NAME,
PROCESS_START_TIME,
PROCESS_END_TIME,
STATUS,
SYS_CREATION_DATE,
SYS_LAST_MODIFIED_DATE,
CNTRY_NAME,
BATCH_ID) 
SELECT
LOAD.LOAD_ID,
'Cleanse Input Load',
CAST(CURRENT_TIMESTAMP(0) AS VARCHAR(19)),
CAST(CURRENT_TIMESTAMP(0) AS VARCHAR(19)),
'In Progress',
CAST(CURRENT_TIMESTAMP(0) AS VARCHAR(19)),
CAST(CURRENT_TIMESTAMP(0) AS VARCHAR(19)),
'CHN',
LI.BATCH_ID
FROM MDM.MDM_LOAD_CONTROL LOAD
INNER JOIN LOAD_INFO LI
ON LOAD.LOAD_ID = LI.LOAD_ID
AND LI.PROCESS_NAME='Trillium'
AND LI.STATUS = 'In Progress'
AND LI.CNTRY_NAME = 'CHN'

INNER JOIN TSS_CLEANSE_LOAD_NBR LOAD1
ON LOAD.LOAD_ID = LOAD1.LOAD_ID

LEFT OUTER JOIN LOAD_INFO LII
ON LOAD.LOAD_ID = LII.LOAD_ID
AND LII.PROCESS_NAME='Wrapper'

WHERE LII.LOAD_ID IS NULL
GROUP BY
LOAD.LOAD_ID,
LI.BATCH_ID
;

 *** Insert completed. 2 rows added. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+----
.IF ERRORLEVEL > 0 THEN .GOTO EXIT;
+---------+---------+---------+---------+---------+---------+---------+----

DELETE FROM MDM.TSS_CLEANSE_INPUT1_CHN ALL;

 *** Delete completed. 17 rows removed. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+----
.IF ERRORLEVEL > 0 THEN .GOTO EXIT;
+---------+---------+---------+---------+---------+---------+---------+----

INSERT INTO MDM.TSS_CLEANSE_INPUT1_CHN
(LEGAL_ENT_NBR                 
,MKTNG_PGM_NBR                 
,REGIS_CNSMR_ID_VAL            
,NAME_PREFX_TXT                
,GVN_NAME                      
,MID_NAME                      
,FAMLY_NAME                    
,NAME_SUFFX_TXT                
,FULL_NAME                     
,GENDR_IND                     
,BRTH_DATE                     
,ADDR_LINE_1_TXT               
,ADDR_LINE_2_TXT               
,ADDR_LINE_3_TXT               
,STRET_NUM                     
,STRET_NAME                    
,APT_NUM                       
,PO_BOX_NUM                    
,CITY_NAME                     
,POSTL_AREA_CODE               
,TERR_NAME                     
,CNTRY_NAME                    
,DPEND_NAME                    
,PET_NAME                      
,WIN_KEY                       
,SYNC_STATUS                   
,USER_NAME                     
,LANG_CODE                     
,SYS_SOURCE                    
,SYS_NC_TYPE                   
,SYS_CREATION_DATE     
,SYS_TARGET_ID
,EMAIL_ADDR_TXT                
,PHONE_EXTSN_NUM               
,FULL_PHONE_NUM                
,PHONE_LINE_NBR                
,PHONE_AREA_NBR                
,PHONE_EXCHG_NBR               
,PHONE_CNTRY_NBR               
,PRSNA_REG_DT       
,ADDRESS_CONTACT
,ADDRESS_SUBSCRPTN
,EMAIL_CONTACT
,EMAIL_SUBSCRPTN
,PHONE_CONTACT
,PHONE_SUBSCRPTN
)
SELECT DISTINCT
   MKTNG_PGM_1.LEGAL_ENT_NBR
  ,PRSNA_STG_1.MKTNG_PGM_NBR
  ,PRSNA_STG_1.REGIS_CNSMR_ID_VAL
  ,PRSNA_STG_1.NAME_PREFX_TXT
  ,PRSNA_STG_1.GVN_NAME
  ,PRSNA_STG_1.MID_NAME
  ,PRSNA_STG_1.FAMLY_NAME
  ,PRSNA_STG_1.NAME_SUFFX_TXT
  ,PRSNA_STG_1.FULL_NAME
  ,PRSNA_STG_1.GENDR_IND
  ,PRSNA_STG_1.BRTH_DATE
  ,PRSNA_POSTL_ADDR_STG_1.ADDR_LINE_1_TXT
  ,PRSNA_POSTL_ADDR_STG_1.ADDR_LINE_2_TXT
  ,PRSNA_POSTL_ADDR_STG_1.ADDR_LINE_3_TXT
  ,PRSNA_POSTL_ADDR_STG_1.STRET_NUM
  ,PRSNA_POSTL_ADDR_STG_1.STRET_NAME
  ,PRSNA_POSTL_ADDR_STG_1.APT_NUM
  ,PRSNA_POSTL_ADDR_STG_1.PO_BOX_NUM
  ,PRSNA_POSTL_ADDR_STG_1.CITY_NAME
  ,PRSNA_POSTL_ADDR_STG_1.POSTL_AREA_CODE
  ,PRSNA_POSTL_ADDR_STG_1.TERR_NAME
  ,COALESCE(PRSNA_POSTL_ADDR_STG_1.CNTRY_NAME,PRSNA_STG_1.CNTRY_CODE) AS C
NTRY_NAME
  ,DPEND_STG_1.DPEND_NAME
  ,PET_STG_1.PET_NAME
  ,PRSNA_STG_1.WIN_KEY
  ,PRSNA_STG_1.SYNC_STATUS
  ,PRSNA_STG_1.USER_NAME
  ,PRSNA_STG_1.LANG_CODE
  ,TRIM(CAST(PRSNA_STG_1.SYS_SOURCE AS INTEGER)) AS SYS_SOURCE
  ,PRSNA_STG_1.SYS_NC_TYPE      
  ,PRSNA_STG_1.SYS_CREATION_DATE
  ,PRSNA_STG_1.SYS_TARGET_ID
  ,CASE WHEN IGN1.EMAIL_ADDR_TXT IS NOT NULL
        THEN ''
        ELSE PRSNA_EMAIL_ADDR_STG_1.EMAIL_ADDR_TXT
    END AS EMAIL_ADDR_TXT_1
  ,PRSNA_EMAIL_ADDR_STG_1.PHONE_EXTSN_NUM AS PHONE_EXTSN_NUM_1
  ,CASE WHEN IGN2.FULL_PHONE_NUM IS NOT NULL
        THEN ''
        ELSE PRSNA_EMAIL_ADDR_STG_1.FULL_PHONE_NUM
    END AS FULL_PHONE_NUM_1
  ,PRSNA_EMAIL_ADDR_STG_1.PHONE_LINE_NBR  AS PHONE_LINE_NBR_1
  ,PRSNA_EMAIL_ADDR_STG_1.PHONE_AREA_NBR  AS PHONE_AREA_NBR_1
  ,PRSNA_EMAIL_ADDR_STG_1.PHONE_EXCHG_NBR AS PHONE_EXCHG_NBR_1
  ,PRSNA_EMAIL_ADDR_STG_1.PHONE_CNTRY_NBR AS PHONE_CNTRY_NBR_1
  ,PRSNA_STG_1.PRSNA_REG_DT
  ,PRSNA_POSTL_ADDR_STG_1.CNTCT_POINT_CATEG_CODE AS ADDRESS_CONTACT
  ,CAST(TRIM(CAST(PRSNA_POSTL_ADDR_STG_1.CNTCT_OPTN_NBR AS INTEGER)) AS VA
RCHAR(5)) AS ADDRESS_SUBSCRPTN
  ,PRSNA_EMAIL_ADDR_STG_1.EMAIL_CONTACT
  ,CAST(TRIM(CAST(PRSNA_EMAIL_ADDR_STG_1.EMAIL_SUBSCRPTN AS INTEGER)) AS V
ARCHAR(5)) EMAIL_SUBSCRPTN
  ,PRSNA_EMAIL_ADDR_STG_1.PHONE_CONTACT
  ,CAST(TRIM(CAST(PRSNA_EMAIL_ADDR_STG_1.PHONE_SUBSCRPTN AS INTEGER)) AS V
ARCHAR(5)) PHONE_SUBSCRPTN  
 
   FROM MDM.PRSNA_STG PRSNA_STG_1
   
   INNER JOIN TSS_CLEANSE_LOAD_NBR LOAD
   ON PRSNA_STG_1.LOAD_ID = LOAD.LOAD_ID
 
   LEFT OUTER JOIN MDM.PRSNA_POSTL_ADDR_STG PRSNA_POSTL_ADDR_STG_1
     ON PRSNA_STG_1.MKTNG_PGM_NBR = PRSNA_POSTL_ADDR_STG_1.MKTNG_PGM_NBR
    AND PRSNA_STG_1.REGIS_CNSMR_ID_VAL = PRSNA_POSTL_ADDR_STG_1.REGIS_CNSM
R_ID_VAL
    AND PRSNA_STG_1.SYS_SOURCE = PRSNA_POSTL_ADDR_STG_1.SYS_SOURCE
    AND PRSNA_STG_1.SYS_NC_TYPE = PRSNA_POSTL_ADDR_STG_1.SYS_NC_TYPE
    AND PRSNA_STG_1.SYS_TARGET_ID = PRSNA_POSTL_ADDR_STG_1.SYS_TARGET_ID
--    AND PRSNA_STG_1.SYS_CREATION_DATE = PRSNA_POSTL_ADDR_STG_1.SYS_CREAT
ION_DATE
 
   LEFT OUTER JOIN (SELECT 
COALESCE(A.MKTNG_PGM_NBR,B.MKTNG_PGM_NBR) MKTNG_PGM_NBR,
COALESCE(A.REGIS_CNSMR_ID_VAL,B.REGIS_CNSMR_ID_VAL) REGIS_CNSMR_ID_VAL,
COALESCE(A.SYS_SOURCE,B.SYS_SOURCE) SYS_SOURCE,
COALESCE(A.SYS_NC_TYPE,B.SYS_NC_TYPE) SYS_NC_TYPE,
A.PHONE_EXTSN_NUM,
A.FULL_PHONE_NUM,
A.PHONE_LINE_NBR,
A.PHONE_AREA_NBR,
A.PHONE_EXCHG_NBR,
A.PHONE_CNTRY_NBR,
B.EMAIL_ADDR_TXT,
A.SYNC_STATUS AS PHONE_SYNC_STATUS,
B.SYNC_STATUS,
A.CNTCT_POINT_CATEG_CODE AS PHONE_CONTACT,
A.CNTCT_OPTN_NBR AS PHONE_SUBSCRPTN,
B.CNTCT_POINT_CATEG_CODE AS EMAIL_CONTACT,
B.CNTCT_OPTN_NBR AS EMAIL_SUBSCRPTN,
A.SYS_TARGET_ID

FROM 

(SELECT
MKTNG_PGM_NBR,
REGIS_CNSMR_ID_VAL,
SYS_SOURCE,
SYS_NC_TYPE,
SYS_TARGET_ID,
PHONE_EXTSN_NUM,
FULL_PHONE_NUM,
PHONE_LINE_NBR,
PHONE_AREA_NBR,
PHONE_EXCHG_NBR,
PHONE_CNTRY_NBR,
SYNC_STATUS,
CNTCT_POINT_CATEG_CODE,
CNTCT_OPTN_NBR,
RANK() OVER(PARTITION BY MKTNG_PGM_NBR,
REGIS_CNSMR_ID_VAL,SYS_TARGET_ID
ORDER BY SYS_SOURCE DESC,
SYS_NC_TYPE DESC,FULL_PHONE_NUM DESC  ) AS RNK
FROM 
PRSNA_PHONE_STG) A

FULL OUTER JOIN 
(SELECT
MKTNG_PGM_NBR,
REGIS_CNSMR_ID_VAL,
SYS_SOURCE,
SYS_NC_TYPE,
SYS_TARGET_ID,
EMAIL_ADDR_TXT,
SYNC_STATUS,
CNTCT_POINT_CATEG_CODE,
CNTCT_OPTN_NBR,
RANK() OVER(PARTITION BY MKTNG_PGM_NBR,
REGIS_CNSMR_ID_VAL,SYS_TARGET_ID
ORDER BY SYS_SOURCE DESC,
SYS_NC_TYPE DESC,EMAIL_ADDR_TXT DESC  ) AS RNK
FROM 
PRSNA_EMAIL_ADDR_STG ) B
     ON A.MKTNG_PGM_NBR = B.MKTNG_PGM_NBR
    AND A.REGIS_CNSMR_ID_VAL = B.REGIS_CNSMR_ID_VAL
    AND A.SYS_SOURCE = B.SYS_SOURCE
    AND A.SYS_NC_TYPE = B.SYS_NC_TYPE
    AND A.SYS_TARGET_ID = B.SYS_TARGET_ID
     AND A.RNK = B.RNK
)  PRSNA_EMAIL_ADDR_STG_1

     ON PRSNA_STG_1.MKTNG_PGM_NBR = PRSNA_EMAIL_ADDR_STG_1.MKTNG_PGM_NBR
    AND PRSNA_STG_1.REGIS_CNSMR_ID_VAL = PRSNA_EMAIL_ADDR_STG_1.REGIS_CNSM
R_ID_VAL
    AND PRSNA_STG_1.SYS_SOURCE = PRSNA_EMAIL_ADDR_STG_1.SYS_SOURCE
    AND PRSNA_STG_1.SYS_NC_TYPE = PRSNA_EMAIL_ADDR_STG_1.SYS_NC_TYPE
    AND PRSNA_STG_1.SYS_TARGET_ID = PRSNA_EMAIL_ADDR_STG_1.SYS_TARGET_ID
--    AND PRSNA_STG_1.SYS_CREATION_DATE = PRSNA_EMAIL_ADDR_STG_1.SYS_CREAT
ION_DATE

   LEFT OUTER JOIN REF_EMAIL_DATA_IGNORE IGN1
     ON IGN1.EMAIL_ADDR_TXT = PRSNA_EMAIL_ADDR_STG_1.EMAIL_ADDR_TXT
     
   LEFT OUTER JOIN REF_PHONE_DATA_IGNORE IGN2
     ON IGN2.FULL_PHONE_NUM = PRSNA_EMAIL_ADDR_STG_1.FULL_PHONE_NUM
 
   LEFT OUTER JOIN MDM.DPEND_STG DPEND_STG_1
     ON PRSNA_STG_1.MKTNG_PGM_NBR = DPEND_STG_1.MKTNG_PGM_NBR
    AND PRSNA_STG_1.REGIS_CNSMR_ID_VAL = DPEND_STG_1.REGIS_CNSMR_ID_VAL
    AND PRSNA_STG_1.SYS_SOURCE = DPEND_STG_1.SYS_SOURCE
    AND PRSNA_STG_1.SYS_NC_TYPE = DPEND_STG_1.SYS_NC_TYPE
    AND PRSNA_STG_1.SYS_TARGET_ID = DPEND_STG_1.SYS_TARGET_ID
--    AND PRSNA_STG_1.SYS_CREATION_DATE = DPEND_STG_1.SYS_CREATION_DATE
 
   LEFT OUTER JOIN MDM.PET_STG PET_STG_1
     ON PRSNA_STG_1.MKTNG_PGM_NBR = PET_STG_1.MKTNG_PGM_NBR
    AND PRSNA_STG_1.REGIS_CNSMR_ID_VAL = PET_STG_1.REGIS_CNSMR_ID_VAL
    AND PRSNA_STG_1.SYS_SOURCE = PET_STG_1.SYS_SOURCE
    AND PRSNA_STG_1.SYS_NC_TYPE = PET_STG_1.SYS_NC_TYPE
    AND PRSNA_STG_1.SYS_TARGET_ID = PET_STG_1.SYS_TARGET_ID
--    AND PRSNA_STG_1.SYS_CREATION_DATE = PET_STG_1.SYS_CREATION_DATE
    
   LEFT OUTER JOIN MDM.MKTNG_PGM MKTNG_PGM_1
     ON PRSNA_STG_1.MKTNG_PGM_NBR = MKTNG_PGM_1.MKTNG_PGM_NBR
 
  WHERE PRSNA_STG_1.SYNC_STATUS IN ('VALIDATED')
    AND (PRSNA_POSTL_ADDR_STG_1.SYNC_STATUS IN ('VALIDATED') OR PRSNA_POST
L_ADDR_STG_1.SYNC_STATUS IS NULL)
    AND (PRSNA_EMAIL_ADDR_STG_1.PHONE_SYNC_STATUS IN ('VALIDATED') OR PRSN
A_EMAIL_ADDR_STG_1.PHONE_SYNC_STATUS IS NULL)
    AND (PRSNA_EMAIL_ADDR_STG_1.SYNC_STATUS IN ('VALIDATED') OR PRSNA_EMAI
L_ADDR_STG_1.SYNC_STATUS IS NULL)
 
 QUALIFY RANK() OVER (PARTITION BY MKTNG_PGM_1.LEGAL_ENT_NBR
  ,PRSNA_STG_1.MKTNG_PGM_NBR
  ,PRSNA_STG_1.REGIS_CNSMR_ID_VAL 
  ,PRSNA_STG_1.SYS_TARGET_ID 
 ORDER BY PRSNA_STG_1.LOAD_ID DESC
 ,PRSNA_STG_1.LOAD_TS DESC
 ,PRSNA_STG_1.RECORD_IND DESC
) = 1;

 *** Insert completed. 26 rows added. 
 *** Total elapsed time was 37 seconds.


+---------+---------+---------+---------+---------+---------+---------+----

COLLECT STATS ON MDM.TSS_CLEANSE_INPUT1_CHN
COLUMN MKTNG_PGM_NBR;

 *** Update completed. One row changed. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+----
.IF ERRORLEVEL > 0 THEN .GOTO EXIT;
+---------+---------+---------+---------+---------+---------+---------+----
COLLECT STATS ON MDM.TSS_CLEANSE_INPUT1_CHN
COLUMN REGIS_CNSMR_ID_VAL;

 *** Update completed. One row changed. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+----
.IF ERRORLEVEL > 0 THEN .GOTO EXIT;
+---------+---------+---------+---------+---------+---------+---------+----
COLLECT STATS ON MDM.TSS_CLEANSE_INPUT1_CHN
COLUMN (MKTNG_PGM_NBR,REGIS_CNSMR_ID_VAL);

 *** Update completed. One row changed. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+----
.IF ERRORLEVEL > 0 THEN .GOTO EXIT;
+---------+---------+---------+---------+---------+---------+---------+----

UPDATE MDM.LOAD_INFO
SET STATUS = 'Success'
,PROCESS_END_TIME = CAST(CURRENT_TIMESTAMP(0) AS VARCHAR(19))
WHERE MDM.LOAD_INFO.PROCESS_NAME='Cleanse Input Load'
AND MDM.LOAD_INFO.STATUS = 'In Progress'
AND MDM.LOAD_INFO.CNTRY_NAME = 'CHN'
;

 *** Update completed. 2 rows changed. 
 *** Total elapsed time was 1 second.


+---------+---------+---------+---------+---------+---------+---------+----
.IF ERRORLEVEL > 0 THEN .GOTO EXIT;
+---------+---------+---------+---------+---------+---------+---------+----

.LABEL EXIT
+---------+---------+---------+---------+---------+---------+---------+----

.IF ERRORLEVEL > 4 THEN .GOTO ERR ;
+---------+---------+---------+---------+---------+---------+---------+----
.IF ERRORLEVEL <= 4 THEN .GOTO WARN;
.GOTO WARN;
+---------+---------+---------+---------+---------+---------+---------+----

.LABEL ERR
+---------+---------+---------+---------+---------+---------+---------+----

UPDATE MDM.LOAD_INFO
SET STATUS = 'Failure'
,PROCESS_END_TIME = CAST(CURRENT_TIMESTAMP(0) AS VARCHAR(19))
WHERE MDM.LOAD_INFO.PROCESS_NAME='Cleanse Input Load'
AND MDM.LOAD_INFO.STATUS = 'In Progress'
AND MDM.LOAD_INFO.CNTRY_NAME = 'CHN'
;
 *** Skipped.
+---------+---------+---------+---------+---------+---------+---------+----

.QUIT 1
 *** Skipped.
+---------+---------+---------+---------+---------+---------+---------+----

.LABEL WARN
+---------+---------+---------+---------+---------+---------+---------+----
 *** Warning: EOF on INPUT stream.
.QUIT 0
 *** You are now logged off from the DBC.
 *** Exiting BTEQ...
 *** RC (return code) = 0 
Microsoft (R) Windows Script Host Version 5.7
Copyright (C) Microsoft Corporation. All rights reserved.

**** 14:25:54 UTY2407 Run time parameters in effect are: UTF-8.
     ========================================================================
     =                                                                      =
     =          FastExport Utility    Release FEXP.13.10.00.007             =
     =          Platform WIN32                                              =
     =                                                                      =
     ========================================================================
     =                                                                      =
     =     Copyright 1990-2010 Teradata Corporation. ALL RIGHTS RESERVED.   =
     =                                                                      =
     ========================================================================
**** 14:25:54 UTY2411 Processing start date: TUE FEB 21, 2012
     ========================================================================
     =                                                                      =
     =          Logon/Connection                                            =
     =                                                                      =
     ========================================================================
0001 .run file \\10.36.32.4\Teradata\MDM\3.04.01.00\custom\pngrelease3\logon\LOGON.txt;
0002 .LOGON 10.36.32.14/mdm,;
**** 14:25:54 UTY6214 Reminder: A .Logtable statement must be entered for a
     successful logon.
     ========================================================================
     =                                                                      =
     =          Processing Control Statements                               =
     =                                                                      =
     ========================================================================

0003 /*******************************************************************************
     ****************************
     SCRIPT:               TSS_CLEANSE_INPUT.FEXP
     DESCRIPTION:          This script generates the initial transaction file
     for use by Trillium
     DEPENDENCY:           MDM Validation load
     INPUT:                MST TABLES
     OUTPUT:               TSS_CLEANSE_INPUT.DAT
     ERRORS:
     SPECIAL INSTRUCTIONS: In case of failure, log table to be dropped and
     script to restart from top.
     CHANGE LOG:
     VERSION              DATE                 AUTHOR                         
     CHANGES
     1.00                 01/21/2011           TERADATA                       
     INITIAL VERSION
     2.00                 10/31/2011           TERADATA                       
     FOR COUNTRY SPECIFIC PROCESSING
                                                                              
     ADDED CHN
     ***************************************************************************
     ********************************/
     .LOGTABLE TSS_CLEANSE_INPUT_LOG_CHN;
**** 14:25:54 UTY8400 Teradata Database Release: 13.10.01.01
**** 14:25:54 UTY8400 Teradata Database Version: 13.10.01.01
**** 14:25:54 UTY8601 Character set specified: UTF8                          
**** 14:25:54 UTY8400 Current RDBMS has UDT support
**** 14:25:54 UTY8400 Current RDBMS has Large Decimal support
**** 14:25:54 UTY8400 Current RDBMS has FEXP w/o Spooling support
**** 14:25:54 UTY8400 Current RDBMS has TASM support
**** 14:25:54 UTY8400 Maximum supported buffer size: 1M
**** 14:25:54 UTY8400 Data Encryption supported by RDBMS server
**** 14:25:54 UTY6211 A successful connect was made to the RDBMS.
**** 14:25:54 UTY6217 Logtable 'MDM.TSS_CLEANSE_INPUT_LOG_CHN' has been
     created.

0004 .BEGIN EXPORT;

0005 .EXPORT OUTFILE
     \\10.36.32.4\Teradata\MDM\3.04.01.00\custom\pngrelease3\data\TSS_CLEANSE_INPUT
     _CHN.DAT FORMAT TEXT MODE RECORD;

0006 SELECT 
     CAST(
     	       COALESCE(TRIM(LEGAL_ENT_NBR),'')
     	||'|'||COALESCE(TRIM(CAST(CAST(MKTNG_PGM_NBR AS INTEGER) AS CHAR(20))),'')
     	||'|'||COALESCE(TRIM(REGIS_CNSMR_ID_VAL),'')
     	||'|'||COALESCE(TRIM(NAME_PREFX_TXT),'')
     	||'|'||COALESCE(TRIM(GVN_NAME),'')
     	||'|'||COALESCE(TRIM(MID_NAME),'')
     	||'|'||COALESCE(TRIM(FAMLY_NAME),'')
     	||'|'||COALESCE(TRIM(NAME_SUFFX_TXT),'')
     	||'|'||COALESCE(TRIM(FULL_NAME),'')
     	||'|'||COALESCE(TRIM(GENDR_IND),'')
     	||'|'||COALESCE(CAST(CAST(BRTH_DATE AS DATE FORMAT 'YYYY-MM-DD') AS
     VARCHAR(10)),'')
     	||'|'||COALESCE(TRIM(ADDR_LINE_1_TXT),'')
     	||'|'||COALESCE(TRIM(ADDR_LINE_2_TXT),'')
     	||'|'||COALESCE(TRIM(ADDR_LINE_3_TXT),'')
     	||'|'||COALESCE(TRIM(STRET_NUM),'')
     	||'|'||COALESCE(TRIM(STRET_NAME),'')
     	||'|'||COALESCE(TRIM(APT_NUM),'')
     	||'|'||COALESCE(TRIM(PO_BOX_NUM),'')
     	||'|'||COALESCE(TRIM(CITY_NAME),'')
     	||'|'||COALESCE(TRIM(POSTL_AREA_CODE),'')
     	||'|'||COALESCE(TRIM(TERR_NAME),'')
     	||'|'||COALESCE(TRIM(CNTRY_NAME),'')
     	||'|'||COALESCE(TRIM(EMAIL_ADDR_TXT),'')
     	||'|'||COALESCE(TRIM(PHONE_EXTSN_NUM),'')
     	||'|'||COALESCE(TRIM(FULL_PHONE_NUM),'')
     	||'|'||COALESCE(TRIM(PHONE_LINE_NBR),'')
     	||'|'||COALESCE(TRIM(PHONE_AREA_NBR),'')
     	||'|'||COALESCE(TRIM(PHONE_EXCHG_NBR),'')
     	||'|'||COALESCE(TRIM(PHONE_CNTRY_NBR),'')
     	||'|'||COALESCE(TRIM(DPEND_NAME),'')
     	||'|'||COALESCE(TRIM(PET_NAME),'')
     	||'|'||COALESCE(TRIM(USER_NAME),'')
     	||'|'||COALESCE(TRIM(LANG_CODE),'')
     	||'|'||COALESCE(TRIM(CAST(CAST(SYS_SOURCE AS INTEGER) AS VARCHAR(20))),'')
     	||'|'||COALESCE(TRIM(SYS_NC_TYPE),'')
     	||'|'||COALESCE(TRIM(CAST(CAST(SYS_CREATION_DATE AS TIMESTAMP(0)) AS
     VARCHAR(20))),'')	
     	||'|'||COALESCE(TRIM(CAST(PRSNA_REG_DT AS VARCHAR(20))),'')
     	||'|'||COALESCE(TRIM(ADDRESS_CONTACT),'')
     	||'|'||COALESCE(TRIM(ADDRESS_SUBSCRPTN),'')
     	||'|'||COALESCE(TRIM(EMAIL_CONTACT),'')
     	||'|'||COALESCE(TRIM(EMAIL_SUBSCRPTN),'')
     	||'|'||COALESCE(TRIM(PHONE_CONTACT),'')
     	||'|'||COALESCE(TRIM(PHONE_SUBSCRPTN),'')
     	||'|'||COALESCE(TRIM(CAST(CAST(SYS_TARGET_ID AS INTEGER) AS
     VARCHAR(20))),'')
         AS CHAR(1500))
       FROM MDM.TSS_CLEANSE_INPUT_CHN
       GROUP BY 1
       ORDER BY 1 ASC
     ;

0007 .END EXPORT;
     ========================================================================
     =                                                                      =
     =          FastExport Initial Phase                                    =
     =                                                                      =
     ========================================================================
**** 14:25:54 UTY8700 Options in effect for this FastExport task:
     .       Sessions:    4 session(s).
     .       Mode:        RECORD
     .       Blocksize:   64330 bytes.
     .       Outlimit:    No limit in effect.
**** 14:25:54 UTY8715 FastExport is submitting the following request:
     Select NULL from MDM.TSS_CLEANSE_INPUT_LOG_CHN where (LogType = 220) and
     (Seq = 1) and (FExptSeq = 0);
**** 14:25:54 UTY8715 FastExport is submitting the following request:
     SET QUERY_BAND='UTILITYNAME=FASTEXP;' UPDATE FOR SESSION;
**** 14:25:54 UTY8715 FastExport is submitting the following request:
     CHECK WORKLOAD FOR BT;BEGIN FASTEXPORT;
**** 14:25:54 UTY8715 FastExport is submitting the following request:
     CHECK WORKLOAD FOR SELECT CAST(	      
     COALESCE(TRIM(LEGAL_ENT_NBR),'')	||'|'||COALESCE(TRIM(CAST(CAST(MKTNG_PGM_
     NBR AS INTEGER) AS
     CHAR(20))),'')	||'|'||COALESCE(TRIM(REGIS_CNSMR_ID_VAL),'')	||'|'||COALES
     CE(TRIM(NAME_PREFX_TXT),'')	||'|'||COALESCE(TRIM(GVN_NAME),'')	||'|'||COA
     LESCE(TRIM(MID_NAME),'')	||'|'||COALESCE(TRIM(FAMLY_NAME),'')	||'|'||COAL
     ESCE(TRIM(NAME_SUFFX_TXT),'')	||'|'||COALESCE(TRIM(FULL_NAME),'')	||'|'||
     COALESCE(TRIM(GENDR_IND),'')	||'|'||COALESCE(CAST(CAST(BRTH_DATE AS DATE
     FORMAT 'YYYY-MM-DD') AS
     VARCHAR(10)),'')	||'|'||COALESCE(TRIM(ADDR_LINE_1_TXT),'')	||'|'||COALESC
     E(TRIM(ADDR_LINE_2_TXT),'')	||'|'||COALESCE(TRIM(ADDR_LINE_3_TXT),'')	||'
     |'||COALESCE(TRIM(STRET_NUM),'')	||'|'||COALESCE(TRIM(STRET_NAME),'')	||'
     |'||COALESCE(TRIM(APT_NUM),'')	||'|'||COALESCE(TRIM(PO_BOX_NUM),'')	||'|'
     ||COALESCE(TRIM(CITY_NAME),'')	||'|'||COALESCE(TRIM(POSTL_AREA_CODE),'')	
     ||'|'||COALESCE(TRIM(TERR_NAME),'')	||'|'||COALESCE(TRIM(CNTRY_NAME),'')	
     ||'|'||COALESCE(TRIM(EMAIL_ADDR_TXT),'')	||'|'||COALESCE(TRIM(PHONE_EXTSN_
     NUM),'')	||'|'||COALESCE(TRIM(FULL_PHONE_NUM),'')	||'|'||COALESCE(TRIM(PH
     ONE_LINE_NBR),'')	||'|'||COALESCE(TRIM(PHONE_AREA_NBR),'')	||'|'||COALESC
     E(TRIM(PHONE_EXCHG_NBR),'')	||'|'||COALESCE(TRIM(PHONE_CNTRY_NBR),'')	||'
     |'||COALESCE(TRIM(DPEND_NAME),'')	||'|'||COALESCE(TRIM(PET_NAME),'')	||'|
     '||COALESCE(TRIM(USER_NAME),'')	||'|'||COALESCE(TRIM(LANG_CODE),'')	||'|'
     ||COALESCE(TRIM(CAST(CAST(SYS_SOURCE AS INTEGER) AS
     VARCHAR(20))),'')	||'|'||COALESCE(TRIM(SYS_NC_TYPE),'')	||'|'||COALESCE(T
     RIM(CAST(CAST(SYS_CREATION_DATE AS TIMESTAMP(0)) AS
     VARCHAR(20))),'')		||'|'||COALESCE(TRIM(CAST(PRSNA_REG_DT AS
     VARCHAR(20))),'')	||'|'||COALESCE(TRIM(ADDRESS_CONTACT),'')	||'|'||COALES
     CE(TRIM(ADDRESS_SUBSCRPTN),'')	||'|'||COALESCE(TRIM(EMAIL_CONTACT),'')	||
     '|'||COALESCE(TRIM(EMAIL_SUBSCRPTN),'')	||'|'||COALESCE(TRIM(PHONE_CONTACT
     ),'')	||'|'||COALESCE(TRIM(PHONE_SUBSCRPTN),'')	||'|'||COALESCE(TRIM(CAST
     (CAST(SYS_TARGET_ID AS INTEGER) AS VARCHAR(20))),'')    AS CHAR(1500)) 
     FROM MDM.TSS_CLEANSE_INPUT_CHN  GROUP BY 1  ORDER BY 1 ASC; 
**** 14:25:54 UTY8715 FastExport is submitting the following request:
     CHECK WORKLOAD END;
**** 14:25:55 UTY8705 EXPORT session(s) requested: 4.
**** 14:25:55 UTY8706 EXPORT session(s) connected: 4.
**** 14:25:55 UTY8715 FastExport is submitting the following request:
     BT;BEGIN FASTEXPORT;
**** 14:25:55 UTY8715 FastExport is submitting the following request:
     SELECT MiscInt1 (INTEGER), MiscInt2 (INTEGER), MiscInt3 (INTEGER),FExptSeq
     (INTEGER), FExptCkpt (VARBYTE(1024)) from MDM.TSS_CLEANSE_INPUT_LOG_CHN
     WHERE (LogType = 210) and (Seq = 1) and (FExptSeq IN (SELECT MAX(FExptSeq)
     from MDM.TSS_CLEANSE_INPUT_LOG_CHN where (LogType = 210) and (Seq = 1)));
**** 14:25:55 UTY8715 FastExport is submitting the following request:
     SELECT MiscInt1 (INTEGER), MiscInt2 (INTEGER),  MiscInt3 (INTEGER),FExptSeq
     (INTEGER), FExptCkpt (VARBYTE(1024)) from MDM.TSS_CLEANSE_INPUT_LOG_CHN
     WHERE (LogType = 212) and (Seq = 1) and (FExptSeq IN (SELECT MAX(FExptSeq)
     from MDM.TSS_CLEANSE_INPUT_LOG_CHN where (LogType = 212) and (Seq = 1)));
**** 14:25:55 UTY8715 FastExport is submitting the following request:
     SELECT CAST(	      
     COALESCE(TRIM(LEGAL_ENT_NBR),'')	||'|'||COALESCE(TRIM(CAST(CAST(MKTNG_PGM_
     NBR AS INTEGER) AS
     CHAR(20))),'')	||'|'||COALESCE(TRIM(REGIS_CNSMR_ID_VAL),'')	||'|'||COALES
     CE(TRIM(NAME_PREFX_TXT),'')	||'|'||COALESCE(TRIM(GVN_NAME),'')	||'|'||COA
     LESCE(TRIM(MID_NAME),'')	||'|'||COALESCE(TRIM(FAMLY_NAME),'')	||'|'||COAL
     ESCE(TRIM(NAME_SUFFX_TXT),'')	||'|'||COALESCE(TRIM(FULL_NAME),'')	||'|'||
     COALESCE(TRIM(GENDR_IND),'')	||'|'||COALESCE(CAST(CAST(BRTH_DATE AS DATE
     FORMAT 'YYYY-MM-DD') AS
     VARCHAR(10)),'')	||'|'||COALESCE(TRIM(ADDR_LINE_1_TXT),'')	||'|'||COALESC
     E(TRIM(ADDR_LINE_2_TXT),'')	||'|'||COALESCE(TRIM(ADDR_LINE_3_TXT),'')	||'
     |'||COALESCE(TRIM(STRET_NUM),'')	||'|'||COALESCE(TRIM(STRET_NAME),'')	||'
     |'||COALESCE(TRIM(APT_NUM),'')	||'|'||COALESCE(TRIM(PO_BOX_NUM),'')	||'|'
     ||COALESCE(TRIM(CITY_NAME),'')	||'|'||COALESCE(TRIM(POSTL_AREA_CODE),'')	
     ||'|'||COALESCE(TRIM(TERR_NAME),'')	||'|'||COALESCE(TRIM(CNTRY_NAME),'')	
     ||'|'||COALESCE(TRIM(EMAIL_ADDR_TXT),'')	||'|'||COALESCE(TRIM(PHONE_EXTSN_
     NUM),'')	||'|'||COALESCE(TRIM(FULL_PHONE_NUM),'')	||'|'||COALESCE(TRIM(PH
     ONE_LINE_NBR),'')	||'|'||COALESCE(TRIM(PHONE_AREA_NBR),'')	||'|'||COALESC
     E(TRIM(PHONE_EXCHG_NBR),'')	||'|'||COALESCE(TRIM(PHONE_CNTRY_NBR),'')	||'
     |'||COALESCE(TRIM(DPEND_NAME),'')	||'|'||COALESCE(TRIM(PET_NAME),'')	||'|
     '||COALESCE(TRIM(USER_NAME),'')	||'|'||COALESCE(TRIM(LANG_CODE),'')	||'|'
     ||COALESCE(TRIM(CAST(CAST(SYS_SOURCE AS INTEGER) AS
     VARCHAR(20))),'')	||'|'||COALESCE(TRIM(SYS_NC_TYPE),'')	||'|'||COALESCE(T
     RIM(CAST(CAST(SYS_CREATION_DATE AS TIMESTAMP(0)) AS
     VARCHAR(20))),'')		||'|'||COALESCE(TRIM(CAST(PRSNA_REG_DT AS
     VARCHAR(20))),'')	||'|'||COALESCE(TRIM(ADDRESS_CONTACT),'')	||'|'||COALES
     CE(TRIM(ADDRESS_SUBSCRPTN),'')	||'|'||COALESCE(TRIM(EMAIL_CONTACT),'')	||
     '|'||COALESCE(TRIM(EMAIL_SUBSCRPTN),'')	||'|'||COALESCE(TRIM(PHONE_CONTACT
     ),'')	||'|'||COALESCE(TRIM(PHONE_SUBSCRPTN),'')	||'|'||COALESCE(TRIM(CAST
     (CAST(SYS_TARGET_ID AS INTEGER) AS VARCHAR(20))),'')    AS CHAR(1500)) 
     FROM MDM.TSS_CLEANSE_INPUT_CHN  GROUP BY 1  ORDER BY 1 ASC; 
**** 14:25:55 UTY8724 Select request submitted to the RDBMS.
**** 14:25:55 UTY8725 Select execution completed. 18 data blocks generated.
**** 14:25:55 UTY8715 FastExport is submitting the following request:
     INS MDM.TSS_CLEANSE_INPUT_LOG_CHN (LogType, Seq) VALUES (220, 1)
**** 14:25:56 UTY8715 FastExport is submitting the following request:
     END FASTEXPORT;ET;
**** 14:25:56 UTY8710 Processing complete for this FastExport task.
     ========================================================================
     =                                                                      =
     =          FastExport Task Complete                                    =
     =                                                                      =
     ========================================================================
**** 14:25:56 UTY1024 Session modal request, 'SET
     QUERY_BAND='UTILITYNAME=FASTEXP;' UPDATE FOR SESSION;', re-executed.
**** 14:25:56 UTY8722 26 total records written to output file.

0008 .SET CREATERC TO 0;

0009 .IF &SYSRC > 4 THEN;
**** 14:25:56 UTY2402 Previous statement modified to:
0010 .IF 0 > 4 THEN;
0011 .SET CREATERC TO 1;
0012 .ELSE;
0013 .IF &SYSRC <= 4 THEN;
**** 14:25:56 UTY2402 Previous statement modified to:
0014 .IF 0 <= 4 THEN;
0015 .SET CREATERC TO 0;
0016 .ENDIF;
0017 .ENDIF;

0018 .LOGOFF &CREATERC;
**** 14:25:56 UTY2402 Previous statement modified to:
0019 .LOGOFF 0;
     ========================================================================
     =                                                                      =
     =          Logoff/Disconnect                                           =
     =                                                                      =
     ========================================================================
**** 14:25:56 UTY6216 The restart log table has been dropped.
**** 14:25:56 UTY6212 A successful disconnect was made from the RDBMS.
**** 14:25:56 UTY2410 Total processor time used = '0.953125 Seconds'
     .       Start : 14:25:53 - TUE FEB 21, 2012
     .       End   : 14:25:56 - TUE FEB 21, 2012
     .       Highest return code encountered = '0'.

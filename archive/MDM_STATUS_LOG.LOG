Microsoft (R) Windows Script Host Version 5.7
Copyright (C) Microsoft Corporation. All rights reserved.

BTEQ 13.10.00.03 Tue Feb 21 15:29:59 2012
 
+---------+---------+---------+---------+---------+---------+---------+----
/***********************************************************************************************************
SCRIPT:               MDM_STATUS.BTEQ 
DESCRIPTION:          THIS SCRIPT UPDATES THE LOAD_CONTROL TABLE WITH THE MDM STATUS.
DEPENDENCY:           MDM PROCESS
INPUT:                
OUTPUT:               LOAD_CONTROL
ERRORS:
SPECIAL INSTRUCTIONS:

CHANGE LOG:
VERSION              DATE                 AUTHOR                          CHANGES
1.00                 01/21/2011           TERADATA                        INITIAL VERSION
***********************************************************************************************************/

.RUN FILE \\10.36.32.4\Teradata\MDM\3.04.01.00\custom\pngrelease3\logon\LOGON.
txt;
+---------+---------+---------+---------+---------+---------+---------+----
.LOGON 10.36.32.14/mdm,

 *** Logon successfully completed.
 *** Teradata Database Release is 13.10.01.01                   
 *** Teradata Database Version is 13.10.01.01                     
 *** Transaction Semantics are BTET.
 *** Session Character Set Name is 'ASCII'.
 
 *** Total elapsed time was 1 second.
 
+---------+---------+---------+---------+---------+---------+---------+----
.SET ERROROUT STDOUT;
 *** Error messages now directed to STDOUT.
+---------+---------+---------+---------+---------+---------+---------+----
.SET SESSION CHARSET 'UTF8';
+---------+---------+---------+---------+---------+---------+---------+----

INSERT INTO ETL_CTRL.LOAD_CONTROL (
LOAD_ID,
SOURCE_ID,
LOAD_TYPE,
LOADSTARTTS,
LOADENDTS,
LOADSTATUS, 
FAILEDREASON,
MDM_PROCESS_DESC,
SOURCECNT,
TARGETCNT,
REJECTSCNT
)
SELECT
A.LOAD_ID,
B.SOURCE_ID,
'MDM',
A.PROCESS_START_TIME,
A.PROCESS_END_TIME,
A.STATUS,
A.ERROR_MSG_TXT,
A.PROCESS_NAME,
B.SOURCECNT,
B.TARGETCNT,
B.REJECTSCNT
FROM 
MDM.LOAD_INFO A

INNER JOIN ETL_CTRL.LOAD_CONTROL B
ON A.LOAD_ID = B.LOAD_ID
AND B.LOAD_TYPE = 'ETL'

WHERE A.LOAD_ID IN
(SELECT LOAD_ID FROM ETL_CTRL.LOAD_CONTROL WHERE LOAD_TYPE = 'ETL'
MINUS
SELECT LOAD_ID FROM ETL_CTRL.LOAD_CONTROL WHERE LOAD_TYPE = 'MDM'
AND LOADSTATUS IN ('Success','Failure-BadFile'))

AND A.LOAD_ID IN 
(SELECT LOAD_ID FROM MDM.LOAD_INFO B
WHERE ((B.PROCESS_NAME = 'Wrapper'
AND B.STATUS = 'Success')
OR B.STATUS IN ('Failure','Failure-BadFile'))
)
;

 *** Insert completed. 72 rows added. 
 *** Total elapsed time was 5 seconds.


+---------+---------+---------+---------+---------+---------+---------+----

.IF ERRORLEVEL > 0 THEN .GOTO EXIT;
+---------+---------+---------+---------+---------+---------+---------+----


.LABEL EXIT
+---------+---------+---------+---------+---------+---------+---------+----

.IF ERRORLEVEL > 4 THEN .GOTO ERR ;
+---------+---------+---------+---------+---------+---------+---------+----
.IF ERRORLEVEL <= 4 THEN .GOTO WARN;
.GOTO WARN;
+---------+---------+---------+---------+---------+---------+---------+----

.LABEL ERR
+---------+---------+---------+---------+---------+---------+---------+----
.QUIT 1
 *** Skipped.
+---------+---------+---------+---------+---------+---------+---------+----

.LABEL WARN
+---------+---------+---------+---------+---------+---------+---------+----
.QUIT 0
 *** You are now logged off from the DBC.
 *** Exiting BTEQ...
 *** RC (return code) = 0 

<?xml version="1.0" encoding="UTF-8"?>
<workflow mgcCount="20" ShowInBreadCrumbs="true" Version="1.0" Name="ApprovalInbox" Description="" Type="" PrimaryDocument="" IsStartAllowed="Yes">
  <variables Description="This task for Approval Inbox, based on the approval  and you can approve or rejects records. Each Approval ,  it is activate the serial approval node.">
    <variable Name="tempAlert" Type="xml" Comment=""/>
    <variable Name="subj" Type="string" Comment=""/>
    <variable Name="mesg" Type="string" Comment=""/>
    <variable Name="creator_Id" Type="string" Comment=""/>
    <variable Name="alertGreen" Type="string" Comment=""/>
    <variable Name="alertRed" Type="string" Comment=""/>
    <variable Name="stepInfo" Type="xml" Comment=""/>
    <variable Name="paginateStartBackup" Type="string" Comment=""/>
    <variable Name="fromViewRecordPage" Type="string" Comment=""/>
    <variable Name="sortOrderBackUp" Type="string" Comment=""/>
    <variable Name="sortByBackUp" Type="string" Comment=""/>
    <variable Name="getFinalOptResults" Type="xml" Comment=""/>
    <variable Name="getAllRecords" Type="xml" Comment=""/>
    <variable Name="selected_TRT_NBR" Type="string" Comment=""/>
    <variable Name="lookup_TRT_NBR" Type="string" Comment=""/>
    <variable Name="lookup_TRT_NAME" Type="string" Comment=""/>
    <variable Name="maxIdVal" Type="string" Comment=""/>
    <variable Name="createOptNumRetain" Type="xml" Comment=""/>
    <variable Name="createOptTypRetain" Type="xml" Comment=""/>
    <variable Name="toViewRecord" Type="xml" Comment=""/>
    <variable Name="selected_TRT_NAME" Type="string" Comment=""/>
    <variable Name="selected_PREDFND_TRT_NBR" Type="string" Comment=""/>
    <variable Name="selected_PREDFND_TRT_TXT" Type="string" Comment=""/>
    <variable Name="selected_PREDFND_TRT_VAL_NAME" Type="string" Comment=""/>
    <variable Name="selected_LINKED_PREDFND_TRT" Type="string" Comment=""/>
    <variable Name="linkedPredfndTrt" Type="xml" Comment=""/>
    <variable Name="ifDataSubsOptTypeBeCreated" Type="xml" Comment=""/>
    <variable Name="lookup_TRT_NAME_LOCAL" Type="string" Comment=""/>
    <variable Name="lookup_LEGAL_ENT" Type="string" Comment=""/>
    <variable Name="lookup_MKTNG_PGM" Type="string" Comment=""/>
    <variable Name="lookup_DISPLAY_TYPE" Type="string" Comment=""/>
    <variable Name="UserGrpId" Type="string" Comment=""/>
    <variable Name="retainVal" Type="xml" Comment=""/>
    <variable Name="retainVal_1" Type="xml" Comment=""/>
    <variable Name="retainVal_2" Type="xml" Comment=""/>
    <variable Name="thisParamBkp1" Type="xml" Comment=""/>
    <variable Name="varSUBSCRPTN_OPT_NAME" Type="xml" Comment=""/>
    <variable Name="retainViewRecords" Type="xml" Comment=""/>
    <variable Name="retainVal_1_indicator" Type="string" Comment=""/>
    <variable Name="toViewRecordIndicator" Type="string" Comment=""/>
    <variable Name="thisParam_SUBSCRPTN_OPT_NBR" Type="xml" Comment=""/>
    <variable Name="thisParam_SUBSCRPTN_OPT_STMT_TXT" Type="xml" Comment=""/>
    <variable Name="startRow2" Type="string" Comment=""/>
    <variable Name="lookup_TRT_NBR1" Type="string" Comment=""/>
    <variable Name="lookup_TRT_NAME_LOCAL1" Type="string" Comment=""/>
    <variable Name="TRT_INS" Type="xml" Comment=""/>
    <variable Name="resultVar" Type="xml" Comment=""/>
    <variable Name="CNSMR_CLCT_IND" Type="string" Comment=""/>
  </variables>
  <nodes>
    <start Name="start2">
      <actions>
        <action>
          <SET Var="selected_TRT_NBR" FromValue=""/>
          <SET Var="selected_TRT_NAME" FromValue=""/>
          <SET Var="selected_PREDFND_TRT_NBR" FromValue=""/>
          <SET Var="selected_PREDFND_TRT_TXT" FromValue=""/>
          <SET Var="selected_PREDFND_TRT_VAL_NAME" FromValue=""/>
        </action>
      </actions>
      <next_nodes>
        <next_node Name="Approval Inbox"/>
      </next_nodes>
    </start>
    <ui_form2 Name="Approval Inbox" InputFormVar="pglFormInput" OutputFormVar="pglFormOutput" ShowInBreadCrumbs="SHOW" Template="Manage_Approvals.pgl">
      <pre_actions>
        <action>
          <IF_TEST Test="$thisParam/BUTTON_ID/@Value='AssignToMe'">
            <THEN>
              <REQUEST Name="GetApprovalUserType" ServiceName="ADMIN_UI" AssignToVar="ApprovalUserType">
                <ID Value="{$thisParam/selected_ID/@Value}"/>
              </REQUEST>
              <IF_TEST Test="$ApprovalUserType/ApprovalUserType/@Value='User Based'">
                <THEN>
                  <TO_DOCVAR AssignToVar="msg">
                    <message Value="Approval Is Already Assigned To You"/>
                  </TO_DOCVAR>
                </THEN>
                <ELSE>
                  <REQUEST Name="AssignToMyself" ServiceName="ADMIN_UI" AssignToVar="currUser">
                    <selected_ID Value="{$thisParam/selected_ID/@Value}"/>
                  </REQUEST>
                  <TO_DOCVAR AssignToVar="msg">
                    <message Value="Record Assigned Successfully"/>
                  </TO_DOCVAR>
                </ELSE>
              </IF_TEST>
              <REMOVE_CHILDREN DocVar="thisParam" ChildName="message"/>
              <ADD_CHILDREN DocVar="thisParam" FromDocVar="msg"/>
            </THEN>
          </IF_TEST>
          <TO_DOCVAR AssignToVar="orderByXml">
            <ORDER_BY/>
          </TO_DOCVAR>
          <IF_TEST Test="$fromViewRecordPage/@Value='yes'">
            <THEN>
              <SET DocVar="thisParam" Property="START_COUNT" FromValue="{$paginateStartBackup/@Value}"/>
              <SET DocVar="thisParam" Property="SORT_ORDER" FromValue="{$sortOrderBackUp/@Value}"/>
              <SET DocVar="thisParam" Property="SORT_BY" FromValue="{$sortByBackUp/@Value}"/>
              <SET Var="fromViewRecordPage" FromValue=""/>
            </THEN>
          </IF_TEST>
          <IF_TEST Test="($thisParam/container1_SELECTED_STEP =null )and ($thisParam/container2_SELECTED_STEP =null)">
            <THEN>
              <SET_PROPS SelectList="$thisParam">
                <Container1_STEP_ID Value="{$stepInfo/Container1SelectedStepId/@Value}" Overwrite="true"/>
                <Container1_SELECTED_STEP Value="{$stepInfo/Container1SelectedStep/@Value}" Overwrite="true"/>
                <container2_STEP_ID Value="{$stepInfo/Container2SelectedStepId/@Value}" Overwrite="true"/>
                <container2_SELECTED_STEP Value="{$stepInfo/Container2SelectedStep/@Value}" Overwrite="true"/>
              </SET_PROPS>
            </THEN>
          </IF_TEST>
          <SET Var="sortOrder" FromValue="{ifElse($thisParam/SORT_ORDER/@Value = null, 'Ascending', $thisParam/SORT_ORDER/@Value)}"/>
          <IF_TEST Test="$thisParam/SORT_BY/@Value='Age'">
            <THEN>
              <SET Var="sortBy" FromValue="DateCreated"/>
            </THEN>
            <ELSE>
              <SET Var="sortBy" FromValue="{ifElse(($thisParam/SORT_BY/@Value = null) or($thisParam/SORT_BY/@Value = 'ID') , 'InstanceDocID', $thisParam/SORT_BY/@Value)}"/>
            </ELSE>
          </IF_TEST>
          <!--IF_TEST Test="$thisParam/BUTTON_ID/@Value='SYS_RELOAD'"-->
          <IF_TEST Test="$thisParam/SORT_ORDER and $thisParam/SORT_BY">
            <THEN>
              <TO_DOCVAR AssignToVar="sortByColumn">
                <TEMP/>
              </TO_DOCVAR>
              <SET_NAME DocVar="sortByColumn" FromValue="{$sortBy}"/>
              <SET Attribute="Sort" DocVar="sortByColumn" FromValue="{$sortOrder}"/>
              <ADD_CHILDREN DocVar="orderByXml" FromDocVar="sortByColumn"/>
            </THEN>
            <ELSE>
              <TO_DOCVAR AssignToVar="sortByColumn">
                <TEMP/>
              </TO_DOCVAR>
              <SET_NAME DocVar="sortByColumn" FromValue="DateCreated"/>
              <SET Attribute="Sort" DocVar="sortByColumn" FromValue="Descending"/>
              <ADD_CHILDREN DocVar="orderByXml" FromDocVar="sortByColumn"/>
            </ELSE>
          </IF_TEST>
          <GET_DOCUMENT Name="Approval_Groups" AssignToVar="ApprovalGroups" ServiceName="APPROVAL" ReturnRowCount="yes" DirtyRead="true">
            <IS_ACTIVE Value="True"/>
            <ENTITY_STATE Value="ACTIVE"/>
          </GET_DOCUMENT>
          <!--FILTER-->
          <SET Var="qu" FromValue="'"/>
          <SET Var="filterQuery" FromValue=""/>
          <SET Var="filterQuery" FromValue="and"/>
          <FOR_EACH SelectList="$thisParam/*" CurrentElement="currentSearchRow">
            <SET Var="temp" FromValue="{substringBefore($currentSearchRow/name(),'_')}"/>
            <IF_TEST Test="($thisParam/BUTTON_ID/@Value='SYS_TAB') and (($temp='FILTER' and $currentSearchRow/@Value!='') or starts-with($currentSearchRow/name(), 'FILTER_FROM') or starts-with($currentSearchRow/name(), 'FILTER_TO') or ends-with($currentSearchRow/name(), 'MATCH_BY'))">
              <THEN>
                <SET DocVar="currentSearchRow" Attribute="Value" FromValue=""/>
              </THEN>
            </IF_TEST>
            <IF_TEST Test="($temp='FILTER' and $currentSearchRow/@Value!='') or starts-with($currentSearchRow/name(), 'FILTER_FROM') or starts-with($currentSearchRow/name(), 'FILTER_TO') or ends-with($currentSearchRow/name(), 'MATCH_BY')">
              <THEN>
                <IF_TEST Test="substringAfter($currentSearchRow/name(),'FILTER_')='InstanceDocID'">
                  <THEN>
                    <SET Var="filterQuery" FromValue="{concat($filterQuery,' INST_DOC_ID LIKE ',$qu,$currentSearchRow/@Value,$qu,' and ')}"/>
                    <CONTINUE/>
                  </THEN>
                </IF_TEST>
                <IF_TEST Test="substringAfter($currentSearchRow/name(),'FILTER_')='InstanceType'">
                  <THEN>
                    <SET Var="filterQuery" FromValue="{concat($filterQuery,' INSTANCE_TYPE LIKE ',$qu,$currentSearchRow/@Value,$qu,' and ')}"/>
                    <CONTINUE/>
                  </THEN>
                </IF_TEST>
                <IF_TEST Test="substringAfter($currentSearchRow/name(),'FILTER_')='ActionType'">
                  <THEN>
                    <SET Var="filterQuery" FromValue="{concat($filterQuery,' INSTANCE_MODE LIKE ',$qu,$currentSearchRow/@Value,$qu,' and ')}"/>
                    <CONTINUE/>
                  </THEN>
                </IF_TEST>
                <IF_TEST Test="substringAfter($currentSearchRow/name(),'FILTER_')='Status'">
                  <THEN>
                    <SET Var="filterQuery" FromValue="{concat($filterQuery,' t1.Status LIKE ',$qu,$currentSearchRow/@Value,$qu,' and ')}"/>
                    <CONTINUE/>
                  </THEN>
                </IF_TEST>
                <IF_TEST Test="substringAfter($currentSearchRow/name(),'FILTER_')='ApproverComments'">
                  <THEN>
                    <SET Var="filterQuery" FromValue="{concat($filterQuery,' t1.COMMENTS LIKE ',$qu,$currentSearchRow/@Value,$qu,' and ')}"/>
                    <CONTINUE/>
                  </THEN>
                </IF_TEST>
                <IF_TEST Test="substringAfter($currentSearchRow/name(),'FILTER_')='FROM_DateCreated'">
                  <THEN>
                    <IF_TEST Test="$currentSearchRow/@Value!=''">
                      <THEN>
                        <SET Var="timeValue" FromValue="{trim($currentSearchRow/@Value)}"/>
                        <SET Var="timeFormat" FromValue="MM/dd/yyyy HH:mm:ss"/>
                        <SET Var="dbFormat" FromValue="MM/dd/yyyy HH:mm:ss"/>
                        <NATIVE_FUNCTION ClassName="com.teradata.xservice.userSecurity.DynamicPGLGenerator" MethodName="parseDate" AssignToVar="nativeReturn">
                          <PARAM Var="timeValue" Caption="date"/>
                          <PARAM Var="timeFormat" Caption="format"/>
                          <PARAM Var="dbFormat" Caption="dbFormat"/>
                        </NATIVE_FUNCTION>
                        <SET Var="formatValue" FromValue="(timestamp(0), format 'MM/DD/YYYYBHH:MI:SS')"/>
                        <SET Var="filterQuery" FromValue="{concat($filterQuery,' (DATE_CREATED >= ',$qu,$nativeReturn/@Value,$qu,$formatValue,') and ')}"/>
                      </THEN>
                    </IF_TEST>
                    <CONTINUE/>
                  </THEN>
                </IF_TEST>
                <IF_TEST Test="substringAfter($currentSearchRow/name(),'FILTER_')='TO_DateCreated'">
                  <THEN>
                    <IF_TEST Test="$currentSearchRow/@Value!=''">
                      <THEN>
                        <SET Var="timeValue" FromValue="{trim($currentSearchRow/@Value)}"/>
                        <SET Var="timeFormat" FromValue="MM/dd/yyyy HH:mm:ss"/>
                        <SET Var="dbFormat" FromValue="MM/dd/yyyy HH:mm:ss"/>
                        <NATIVE_FUNCTION ClassName="com.teradata.xservice.userSecurity.DynamicPGLGenerator" MethodName="parseDate" AssignToVar="nativeReturn">
                          <PARAM Var="timeValue" Caption="date"/>
                          <PARAM Var="timeFormat" Caption="format"/>
                          <PARAM Var="dbFormat" Caption="dbFormat"/>
                        </NATIVE_FUNCTION>
                        <SET Var="formatValue" FromValue=" (timestamp(0), format 'MM/DD/YYYYBHH:MI:SS') "/>
                        <SET Var="filterQuery" FromValue="{concat($filterQuery,' (DATE_CREATED &lt;= ',$qu,$nativeReturn/@Value,$qu,$formatValue,') and ')}"/>
                      </THEN>
                    </IF_TEST>
                    <CONTINUE/>
                  </THEN>
                </IF_TEST>
                <IF_TEST Test="substringAfter($currentSearchRow/name(),'FILTER_')='NodeType'">
                  <THEN>
                    <SET Var="nodeTypeValue" FromValue="{ifElse($currentSearchRow/@Value ='Serial' , 'S', 'P')}"/>
                    <SET Var="filterQuery" FromValue="{concat($filterQuery,' NODE_TYPE LIKE ',$qu,$nodeTypeValue,$qu,' and ')}"/>
                    <CONTINUE/>
                  </THEN>
                </IF_TEST>
                <!-- Code by Aishwarya starts -->
                <IF_TEST Test="substringAfter($currentSearchRow/name(),'FILTER_')='LEGAL_ENT_NAME'">
                  <THEN>
                    <SET Var="LE_FILTER" FromValue="{$currentSearchRow/@Value}"/>
                    <SET Var="replace" FromValue="\*"/>
                    <SET Var="replaceWith" FromValue="\%"/>
                    <SET Var="LE_FILTER" FromValue="{strReplaceAll($LE_FILTER/@Value,$replace,$replaceWith)}"/>
                    <!--<SET Var="LE_FILTER" FromValue="{strReplaceAll($LE_FILTER/@Value,'*','%')}"/>
                    <SET Var="LE_FILTER" FromValue="{trim(LE_FILTER)}"/>                   
                    <EXECUTE_SQL_QUERY AssignToVar="LE_FILTER1" Value="sel LEGAL_ENT_NAME from LEGAL_ENT where LEGAL_ENT_NAME like '{$LE_FILTER/@Value}'"/>                    -->
                    <!--<SET Var="filterQuery" FromValue="{concat($filterQuery,' LEGAL_ENT_NAME LIKE ',$qu,$LE_FILTER/@Value,$qu,' and ')}"/>-->
                    <SET Var="filterQuery" FromValue="{concat($filterQuery,' ',substringAfter($currentSearchRow/name(),'FILTER_'),' LIKE ',$qu,$LE_FILTER/@Value,$qu,' and ')}"/>
                    <CONTINUE/>
                    <!--<SET Var="LE_FILTER" FromValue="{$currentSearchRow/@Value}"/>
                    {strReplaceAll($thisParam/Page_URL/@Value,';amp;','&amp;')}                    -->
                  </THEN>
                </IF_TEST>
                <!-- Code by Aishwarya ends -->
                <SET Var="filterQuery" FromValue="{concat($filterQuery,' ',substringAfter($currentSearchRow/name(),'FILTER_'),' LIKE ',$qu,$currentSearchRow/@Value,$qu,' and ')}"/>
              </THEN>
            </IF_TEST>
          </FOR_EACH>
          <SET Var="filterQuery" FromValue="{concat($filterQuery,' 1=1 ')}"/>
          <!--FILTER-->
          <!--paginate variables-->
          <SET Var="paginateStart" FromValue="{int(ifElse($thisParam/START_COUNT/@Value = null, 0, $thisParam/START_COUNT/@Value))}"/>
          <IF_TEST Test="$thisParam/EXPORT_ALL/@Value='yes'">
            <THEN>
              <SET Var="paginateStart" FromValue="0"/>
              <SET Var="maxRow" FromValue="{$thisParam/MAX_ROWS/@Value}"/>
            </THEN>
          </IF_TEST>
          <SET Var="maxRow" FromValue="10"/>
          <!--paginate variables-->
          <IF_TEST Test="$thisParam/container2_SELECTED_STEP/@Value='History'">
            <THEN>
              <TO_DOCVAR AssignToVar="orderBy">
                <TO_XML SelectList="$orderByXml"/>
              </TO_DOCVAR>
              <REQUEST Name="FetchApprovalHistory" ServiceName="ADMIN_UI" AssignToVar="curAlertHist">
                <TO_XML DocVar="orderBy"/>
                <APPROVER_ID Value="{$userName/@Value}"/>
                <filterQuery Value="{$filterQuery}"/>
                <paginateStart Value="{$paginateStart}"/>
                <maxRow Value="{$maxRow}"/>
              </REQUEST>
              <TO_DOCVAR AssignToVar="_history">
                <HIST/>
              </TO_DOCVAR>
              <FOR_EACH CurrentElement="currHist" SelectList="$curAlertHist/RESPONSE/SQL_RESULT">
                <SET_PROPS SelectList="$currHist">
                  <InstanceDocID Value="{$currHist/INST_DOC_ID/@Value}"/>
                  <InstanceType Value="{$currHist/INSTANCE_TYPE/@Value}"/>
                  <ActionType Value="{$currHist/INSTANCE_MODE/@Value}"/>
                  <Status Value="{$currHist/STATUS/@Value}"/>
                  <DateCreated Value="{$currHist/DATE_CREATED/@Value}"/>
                  <ApproverComments Value="{$currHist/COMMENTS/@Value}"/>
                  <MAP_ID Value="{$currHist/MAP_ID/@Value}"/>
                </SET_PROPS>
                <!-- Code Added by Aishwarya to populate LEGAL_ENT_NAME on Approval History List starts -->
                <!--<EXECUTE_SQL_QUERY AssignToVar="GET_LE_NBR" Value="sel ATTRIBUTEVALUE from AW_DOC_ATTR where INSTANCEID in (sel ID from AW_DOC_INSTANCE where ALERTID = '{$currHist/InstanceDocID/@Value}') and ATTRIBUTEID = 'LEGAL_ENT_NBR'"/>
                <IF_TEST Test="$GET_LE_NBR/SQL_RESULT/ATTRIBUTEVALUE/@Value = '' or $GET_LE_NBR/SQL_RESULT/ATTRIBUTEVALUE/@Value = null">
                  <THEN>
                    <EXECUTE_SQL_QUERY AssignToVar="GET_LE_NBR" Value="sel LEGAL_ENT_NBR from MKTNG_PGM where MKTNG_PGM_NBR = (sel ATTRIBUTEVALUE from AW_DOC_ATTR where INSTANCEID in (sel ID from AW_DOC_INSTANCE where ALERTID = '{$currHist/InstanceDocID/@Value}') and ATTRIBUTEID = 'MKTNG_PGM_NBR')"/>
                    <SET Var="LE_NBR" FromValue="{$GET_LE_NBR/SQL_RESULT/LEGAL_ENT_NBR/@Value}"/>
                  </THEN>
                  <ELSE>
                    <SET Var="LE_NBR" FromValue="{$GET_LE_NBR/SQL_RESULT/ATTRIBUTEVALUE/@Value}"/>
                  </ELSE>
                </IF_TEST>
                <EXECUTE_SQL_QUERY AssignToVar="GET_LE_NAME" Value="SEL LEGAL_ENT_NAME from LEGAL_ENT where LEGAL_ENT_NBR = '{$LE_NBR/@Value}'"/>
                <SET_PROPS SelectList="$currHist">
                  <LegalEntName Value="{$GET_LE_NAME/SQL_RESULT/LEGAL_ENT_NAME/@Value}"/>
                </SET_PROPS>-->
                <!-- Code Added by Aishwarya to populate LEGAL_ENT_NAME on Approval History List ends -->
                <IF_TEST Test="$currHist/NODE_TYPE/@Value='S'">
                  <THEN>
                    <SET_PROPS SelectList="$currHist">
                      <NodeType Value="Serial" Overwrite="true"/>
                    </SET_PROPS>
                    <SET Var="_locTargetColumn" FromValue="{$ApprovalGroups/*[EVENT_NAME/@Value=$currHist/InstanceType/@Value]/APPROVAL_MAP_ID/@Value}"/>
                    <SET_PROPS SelectList="$currHist">
                      <MAP_ID Value="{$_locTargetColumn/@Value}" Overwrite="true"/>
                    </SET_PROPS>
                  </THEN>
                  <ELSE>
                    <SET_PROPS SelectList="$currHist">
                      <NodeType Value="Parallel" Overwrite="true"/>
                    </SET_PROPS>
                    <SET Var="_locTargetColumn" FromValue="{$ApprovalGroups/*[EVENT_NAME/@Value=$currHist/InstanceType/@Value]/APPROVAL_MAP_ID/@Value}"/>
                    <SET_PROPS SelectList="$currHist">
                      <MAP_ID Value="{$_locTargetColumn/@Value}" Overwrite="true"/>
                    </SET_PROPS>
                  </ELSE>
                </IF_TEST>
                <!-- Code Added by Aishwarya to filter LEGAL_ENT_NAME on Approval History List starts -->
                <!--<IF_TEST Test="$LE_FILTER != null">
                  <THEN>
                    <FOR_EACH SelectList="$LE_FILTER1/*" CurrentElement="currElem">
                      <IF_TEST Test="$currHist/LegalEntName/@Value=$currElem/LEGAL_ENT_NAME/@Value">
                        <THEN>
                          <ADD_CHILDREN DocVar="_history" FromSelectList="$currHist" />
                        </THEN>
                      </IF_TEST>
                    </FOR_EACH>
                  </THEN>
                  <ELSE>
                    <ADD_CHILDREN DocVar="_history" FromSelectList="$currHist" />
                  </ELSE>
                </IF_TEST>-->
                <!-- Code Added by Aishwarya to filter LEGAL_ENT_NAME on Approval History List ends -->
                <ADD_CHILDREN DocVar="_history" FromSelectList="$currHist"/>
              </FOR_EACH>
              <TO_DOCVAR AssignToVar="pglFormInput">
                <ROOT>
                  <StartRowCount Value="{$paginateStart}"/>
                  <TotalRowCount Value="{$curAlertHist/RESPONSE/@TotalRowCount}"/>
                  <TEMP_LEGACY_CUSTOMER TotalRowCount="{$tempLC/@TotalRowCount}">
                    <TO_XML SelectList="$tempLC/*"/>
                  </TEMP_LEGACY_CUSTOMER>
                  <HIST TotalRowCount="{$curAlertHist/RESPONSE/@TotalRowCount}">
                    <TO_XML SelectList="$_history/*"/>
                  </HIST>
                </ROOT>
              </TO_DOCVAR>
            </THEN>
            <ELSE>
              <TO_DOCVAR AssignToVar="_inbox">
                <INBOX/>
              </TO_DOCVAR>
              <TO_DOCVAR AssignToVar="orderBy">
                <TO_XML SelectList="$orderByXml"/>
              </TO_DOCVAR>
              <REQUEST Name="FetchApprovalInbox" ServiceName="ADMIN_UI" AssignToVar="ApprovalResult">
                <TO_XML DocVar="orderBy"/>
                <APPROVER_ID Value="{$userName/@Value}"/>
                <filterQuery Value="{$filterQuery}"/>
                <paginateStart Value="{$paginateStart}"/>
                <maxRow Value="{$maxRow}"/>
              </REQUEST>
              <SET Var="ageCalculationParam" FromSelect="$ApprovalResult/RESPONSE"/>
              <REQUEST Name="ageCalculate" ServiceName="ADMIN_UI" AssignToVar="testResult">
                <TO_XML DocVar="ageCalculationParam"/>
              </REQUEST>
              <SET Var="ctr" FromValue="1"/>
              <FOR_EACH CurrentElement="currAlert" SelectList="$ApprovalResult/RESPONSE/*">
                <IF_TEST Test="$currAlert/recordCount/@Value = 1">
                  <THEN>
                    <REQUEST Name="GetApprovalRecord" ServiceName="ADMIN_UI" AssignToVar="approvalRecord" HandleException="true">
                      <DocumentInstanceID Value="{$currAlert/INST_DOC_ID/@Value}"/>
                    </REQUEST>
                    <SET Var="rowCountVal" FromValue="{$currAlert/DOCUMENTACTION/@Value}-{$approvalRecord/*/@TotalRowCount}"/>
                  </THEN>
                  <ELSE>
                    <SET Var="rowCountVal" FromValue="BULK"/>
                  </ELSE>
                </IF_TEST>
                <SET_PROPS SelectList="$currAlert">
                  <rowCount Value="{$rowCountVal}"/>
                  <InstanceDocID Value="{$currAlert/INST_DOC_ID/@Value}"/>
                  <InstanceType Value="{$currAlert/INSTANCE_TYPE/@Value}"/>
                  <ActionType Value="{$currAlert/INSTANCE_MODE/@Value}"/>
                  <Status Value="{$currAlert/STATUS/@Value}"/>
                  <DateCreated Value="{$currAlert/DATE_CREATED/@Value}"/>
                  <MAP_ID Value="{$currAlert/MAP_ID/@Value}"/>
                </SET_PROPS>
                <!-- Code Added by Aishwarya to populate LEGAL_ENT_NAME on Approval List starts -->
                <!--<EXECUTE_SQL_QUERY AssignToVar="GET_LE_NBR" Value="sel ATTRIBUTEVALUE from AW_DOC_ATTR where INSTANCEID in (sel ID from AW_DOC_INSTANCE where ALERTID = '{$currAlert/InstanceDocID/@Value}') and ATTRIBUTEID = 'LEGAL_ENT_NBR'"/>
                <IF_TEST Test="$GET_LE_NBR/SQL_RESULT/ATTRIBUTEVALUE/@Value = '' or $GET_LE_NBR/SQL_RESULT/ATTRIBUTEVALUE/@Value = null or $GET_LE_NBR/SQL_RESULT/ATTRIBUTEVALUE/@Value = '0'">
                  <THEN>
                    <EXECUTE_SQL_QUERY AssignToVar="GET_LE_NBR" Value="sel LEGAL_ENT_NBR from MKTNG_PGM where MKTNG_PGM_NBR = (sel ATTRIBUTEVALUE from AW_DOC_ATTR where INSTANCEID in (sel ID from AW_DOC_INSTANCE where ALERTID = '{$currAlert/InstanceDocID/@Value}') and ATTRIBUTEID = 'MKTNG_PGM_NBR')"/>
                    <SET Var="LE_NBR" FromValue="{$GET_LE_NBR/SQL_RESULT/LEGAL_ENT_NBR/@Value}"/>
                  </THEN>
                  <ELSE>
                    <SET Var="LE_NBR" FromValue="{$GET_LE_NBR/SQL_RESULT/ATTRIBUTEVALUE/@Value}"/>
                  </ELSE>
                </IF_TEST>
                <EXECUTE_SQL_QUERY AssignToVar="GET_LE_NAME" Value="SEL LEGAL_ENT_NAME from LEGAL_ENT where LEGAL_ENT_NBR = '{$LE_NBR/@Value}'"/>
                <SET_PROPS SelectList="$currAlert">
                  <LegalEntName Value="{$GET_LE_NAME/SQL_RESULT/LEGAL_ENT_NAME/@Value}"/>
                </SET_PROPS>
                <TO_DOCVAR AssignToVar="currAlert1">
                  <SQL_RESULT/>
                </TO_DOCVAR>-->
                <!-- Code Added by Aishwarya to populate LEGAL_ENT_NAME on Approval List ends -->
                <IF_TEST Test="int($ApprovalResult/RESPONSE/@TotalRowCount) = 1">
                  <THEN>
                    <SET_PROPS SelectList="$currAlert">
                      <Age Value="{$testResult/age/@Value}"/>
                    </SET_PROPS>
                  </THEN>
                  <ELSE>
                    <SET_PROPS SelectList="$currAlert">
                      <Age Value="{$testResult/age[int($ctr)]/@Value}"/>
                    </SET_PROPS>
                    <SET Var="ctr" FromValue="{int($ctr)+1}"/>
                  </ELSE>
                </IF_TEST>
                <IF_TEST Test="$currAlert/NODE_TYPE/@Value='S'">
                  <THEN>
                    <SET_PROPS SelectList="$currAlert">
                      <NodeType Value="Serial" Overwrite="true"/>
                    </SET_PROPS>
                    <SET Var="_locTargetColumn" FromValue="{$ApprovalGroups/*[EVENT_NAME/@Value=$currAlert/InstanceType/@Value]/APPROVAL_MAP_ID/@Value}"/>
                    <SET_PROPS SelectList="$currAlert">
                      <MAP_ID Value="{$_locTargetColumn/@Value}" Overwrite="true"/>
                    </SET_PROPS>
                  </THEN>
                  <ELSE>
                    <SET_PROPS SelectList="$currAlert">
                      <NodeType Value="Parallel" Overwrite="true"/>
                    </SET_PROPS>
                    <SET Var="_locTargetColumn" FromValue="{$ApprovalGroups/*[EVENT_NAME/@Value=$currAlert/InstanceType/@Value]/APPROVAL_MAP_ID/@Value}"/>
                    <SET_PROPS SelectList="$currAlert">
                      <MAP_ID Value="{$_locTargetColumn/@Value}" Overwrite="true"/>
                    </SET_PROPS>
                  </ELSE>
                </IF_TEST>
                <!-- Code Added by Aishwarya to filter LEGAL_ENT_NAME on Approval List starts -->
                <!--<TO_DOCVAR AssignToVar="currAlert1">
                  <SQL_RESULT />
                </TO_DOCVAR>
                <IF_TEST Test="$LE_FILTER != null">
                  <THEN>
                    <FOR_EACH SelectList="$LE_FILTER1/*" CurrentElement="currElem">
                      <IF_TEST Test="$currAlert/LegalEntName/@Value=$currElem/LEGAL_ENT_NAME/@Value">
                        <THEN>                -->
                <!--<APPEND_TO_XML DocVar="currAlert1">
                            <TO_XML SelectList="$currAlert"/>
                          </APPEND_TO_XML>-->
                <!--<ADD_CHILDREN DocVar="_inbox" FromSelectList="$currAlert" />
                        </THEN>
                      </IF_TEST>
                    </FOR_EACH>
                  </THEN>
                  <ELSE>
                    <ADD_CHILDREN DocVar="_inbox" FromSelectList="$currAlert" />
                  </ELSE>
                </IF_TEST>-->
                <!-- Code Added by Aishwarya to filter LEGAL_ENT_NAME on Approval List ends -->
                <ADD_CHILDREN DocVar="_inbox" FromSelectList="$currAlert"/>
              </FOR_EACH>
              <TO_DOCVAR AssignToVar="page">
                <ABC>
                  <StartRowCount Value="{$paginateStart}"/>
                  <TotalRowCount Value="{$ApprovalResult/RESPONSE/@TotalRowCount}"/>
                  <SORT_BY Value="{$sortByColumn/name()}"/>
                </ABC>
              </TO_DOCVAR>
              <TO_DOCVAR AssignToVar="pglFormInput">
                <ROOT>
                  <ALERTMSG Value="{$thisParam/message/@Value}"/>
                  <STATUS Value="{$thisParam/status/@Value}"/>
                  <TEMP_LEGACY_CUSTOMER TotalRowCount="{$tempLC/@TotalRowCount}">
                    <TO_XML SelectList="$tempLC/*"/>
                  </TEMP_LEGACY_CUSTOMER>
                  <INBOX TotalRowCount="{$ApprovalResult/RESPONSE/@TotalRowCount}">
                    <TO_XML SelectList="$_inbox/*"/>
                  </INBOX>
                </ROOT>
              </TO_DOCVAR>
              <ADD_CHILDREN DocVar="pglFormInput" FromSelectList="$page/*"/>
            </ELSE>
          </IF_TEST>
        </action>
      </pre_actions>
      <post_actions>
        <action>
          <SET Var="paginateStartBackup" FromValue="{int(ifElse($thisParam/START_COUNT/@Value = null, 0, $thisParam/START_COUNT/@Value))}"/>
          <SET Var="sortOrderBackUp" FromValue="{$thisParam/SORT_ORDER/@Value}"/>
          <SET Var="sortByBackUp" FromValue="{$thisParam/SORT_BY/@Value}"/>
        </action>
      </post_actions>
      <if_cond Value="$userAction ='SEARCH'">
        <next_nodes OutputVar="{outputXml,xml}"/>
      </if_cond>
      <else_if_cond Value="$userAction ='Done'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="Stop" Description=""/>
        </next_nodes>
      </else_if_cond>
      <else_if_cond Value="$userAction ='REJECT'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="Reject" Description=""/>
        </next_nodes>
      </else_if_cond>
      <else_if_cond Value="$userAction ='ACCEPT'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="Approve" Description=""/>
        </next_nodes>
      </else_if_cond>
      <else_if_cond Value="$userAction ='VIEW'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="display_ViewRecord" Description=""/>
        </next_nodes>
      </else_if_cond>
      <else_if_cond Value="$userAction ='AssignToMe'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="Approval Inbox" Description=""/>
        </next_nodes>
      </else_if_cond>
      <else_if_cond Value="true()">
        <next_nodes OutputVar="{outputXml,xml}"/>
      </else_if_cond>
    </ui_form2>
    <done Name="Stop">
      <actions>
        <action>
          <IF_TEST Test="$alertRed/@Value != null">
            <THEN>
              <SET Var="urlStr" FromValue="{concat('start.x2ps?START_WORKFLOW=ApprovalInbox&amp;SOLUTION_NAME=MDM&amp;SERVICE_NAME=ADMIN_UI&amp;message=',$alertRed/@Value,'&amp;status=fail&amp;ParentContainer_STEP_ID=',$messageType)}"/>
            </THEN>
            <ELSE>
              <SET Var="urlStr" FromValue="{concat('start.x2ps?START_WORKFLOW=ApprovalInbox&amp;SOLUTION_NAME=MDM&amp;SERVICE_NAME=ADMIN_UI&amp;message=',$alertGreen/@Value,'&amp;status=&amp;ParentContainer_STEP_ID=',$messageType)}"/>
            </ELSE>
          </IF_TEST>
          <SET Var="REDIRECT_URL" FromValue="{$urlStr}"/>
        </action>
      </actions>
      <next_nodes/>
    </done>
    <task Name="Approve" InputVar="{nodeinputXml,xml}">
      <actions>
        <action>
          <REQUEST Name="getUser" ServiceName="USER_SECURITY" AssignToVar="currUser">
            <ID Value="{$userId}"/>
          </REQUEST>
          <REQUEST Name="AssignToMyself" ServiceName="ADMIN_UI" AssignToVar="currUser1">
            <selected_ID Value="{$thisParam/selected_ID/@Value}"/>
          </REQUEST>
          <EXECUTE_SQL_QUERY Value="LOCKING ROW FOR ACCESS SELECT COUNT(*) AS TOT_RECORDS FROM AW_ALERT WHERE INST_DOC_ID='{$thisParam/selected_ID/@Value}' AND APPROVER_ID='{$currUser/USER_PROFILE/LOGIN_NAME/@Value}'" AssignToVar="cnt"/>
          <IF_TEST Test="$cnt/SQL_RESULT/TOT_RECORDS/@Value != '0'">
            <THEN>
              <REQUEST Name="getAllUsersForGrp" AssignToVar="userNameResp" ServiceName="ADMIN_UI"/>
              <GET_DOCUMENT Name="Alert" ServiceName="APPROVAL" AssignToVar="curAlert" DirtyRead="true" ReturnRowCount="yes">
                <InstanceDocID Value="{$thisParam/selected_ID/@Value}"/>
                <OR>
                  <TO_XML SelectList="$userNameResp/*"/>
                </OR>
                <Status Value="A"/>
              </GET_DOCUMENT>
              <IF_TEST Test="int($curAlert/@TotalRowCount) > 0">
                <THEN>
                  <GET_DOCUMENT AssignToVar="DocumentInstance" Name="DocumentInstance" ServiceName="APPROVAL" ReturnRowCount="yes" DirtyRead="true">
                    <SELECT>
                      <DocumentAction/>
                    </SELECT>
                    <AlertID Value="{$thisParam/selected_ID/@Value}"/>
                  </GET_DOCUMENT>
                  <GET_DOCUMENT Name="Approval_Groups" AssignToVar="ApprovalGroups" ServiceName="APPROVAL" ReturnRowCount="yes" DirtyRead="true">
                    <EVENT_NAME Value="{$curAlert/Alert/InstanceType/@Value}"/>
                    <IS_ACTIVE Value="True"/>
                    <OR>
                      <ACTION_TYPE Value="{$DocumentInstance/DocumentInstance/DocumentAction/@Value}"/>
                      <ACTION_TYPE Value="ALL"/>
                    </OR>
                  </GET_DOCUMENT>
                  <GET_DOCUMENT Name="Approvals" AssignToVar="Approvals" ServiceName="APPROVAL" ReturnRowCount="yes" DirtyRead="true">
                    <SELECT>
                      <NOTIFICATION_TYPE/>
                    </SELECT>
                    <APPROVAL_GROUP_ID Value="{$ApprovalGroups/Approval_Groups/SEQID/@Value}"/>
                    <IS_ACTIVE Value="True"/>
                    <ENTITY_STATE Value="ACTIVE"/>
                    <EXECUTION_ORDER Value="1"/>
                  </GET_DOCUMENT>
                  <CLONE_XML DocVar="thisParam" AssignToVar="SelectedItemApprovalDetails"/>
                  <SET Var="name1" FromValue="{$thisParam/InstanceType/@Value}"/>
                  <IF_TEST Test="$name1/@Value='TRT_IN'">
                    <THEN>
                      <FOR_EACH SelectList="$getAllRecords/DocumentAttributes" CurrentElement="currElem">
                        <IF_TEST Test="$currElem/AttributeID/@Value= 'TRT_NBR'">
                          <THEN>
                            <SET Var="TRT_NBR_Final" FromValue="{$currElem/AttributeValue/@Value}"/>
                          </THEN>
                          <ELSE>
                            <IF_TEST Test="$currElem/AttributeID/@Value ='TRT_NAME_LOCAL'">
                              <THEN>
                                <SET Var="TRT_NAME_Final" FromValue="{$currElem/AttributeValue/@Value}"/>
                              </THEN>
                              <ELSE>
                                <IF_TEST Test="$currElem/AttributeID/@Value ='LEGAL_ENT_NBR'">
                                  <THEN>
                                    <SET Var="LEGAL_ENT_Final" FromValue="{$currElem/AttributeValue/@Value}"/>
                                  </THEN>
                                  <ELSE>
                                    <IF_TEST Test="$currElem/AttributeID/@Value ='MKTNG_PGM_NBR'">
                                      <THEN>
                                        <SET Var="MKTNG_PGM_Final" FromValue="{$currElem/AttributeValue/@Value}"/>
                                      </THEN>
                                      <ELSE>
                                        <IF_TEST Test="$currElem/AttributeID/@Value ='ID'">
                                          <THEN>
                                            <SET Var="ID_Final" FromValue="{$currElem/AttributeValue/@Value}"/>
                                          </THEN>
                                          <ELSE>
                                            <IF_TEST Test="$currElem/AttributeID/@Value ='CNSMR_CLCT_IND'">
                                              <THEN>
                                                <SET Var="CNSMR_CLCT_IND_Final" FromValue="{$currElem/AttributeValue/@Value}"/>
                                              </THEN>
                                            </IF_TEST>
                                          </ELSE>
                                        </IF_TEST>
                                      </ELSE>
                                    </IF_TEST>
                                  </ELSE>
                                </IF_TEST>
                              </ELSE>
                            </IF_TEST>
                          </ELSE>
                        </IF_TEST>
                      </FOR_EACH>
                      <IF_TEST Test="$LEGAL_ENT_Final!=''">
                        <THEN>
                          <GET_DOC_SMART Name="LEGAL_ENT_TRAIT_MAP" AssignToVar="get_LE_TRT_MAP" ServiceName="BCM_MASTER" HandleException="true">
                            <LEGAL_ENT_NBR Value="{$LEGAL_ENT_Final/@Value}"/>
                            <TRT_NBR Value="{$TRT_NBR_Final/@Value}"/>
                            <TRT_NAME Value="{$TRT_NAME_Final/@Value}"/>
                          </GET_DOC_SMART>
                          <!--<GET_DOC_SMART Name="PREDFND_TRT_VAL_IN_DUMMY" AssignToVar="GET_PREDFND_TRT" ServiceName="BCM_MASTER" HandleException="true" DirtyRead="true">
                            <TRT_NAME Value="{$lookup_TRT_NAME_LOCAL/@Value}"/>
                            <SELECT>
                              <ID/>
                              <TRT_NBR/>
                              <TRT_NAME/>
                              <PREDFND_TRT_VAL_NBR/>
                              <PREDFND_TRT_TXT/>
                              <PREDFND_TRT_TXT_LOCAL/>
                              <PREDFND_TRT_DATE/>
                              <PREDFND_TRT_VAL_NAME/>
                              <SYS_TARGET_ID/>
                            </SELECT>
                          </GET_DOC_SMART>
                          <TO_DOCVAR AssignToVar="linkedPredfndTrt">
                            <ROOT2/>
                          </TO_DOCVAR>
                          <ADD_CHILDREN DocVar="linkedPredfndTrt" FromSelectList="$GET_PREDFND_TRT/*"/>-->
                          <SET Var="count1" FromValue="{count($get_LE_TRT_MAP/LEGAL_ENT_TRAIT_MAP)}"/>
                          <SET Var="count11" FromValue="{count($linkedPredfndTrt/PREDFND_TRT_VAL_IN_DUMMY)}"/>
                          <SET Var="count12" FromValue="{count($linkedPredfndTrt/PREDFND_TRT_VAL_IN_DUMMY/PREDFND_TRT_VAL_NBR[@Value='' or @Value=null])}"/>
                          <IF_TEST Test="$count12='0'">
                            <THEN>
                              <IF_TEST Test="$count1='0'">
                                <THEN>
                                  <IF_TEST Test="$count11='0'">
                                    <THEN>
                                      <DO_DB_PERSIST DocumentName="LEGAL_ENT_TRAIT_MAP" Action="INSERT" ServiceName="BCM_MASTER" AssignToVar="INS_LE_TRT_MAP">
                                        <LEGAL_ENT_NBR Value="{$LEGAL_ENT_Final}"/>
                                        <TRT_NBR Value="{$TRT_NBR_Final}"/>
                                        <TRT_NAME Value="{$TRT_NAME_Final}"/>
                                        <PREDFND_TRT_VAL_NBR Value="0"/>
                                      </DO_DB_PERSIST>
                                    </THEN>
                                    <ELSE>
                                      <FOR_EACH CurrentElement="currElem" SelectList="$linkedPredfndTrt/PREDFND_TRT_VAL_IN_DUMMY">
                                        <EXECUTE_SQL_QUERY AssignToVar="TargetId" Value="LOCKING ROW FOR ACCESS SEL SYS_TARGET_ID  FROM PREDFND_TRT_VAL_IN_DUMMY where ID={$currElem/ID/@Value};"/>
                                        <SET Var="PREDFND_TRT_VAL_NBR" FromValue="{$currElem/PREDFND_TRT_VAL_NBR/@Value}"/>
                                        <SET Var="PREDFND_TRT_DESC" FromValue="{$currElem/PREDFND_TRT_TXT_LOCAL/@Value}"/>
                                        <SET Var="TGT_ID" FromValue="{$TargetId/SQL_RESULT/SYS_TARGET_ID/@Value}"/>
                                        <IF_TEST Test="$TGT_ID='99'">
                                          <THEN>
                                            <DO_DB_PERSIST DocumentName="LEGAL_ENT_TRAIT_MAP" Action="INSERT" ServiceName="BCM_MASTER" AssignToVar="INS_LE_TRT_MAP">
                                              <LEGAL_ENT_NBR Value="{$LEGAL_ENT_Final}"/>
                                              <TRT_NBR Value="{$TRT_NBR_Final}"/>
                                              <TRT_NAME Value="{$TRT_NAME_Final}"/>
                                              <PREDFND_TRT_VAL_NBR Value="{$PREDFND_TRT_VAL_NBR}"/>
                                              <PREDFND_TRT_DESC Value="{$PREDFND_TRT_DESC}"/>
                                            </DO_DB_PERSIST>
                                          </THEN>
                                          <ELSE>
                                            <THEN>
                                              <SET Var="TRT_NBR" FromValue="{$currElem/TRT_NBR/@Value}"/>
                                              <SET Var="PREDFND_TRT_VAL_NBR" FromValue="{$currElem/PREDFND_TRT_VAL_NBR/@Value}"/>
                                              <SET Var="PREDFND_TRT_DATE" FromValue="{$currElem/PREDFND_TRT_DATE/@Value}"/>
                                              <SET Var="PREDFND_TRT_TXT" FromValue="{$currElem/PREDFND_TRT_TXT/@Value}"/>
                                              <SET Var="PREDFND_TRT_VAL_NAME" FromValue="{$currElem/PREDFND_TRT_VAL_NAME/@Value}"/>
                                              <SET Var="PREDFND_TRT_DESC" FromValue="{$currElem/PREDFND_TRT_DESC/@Value}"/>
                                              <SET Var="LANG_CODE" FromValue="{$currElem/LANG_CODE/@Value}"/>
                                              <IF_TEST Test="$PREDFND_TRT_DATE = null or $PREDFND_TRT_DATE = ''">
                                                <THEN>
                                                  <DO_DB_PERSIST Action="INSERT" DocumentName="PREDFND_TRT_VAL" AssignToVar="PREDFND_TRT_INS" ServiceName="BCM_MASTER" HandleException="true">
                                                    <TRT_NBR Value="{$TRT_NBR}"/>
                                                    <PREDFND_TRT_VAL_NBR Value="{$PREDFND_TRT_VAL_NBR}"/>
                                                    <PREDFND_TRT_TXT Value="{$PREDFND_TRT_TXT}"/>
                                                    <PREDFND_TRT_VAL_NAME Value="{$PREDFND_TRT_VAL_NAME}"/>
                                                    <PREDFND_TRT_DESC Value="{$PREDFND_TRT_DESC}"/>
                                                    <LANG_CODE Value="{$LANG_CODE}"/>
                                                  </DO_DB_PERSIST>
                                                </THEN>
                                                <ELSE>
                                                  <DO_DB_PERSIST Action="INSERT" DocumentName="PREDFND_TRT_VAL" AssignToVar="PREDFND_TRT_INS" ServiceName="BCM_MASTER" HandleException="true">
                                                    <TRT_NBR Value="{$TRT_NBR}"/>
                                                    <PREDFND_TRT_VAL_NBR Value="{$PREDFND_TRT_VAL_NBR}"/>
                                                    <PREDFND_TRT_DATE Value="{$PREDFND_TRT_DATE}"/>
                                                    <PREDFND_TRT_TXT Value="{$PREDFND_TRT_TXT}"/>
                                                    <PREDFND_TRT_VAL_NAME Value="{$PREDFND_TRT_VAL_NAME}"/>
                                                    <PREDFND_TRT_DESC Value="{$PREDFND_TRT_DESC}"/>
                                                    <LANG_CODE Value="{$LANG_CODE}"/>
                                                  </DO_DB_PERSIST>
                                                </ELSE>
                                              </IF_TEST>
                                              <IF_TEST Test="$PREDFND_TRT_INS/VALIDATION_RESULT/@Value = 'ERROR'">
                                                <THEN>
                                                  <SET Var="msg" FromValue="{$PREDFND_TRT_INS/VALIDATION_RESULT/ERROR_CODE/@Value}"/>
                                                </THEN>
                                                <ELSE>
                                                  <DO_DB_PERSIST DocumentName="LEGAL_ENT_TRAIT_MAP" Action="INSERT" ServiceName="BCM_MASTER" AssignToVar="INS_LE_TRT_MAP">
                                                    <LEGAL_ENT_NBR Value="{$LEGAL_ENT_Final}"/>
                                                    <TRT_NBR Value="{$TRT_NBR_Final}"/>
                                                    <TRT_NAME Value="{$TRT_NAME_Final}"/>
                                                    <PREDFND_TRT_VAL_NBR Value="{$PREDFND_TRT_VAL_NBR}"/>
                                                    <PREDFND_TRT_DESC Value="{$PREDFND_TRT_DESC}"/>
                                                  </DO_DB_PERSIST>
                                                </ELSE>
                                              </IF_TEST>
                                            </THEN>
                                          </ELSE>
                                        </IF_TEST>
                                      </FOR_EACH>
                                    </ELSE>
                                  </IF_TEST>
                                </THEN>
                                <ELSE>
                                  <IF_TEST Test="$count11!='0'">
                                    <THEN>
                                      <FOR_EACH CurrentElement="currElem" SelectList="$linkedPredfndTrt/PREDFND_TRT_VAL_IN_DUMMY">
                                        <SET Var="PREDFND_TRT_VAL_NBR" FromValue="{$currElem/PREDFND_TRT_VAL_NBR/@Value}"/>
                                        <SET Var="PREDFND_TRT_DESC" FromValue="{$currElem/PREDFND_TRT_TXT_LOCAL/@Value}"/>
                                        <EXECUTE_SQL_QUERY AssignToVar="TargetId" Value="LOCKING ROW FOR ACCESS SEL SYS_TARGET_ID  FROM PREDFND_TRT_VAL_IN_DUMMY where ID={$currElem/ID/@Value};"/>
                                        <SET Var="TGT_ID" FromValue="{$TargetId/SQL_RESULT/SYS_TARGET_ID/@Value}"/>
                                        <SET Var="chk_TRT_NBR" FromValue=""/>
                                        <SET Var="chk_TRT_NBR" FromValue="{$get_LE_TRT_MAP/LEGAL_ENT_TRAIT_MAP[PREDFND_TRT_VAL_NBR/@Value=$PREDFND_TRT_VAL_NBR/@Value]/TRT_NBR/@Value}"/>
                                        <IF_TEST Test="strlen(trim($chk_TRT_NBR)) = 0">
                                          <THEN>
                                            <SET Var="chk1" FromValue="Y"/>
                                          </THEN>
                                          <ELSE>
                                            <THEN>
                                              <SET Var="chk1" FromValue="N"/>
                                            </THEN>
                                          </ELSE>
                                        </IF_TEST>
                                        <IF_TEST Test="$chk1/@Value ='Y'">
                                          <THEN>
                                            <IF_TEST Test="$TGT_ID='99'">
                                              <THEN>
                                                <DO_DB_PERSIST DocumentName="LEGAL_ENT_TRAIT_MAP" Action="INSERT" ServiceName="BCM_MASTER" AssignToVar="INS_LE_TRT_MAP">
                                                  <LEGAL_ENT_NBR Value="{$LEGAL_ENT_Final}"/>
                                                  <TRT_NBR Value="{$TRT_NBR_Final}"/>
                                                  <TRT_NAME Value="{$TRT_NAME_Final}"/>
                                                  <PREDFND_TRT_VAL_NBR Value="{$PREDFND_TRT_VAL_NBR}"/>
                                                  <PREDFND_TRT_DESC Value="{$PREDFND_TRT_DESC}"/>
                                                </DO_DB_PERSIST>
                                              </THEN>
                                              <ELSE>
                                                <THEN>
                                                  <SET Var="TRT_NBR" FromValue="{$currElem/TRT_NBR/@Value}"/>
                                                  <SET Var="PREDFND_TRT_VAL_NBR" FromValue="{$currElem/PREDFND_TRT_VAL_NBR/@Value}"/>
                                                  <SET Var="PREDFND_TRT_DATE" FromValue="{$currElem/PREDFND_TRT_DATE/@Value}"/>
                                                  <SET Var="PREDFND_TRT_TXT" FromValue="{$currElem/PREDFND_TRT_TXT/@Value}"/>
                                                  <SET Var="PREDFND_TRT_VAL_NAME" FromValue="{$currElem/PREDFND_TRT_VAL_NAME/@Value}"/>
                                                  <SET Var="PREDFND_TRT_DESC" FromValue="{$currElem/PREDFND_TRT_DESC/@Value}"/>
                                                  <SET Var="LANG_CODE" FromValue="{$currElem/LANG_CODE/@Value}"/>
                                                  <IF_TEST Test="$PREDFND_TRT_DATE = null or $PREDFND_TRT_DATE = ''">
                                                    <THEN>
                                                      <DO_DB_PERSIST Action="INSERT" DocumentName="PREDFND_TRT_VAL" AssignToVar="PREDFND_TRT_INS" ServiceName="BCM_MASTER" HandleException="true">
                                                        <TRT_NBR Value="{$TRT_NBR}"/>
                                                        <PREDFND_TRT_VAL_NBR Value="{$PREDFND_TRT_VAL_NBR}"/>
                                                        <PREDFND_TRT_TXT Value="{$PREDFND_TRT_TXT}"/>
                                                        <PREDFND_TRT_VAL_NAME Value="{$PREDFND_TRT_VAL_NAME}"/>
                                                        <PREDFND_TRT_DESC Value="{$PREDFND_TRT_DESC}"/>
                                                        <LANG_CODE Value="{$LANG_CODE}"/>
                                                      </DO_DB_PERSIST>
                                                    </THEN>
                                                    <ELSE>
                                                      <DO_DB_PERSIST Action="INSERT" DocumentName="PREDFND_TRT_VAL" AssignToVar="PREDFND_TRT_INS" ServiceName="BCM_MASTER" HandleException="true">
                                                        <TRT_NBR Value="{$TRT_NBR}"/>
                                                        <PREDFND_TRT_VAL_NBR Value="{$PREDFND_TRT_VAL_NBR}"/>
                                                        <PREDFND_TRT_DATE Value="{$PREDFND_TRT_DATE}"/>
                                                        <PREDFND_TRT_TXT Value="{$PREDFND_TRT_TXT}"/>
                                                        <PREDFND_TRT_VAL_NAME Value="{$PREDFND_TRT_VAL_NAME}"/>
                                                        <PREDFND_TRT_DESC Value="{$PREDFND_TRT_DESC}"/>
                                                        <LANG_CODE Value="{$LANG_CODE}"/>
                                                      </DO_DB_PERSIST>
                                                    </ELSE>
                                                  </IF_TEST>
                                                  <IF_TEST Test="$PREDFND_TRT_INS/VALIDATION_RESULT/@Value = 'ERROR'">
                                                    <THEN>
                                                      <SET Var="msg" FromValue="{$PREDFND_TRT_INS/VALIDATION_RESULT/ERROR_CODE/@Value}"/>
                                                    </THEN>
                                                    <ELSE>
                                                      <DO_DB_PERSIST DocumentName="LEGAL_ENT_TRAIT_MAP" Action="INSERT" ServiceName="BCM_MASTER" AssignToVar="INS_LE_TRT_MAP">
                                                        <LEGAL_ENT_NBR Value="{$LEGAL_ENT_Final}"/>
                                                        <TRT_NBR Value="{$TRT_NBR_Final}"/>
                                                        <TRT_NAME Value="{$TRT_NAME_Final}"/>
                                                        <PREDFND_TRT_VAL_NBR Value="{$PREDFND_TRT_VAL_NBR}"/>
                                                        <PREDFND_TRT_DESC Value="{$PREDFND_TRT_DESC}"/>
                                                      </DO_DB_PERSIST>
                                                    </ELSE>
                                                  </IF_TEST>
                                                </THEN>
                                              </ELSE>
                                            </IF_TEST>
                                          </THEN>
                                          <ELSE/>
                                        </IF_TEST>
                                      </FOR_EACH>
                                    </THEN>
                                  </IF_TEST>
                                </ELSE>
                              </IF_TEST>
                              <MODIFY_DOC_SMART Name="TRT_IN_DUMMY" ServiceName="BCM_MASTER" AssignToVar="UPD_TRT_IN_DUMMY">
                                <DOCUMENT_CONTEXT>
                                  <ID Value="{$ID_Final/@Value}"/>
                                </DOCUMENT_CONTEXT>
                                <UPDATE_PROPERTIES>
                                  <TRT_NBR Value="{$TRT_NBR_Final/@Value}"/>
                                  <TRT_NAME_LOCAL Value="{$TRT_NAME_Final/@Value}"/>
                                  <STATUS Value="APPROVED"/>
                                </UPDATE_PROPERTIES>
                              </MODIFY_DOC_SMART>
                              <MODIFY_DOC_SMART Name="TRT_IN" ServiceName="BCM_MASTER" AssignToVar="UPD_TRT_IN">
                                <DOCUMENT_CONTEXT>
                                  <ID Value="{$ID_Final/@Value}"/>
                                </DOCUMENT_CONTEXT>
                                <UPDATE_PROPERTIES>
                                  <TRT_NBR Value="{$TRT_NBR_Final/@Value}"/>
                                  <TRT_NAME_LOCAL Value="{$TRT_NAME_Final/@Value}"/>
                                </UPDATE_PROPERTIES>
                              </MODIFY_DOC_SMART>
                              <FOR_EACH CurrentElement="currElem" SelectList="$linkedPredfndTrt/PREDFND_TRT_VAL_IN_DUMMY">
                                <SET Var="PREDFND_TRT_VAL_NBR" FromValue="{$currElem/PREDFND_TRT_VAL_NBR/@Value}"/>
                                <SET Var="PREDFND_TRT_TXT" FromValue="{$currElem/PREDFND_TRT_TXT_LOCAL/@Value}"/>
                                <SET Var="PREDFND_TRT_VAL_NAME" FromValue="{$currElem/PREDFND_TRT_TXT/@Value}"/>
                                <SET Var="PRE_ID" FromValue="{$currElem/ID/@Value}"/>
                                <DO_DB_PERSIST DocumentName="PREDFND_TRT_VAL_IN_DUMMY" ServiceName="BCM_MASTER" Action="UPDATE" AssignToVar="UPD_TRT_IN_DUMMY">
                                  <DOCUMENT_CONTEXT>
                                    <ID Value="{$PRE_ID/@Value}"/>
                                    <TRT_NAME Value="{$TRT_NAME_Final/@Value}"/>
                                  </DOCUMENT_CONTEXT>
                                  <UPDATE_PROPERTIES>
                                    <STATUS Value="APPROVED"/>
                                  </UPDATE_PROPERTIES>
                                </DO_DB_PERSIST>
                              </FOR_EACH>
                            </THEN>
                            <ELSE>
                              <THEN/>
                            </ELSE>
                          </IF_TEST>
                        </THEN>
                      </IF_TEST>
                      <IF_TEST Test=" $MKTNG_PGM_Final!=''">
                        <THEN>
                          <GET_DOC_SMART Name="MKTNG_PGM_TRAIT_MAP" AssignToVar="get_MP_TRT_MAP" ServiceName="BCM_MASTER" HandleException="true">
                            <MKTNG_PGM_NBR Value="{$MKTNG_PGM_Final/@Value}"/>
                            <TRT_NBR Value="{$TRT_NBR_Final/@Value}"/>
                            <TRT_NAME Value="{$TRT_NAME_Final/@Value}"/>
                          </GET_DOC_SMART>
                          <SET Var="count2" FromValue="{count($get_MP_TRT_MAP/MKTNG_PGM_TRAIT_MAP)}"/>
                          <SET Var="count11" FromValue="{count($linkedPredfndTrt/PREDFND_TRT_VAL_IN_DUMMY)}"/>
                          <SET Var="count12" FromValue="{count($linkedPredfndTrt/PREDFND_TRT_VAL_IN_DUMMY/PREDFND_TRT_VAL_NBR[@Value='' or @Value=null])}"/>
                          <IF_TEST Test="$count12='0'">
                            <THEN>
                              <IF_TEST Test="$count2='0'">
                                <THEN>
                                  <IF_TEST Test="$count11='0'">
                                    <THEN>
                                      <DO_DB_PERSIST DocumentName="MKTNG_PGM_TRAIT_MAP" Action="INSERT" ServiceName="BCM_MASTER" AssignToVar="INS_LE_TRT_MAP">
                                        <MKTNG_PGM_NBR Value="{$MKTNG_PGM_Final}"/>
                                        <TRT_NBR Value="{$TRT_NBR_Final}"/>
                                        <TRT_NAME Value="{$TRT_NAME_Final}"/>
                                        <PREDFND_TRT_VAL_NBR Value="0"/>
                                      </DO_DB_PERSIST>
                                    </THEN>
                                    <ELSE>
                                      <FOR_EACH CurrentElement="currElem" SelectList="$linkedPredfndTrt/PREDFND_TRT_VAL_IN_DUMMY">
                                        <SET Var="PREDFND_TRT_VAL_NBR" FromValue="{$currElem/PREDFND_TRT_VAL_NBR/@Value}"/>
                                        <SET Var="PREDFND_TRT_DESC" FromValue="{$currElem/PREDFND_TRT_TXT_LOCAL/@Value}"/>
                                        <EXECUTE_SQL_QUERY AssignToVar="TargetId" Value="LOCKING ROW FOR ACCESS SEL SYS_TARGET_ID  FROM PREDFND_TRT_VAL_IN_DUMMY where ID={$currElem/ID/@Value};"/>
                                        <SET Var="TGT_ID" FromValue="{$TargetId/SQL_RESULT/SYS_TARGET_ID/@Value}"/>
                                        <IF_TEST Test="$TGT_ID='99'">
                                          <THEN>
                                            <DO_DB_PERSIST DocumentName="MKTNG_PGM_TRAIT_MAP" Action="INSERT" ServiceName="BCM_MASTER" AssignToVar="INS_LE_TRT_MAP">
                                              <MKTNG_PGM_NBR Value="{$MKTNG_PGM_Final}"/>
                                              <TRT_NBR Value="{$TRT_NBR_Final}"/>
                                              <TRT_NAME Value="{$TRT_NAME_Final}"/>
                                              <PREDFND_TRT_VAL_NBR Value="{$PREDFND_TRT_VAL_NBR}"/>
                                              <PREDFND_TRT_DESC Value="{$PREDFND_TRT_DESC}"/>
                                              <CNSMR_CLCT_IND Value="{$CNSMR_CLCT_IND_Final}"/>
                                            </DO_DB_PERSIST>
                                          </THEN>
                                          <ELSE>
                                            <THEN>
                                              <SET Var="TRT_NBR" FromValue="{$currElem/TRT_NBR/@Value}"/>
                                              <SET Var="PREDFND_TRT_VAL_NBR" FromValue="{$currElem/PREDFND_TRT_VAL_NBR/@Value}"/>
                                              <SET Var="PREDFND_TRT_DATE" FromValue="{$currElem/PREDFND_TRT_DATE/@Value}"/>
                                              <SET Var="PREDFND_TRT_TXT" FromValue="{$currElem/PREDFND_TRT_TXT/@Value}"/>
                                              <SET Var="PREDFND_TRT_VAL_NAME" FromValue="{$currElem/PREDFND_TRT_VAL_NAME/@Value}"/>
                                              <SET Var="PREDFND_TRT_DESC" FromValue="{$currElem/PREDFND_TRT_DESC/@Value}"/>
                                              <SET Var="LANG_CODE" FromValue="{$currElem/LANG_CODE/@Value}"/>
                                              <IF_TEST Test="$PREDFND_TRT_DATE = null or $PREDFND_TRT_DATE = ''">
                                                <THEN>
                                                  <DO_DB_PERSIST Action="INSERT" DocumentName="PREDFND_TRT_VAL" AssignToVar="PREDFND_TRT_INS" ServiceName="BCM_MASTER" HandleException="true">
                                                    <TRT_NBR Value="{$TRT_NBR}"/>
                                                    <PREDFND_TRT_VAL_NBR Value="{$PREDFND_TRT_VAL_NBR}"/>
                                                    <PREDFND_TRT_TXT Value="{$PREDFND_TRT_TXT}"/>
                                                    <PREDFND_TRT_VAL_NAME Value="{$PREDFND_TRT_VAL_NAME}"/>
                                                    <PREDFND_TRT_DESC Value="{$PREDFND_TRT_DESC}"/>
                                                    <LANG_CODE Value="{$LANG_CODE}"/>
                                                  </DO_DB_PERSIST>
                                                </THEN>
                                                <ELSE>
                                                  <DO_DB_PERSIST Action="INSERT" DocumentName="PREDFND_TRT_VAL" AssignToVar="PREDFND_TRT_INS" ServiceName="BCM_MASTER" HandleException="true">
                                                    <TRT_NBR Value="{$TRT_NBR}"/>
                                                    <PREDFND_TRT_VAL_NBR Value="{$PREDFND_TRT_VAL_NBR}"/>
                                                    <PREDFND_TRT_DATE Value="{$PREDFND_TRT_DATE}"/>
                                                    <PREDFND_TRT_TXT Value="{$PREDFND_TRT_TXT}"/>
                                                    <PREDFND_TRT_VAL_NAME Value="{$PREDFND_TRT_VAL_NAME}"/>
                                                    <PREDFND_TRT_DESC Value="{$PREDFND_TRT_DESC}"/>
                                                    <LANG_CODE Value="{$LANG_CODE}"/>
                                                  </DO_DB_PERSIST>
                                                </ELSE>
                                              </IF_TEST>
                                              <IF_TEST Test="$PREDFND_TRT_INS/VALIDATION_RESULT/@Value = 'ERROR'">
                                                <THEN>
                                                  <SET Var="msg" FromValue="{$PREDFND_TRT_INS/VALIDATION_RESULT/ERROR_CODE/@Value}"/>
                                                </THEN>
                                                <ELSE>
                                                  <DO_DB_PERSIST DocumentName="MKTNG_PGM_TRAIT_MAP" Action="INSERT" ServiceName="BCM_MASTER" AssignToVar="INS_LE_TRT_MAP">
                                                    <MKTNG_PGM_NBR Value="{$MKTNG_PGM_Final}"/>
                                                    <TRT_NBR Value="{$TRT_NBR_Final}"/>
                                                    <TRT_NAME Value="{$TRT_NAME_Final}"/>
                                                    <PREDFND_TRT_VAL_NBR Value="{$PREDFND_TRT_VAL_NBR}"/>
                                                    <PREDFND_TRT_DESC Value="{$PREDFND_TRT_DESC}"/>
                                                    <CNSMR_CLCT_IND Value="{$CNSMR_CLCT_IND_Final}"/>
                                                  </DO_DB_PERSIST>
                                                </ELSE>
                                              </IF_TEST>
                                            </THEN>
                                          </ELSE>
                                        </IF_TEST>
                                      </FOR_EACH>
                                    </ELSE>
                                  </IF_TEST>
                                </THEN>
                                <ELSE>
                                  <IF_TEST Test="$count11!='0'">
                                    <THEN>
                                      <FOR_EACH CurrentElement="currElem" SelectList="$linkedPredfndTrt/PREDFND_TRT_VAL_IN_DUMMY">
                                        <SET Var="PREDFND_TRT_VAL_NBR" FromValue="{$currElem/PREDFND_TRT_VAL_NBR/@Value}"/>
                                        <SET Var="PREDFND_TRT_DESC" FromValue="{$currElem/PREDFND_TRT_TXT_LOCAL/@Value}"/>
                                        <EXECUTE_SQL_QUERY AssignToVar="TargetId" Value="LOCKING ROW FOR ACCESS SEL SYS_TARGET_ID  FROM PREDFND_TRT_VAL_IN_DUMMY where ID={$currElem/ID/@Value};"/>
                                        <SET Var="TGT_ID" FromValue="{$TargetId/SQL_RESULT/SYS_TARGET_ID/@Value}"/>
                                        <SET Var="chk_TRT_NBR" FromValue=""/>
                                        <SET Var="chk_TRT_NBR" FromValue="{$get_MP_TRT_MAP/MKTNG_PGM_TRAIT_MAP[PREDFND_TRT_VAL_NBR/@Value=$PREDFND_TRT_VAL_NBR/@Value]/TRT_NBR/@Value}"/>
                                        <IF_TEST Test="strlen(trim($chk_TRT_NBR)) = 0">
                                          <THEN>
                                            <SET Var="chk1" FromValue="Y"/>
                                          </THEN>
                                          <ELSE>
                                            <THEN>
                                              <SET Var="chk1" FromValue="N"/>
                                            </THEN>
                                          </ELSE>
                                        </IF_TEST>
                                        <IF_TEST Test="$chk1/@Value ='Y' ">
                                          <THEN>
                                            <IF_TEST Test="$TGT_ID='99'">
                                              <THEN>
                                                <DO_DB_PERSIST DocumentName="MKTNG_PGM_TRAIT_MAP" Action="INSERT" ServiceName="BCM_MASTER" AssignToVar="INS_LE_TRT_MAP">
                                                  <MKTNG_PGM_NBR Value="{$MKTNG_PGM_Final}"/>
                                                  <TRT_NBR Value="{$TRT_NBR_Final}"/>
                                                  <TRT_NAME Value="{$TRT_NAME_Final}"/>
                                                  <PREDFND_TRT_VAL_NBR Value="{$PREDFND_TRT_VAL_NBR}"/>
                                                  <PREDFND_TRT_DESC Value="{$PREDFND_TRT_DESC}"/>
                                                  <CNSMR_CLCT_IND Value="{$CNSMR_CLCT_IND_Final}"/>
                                                </DO_DB_PERSIST>
                                              </THEN>
                                              <ELSE>
                                                <THEN>
                                                  <SET Var="TRT_NBR" FromValue="{$currElem/TRT_NBR/@Value}"/>
                                                  <SET Var="PREDFND_TRT_VAL_NBR" FromValue="{$currElem/PREDFND_TRT_VAL_NBR/@Value}"/>
                                                  <SET Var="PREDFND_TRT_DATE" FromValue="{$currElem/PREDFND_TRT_DATE/@Value}"/>
                                                  <SET Var="PREDFND_TRT_TXT" FromValue="{$currElem/PREDFND_TRT_TXT/@Value}"/>
                                                  <SET Var="PREDFND_TRT_VAL_NAME" FromValue="{$currElem/PREDFND_TRT_VAL_NAME/@Value}"/>
                                                  <SET Var="PREDFND_TRT_DESC" FromValue="{$currElem/PREDFND_TRT_DESC/@Value}"/>
                                                  <SET Var="LANG_CODE" FromValue="{$currElem/LANG_CODE/@Value}"/>
                                                  <IF_TEST Test="$PREDFND_TRT_DATE = null or $PREDFND_TRT_DATE = ''">
                                                    <THEN>
                                                      <DO_DB_PERSIST Action="INSERT" DocumentName="PREDFND_TRT_VAL" AssignToVar="PREDFND_TRT_INS" ServiceName="BCM_MASTER" HandleException="true">
                                                        <TRT_NBR Value="{$TRT_NBR}"/>
                                                        <PREDFND_TRT_VAL_NBR Value="{$PREDFND_TRT_VAL_NBR}"/>
                                                        <PREDFND_TRT_TXT Value="{$PREDFND_TRT_TXT}"/>
                                                        <PREDFND_TRT_VAL_NAME Value="{$PREDFND_TRT_VAL_NAME}"/>
                                                        <PREDFND_TRT_DESC Value="{$PREDFND_TRT_DESC}"/>
                                                        <LANG_CODE Value="{$LANG_CODE}"/>
                                                      </DO_DB_PERSIST>
                                                    </THEN>
                                                    <ELSE>
                                                      <DO_DB_PERSIST Action="INSERT" DocumentName="PREDFND_TRT_VAL" AssignToVar="PREDFND_TRT_INS" ServiceName="BCM_MASTER" HandleException="true">
                                                        <TRT_NBR Value="{$TRT_NBR}"/>
                                                        <PREDFND_TRT_VAL_NBR Value="{$PREDFND_TRT_VAL_NBR}"/>
                                                        <PREDFND_TRT_DATE Value="{$PREDFND_TRT_DATE}"/>
                                                        <PREDFND_TRT_TXT Value="{$PREDFND_TRT_TXT}"/>
                                                        <PREDFND_TRT_VAL_NAME Value="{$PREDFND_TRT_VAL_NAME}"/>
                                                        <PREDFND_TRT_DESC Value="{$PREDFND_TRT_DESC}"/>
                                                        <LANG_CODE Value="{$LANG_CODE}"/>
                                                      </DO_DB_PERSIST>
                                                    </ELSE>
                                                  </IF_TEST>
                                                  <IF_TEST Test="$PREDFND_TRT_INS/VALIDATION_RESULT/@Value = 'ERROR'">
                                                    <THEN>
                                                      <SET Var="msg" FromValue="{$PREDFND_TRT_INS/VALIDATION_RESULT/ERROR_CODE/@Value}"/>
                                                    </THEN>
                                                    <ELSE>
                                                      <DO_DB_PERSIST DocumentName="MKTNG_PGM_TRAIT_MAP" Action="INSERT" ServiceName="BCM_MASTER" AssignToVar="INS_LE_TRT_MAP">
                                                        <MKTNG_PGM_NBR Value="{$MKTNG_PGM_Final}"/>
                                                        <TRT_NBR Value="{$TRT_NBR_Final}"/>
                                                        <TRT_NAME Value="{$TRT_NAME_Final}"/>
                                                        <PREDFND_TRT_VAL_NBR Value="{$PREDFND_TRT_VAL_NBR}"/>
                                                        <PREDFND_TRT_DESC Value="{$PREDFND_TRT_DESC}"/>
                                                        <CNSMR_CLCT_IND Value="{$CNSMR_CLCT_IND_Final}"/>
                                                      </DO_DB_PERSIST>
                                                    </ELSE>
                                                  </IF_TEST>
                                                </THEN>
                                              </ELSE>
                                            </IF_TEST>
                                          </THEN>
                                          <ELSE/>
                                        </IF_TEST>
                                      </FOR_EACH>
                                    </THEN>
                                  </IF_TEST>
                                </ELSE>
                              </IF_TEST>
                              <MODIFY_DOC_SMART Name="TRT_IN_DUMMY" ServiceName="BCM_MASTER" AssignToVar="UPD_TRT_IN_DUMMY">
                                <DOCUMENT_CONTEXT>
                                  <ID Value="{$ID_Final/@Value}"/>
                                </DOCUMENT_CONTEXT>
                                <UPDATE_PROPERTIES>
                                  <TRT_NBR Value="{$TRT_NBR_Final/@Value}"/>
                                  <TRT_NAME_LOCAL Value="{$TRT_NAME_Final/@Value}"/>
                                  <STATUS Value="APPROVED"/>
                                </UPDATE_PROPERTIES>
                              </MODIFY_DOC_SMART>
                              <MODIFY_DOC_SMART Name="TRT_IN" ServiceName="BCM_MASTER" AssignToVar="UPD_TRT_IN">
                                <DOCUMENT_CONTEXT>
                                  <ID Value="{$ID_Final/@Value}"/>
                                </DOCUMENT_CONTEXT>
                                <UPDATE_PROPERTIES>
                                  <TRT_NBR Value="{$TRT_NBR_Final/@Value}"/>
                                  <TRT_NAME_LOCAL Value="{$TRT_NAME_Final/@Value}"/>
                                </UPDATE_PROPERTIES>
                              </MODIFY_DOC_SMART>
                              <FOR_EACH CurrentElement="currElem" SelectList="$linkedPredfndTrt/PREDFND_TRT_VAL_IN_DUMMY">
                                <SET Var="PREDFND_TRT_VAL_NBR" FromValue="{$currElem/PREDFND_TRT_VAL_NBR/@Value}"/>
                                <SET Var="PREDFND_TRT_TXT" FromValue="{$currElem/PREDFND_TRT_TXT_LOCAL/@Value}"/>
                                <SET Var="PREDFND_TRT_VAL_NAME" FromValue="{$currElem/PREDFND_TRT_TXT/@Value}"/>
                                <SET Var="PRE_ID" FromValue="{$currElem/ID/@Value}"/>
                                <DO_DB_PERSIST DocumentName="PREDFND_TRT_VAL_IN_DUMMY" ServiceName="BCM_MASTER" Action="UPDATE" AssignToVar="UPD_TRT_IN_DUMMY">
                                  <DOCUMENT_CONTEXT>
                                    <ID Value="{$PRE_ID/@Value}"/>
                                    <TRT_NAME Value="{$TRT_NAME_Final/@Value}"/>
                                  </DOCUMENT_CONTEXT>
                                  <UPDATE_PROPERTIES>
                                    <STATUS Value="APPROVED"/>
                                  </UPDATE_PROPERTIES>
                                </DO_DB_PERSIST>
                              </FOR_EACH>
                            </THEN>
                            <ELSE>
                              <THEN/>
                            </ELSE>
                          </IF_TEST>
                        </THEN>
                      </IF_TEST>
                      <!--<DO_DB_PERSIST DocumentName="TRT_IN_DUMMY" ServiceName="BCM_MASTER" Action="UPDATE" AssignToVar="UPD_TRT_IN_DUMMY">
                        <DOCUMENT_CONTEXT>
                          <ID Value="{$ID_Final/@Value}"/>
                          <TRT_NAME_LOCAL Value="{$TRT_NAME_Final/@Value}"/>
                        </DOCUMENT_CONTEXT>
                        <UPDATE_PROPERTIES>
                          <STATUS Value="APPROVED"/>
                        </UPDATE_PROPERTIES>
                      </DO_DB_PERSIST>-->
                      <!-- <MODIFY_DOC_SMART Name="TRT_IN_DUMMY" ServiceName="BCM_MASTER" AssignToVar="UPD_TRT_IN_DUMMY">
                        <DOCUMENT_CONTEXT>
                          <ID Value="{$ID_Final/@Value}"/>
                        </DOCUMENT_CONTEXT>
                        <UPDATE_PROPERTIES>
                          <TRT_NBR Value="{$TRT_NBR_Final/@Value}"/>
                          <TRT_NAME_LOCAL Value="{$TRT_NAME_Final/@Value}"/>
                          <STATUS Value="APPROVED"/>
                        </UPDATE_PROPERTIES>
                      </MODIFY_DOC_SMART>
                      <MODIFY_DOC_SMART Name="TRT_IN" ServiceName="BCM_MASTER" AssignToVar="UPD_TRT_IN">
                        <DOCUMENT_CONTEXT>
                          <ID Value="{$ID_Final/@Value}"/>
                        </DOCUMENT_CONTEXT>
                        <UPDATE_PROPERTIES>
                          <TRT_NBR Value="{$TRT_NBR_Final/@Value}"/>
                          <TRT_NAME_LOCAL Value="{$TRT_NAME_Final/@Value}"/>
                        </UPDATE_PROPERTIES>
                      </MODIFY_DOC_SMART>
                      <FOR_EACH CurrentElement="currElem" SelectList="$linkedPredfndTrt/PREDFND_TRT_VAL_IN_DUMMY">
                        <SET Var="PREDFND_TRT_VAL_NBR" FromValue="{$currElem/PREDFND_TRT_VAL_NBR/@Value}"/>
                        <SET Var="PREDFND_TRT_TXT" FromValue="{$currElem/PREDFND_TRT_TXT_LOCAL/@Value}"/>
                        <SET Var="PREDFND_TRT_VAL_NAME" FromValue="{$currElem/PREDFND_TRT_TXT/@Value}"/>
                        <SET Var="PRE_ID" FromValue="{$currElem/ID/@Value}"/>
                        <DO_DB_PERSIST DocumentName="PREDFND_TRT_VAL_IN_DUMMY" ServiceName="BCM_MASTER" Action="UPDATE" AssignToVar="UPD_TRT_IN_DUMMY">
                          <DOCUMENT_CONTEXT>
                            <ID Value="{$PRE_ID/@Value}"/>
                            <TRT_NAME Value="{$TRT_NAME_Final/@Value}"/>
                          </DOCUMENT_CONTEXT>
                          <UPDATE_PROPERTIES>
                            <STATUS Value="APPROVED"/>
                          </UPDATE_PROPERTIES>
                        </DO_DB_PERSIST>
                      </FOR_EACH>-->
                    </THEN>
                  </IF_TEST>
                  <IF_TEST Test="$count12 > 0">
                    <THEN>
                      <REQUEST Name="getUser" ServiceName="USER_SECURITY" AssignToVar="creatorDetails">
                        <ID Value="{$userId}"/>
                      </REQUEST>
                      <REQUEST Name="sendEmail" ServiceName="OMS_MESSAGE_SERVICE" Synchronous="no">
                        <SUBJECT Value="Approval can't be processed as Pre Defined Trait Number can't be NULL !!!"/>
                        <TO_ADDRS>
                          <TO_ADDR Value="{$creatorDetails/USER_PROFILE/EMAIL_ADDRESS/@Value}"/>
                        </TO_ADDRS>
                        <FORMAT Value="text/html"/>
                        <MESSAGE>
                          <DATA Value="Approval can't be processed as Pre Defined Trait Number can't be NULL !!!"/>
                        </MESSAGE>
                      </REQUEST>
                      <SET Var="DocumentName" FromValue="TRT_IN"/>
                      <!--<REQUEST Name="sendEmailNotification" AssignToVar="respEmail" ServiceName="BCM_MASTER" HandleException="true">
                        <TO_ADDRS>
                          <TO_ADDR Value="{$userId/@Value}"/>
                        </TO_ADDRS>
                        <SUBJECT Value="Approval can't be processed as Pre Defined Trait Number can't be NULL !!!"/>
                        <FORMAT Value="text/html"/>
                        <MESSAGE>
                          <DATA Value="Approval can't be processed as Pre Defined Trait Number can't be NULL. Please request again ."/>
                        </MESSAGE>
                      </REQUEST>-->
                    </THEN>
                    <ELSE>
                      <THEN>
                        <REQUEST Name="ACTIVATE_APPROVAL_NODE" AssignToVar="activateAppNodeResp">
                          <Result Value="APPROVED"/>
                          <ID Value="{$thisParam/selected_ID/@Value}"/>
                          <InstanceDocID Value="{$curAlert/Alert/InstanceDocID/@Value}"/>
                          <InstanceType Value="{$curAlert/Alert/InstanceType/@Value}"/>
                          <Comment Value="{$thisParam/Comment/@Value}"/>
                          <messageType Value="{$curAlert/Alert/InstanceType/@Value}"/>
                          <EMAIL_NODE_TYPE Value="{$curAlert/Alert/InstanceMode/@Value}"/>
                          <TokenId Value="{$curAlert/Alert/TokenID/@Value}"/>
                        </REQUEST>
                        <SET Var="DocumentName" FromValue="{$activateAppNodeResp/InstanceType/@Value}"/>
                      </THEN>
                    </ELSE>
                  </IF_TEST>
                  <ADD_CHILDREN DocVar="thisParam" FromDocVar="activateAppNodeResp"/>
                  <SET DocVar="thisParam" Var="EMAIL_NODE_TYPE" FromValue="{$curAlert/Alert/InstanceMode/@Value}"/>
                  <SET DocVar="thisParam" Var="messageType" FromValue="{$curAlert/Alert/InstanceType/@Value}"/>
                  <GET_DOCUMENT AssignToVar="tempAlert" Name="Alert" ServiceName="APPROVAL" ReturnRowCount="yes" DirtyRead="true">
                    <SELECT>
                      <ApproverID/>
                    </SELECT>
                    <Status Value="A"/>
                    <InstanceDocID Value="{$thisParam/selected_ID/@Value}"/>
                  </GET_DOCUMENT>
                  <GET_DOCUMENT Name="DocumentInstance" AssignToVar="DocumentInstance" ServiceName="APPROVAL" DirtyRead="true">
                    <AlertID Value="{$thisParam/selected_ID/@Value}"/>
                  </GET_DOCUMENT>
                  <GET_DOCUMENT Name="ApprovalHistory" AssignToVar="ApprovalHistory" ServiceName="APPROVAL" DirtyRead="true">
                    <InstanceDocID Value="{$thisParam/selected_ID/@Value}"/>
                  </GET_DOCUMENT>
                  <GET_DOCUMENT AssignToVar="ApprovalGroups" Name="Approval_Groups" ReturnRowCount="yes" ServiceName="APPROVAL" DirtyRead="true">
                    <OR>
                      <ACTION_TYPE Value="{$DocumentInstance/DocumentInstance/DocumentAction/@Value}"/>
                      <ACTION_TYPE Value="ALL"/>
                    </OR>
                    <EVENT_NAME Value="{$DocumentInstance/DocumentInstance/DocumentType/@Value}"/>
                    <IS_ACTIVE Value="True"/>
                  </GET_DOCUMENT>
                  <REQUEST Name="getUser" ServiceName="USER_SECURITY" AssignToVar="creatorDetails">
                    <ID Value="{$DocumentInstance/DocumentInstance/SubmitByID/@Value}"/>
                  </REQUEST>
                  <REQUEST Name="getUser" ServiceName="USER_SECURITY" AssignToVar="cur_approver_Details">
                    <ID Value="{$userId/@Value}"/>
                  </REQUEST>
                  <SET Var="approvers" FromValue=""/>
                  <SET Var="ctr" FromValue="0"/>
                  <SET Var="present" FromValue="false"/>
                  <GET_DOCUMENT AssignToVar="existingApprovers" Name="Approvals" ReturnRowCount="yes" ServiceName="APPROVAL" DirtyRead="true">
                    <SELECT>
                      <APPROVER_NAME/>
                    </SELECT>
                    <ORDER_BY>
                      <EXECUTION_ORDER Sort="{$sortOrder}"/>
                    </ORDER_BY>
                    <APPROVAL_GROUP_ID Value="{$ApprovalGroups/Approval_Groups/SEQID/@Value}"/>
                  </GET_DOCUMENT>
                  <IF_TEST Test="$curAlert/Alert/NodeName/@Value = 'serial_approval_node'">
                    <THEN>
                      <SET Var="ApprovalType" FromValue="Serial"/>
                    </THEN>
                    <ELSE>
                      <SET Var="ApprovalType" FromValue="Parallel"/>
                    </ELSE>
                  </IF_TEST>
                  <REQUEST Name="GetApprovalUserType" ServiceName="ADMIN_UI" AssignToVar="ApprovalUserType">
                    <EVENT_NAME Value="{$thisParam/InstanceType/@Value}"/>
                    <ACTION_TYPE Value="{$thisParam/RESPONSE/EMAIL_NODE_TYPE/@Value}"/>
                  </REQUEST>
                  <SET Var="msg" FromValue="User Group Based"/>
                  <FOR_EACH SelectList="$existingApprovers/Approvals" CurrentElement="currAct">
                    <FOR_EACH SelectList="$ApprovalHistory/ApprovalHistory" CurrentElement="currApprover">
                      <IF_TEST Test="$ApprovalUserType/ApprovalUserType/@Value = $msg">
                        <THEN>
                          <EXECUTE_SQL_QUERY Value="LOCKING ROW FOR ACCESS SELECT ID FROM USER_PROFILE_T WHERE LOGIN_NAME = '{$currApprover/ApproverID/@Value}'" AssignToVar="User"/>
                          <EXECUTE_SQL_QUERY Value="LOCKING ROW FOR ACCESS SELECT USER_GRP_ID FROM USER_UG_RELATION WHERE USER_ID = '{$User/SQL_RESULT/ID/@Value}'" AssignToVar="groupName"/>
                          <IF_TEST Test="$currAct/APPROVER_NAME/@Value = $groupName/SQL_RESULT/USER_GRP_ID/@Value">
                            <THEN>
                              <SET Var="present" FromValue="true"/>
                            </THEN>
                          </IF_TEST>
                        </THEN>
                        <ELSE>
                          <IF_TEST Test="$currAct/APPROVER_NAME/@Value = $currApprover/ApproverID/@Value">
                            <THEN>
                              <SET Var="present" FromValue="true"/>
                            </THEN>
                          </IF_TEST>
                        </ELSE>
                      </IF_TEST>
                    </FOR_EACH>
                    <IF_TEST Test="$present = 'false'">
                      <THEN>
                        <SET Var="ctr" FromValue="{int($ctr)+1}"/>
                        <SET Var="approvers" FromValue="{$approvers}{int($ctr)}. {$currAct/APPROVER_NAME/@Value}&lt;br/>"/>
                      </THEN>
                    </IF_TEST>
                    <SET Var="present" FromValue="false"/>
                  </FOR_EACH>
                  <!-- code moved as part of Rel 5.7.3 starts -->
                  <!--Code written by Ankita Sadhwani Starts-->
                  <!--Insert Values in Subscription tables if record is Accepted-->
                  <IF_TEST Test="$DocumentName/@Value= 'DATA_SRCE_SUBS_OPT_IN'">
                    <THEN>
                      <FOR_EACH SelectList="$getAllRecords/DocumentAttributes" CurrentElement="currElem">
                        <IF_TEST Test="$currElem/AttributeID/@Value= 'MKTNG_PGM_NBR'">
                          <THEN>
                            <SET Var="MKTNG_PGM_NBR_6" FromValue="{$currElem/AttributeValue/@Value}"/>
                          </THEN>
                          <ELSE>
                            <IF_TEST Test="$currElem/AttributeID/@Value ='LEGAL_ENT_NBR'">
                              <THEN>
                                <SET Var="LEGAL_ENT_NBR_6" FromValue="{$currElem/AttributeValue/@Value}"/>
                              </THEN>
                              <ELSE>
                                <IF_TEST Test="$currElem/AttributeID/@Value= 'DATA_SRCE_NBR'">
                                  <THEN>
                                    <SET Var="DATA_SRCE_NBR_6" FromValue="{$currElem/AttributeValue/@Value}"/>
                                  </THEN>
                                  <ELSE>
                                    <IF_TEST Test="$currElem/AttributeID/@Value= 'CR_NUM'">
                                      <THEN>
                                        <SET Var="CR_NUM_6" FromValue="{$currElem/AttributeValue/@Value}"/>
                                      </THEN>
                                      <ELSE>
                                        <IF_TEST Test="$currElem/AttributeID/@Value= 'CR_DESC'">
                                          <THEN>
                                            <SET Var="CR_DESC_6" FromValue="{$currElem/AttributeValue/@Value}"/>
                                          </THEN>
                                          <ELSE>
                                            <IF_TEST Test="$currElem/AttributeID/@Value= 'ENG_TXT'">
                                              <THEN>
                                                <SET Var="ENG_TXT_6" FromValue="{$currElem/AttributeValue/@Value}"/>
                                              </THEN>
                                              <ELSE>
                                                <IF_TEST Test="$currElem/AttributeID/@Value= 'LOCAL_TXT'">
                                                  <THEN>
                                                    <SET Var="LOCAL_TXT_6" FromValue="{$currElem/AttributeValue/@Value}"/>
                                                  </THEN>
                                                  <ELSE>
                                                    <IF_TEST Test="$currElem/AttributeID/@Value= 'BRAND_CODE'">
                                                      <THEN>
                                                        <SET Var="BRAND_CODE_6" FromValue="{$currElem/AttributeValue/@Value}"/>
                                                      </THEN>
                                                      <ELSE>
                                                        <IF_TEST Test="$currElem/AttributeID/@Value= 'COMMENTS'">
                                                          <THEN>
                                                            <SET Var="COMMENTS_6" FromValue="{$currElem/AttributeValue/@Value}"/>
                                                          </THEN>
                                                          <ELSE>
                                                            <IF_TEST Test="$currElem/AttributeID/@Value= 'IN_id'">
                                                              <THEN>
                                                                <SET Var="IN_id_6" FromValue="{$currElem/AttributeValue/@Value}"/>
                                                              </THEN>
                                                            </IF_TEST>
                                                          </ELSE>
                                                        </IF_TEST>
                                                      </ELSE>
                                                    </IF_TEST>
                                                  </ELSE>
                                                </IF_TEST>
                                              </ELSE>
                                            </IF_TEST>
                                          </ELSE>
                                        </IF_TEST>
                                      </ELSE>
                                    </IF_TEST>
                                  </ELSE>
                                </IF_TEST>
                              </ELSE>
                            </IF_TEST>
                          </ELSE>
                        </IF_TEST>
                      </FOR_EACH>
                      <IF_TEST Test="$ENG_TXT_6/@Value='' or $ENG_TXT_6/@Value= null">
                        <THEN>
                          <SET Var="ENG_TXT_insert" FromValue="{$thisParam/SUBSCRPTN_OPT_STMT_TXT/@Value}"/>
                        </THEN>
                        <ELSE>
                          <SET Var="ENG_TXT_insert" FromValue="{$ENG_TXT_6/@Value}"/>
                        </ELSE>
                      </IF_TEST>
                      <!--<GET_DOC_SMART Name="DATA_SRCE_SUBS_OPT" AssignToVar="getVersionDetails" DirtyRead="true" HandleException="true" ReturnRowCount="yes" ServiceName="BCM_MASTER">
						<LEGAL_ENT_NBR Value="{$LEGAL_ENT_NBR_6/@Value}"/>
						<MKTNG_PGM_NBR Value="{$MKTNG_PGM_NBR_6/@Value}"/>
						<SUBSCRPTN_OPT_NBR Value="{$thisParam/SUBSCRPTN_OPT_NBR/@Value}"/>
					  </GET_DOC_SMART>-->
                      <EXECUTE_SQL_QUERY Value="LOCKING ROW FOR ACCESS NONSEQUENCED  TRANSACTIONTIME SELECT * FROM DATA_SRCE_SUBS_OPT where SUBSCRPTN_OPT_NBR='{$thisParam/SUBSCRPTN_OPT_NBR/@Value}' AND MKTNG_PGM_NBR='{$MKTNG_PGM_NBR_6/@Value}' AND DATA_SRCE_NBR ='{$DATA_SRCE_NBR_6/@Value}'" AssignToVar="getVersionDetails" ReturnRowCount="yes"/>
                      <!--If the record is INSERT set Version Number as 0, else increase Version Number by 1 in the table DATA_SRCE_SUBS_OPT-->
                      <!--<IF_TEST Test="$currApprover/InstanceMode/@Value='INSERT'">-->
                      <IF_TEST Test="$getVersionDetails/@TotalRowCount='0'">
                        <THEN>
                          <!--<ADD_DOC_SMART AssignToVar="addOptVersion" Name="DATA_SRCE_SUBS_OPT" HandleException="true" ServiceName="BCM_MASTER">
                            <LEGAL_ENT_NBR Value="{$LEGAL_ENT_NBR_6/@Value}"/>
                            <MKTNG_PGM_NBR Value="{$MKTNG_PGM_NBR_6/@Value}"/>
                            <DATA_SRCE_NBR Value="{$DATA_SRCE_NBR_6/@Value}"/>
                            <SUBSCRPTN_OPT_NBR Value="{$thisParam/SUBSCRPTN_OPT_NBR/@Value}"/>
                            <CR_NUM Value="{$CR_NUM_6/@Value}"/>
                            <CR_DESC Value="{$CR_DESC_6/@Value}"/>
                            <ENG_TXT Value="{$thisParam/SUBSCRPTN_OPT_STMT_TXT/@Value}"/>
                            <LOCAL_TXT Value="{$LOCAL_TXT_6/@Value}"/>
                            <BRAND_CODE Value="{$BRAND_CODE_6/@Value}"/>
                            <COMMENTS Value="{$COMMENTS_6/@Value}"/>
                            <SUBSCRPTN_OPT_NAME Value="{$varSUBSCRPTN_OPT_NAME/SUBSCRPTN_OPT_NAME/@Value}"/>
                            <SUBSCRPTN_OPT_STMT_TXT Value="{$thisParam/SUBSCRPTN_OPT_STMT_TXT/@Value}"/>
                            <SUBSCRPTN_VERSION_NBR Value="0"/>
                          </ADD_DOC_SMART>-->
                          <!--Below Native Function to convert the date into format we want-->
                          <SET Var="dateValue" FromValue="{trim($thisParam/SUBSCRPTN_OPT_START_DATE/@Value)}"/>
                          <SET Var="dbFormat" FromValue="yyyy-MM-dd"/>
                          <SET Var="dateFormat" FromValue="MM/dd/yyyy"/>
                          <SET Var="dateValue1" FromValue="{trim($thisParam/SUBSCRPTN_OPT_END_DATE/@Value)}"/>
                          <SET Var="dbFormat1" FromValue="yyyy-MM-dd"/>
                          <SET Var="dateFormat1" FromValue="MM/dd/yyyy"/>
                          <NATIVE_FUNCTION ClassName="com.teradata.xservice.userSecurity.DynamicPGLGenerator" MethodName="parseDate" AssignToVar="nativeReturn_start">
                            <PARAM Var="dateValue" Caption="date"/>
                            <PARAM Var="dateFormat" Caption="format"/>
                            <PARAM Var="dbFormat" Caption="dbFormat"/>
                          </NATIVE_FUNCTION>
                          <NATIVE_FUNCTION ClassName="com.teradata.xservice.userSecurity.DynamicPGLGenerator" MethodName="parseDate" AssignToVar="nativeReturn_end">
                            <PARAM Var="dateValue1" Caption="date"/>
                            <PARAM Var="dateFormat1" Caption="format"/>
                            <PARAM Var="dbFormat1" Caption="dbFormat"/>
                          </NATIVE_FUNCTION>
                          <EXECUTE_SQL_DML Value="INSERT INTO DATA_SRCE_SUBS_OPT  (LEGAL_ENT_NBR, MKTNG_PGM_NBR, DATA_SRCE_NBR, SUBSCRPTN_OPT_NBR, SUBSCRPTN_OPT_NAME, SUBSCRPTN_OPT_STMT_TXT, SUBSCRPTN_VERSION_NBR, SUBSCRPTN_OPT_START_DATE, SUBSCRPTN_OPT_END_DATE) VALUES('{$LEGAL_ENT_NBR_6/@Value}','{$MKTNG_PGM_NBR_6/@Value}',  '{$DATA_SRCE_NBR_6/@Value}', '{$thisParam/SUBSCRPTN_OPT_NBR/@Value}', '{$varSUBSCRPTN_OPT_NAME/SUBSCRPTN_OPT_NAME/@Value}', '{$thisParam/SUBSCRPTN_OPT_STMT_TXT/@Value}', 1, '{$nativeReturn_start/@Value}', '{$nativeReturn_end/@Value}');" AssignToVar="addOptVersion" HandleException="true"/>
                          <!--<EXECUTE_SQL_DML Value="INSERT INTO DATA_SRCE_SUBS_OPT  (LEGAL_ENT_NBR, MKTNG_PGM_NBR, DATA_SRCE_NBR, SUBSCRPTN_OPT_NBR, SUBSCRPTN_OPT_NAME, SUBSCRPTN_OPT_STMT_TXT, SUBSCRPTN_VERSION_NBR) VALUES('{$LEGAL_ENT_NBR_6/@Value}','{$MKTNG_PGM_NBR_6/@Value}',  '{$DATA_SRCE_NBR_6/@Value}', '{$thisParam/SUBSCRPTN_OPT_NBR/@Value}', '{$varSUBSCRPTN_OPT_NAME/SUBSCRPTN_OPT_NAME/@Value}', '{$thisParam/SUBSCRPTN_OPT_STMT_TXT/@Value}', 1);" AssignToVar="addOptVersion" HandleException="true"/>-->
                          <!--Update the changes and status as Approved in DATA_SRCE_SUBS_OPT_IN_DMY table-->
                          <MODIFY_DOCUMENT Name="DATA_SRCE_SUBS_OPT_IN_DMY" AssignToVar="addOptInDummy" HandleException="true" ServiceName="BCM_MASTER">
                            <DOCUMENT_CONTEXT>
                              <MKTNG_PGM_NBR Value="{$MKTNG_PGM_NBR_6/@Value}"/>
                              <LEGAL_ENT_NBR Value="{$LEGAL_ENT_NBR_6/@Value}"/>
                              <DATA_SRCE_NBR Value="{$DATA_SRCE_NBR_6/@Value}"/>
                            </DOCUMENT_CONTEXT>
                            <UPDATE_PROPERTIES>
                              <SUBSCRPTN_OPT_NBR Value="{$thisParam/SUBSCRPTN_OPT_NBR/@Value}"/>
                              <CR_NUM Value="{$CR_NUM_6/@Value}"/>
                              <CR_DESC Value="{$CR_DESC_6/@Value}"/>
                              <ENG_TXT Value="{$ENG_TXT_insert/@Value}"/>
                              <LOCAL_TXT Value="{$LOCAL_TXT_6/@Value}"/>
                              <BRAND_CODE Value="{$BRAND_CODE_6/@Value}"/>
                              <COMMENTS Value="{$COMMENTS_6/@Value}"/>
                              <STATUS Value="Approved"/>
                              <CNTCT_CHANL_TYPE_CODE Value="{$createOptTypRetain/CNTCT_CHANL_TYPE_CODE/@Value}"/>
                              <CNTCT_POINT_CATEG_CODE Value="{$createOptTypRetain/CNTCT_POINT_CATEG_CODE/@Value}"/>
                              <SUBSCRPTN_OPT_FREQ_TXT Value="{$createOptTypRetain/SUBSCRPTN_OPT_FREQ_TXT/@Value}"/>
                              <SUBSCRPTN_OPT_NAME Value="{$varSUBSCRPTN_OPT_NAME/SUBSCRPTN_OPT_NAME/@Value}"/>
                              <SUBSCRPTN_OPT_STMT_TXT Value="{$thisParam/SUBSCRPTN_OPT_STMT_TXT/@Value}"/>
                              <SUBSCRPTN_OPT_START_DATE Value="{$thisParam/SUBSCRPTN_OPT_START_DATE/@Value}"/>
                              <SUBSCRPTN_OPT_END_DATE Value="{$thisParam/SUBSCRPTN_OPT_END_DATE/@Value}"/>
                              <SUBSCRPTN_VERSION_NBR Value="1"/>
                            </UPDATE_PROPERTIES>
                          </MODIFY_DOCUMENT>
                          <!--Update the changes and status as Approved in DATA_SRCE_SUBS_OPT_IN table-->
                          <MODIFY_DOCUMENT Name="DATA_SRCE_SUBS_OPT_IN" AssignToVar="modifyOptIn" HandleException="true" ServiceName="BCM_MASTER">
                            <DOCUMENT_CONTEXT>
                              <MKTNG_PGM_NBR Value="{$MKTNG_PGM_NBR_6/@Value}"/>
                              <LEGAL_ENT_NBR Value="{$LEGAL_ENT_NBR_6/@Value}"/>
                              <DATA_SRCE_NBR Value="{$DATA_SRCE_NBR_6/@Value}"/>
                              <IN_id Value="{$IN_id_6/@Value}"/>
                            </DOCUMENT_CONTEXT>
                            <UPDATE_PROPERTIES>
                              <SUBSCRPTN_OPT_NBR Value="{$thisParam/SUBSCRPTN_OPT_NBR/@Value}"/>
                              <CR_NUM Value="{$CR_NUM_6/@Value}"/>
                              <CR_DESC Value="{$CR_DESC_6/@Value}"/>
                              <ENG_TXT Value="{$ENG_TXT_insert/@Value}"/>
                              <LOCAL_TXT Value="{$LOCAL_TXT_6/@Value}"/>
                              <BRAND_CODE Value="{$BRAND_CODE_6/@Value}"/>
                              <COMMENTS Value="{$COMMENTS_6/@Value}"/>
                              <STATUS Value="Approved"/>
                              <CNTCT_CHANL_TYPE_CODE Value="{$createOptTypRetain/CNTCT_CHANL_TYPE_CODE/@Value}"/>
                              <CNTCT_POINT_CATEG_CODE Value="{$createOptTypRetain/CNTCT_POINT_CATEG_CODE/@Value}"/>
                              <SUBSCRPTN_OPT_FREQ_TXT Value="{$createOptTypRetain/SUBSCRPTN_OPT_FREQ_TXT/@Value}"/>
                              <SUBSCRPTN_OPT_NAME Value="{$varSUBSCRPTN_OPT_NAME/SUBSCRPTN_OPT_NAME/@Value}"/>
                              <SUBSCRPTN_OPT_STMT_TXT Value="{$thisParam/SUBSCRPTN_OPT_STMT_TXT/@Value}"/>
                              <SUBSCRPTN_OPT_START_DATE Value="{$thisParam/SUBSCRPTN_OPT_START_DATE/@Value}"/>
                              <SUBSCRPTN_OPT_END_DATE Value="{$thisParam/SUBSCRPTN_OPT_END_DATE/@Value}"/>
                              <SUBSCRPTN_VERSION_NBR Value="1"/>
                            </UPDATE_PROPERTIES>
                          </MODIFY_DOCUMENT>
                        </THEN>
                        <ELSE>
                          <!--Code to increase the latest version by 1-->
                          <EXECUTE_SQL_QUERY Value="LOCKING ROW FOR ACCESS NONSEQUENCED  TRANSACTIONTIME SELECT MAX(SUBSCRPTN_VERSION_NBR)  FROM DATA_SRCE_SUBS_OPT WHERE SUBSCRPTN_OPT_NBR='{$thisParam/SUBSCRPTN_OPT_NBR/@Value}' and MKTNG_PGM_NBR='{$MKTNG_PGM_NBR_6/@Value}' AND DATA_SRCE_NBR='{$DATA_SRCE_NBR_6/@Value}'" AssignToVar="getMaxVersion" ReturnRowCount="yes"/>
                          <!--<SET Var="j" FromValue="{$getVersionDetails/SQL_RESULT/SUBSCRPTN_VERSION_NBR/@Value}"/>-->
                          <SET Var="j" FromValue="{$getMaxVersion/SQL_RESULT/SUBSCRPTN_VERSION_NBR/@Value}"/>
                          <SET Var="i" FromValue="1"/>
                          <SET Var="SUBSCRPTN_VERSION_NBR_Up" FromValue="{int($j+$i)}"/>
                          <!--<MODIFY_DOC_SMART Name="DATA_SRCE_SUBS_OPT" AssignToVar="updateOptVersion" HandleException="true" ServiceName="BCM_MASTER">
                            <DOCUMENT_CONTEXT>
                              <LEGAL_ENT_NBR Value="{$LEGAL_ENT_NBR_6/@Value}"/>
                              <MKTNG_PGM_NBR Value="{$MKTNG_PGM_NBR_6/@Value}"/>
                              <DATA_SRCE_NBR Value="{$DATA_SRCE_NBR_6/@Value}"/>
                              <SUBSCRPTN_OPT_NBR Value="{$thisParam/SUBSCRPTN_OPT_NBR/@Value}"/>
                            </DOCUMENT_CONTEXT>
                            <UPDATE_PROPERTIES>
                              <CR_NUM Value="{$CR_NUM_6/@Value}"/>
                              <CR_DESC Value="{$CR_DESC_6/@Value}"/>
                              <ENG_TXT Value="{$thisParam/SUBSCRPTN_OPT_STMT_TXT/@Value}"/>
                              <LOCAL_TXT Value="{$LOCAL_TXT_6/@Value}"/>
                              <BRAND_CODE Value="{$BRAND_CODE_6/@Value}"/>
                              <COMMENTS Value="{$COMMENTS_6/@Value}"/>
                              <SUBSCRPTN_OPT_NAME Value="{$varSUBSCRPTN_OPT_NAME/SUBSCRPTN_OPT_NAME/@Value}"/>
                              <SUBSCRPTN_OPT_STMT_TXT Value="{$thisParam/SUBSCRPTN_OPT_STMT_TXT/@Value}"/>
                              <SUBSCRPTN_VERSION_NBR Value="{$SUBSCRPTN_VERSION_NBR_Up/@Value}"/>
                            </UPDATE_PROPERTIES>
                          </MODIFY_DOC_SMART>-->
                          <!--<EXECUTE_SQL_DML Value="UPDATE DATA_SRCE_SUBS_OPT SET SUBSCRPTN_OPT_NAME='{$varSUBSCRPTN_OPT_NAME/SUBSCRPTN_OPT_NAME/@Value}', SUBSCRPTN_OPT_STMT_TXT='{$thisParam/SUBSCRPTN_OPT_STMT_TXT/@Value}', SUBSCRPTN_VERSION_NBR='{$SUBSCRPTN_VERSION_NBR_Up/@Value}',  LEGAL_ENT_NBR='{$LEGAL_ENT_NBR_6/@Value}'  WHERE DATA_SRCE_NBR='{$DATA_SRCE_NBR_6/@Value}' AND MKTNG_PGM_NBR='{$MKTNG_PGM_NBR_6/@Value}' AND SUBSCRPTN_OPT_NBR='{$thisParam/SUBSCRPTN_OPT_NBR/@Value}' AND SUBSCRPTN_OPT_START_DATE='{$thisParam/SUBSCRPTN_OPT_START_DATE/@Value}' AND SUBSCRPTN_OPT_END_DATE='{$thisParam/SUBSCRPTN_OPT_END_DATE/@Value}' ;" AssignToVar="updateOptVersion1" HandleException="true"/>-->
                          <!--Below Native Function to convert the date into format we want-->
                          <SET Var="dateValue" FromValue="{trim($thisParam/SUBSCRPTN_OPT_START_DATE/@Value)}"/>
                          <SET Var="dbFormat" FromValue="yyyy-MM-dd"/>
                          <SET Var="dateFormat" FromValue="MM/dd/yyyy"/>
                          <SET Var="dateValue1" FromValue="{trim($thisParam/SUBSCRPTN_OPT_END_DATE/@Value)}"/>
                          <SET Var="dbFormat1" FromValue="yyyy-MM-dd"/>
                          <SET Var="dateFormat1" FromValue="MM/dd/yyyy"/>
                          <NATIVE_FUNCTION ClassName="com.teradata.xservice.userSecurity.DynamicPGLGenerator" MethodName="parseDate" AssignToVar="nativeReturn_start">
                            <PARAM Var="dateValue" Caption="date"/>
                            <PARAM Var="dateFormat" Caption="format"/>
                            <PARAM Var="dbFormat" Caption="dbFormat"/>
                          </NATIVE_FUNCTION>
                          <NATIVE_FUNCTION ClassName="com.teradata.xservice.userSecurity.DynamicPGLGenerator" MethodName="parseDate" AssignToVar="nativeReturn_end">
                            <PARAM Var="dateValue1" Caption="date"/>
                            <PARAM Var="dateFormat1" Caption="format"/>
                            <PARAM Var="dbFormat1" Caption="dbFormat"/>
                          </NATIVE_FUNCTION>
                          <EXECUTE_SQL_DML Value="INSERT INTO DATA_SRCE_SUBS_OPT  (LEGAL_ENT_NBR, MKTNG_PGM_NBR, DATA_SRCE_NBR, SUBSCRPTN_OPT_NBR, SUBSCRPTN_OPT_NAME, SUBSCRPTN_OPT_STMT_TXT, SUBSCRPTN_VERSION_NBR, SUBSCRPTN_OPT_START_DATE, SUBSCRPTN_OPT_END_DATE)VALUES ('{$LEGAL_ENT_NBR_6/@Value}','{$MKTNG_PGM_NBR_6/@Value}',  '{$DATA_SRCE_NBR_6/@Value}', '{$thisParam/SUBSCRPTN_OPT_NBR/@Value}', '{$varSUBSCRPTN_OPT_NAME/SUBSCRPTN_OPT_NAME/@Value}', '{$thisParam/SUBSCRPTN_OPT_STMT_TXT/@Value}', '{$SUBSCRPTN_VERSION_NBR_Up/@Value}', '{$nativeReturn_start/@Value}', '{$nativeReturn_end/@Value}');" AssignToVar="addOptVersion" HandleException="true"/>
                          <!--Update the changes and status as Approved in DATA_SRCE_SUBS_OPT_IN_DMY table-->
                          <MODIFY_DOCUMENT Name="DATA_SRCE_SUBS_OPT_IN_DMY" AssignToVar="addOptInDummy" HandleException="true" ServiceName="BCM_MASTER">
                            <DOCUMENT_CONTEXT>
                              <MKTNG_PGM_NBR Value="{$MKTNG_PGM_NBR_6/@Value}"/>
                              <LEGAL_ENT_NBR Value="{$LEGAL_ENT_NBR_6/@Value}"/>
                              <DATA_SRCE_NBR Value="{$DATA_SRCE_NBR_6/@Value}"/>
                            </DOCUMENT_CONTEXT>
                            <UPDATE_PROPERTIES>
                              <SUBSCRPTN_OPT_NBR Value="{$thisParam/SUBSCRPTN_OPT_NBR/@Value}"/>
                              <CR_NUM Value="{$CR_NUM_6/@Value}"/>
                              <CR_DESC Value="{$CR_DESC_6/@Value}"/>
                              <ENG_TXT Value="{$ENG_TXT_insert/@Value}"/>
                              <LOCAL_TXT Value="{$LOCAL_TXT_6/@Value}"/>
                              <BRAND_CODE Value="{$BRAND_CODE_6/@Value}"/>
                              <COMMENTS Value="{$COMMENTS_6/@Value}"/>
                              <STATUS Value="Approved"/>
                              <CNTCT_CHANL_TYPE_CODE Value="{$createOptTypRetain/CNTCT_CHANL_TYPE_CODE/@Value}"/>
                              <CNTCT_POINT_CATEG_CODE Value="{$createOptTypRetain/CNTCT_POINT_CATEG_CODE/@Value}"/>
                              <SUBSCRPTN_OPT_FREQ_TXT Value="{$createOptTypRetain/SUBSCRPTN_OPT_FREQ_TXT/@Value}"/>
                              <SUBSCRPTN_OPT_NAME Value="{$varSUBSCRPTN_OPT_NAME/SUBSCRPTN_OPT_NAME/@Value}"/>
                              <SUBSCRPTN_OPT_STMT_TXT Value="{$thisParam/SUBSCRPTN_OPT_STMT_TXT/@Value}"/>
                              <SUBSCRPTN_OPT_START_DATE Value="{$thisParam/SUBSCRPTN_OPT_START_DATE/@Value}"/>
                              <SUBSCRPTN_OPT_END_DATE Value="{$thisParam/SUBSCRPTN_OPT_END_DATE/@Value}"/>
                              <SUBSCRPTN_VERSION_NBR Value="{$SUBSCRPTN_VERSION_NBR_Up/@Value}"/>
                            </UPDATE_PROPERTIES>
                          </MODIFY_DOCUMENT>
                          <!--Update the changes and status as Approved in DATA_SRCE_SUBS_OPT_IN table-->
                          <MODIFY_DOCUMENT Name="DATA_SRCE_SUBS_OPT_IN" AssignToVar="modifyOptIn" HandleException="true" ServiceName="BCM_MASTER">
                            <DOCUMENT_CONTEXT>
                              <MKTNG_PGM_NBR Value="{$MKTNG_PGM_NBR_6/@Value}"/>
                              <LEGAL_ENT_NBR Value="{$LEGAL_ENT_NBR_6/@Value}"/>
                              <DATA_SRCE_NBR Value="{$DATA_SRCE_NBR_6/@Value}"/>
                              <IN_id Value="{$IN_id_6/@Value}"/>
                            </DOCUMENT_CONTEXT>
                            <UPDATE_PROPERTIES>
                              <SUBSCRPTN_OPT_NBR Value="{$thisParam/SUBSCRPTN_OPT_NBR/@Value}"/>
                              <CR_NUM Value="{$CR_NUM_6/@Value}"/>
                              <CR_DESC Value="{$CR_DESC_6/@Value}"/>
                              <ENG_TXT Value="{$ENG_TXT_insert/@Value}"/>
                              <LOCAL_TXT Value="{$LOCAL_TXT_6/@Value}"/>
                              <BRAND_CODE Value="{$BRAND_CODE_6/@Value}"/>
                              <COMMENTS Value="{$COMMENTS_6/@Value}"/>
                              <STATUS Value="Approved"/>
                              <CNTCT_CHANL_TYPE_CODE Value="{$createOptTypRetain/CNTCT_CHANL_TYPE_CODE/@Value}"/>
                              <CNTCT_POINT_CATEG_CODE Value="{$createOptTypRetain/CNTCT_POINT_CATEG_CODE/@Value}"/>
                              <SUBSCRPTN_OPT_FREQ_TXT Value="{$createOptTypRetain/SUBSCRPTN_OPT_FREQ_TXT/@Value}"/>
                              <SUBSCRPTN_OPT_NAME Value="{$varSUBSCRPTN_OPT_NAME/SUBSCRPTN_OPT_NAME/@Value}"/>
                              <SUBSCRPTN_OPT_STMT_TXT Value="{$thisParam/SUBSCRPTN_OPT_STMT_TXT/@Value}"/>
                              <SUBSCRPTN_OPT_START_DATE Value="{$thisParam/SUBSCRPTN_OPT_START_DATE/@Value}"/>
                              <SUBSCRPTN_OPT_END_DATE Value="{$thisParam/SUBSCRPTN_OPT_END_DATE/@Value}"/>
                              <SUBSCRPTN_VERSION_NBR Value="{$SUBSCRPTN_VERSION_NBR_Up/@Value}"/>
                            </UPDATE_PROPERTIES>
                          </MODIFY_DOCUMENT>
                        </ELSE>
                      </IF_TEST>
                      <!--Check if data is created for SUBSCRPTN_OPT_TYPE, if yes insert into DATA_SRCE_SUBS_OPT_TYPE-->
                      <IF_TEST Test="$ifDataSubsOptTypeBeCreated/createOptTypCombine/VALIDATION_RESULT/@Value='SUCCESS'">
                        <THEN>
                          <ADD_DOC_SMART AssignToVar="addOptType" Name="DATA_SRCE_SUBS_OPT_TYPE" HandleException="true" ServiceName="BCM_MASTER">
                            <LEGAL_ENT_NBR Value="{$LEGAL_ENT_NBR_6/@Value}"/>
                            <MKTNG_PGM_NBR Value="{$MKTNG_PGM_NBR_6/@Value}"/>
                            <DATA_SRCE_NBR Value="{$DATA_SRCE_NBR_6/@Value}"/>
                            <SUBSCRPTN_OPT_NBR Value="{$thisParam/SUBSCRPTN_OPT_NBR/@Value}"/>
                            <CNTCT_CHANL_TYPE_CODE Value="{$createOptTypRetain/CNTCT_CHANL_TYPE_CODE/@Value}"/>
                            <CNTCT_POINT_CATEG_CODE Value="{$createOptTypRetain/CNTCT_POINT_CATEG_CODE/@Value}"/>
                            <SUBSCRPTN_OPT_FREQ_TXT Value="{$createOptTypRetain/SUBSCRPTN_OPT_FREQ_TXT/@Value}"/>
                          </ADD_DOC_SMART>
                        </THEN>
                      </IF_TEST>
                    </THEN>
                  </IF_TEST>
                  <!--Code written by Ankita Sadhwani Ends-->
                  <!-- code moved as part of Rel 5.7.3 ends -->
                  <IF_TEST Test="$DocumentInstance/DocumentInstance/SubmitByID != null">
                    <THEN>
                      <IF_TEST Test="$Approvals/Approvals/NOTIFICATION_TYPE/@Value ='ALL' or $Approvals/Approvals/NOTIFICATION_TYPE/@Value ='WEB'">
                        <THEN>
                          <REQUEST Name="sendAlert">
                            <DOCUMENT_ID Value="{$DocumentInstance/DocumentInstance/ID/@Value}"/>
                            <DOCUMENT_NAME Value="{$DocumentInstance/DocumentInstance/DocumentType/@Value}"/>
                            <ARG_INDEX Value="0"/>
                            <PRIORITY Value="3"/>
                            <USER_ID Value="{$creatorDetails/USER_PROFILE/ID/@Value}"/>
                            <SERVICE_NAME Value="APPROVAL"/>
                            <MESSAGE Value="{$DocumentInstance/DocumentInstance[1]/DocumentAction/@Value} request for {$DocumentName/@Value} is Approved by {$cur_approver_Details/USER_PROFILE/LOGIN_NAME/@Value}"/>
                          </REQUEST>
                        </THEN>
                      </IF_TEST>
                      <IF_TEST Test="$Approvals/Approvals/NOTIFICATION_TYPE/@Value ='ALL' or $Approvals/Approvals/NOTIFICATION_TYPE/@Value ='EMAIL'">
                        <THEN>
                          <!--<REQUEST Name="sendEmail" ServiceName="OMS_MESSAGE_SERVICE" Synchronous="no">
                            <SUBJECT Value="[MDM] {$DocumentInstance/DocumentInstance[1]/DocumentAction/@Value} request for {$DocumentName/@Value} is Approved"/>
                            <TO_ADDRS>
                              <TO_ADDR Value="{$creatorDetails/USER_PROFILE/EMAIL_ADDRESS/@Value}"/>
                            </TO_ADDRS>
                            <FORMAT Value="text/html"/>
                            <MESSAGE>
                              <XML_DATA XsltFileName="xservice/email/xml/GenericApproval_Approved_Rejected_Template.xsl">
                                <DATA>
                                  <DocumentAction Value="{$DocumentInstance/DocumentInstance[1]/DocumentAction/@Value}"/>
                                  <DocumentType Value="{$DocumentName/@Value}"/>
                                  <LOGIN_NAME Value="{$cur_approver_Details/USER_PROFILE/LOGIN_NAME/@Value}"/>
                                  <ApprovalType Value="{$ApprovalType/@Value}"/>
                                  <approvers Value="{$approvers/@Value}"/>
                                  <creatorDetails Value="{$creatorDetails/USER_PROFILE/LOGIN_NAME/@Value}"/>
                                  <DocumentInstance Value="{$DocumentInstance/DocumentInstance/ID/@Value}"/>
                                  <APPROVED_REJECTED Value="Approved"/>
                                </DATA>
                              </XML_DATA>
                            </MESSAGE>
                          </REQUEST>-->
                          <FOR_EACH SelectList="$getAllRecords/DocumentAttributes" CurrentElement="currElem">
                            <IF_TEST Test="$currElem/AttributeID/@Value= 'MKTNG_PGM_NBR'">
                              <THEN>
                                <SET Var="MKTNG_PGM_NBR_subs" FromValue="{$currElem/AttributeValue/@Value}"/>
                              </THEN>
                              <ELSE>
                                <IF_TEST Test="$currElem/AttributeID/@Value ='LEGAL_ENT_NBR'">
                                  <THEN>
                                    <SET Var="LEGAL_ENT_NBR_subs" FromValue="{$currElem/AttributeValue/@Value}"/>
                                  </THEN>
                                  <ELSE>
                                    <IF_TEST Test="$currElem/AttributeID/@Value= 'DATA_SRCE_NBR'">
                                      <THEN>
                                        <SET Var="DATA_SRCE_NBR_subs" FromValue="{$currElem/AttributeValue/@Value}"/>
                                      </THEN>
                                      <ELSE>
                                        <IF_TEST Test="$currElem/AttributeID/@Value= 'CR_NUM'">
                                          <THEN>
                                            <SET Var="CR_NUM_subs" FromValue="{$currElem/AttributeValue/@Value}"/>
                                          </THEN>
                                          <ELSE>
                                            <IF_TEST Test="$currElem/AttributeID/@Value= 'CR_DESC'">
                                              <THEN>
                                                <SET Var="CR_DESC_subs" FromValue="{$currElem/AttributeValue/@Value}"/>
                                              </THEN>
                                              <ELSE>
                                                <IF_TEST Test="$currElem/AttributeID/@Value= 'ENG_TXT'">
                                                  <THEN>
                                                    <SET Var="ENG_TXT_subs" FromValue="{$currElem/AttributeValue/@Value}"/>
                                                  </THEN>
                                                  <ELSE>
                                                    <IF_TEST Test="$currElem/AttributeID/@Value= 'LOCAL_TXT'">
                                                      <THEN>
                                                        <SET Var="LOCAL_TXT_subs" FromValue="{$currElem/AttributeValue/@Value}"/>
                                                      </THEN>
                                                      <ELSE>
                                                        <IF_TEST Test="$currElem/AttributeID/@Value= 'BRAND_CODE'">
                                                          <THEN>
                                                            <SET Var="BRAND_CODE_subs" FromValue="{$currElem/AttributeValue/@Value}"/>
                                                          </THEN>
                                                          <ELSE>
                                                            <IF_TEST Test="$currElem/AttributeID/@Value= 'COMMENTS'">
                                                              <THEN>
                                                                <SET Var="COMMENTS_subs" FromValue="{$currElem/AttributeValue/@Value}"/>
                                                              </THEN>
                                                            </IF_TEST>
                                                          </ELSE>
                                                        </IF_TEST>
                                                      </ELSE>
                                                    </IF_TEST>
                                                  </ELSE>
                                                </IF_TEST>
                                              </ELSE>
                                            </IF_TEST>
                                          </ELSE>
                                        </IF_TEST>
                                      </ELSE>
                                    </IF_TEST>
                                  </ELSE>
                                </IF_TEST>
                              </ELSE>
                            </IF_TEST>
                          </FOR_EACH>
                          <IF_TEST Test="$DocumentName/@Value= 'DATA_SRCE_SUBS_OPT_IN'">
                            <THEN>
                              <!-- <TO_DOCVAR AssignToVar="thisParamInsideEmail">
                                <ROOT>
                                  <
                                </ROOT>
                              </TO_DOCVAR>-->
                              <SET Var="UserGrpId" FromValue="SU_UGP" scope="Global"/>
                              <TO_DOCVAR AssignToVar="emailSubject">
                                <ROOT>
                                  <!--<SUBJECT Value="INSERT request for DATA_SRCE_SUBS_OPT_IN with CR # {$CR_NUM_subs/@Value}is Approved."/>-->
                                  <SUBJECT Value="[MDM] {$DocumentInstance/DocumentInstance[1]/DocumentAction/@Value} request for {$DocumentName/@Value} with CR # {$CR_NUM_subs/@Value} is Approved"/>
                                </ROOT>
                              </TO_DOCVAR>
                              <TO_DOCVAR AssignToVar="emailFormat">
                                <ROOT>
                                  <FORMAT Value="text/html"/>
                                </ROOT>
                              </TO_DOCVAR>
                              <TO_DOCVAR AssignToVar="emailMessage">
                                <ROOT>
                                  <MESSAGE>
                                    <SET Var="AcceptApprovalDetails" FromValue="E:\Teradata\MDM\3.05.02\custom\pngrelease3\AcceptApproval.xsl"/>
                                    <XML_DATA XsltFileName="{$AcceptApprovalDetails}">
                                      <REPORT>
                                        <DocumentAction Value="{$DocumentInstance/DocumentInstance[1]/DocumentAction/@Value}"/>
                                        <DocumentType Value="{$DocumentName/@Value}"/>
                                        <LOGIN_NAME Value="{$cur_approver_Details/USER_PROFILE/LOGIN_NAME/@Value}"/>
                                        <ApprovalType Value="{$ApprovalType/@Value}"/>
                                        <approvers Value="{$approvers/@Value}"/>
                                        <creatorDetails Value="{$creatorDetails/USER_PROFILE/LOGIN_NAME/@Value}"/>
                                        <DocumentInstance Value="{$DocumentInstance/DocumentInstance/AlertID/@Value}"/>
                                        <APPROVED_REJECTED Value="Approved"/>
                                        <Comment Value="{$Comment/@Value}"/>
                                        <SUBSCRPTN_OPT_NBR Value="{$thisParam/SUBSCRPTN_OPT_NBR/@Value}"/>
                                        <LEGAL_ENT_NBR Value="{$LEGAL_ENT_NBR_subs}"/>
                                        <MKTNG_PGM_NBR Value="{$MKTNG_PGM_NBR_subs}"/>
                                        <DATA_SRCE_NBR Value="{$DATA_SRCE_NBR_subs}"/>
                                        <CR_NUM Value="{$CR_NUM_subs}"/>
                                        <CR_DESC Value="{$CR_DESC_subs}"/>
                                        <ENG_TXT Value="{$ENG_TXT_subs}"/>
                                        <LOCAL_TXT Value="{$LOCAL_TXT_subs}"/>
                                        <BRAND_CODE Value="{$BRAND_CODE_subs}"/>
                                        <COMMENTS Value="{$COMMENTS_subs}"/>
                                      </REPORT>
                                    </XML_DATA>
                                  </MESSAGE>
                                </ROOT>
                              </TO_DOCVAR>
                              <!--   <TO_DOCVAR AssignToVar="emailRecipients">
                                <TO_ADDRS>
                                  <TO_ADDR Value="{$creatorDetails/USER_PROFILE/EMAIL_ADDRESS/@Value}"/>
                                </TO_ADDRS>
                              </TO_DOCVAR>-->
                              <TO_DOCVAR AssignToVar="emailRecipients">
                                <TO_ADDRS/>
                              </TO_DOCVAR>
                              <EXECUTE_SQL_QUERY AssignToVar="GetApprGrpName" Value="SELECT APPROVER_NAME FROM AW_APPROVALS A, AW_APPROVAL_GROUPS B WHERE A.APPROVAL_GROUP_ID = B.SEQID AND B.EVENT_NAME = 'DATA_SRCE_SUBS_OPT_IN'"/>
                              <EXECUTE_SQL_QUERY AssignToVar="allApproverUsers" Value="LOCKING ROW FOR ACCESS sel USER_ID from USER_UG_RELATION where user_grp_id in (  sel ID from USR_GRP_PROFIL where grp_name = '{$GetApprGrpName/SQL_RESULT/APPROVER_NAME/@Value}' )"/>
                              <!--<EXECUTE_SQL_QUERY AssignToVar="allApproverUsers" Value="LOCKING ROW FOR ACCESS sel USER_ID from USER_UG_RELATION where user_grp_id in (  sel ID from USR_GRP_PROFIL where grp_name = 'DATA_SUBS_Approver_GRP' )"/>-->
                              <FOR_EACH CurrentElement="currAppr" SelectList="$allApproverUsers/SQL_RESULT">
                                <SET Var="currApprUser" FromValue="{$currAppr/USER_ID/@Value}"/>
                                <REQUEST Name="getUser" ServiceName="USER_SECURITY" AssignToVar="apprDetails">
                                  <ID Value="{$currApprUser/@Value}"/>
                                </REQUEST>
                                <APPEND_TO_XML SelectList="$emailRecipients">
                                  <TO_ADDR Value="{$apprDetails/USER_PROFILE/EMAIL_ADDRESS/@Value}"/>
                                </APPEND_TO_XML>
                              </FOR_EACH>
                              <APPEND_TO_XML DocVar="emailRecipients">
                                <TO_ADDR Value="{$creatorDetails/USER_PROFILE/EMAIL_ADDRESS/@Value}"/>
                              </APPEND_TO_XML>
                              <!--<FOR_EACH SelectList="$resAttValues/*" CurrentElement="currRec">
                                <APPEND_TO_XML DocVar="emailRecipients">
                                  <TO_ADDR Value="{$currRec/AV_DESCRIPTION/@Value}"/>
                                </APPEND_TO_XML>
                              </FOR_EACH>-->
                              <REQUEST Name="sendEmailNotification" AssignToVar="respEmail" ServiceName="BCM_MASTER" HandleException="true">
                                <TO_XML DocVar="emailRecipients"/>
                                <TO_XML SelectList="$emailSubject/*"/>
                                <TO_XML SelectList="$emailFormat/*"/>
                                <TO_XML SelectList="$emailMessage/*"/>
                              </REQUEST>
                            </THEN>
                            <ELSE>
                              <IF_TEST Test="$DocumentName/@Value= 'TRT_IN'">
                                <THEN>
                                  <SET Var="UserGrpId1" FromValue="SU_UGP"/>
                                  <FOR_EACH SelectList="$getAllRecords/DocumentAttributes" CurrentElement="currElem">
                                    <IF_TEST Test="$currElem/AttributeID/@Value= 'TRT_NBR'">
                                      <THEN>
                                        <SET Var="TRT_NBR_trt" FromValue="{$currElem/AttributeValue/@Value}"/>
                                      </THEN>
                                      <ELSE>
                                        <IF_TEST Test="$currElem/AttributeID/@Value ='TRT_NAME_LOCAL'">
                                          <THEN>
                                            <SET Var="TRT_NAME_trtl" FromValue="{$currElem/AttributeValue/@Value}"/>
                                          </THEN>
                                          <ELSE>
                                            <IF_TEST Test="$currElem/AttributeID/@Value ='LEGAL_ENT_NBR'">
                                              <THEN>
                                                <SET Var="LEGAL_ENT_trtl" FromValue="{$currElem/AttributeValue/@Value}"/>
                                              </THEN>
                                              <ELSE>
                                                <IF_TEST Test="$currElem/AttributeID/@Value ='MKTNG_PGM_NBR'">
                                                  <THEN>
                                                    <SET Var="MKTNG_PGM_trtl" FromValue="{$currElem/AttributeValue/@Value}"/>
                                                  </THEN>
                                                </IF_TEST>
                                              </ELSE>
                                            </IF_TEST>
                                          </ELSE>
                                        </IF_TEST>
                                      </ELSE>
                                    </IF_TEST>
                                  </FOR_EACH>
                                  <IF_TEST Test="$count12 > 0">
                                    <THEN>
                                      <TO_DOCVAR AssignToVar="emailSubject">
                                        <ROOT>
                                          <SUBJECT Value="Approval can't be processed as Pre Defined Trait Number can't be NULL !!!"/>
                                        </ROOT>
                                      </TO_DOCVAR>
                                    </THEN>
                                    <ELSE>
                                      <THEN>
                                        <TO_DOCVAR AssignToVar="emailSubject">
                                          <ROOT>
                                            <SUBJECT Value="[MDM] {$DocumentInstance/DocumentInstance[1]/DocumentAction/@Value} request for {$DocumentName/@Value} with TRT # {$TRT_NBR_trt/@Value} is Approved"/>
                                          </ROOT>
                                        </TO_DOCVAR>
                                      </THEN>
                                    </ELSE>
                                  </IF_TEST>
                                  <!-- <TO_DOCVAR AssignToVar="emailSubject">
                                    <ROOT>
                                      <SUBJECT Value="[MDM] {$DocumentInstance/DocumentInstance[1]/DocumentAction/@Value} request for {$DocumentName/@Value} with TRT # {$TRT_NBR_trt/@Value} is Approved"/>
                                    </ROOT>
                                  </TO_DOCVAR>-->
                                  <TO_DOCVAR AssignToVar="emailFormat">
                                    <ROOT>
                                      <FORMAT Value="text/html"/>
                                    </ROOT>
                                  </TO_DOCVAR>
                                  <TO_DOCVAR AssignToVar="emailMessage">
                                    <ROOT>
                                      <MESSAGE>
                                        <SET Var="AcceptTRTApprovalDetails" FromValue="E:\Teradata\MDM\3.05.02\custom\pngrelease3\AcceptTRTApproval.xsl"/>
                                        <XML_DATA XsltFileName="{$AcceptTRTApprovalDetails}">
                                          <REPORT>
                                            <DocumentAction Value="{$DocumentInstance/DocumentInstance[1]/DocumentAction/@Value}"/>
                                            <DocumentType Value="{$DocumentName/@Value}"/>
                                            <LOGIN_NAME Value="{$cur_approver_Details/USER_PROFILE/LOGIN_NAME/@Value}"/>
                                            <ApprovalType Value="{$ApprovalType/@Value}"/>
                                            <approvers Value="{$approvers/@Value}"/>
                                            <creatorDetails Value="{$creatorDetails/USER_PROFILE/LOGIN_NAME/@Value}"/>
                                            <DocumentInstance Value="{$DocumentInstance/DocumentInstance/AlertID/@Value}"/>
                                            <APPROVED_REJECTED Value="Approved"/>
                                            <Comment Value="{$Comment/@Value}"/>
                                            <TRT_NBR Value="{$TRT_NBR_trt}"/>
                                            <TRT_NAME Value="{$TRT_NAME_trtl}"/>
                                            <LEGAL_ENT_NBR Value="{$LEGAL_ENT_trtl}"/>
                                            <MKTNG_PGM_NBR Value="{$MKTNG_PGM_trtl}"/>
                                          </REPORT>
                                          <REPORT1>
                                            <TO_XML SelectList="$linkedPredfndTrt/*"/>
                                          </REPORT1>
                                        </XML_DATA>
                                      </MESSAGE>
                                    </ROOT>
                                  </TO_DOCVAR>
                                  <!--  code by aishwarya starts -->
                                  <TO_DOCVAR AssignToVar="emailRecipients">
                                    <TO_ADDRS/>
                                  </TO_DOCVAR>
                                  <EXECUTE_SQL_QUERY AssignToVar="GetApprGrpName" Value="SELECT APPROVER_NAME FROM AW_APPROVALS A, AW_APPROVAL_GROUPS B WHERE A.APPROVAL_GROUP_ID = B.SEQID AND B.EVENT_NAME = 'TRT_IN'"/>
                                  <EXECUTE_SQL_QUERY AssignToVar="allApproverUsers" Value="LOCKING ROW FOR ACCESS sel USER_ID from USER_UG_RELATION where user_grp_id in (  sel ID from USR_GRP_PROFIL where grp_name = '{$GetApprGrpName/SQL_RESULT/APPROVER_NAME/@Value}' )"/>
                                  <!--<EXECUTE_SQL_QUERY AssignToVar="allApproverUsers" Value="LOCKING ROW FOR ACCESS sel USER_ID from USER_UG_RELATION where user_grp_id in (  sel ID from USR_GRP_PROFIL where grp_name = 'TRT_Approver_GRP' )"/>-->
                                  <FOR_EACH CurrentElement="currAppr" SelectList="$allApproverUsers/SQL_RESULT">
                                    <SET Var="currApprUser" FromValue="{$currAppr/USER_ID/@Value}"/>
                                    <REQUEST Name="getUser" ServiceName="USER_SECURITY" AssignToVar="apprDetails">
                                      <ID Value="{$currApprUser/@Value}"/>
                                    </REQUEST>
                                    <APPEND_TO_XML SelectList="$emailRecipients">
                                      <TO_ADDR Value="{$apprDetails/USER_PROFILE/EMAIL_ADDRESS/@Value}"/>
                                    </APPEND_TO_XML>
                                  </FOR_EACH>
                                  <APPEND_TO_XML DocVar="emailRecipients">
                                    <TO_ADDR Value="{$creatorDetails/USER_PROFILE/EMAIL_ADDRESS/@Value}"/>
                                  </APPEND_TO_XML>
                                  <!-- code by aishwarya ends -->
                                  <!--<TO_DOCVAR AssignToVar="emailRecipients">
                                    <TO_ADDRS>
                                      <TO_ADDR Value="{$creatorDetails/USER_PROFILE/EMAIL_ADDRESS/@Value}"/>
                                    </TO_ADDRS>
                                  </TO_DOCVAR>-->
                                  <!--<FOR_EACH SelectList="$resAttValues/*" CurrentElement="currRec">
                          <APPEND_TO_XML DocVar="emailRecipients">
<TO_ADDR Value="{$currRec/AV_DESCRIPTION/@Value}"/>
                          </APPEND_TO_XML>
                          </FOR_EACH>-->
                                  <REQUEST Name="sendEmailNotification" AssignToVar="respEmail" ServiceName="BCM_MASTER" HandleException="true">
                                    <TO_XML DocVar="emailRecipients"/>
                                    <TO_XML SelectList="$emailSubject/*"/>
                                    <TO_XML SelectList="$emailFormat/*"/>
                                    <TO_XML SelectList="$emailMessage/*"/>
                                  </REQUEST>
                                </THEN>
                              </IF_TEST>
                            </ELSE>
                          </IF_TEST>
                        </THEN>
                      </IF_TEST>
                      <IF_TEST Test="$count12 > 0">
                        <THEN>
                          <SET Var="alertRed" FromValue="Approval can't be processed as Pre Defined Trait Number can't be NULL !!!"/>
                        </THEN>
                        <ELSE>
                          <THEN>
                            <SET Var="alertGreen" FromValue="Approval accepted successfully."/>
                          </THEN>
                        </ELSE>
                      </IF_TEST>
                    </THEN>
                  </IF_TEST>
                  <IF_TEST Test="$curAlert/Alert/NodeName/@Value = 'serial_approval_node'">
                    <THEN>
                      <SET Var="nextApprover" FromValue="{substringBefore(substringAfter($approvers,'1. '),'&lt;br/>')}"/>
                      <GET_DOCUMENT AssignToVar="curDetails" Name="USER_PROFILE" ServiceName="USER_SECURITY" Distinct="true" DirtyRead="true">
                        <LOGIN_NAME Value="{$nextApprover/@Value}"/>
                      </GET_DOCUMENT>
                      <REQUEST Name="GetApprovalUserType" ServiceName="ADMIN_UI" AssignToVar="ApprovalUserType">
                        <EVENT_NAME Value="{$thisParam/InstanceType/@Value}"/>
                        <ACTION_TYPE Value="{$thisParam/RESPONSE/EMAIL_NODE_TYPE/@Value}"/>
                      </REQUEST>
                      <SET Var="msg" FromValue="User Group Based"/>
                      <IF_TEST Test="$ApprovalUserType/ApprovalUserType/@Value = $msg">
                        <THEN>
                          <REQUEST Name="getGrpMembers" AssignToVar="userNameResp" ServiceName="ADMIN_UI">
                            <userName Value="{$nextApprover/@Value}"/>
                          </REQUEST>
                          <TO_DOCVAR AssignToVar="curDetails">
                            <USER_PROFILE/>
                          </TO_DOCVAR>
                          <FOR_EACH SelectList="$userNameResp/*" CurrentElement="curr">
                            <SET_NAME DocVar="curr" FromValue="ID"/>
                            <ADD_CHILDREN DocVar="curDetails" FromDocVar="curr"/>
                          </FOR_EACH>
                        </THEN>
                      </IF_TEST>
                      <!-- Remove All duplicates-->
                      <TO_DOCVAR AssignToVar="UniqueApprovedUsers">
                        <APPROVED_USER/>
                      </TO_DOCVAR>
                      <FOR_EACH SelectList="$curDetails/*" CurrentElement="allApprovers">
                        <FOR_EACH SelectList="$UniqueApprovedUsers/*" CurrentElement="UniqueApprovers">
                          <IF_TEST Test="$allApprovers/ID/@Value=$UniqueApprovers/@Value">
                            <THEN>
                              <SET Var="available" FromValue="true"/>
                              <BREAK/>
                            </THEN>
                            <ELSE>
                              <SET Var="available" FromValue="false"/>
                            </ELSE>
                          </IF_TEST>
                        </FOR_EACH>
                        <IF_TEST Test="$available!='true'">
                          <THEN>
                            <IF_TEST Test="strlen(trim($allApprovers/ID/@Value))>0">
                              <THEN>
                                <SET Var="id" FromValue="{$allApprovers/ID/@Value}"/>
                              </THEN>
                              <ELSE>
                                <SET Var="id" FromValue="{$allApprovers/@Value}"/>
                              </ELSE>
                            </IF_TEST>
                            <APPEND_TO_XML Select="$UniqueApprovedUsers">
                              <ID Value="{$id}"/>
                            </APPEND_TO_XML>
                          </THEN>
                        </IF_TEST>
                      </FOR_EACH>
                      <!-- Remove All duplicates-->
                      <!--<FOR_EACH SelectList="$UniqueApprovedUsers" CurrentElement="current">
                        <REQUEST Name="getUser" ServiceName="USER_SECURITY" AssignToVar="approverDetails" ReturnRowCount="true">
                          <ID Value="{$current/ID/@Value}"/>
                        </REQUEST>
                        <IF_TEST Test="$nextApprover/@Value != ''">
                          <THEN>
                            <IF_TEST Test="$Approvals/Approvals/NOTIFICATION_TYPE/@Value ='ALL' or $Approvals/Approvals/NOTIFICATION_TYPE/@Value ='WEB'">
                              <THEN>
                                <REQUEST Name="sendAlert">
                                  <DOCUMENT_ID Value="{$DocumentInstance/DocumentInstance/ID/@Value}"/>
                                  <DOCUMENT_NAME Value="{$DocumentInstance/DocumentInstance/DocumentType/@Value}"/>
                                  <ARG_INDEX Value="0"/>
                                  <PRIORITY Value="3"/>
                                  <USER_ID Value="{$approverDetails/USER_PROFILE/ID/@Value}"/>
                                  <SERVICE_NAME Value="APPROVAL"/>
                                  <MESSAGE Value="{$DocumentInstance/DocumentInstance[1]/DocumentAction/@Value} request for {$DocumentName/@Value} is pending for your Approval Approval ID:  {$DocumentInstance/DocumentInstance/ID/@Value}"/>
                                </REQUEST>
                              </THEN>
                            </IF_TEST>
                            <IF_TEST Test="$Approvals/Approvals/NOTIFICATION_TYPE/@Value ='ALL' or $Approvals/Approvals/NOTIFICATION_TYPE/@Value ='EMAIL'">
                              <THEN>
                                <REQUEST Name="sendEmail" ServiceName="OMS_MESSAGE_SERVICE" Synchronous="no">
                                  <SUBJECT Value="[MDM] {$DocumentInstance/DocumentInstance[1]/DocumentAction/@Value} request for {$DocumentName/@Value} is pending for your Approval"/>
                                  <TO_ADDRS>
                                    <TO_ADDR Value="{$approverDetails/USER_PROFILE/EMAIL_ADDRESS/@Value}"/>
                                  </TO_ADDRS>
                                  <FORMAT Value="text/html"/>
                                  <MESSAGE>
                                    <XML_DATA XsltFileName="xservice/email/xml/GenericApproval_Pending_For_Approval_Template.xsl">
                                      <DATA>
                                        <DocumentAction Value="{$DocumentInstance/DocumentInstance[1]/DocumentAction/@Value}"/>
                                        <DocumentType Value="{$DocumentName/@Value}"/>
                                        <LOGIN_NAME Value="{$cur_approver_Details/USER_PROFILE/LOGIN_NAME/@Value}"/>
                                        <ApprovalType Value="{$ApprovalType/@Value}"/>
                                        <approvers Value="{$approvers/@Value}"/>
                                        <creatorDetails Value="{$creatorDetails/USER_PROFILE/LOGIN_NAME/@Value}"/>
                                        <DocumentInstance Value="{$DocumentInstance/DocumentInstance/ID/@Value}"/>
                                      </DATA>
                                    </XML_DATA>
                                  </MESSAGE>
                                </REQUEST>
                              </THEN>
                            </IF_TEST>
                          </THEN>
                        </IF_TEST>
                      </FOR_EACH>
-->
                    </THEN>
                  </IF_TEST>
                </THEN>
                <ELSE>
                  <EXCEPTION Value="The record may be accepted or rejected by a different user."/>
                </ELSE>
              </IF_TEST>
            </THEN>
            <ELSE>
              <SET Var="alertRed" FromValue="Assign the record to yourself before taking an action."/>
            </ELSE>
          </IF_TEST>
        </action>
      </actions>
      <next_nodes OutputVar="{SelectedItemApprovalDetails,xml}">
        <next_node Name="Does next approver exist ?"/>
      </next_nodes>
    </task>
    <decision Name="Does next approver exist ?" InputVar="{nodeInputXml,xml}">
      <actions>
        <action>
          <GET_DOCUMENT Name="Alert" ServiceName="APPROVAL" AssignToVar="curAlert" DirtyRead="true">
            <InstanceDocID Value="{$thisParam/selected_ID/@Value}"/>
            <!-- ApproverID Value="{$currUser}" / -->
            <Status Value="A"/>
            <NodeType Value="S"/>
          </GET_DOCUMENT>
          <!--PRINTLN Value="DoesNextApporverExist ....{count($curAlert/*)}"/-->
          <IF_TEST Test="count($curAlert/*) > 0">
            <THEN>
              <SET Var="DoesNextApporverExist" FromValue="true"/>
            </THEN>
            <ELSE>
              <SET Var="DoesNextApporverExist" FromValue="false"/>
              <GET_DOCUMENT Name="Alert" ServiceName="APPROVAL" AssignToVar="curParallelAlert" DirtyRead="true">
                <InstanceDocID Value="{$thisParam/selected_ID/@Value}"/>
                <!-- ApproverID Value="{$currUser}" / -->
                <Status Value="A"/>
                <NodeType Value="P"/>
              </GET_DOCUMENT>
              <!--PRINTLN Value="DoesNextApporverExist ....{count($curAlert/*)}"/-->
              <IF_TEST Test="count($curParallelAlert/*) > 0">
                <THEN>
                  <SET Var="DoesNextApporverExist" FromValue="true"/>
                  <SET Var="subj" FromValue="waiting for approval"/>
                  <SET Var="mesg" FromValue="approved By {$userName}"/>
                </THEN>
                <ELSE>
                  <SET Var="DoesNextApporverExist" FromValue="false"/>
                </ELSE>
              </IF_TEST>
            </ELSE>
          </IF_TEST>
          <!--PRINTLN Value="DoesNextApporverExist ....{$DoesNextApporverExist}"/-->
        </action>
      </actions>
      <condition Value="$DoesNextApporverExist/@Value = 'true'"/>
      <if_true>
        <next_nodes OutputVar="{messageType,String}">
          <next_node Name="Dectsion on Notification" Description=""/>
        </next_nodes>
      </if_true>
      <if_false>
        <next_nodes OutputVar="{rootOBJ_ID,String}">
          <next_node Name="Stop" Description=""/>
        </next_nodes>
      </if_false>
    </decision>
    <done Name="Copy_of_Stop">
      <actions>
        <action>
          <IF_TEST Test="$alertRed/@Value != null">
            <THEN>
              <SET Var="urlStr" FromValue="{concat('start.x2ps?START_WORKFLOW=ApprovalInbox&amp;SOLUTION_NAME=MDM&amp;SERVICE_NAME=ADMIN_UI&amp;message=',$alertRed/@Value,'&amp;status=fail&amp;ParentContainer_STEP_ID=',$messageType)}"/>
            </THEN>
            <ELSE>
              <SET Var="urlStr" FromValue="{concat('start.x2ps?START_WORKFLOW=ApprovalInbox&amp;SOLUTION_NAME=MDM&amp;SERVICE_NAME=ADMIN_UI&amp;message=',$alertGreen/@Value,'&amp;status=&amp;ParentContainer_STEP_ID=',$messageType)}"/>
            </ELSE>
          </IF_TEST>
          <SET Var="REDIRECT_URL" FromValue="{$urlStr}"/>
        </action>
      </actions>
      <next_nodes/>
    </done>
    <task Name="Reject">
      <actions>
        <action>
          <REQUEST Name="getUser" ServiceName="USER_SECURITY" AssignToVar="currUser">
            <ID Value="{$userId}"/>
          </REQUEST>
          <EXECUTE_SQL_QUERY Value="LOCKING ROW FOR ACCESS SELECT COUNT(*) AS TOT_RECORDS FROM AW_ALERT WHERE INST_DOC_ID='{$thisParam/selected_ID/@Value}' AND APPROVER_ID='{$currUser/USER_PROFILE/LOGIN_NAME/@Value}'" AssignToVar="cnt"/>
          <IF_TEST Test="$cnt/SQL_RESULT/TOT_RECORDS/@Value != '0'">
            <THEN>
              <REQUEST Name="getAllUsersForGrp" AssignToVar="userNameResp" ServiceName="ADMIN_UI"/>
              <GET_DOCUMENT Name="Alert" ServiceName="APPROVAL" AssignToVar="curAlert" ReturnRowCount="yes" DirtyRead="true">
                <InstanceDocID Value="{$thisParam/selected_ID/@Value}"/>
                <OR>
                  <TO_XML SelectList="$userNameResp/*"/>
                </OR>
                <Status Value="A"/>
              </GET_DOCUMENT>
              <IF_TEST Test="int($curAlert/@TotalRowCount) > 0">
                <THEN>
                  <GET_DOCUMENT AssignToVar="tempAlert" Name="Alert" ServiceName="APPROVAL" ReturnRowCount="yes" DirtyRead="true">
                    <SELECT>
                      <ApproverID/>
                    </SELECT>
                    <Status Value="A"/>
                    <InstanceDocID Value="{$thisParam/selected_ID/@Value}"/>
                  </GET_DOCUMENT>
                  <IF_TEST Test="$curAlert/Alert/NodeName/@Value = 'serial_approval_node'">
                    <THEN>
                      <SET Var="ApprovalType" FromValue="Serial"/>
                    </THEN>
                    <ELSE>
                      <SET Var="ApprovalType" FromValue="Parallel"/>
                    </ELSE>
                  </IF_TEST>
                  <REQUEST Name="GetApprovalUserType" ServiceName="ADMIN_UI" AssignToVar="ApprovalUserType">
                    <ID Value="{$thisParam/selected_ID/@Value}"/>
                  </REQUEST>
                  <GET_DOCUMENT Name="Alert" AssignToVar="alertforMailUser" ReturnRowCount="true" ServiceName="APPROVAL" DirtyRead="true">
                    <InstanceDocID Value="{$thisParam/selected_ID/@Value}"/>
                    <NodeType Value="P"/>
                  </GET_DOCUMENT>
                  <GET_DOCUMENT AssignToVar="DocumentInstance" Name="DocumentInstance" ServiceName="APPROVAL" ReturnRowCount="yes" DirtyRead="true">
                    <SELECT>
                      <DocumentAction/>
                    </SELECT>
                    <AlertID Value="{$thisParam/selected_ID/@Value}"/>
                  </GET_DOCUMENT>
                  <GET_DOCUMENT Name="Approval_Groups" AssignToVar="ApprovalGroups" ServiceName="APPROVAL" ReturnRowCount="yes" DirtyRead="true">
                    <EVENT_NAME Value="{$curAlert/Alert/InstanceType/@Value}"/>
                    <IS_ACTIVE Value="True"/>
                    <OR>
                      <ACTION_TYPE Value="{$DocumentInstance/DocumentInstance/DocumentAction/@Value}"/>
                      <ACTION_TYPE Value="ALL"/>
                    </OR>
                  </GET_DOCUMENT>
                  <GET_DOCUMENT Name="Approvals" AssignToVar="Approvals" ServiceName="APPROVAL" ReturnRowCount="yes" DirtyRead="true">
                    <SELECT>
                      <NOTIFICATION_TYPE/>
                    </SELECT>
                    <APPROVAL_GROUP_ID Value="{$ApprovalGroups/Approval_Groups/SEQID/@Value}"/>
                    <IS_ACTIVE Value="True"/>
                    <ENTITY_STATE Value="ACTIVE"/>
                    <EXECUTION_ORDER Value="1"/>
                  </GET_DOCUMENT>
                  <CLONE_XML DocVar="thisParam" AssignToVar="SelectedItemApprovalDetails"/>
                  <REQUEST Name="ACTIVATE_APPROVAL_NODE" AssignToVar="activateAppNodeResp">
                    <ID Value="{$thisParam/selected_ID/@Value}"/>
                    <Result Value="ED"/>
                    <InstanceDocID Value="{$curAlert/Alert/InstanceDocID/@Value}"/>
                    <InstanceType Value="{$curAlert/Alert/InstanceType/@Value}"/>
                    <Comment Value="{$thisParam/Comment/@Value}"/>
                    <TokenId Value="{$curAlert/Alert/TokenID/@Value}"/>
                    <messageType Value="{$curAlert/Alert/InstanceType/@Value}"/>
                    <EMAIL_NODE_TYPE Value="{$curAlert/Alert/InstanceMode/@Value}"/>
                  </REQUEST>
                  <SET Var="DocumentName" FromValue="{$activateAppNodeResp/InstanceType/@Value}"/>
                  <GET_DOCUMENT Name="DocumentInstance" AssignToVar="DocumentInstance" ServiceName="APPROVAL" DirtyRead="true">
                    <AlertID Value="{$thisParam/selected_ID/@Value}"/>
                  </GET_DOCUMENT>
                  <REQUEST Name="getUser" ServiceName="USER_SECURITY" AssignToVar="cur_approver_Details">
                    <ID Value="{$userId/@Value}"/>
                  </REQUEST>
                  <REQUEST Name="getUser" ServiceName="USER_SECURITY" AssignToVar="creatorDetails">
                    <ID Value="{$DocumentInstance/DocumentInstance/SubmitByID/@Value}"/>
                  </REQUEST>
                  <IF_TEST Test="$DocumentInstance/DocumentInstance/SubmitByID != null">
                    <THEN>
                      <IF_TEST Test="$Approvals/Approvals/NOTIFICATION_TYPE/@Value ='ALL' or $Approvals/Approvals/NOTIFICATION_TYPE/@Value ='WEB'">
                        <THEN>
                          <REQUEST Name="sendAlert">
                            <DOCUMENT_ID Value="{$DocumentInstance/DocumentInstance/ID/@Value}"/>
                            <DOCUMENT_NAME Value="{$DocumentInstance/DocumentInstance/DocumentType/@Value}"/>
                            <ARG_INDEX Value="0"/>
                            <PRIORITY Value="3"/>
                            <USER_ID Value="{$creatorDetails/USER_PROFILE/ID/@Value}"/>
                            <SERVICE_NAME Value="APPROVAL"/>
                            <MESSAGE Value="{$DocumentInstance/DocumentInstance[1]/DocumentAction/@Value} request for {$DocumentName/@Value} is Rejected by {$cur_approver_Details/USER_PROFILE/LOGIN_NAME/@Value}"/>
                          </REQUEST>
                        </THEN>
                      </IF_TEST>
                      <IF_TEST Test="$Approvals/Approvals/NOTIFICATION_TYPE/@Value ='ALL' or $Approvals/Approvals/NOTIFICATION_TYPE/@Value ='EMAIL'">
                        <THEN>
                          <!--<REQUEST Name="sendEmail" ServiceName="OMS_MESSAGE_SERVICE" Synchronous="no">
                            <SUBJECT Value="[MDM] {$DocumentInstance/DocumentInstance[1]/DocumentAction/@Value} request for {$DocumentName/@Value} is Rejected"/>
                            <TO_ADDRS>
                              <TO_ADDR Value="{$creatorDetails/USER_PROFILE/EMAIL_ADDRESS/@Value}"/>
                            </TO_ADDRS>
                            <FORMAT Value="text/html"/>
                            <MESSAGE>
                              <XML_DATA XsltFileName="xservice/email/xml/GenericApproval_Approved_Rejected_Template.xsl">
                                <DATA>
                                  <DocumentAction Value="{$DocumentInstance/DocumentInstance[1]/DocumentAction/@Value}"/>
                                  <DocumentType Value="{$DocumentName/@Value}"/>
                                  <LOGIN_NAME Value="{$cur_approver_Details/USER_PROFILE/LOGIN_NAME/@Value}"/>
                                  <ApprovalType Value="{$ApprovalType/@Value}"/>
                                  <approvers Value="{$approvers/@Value}"/>
                                  <creatorDetails Value="{$creatorDetails/USER_PROFILE/LOGIN_NAME/@Value}"/>
                                  <DocumentInstance Value="{$DocumentInstance/DocumentInstance/ID/@Value}"/>
                                  <APPROVED_REJECTED Value="Rejected"/>
                                </DATA>
                              </XML_DATA>
                            </MESSAGE>
                          </REQUEST>
                        </THEN>
                      </IF_TEST>
                      <REQUEST Name="sendMail2ApprovedUsers" ServiceName="ADMIN_UI">
                        <ID Value="{$thisParam/selected_ID/@Value}"/>
                        <ApprovalType Value="{$ApprovalType/@Value}"/>
                        <DocumentInstanceID Value="{$DocumentInstance/DocumentInstance/ID/@Value}"/>
                        <DocumentInstanceType Value="{$DocumentInstance/DocumentInstance/DocumentType/@Value}"/>
                        <DocumentAction Value="{$DocumentInstance/DocumentInstance[1]/DocumentAction/@Value}"/>
                        <DocumentName Value="{$DocumentName/@Value}"/>
                        <ApproverName Value="{$cur_approver_Details/USER_PROFILE/LOGIN_NAME/@Value}"/>
                        <CreatorName Value="{$creatorDetails/USER_PROFILE/LOGIN_NAME/@Value}"/>
                        <NOTIFICATION_TYPE Value="{$Approvals/Approvals/NOTIFICATION_TYPE/@Value}"/>
                        <ApprovalUserType Value="{$ApprovalUserType/ApprovalUserType/@Value}"/>
                        <Alert>
                          <TO_XML SelectList="$alertforMailUser/*"/>
                        </Alert>
                      </REQUEST>-->
                          <FOR_EACH SelectList="$getAllRecords/DocumentAttributes" CurrentElement="currElem">
                            <IF_TEST Test="$currElem/AttributeID/@Value= 'MKTNG_PGM_NBR'">
                              <THEN>
                                <SET Var="MKTNG_PGM_NBR_subs" FromValue="{$currElem/AttributeValue/@Value}"/>
                              </THEN>
                              <ELSE>
                                <IF_TEST Test="$currElem/AttributeID/@Value ='LEGAL_ENT_NBR'">
                                  <THEN>
                                    <SET Var="LEGAL_ENT_NBR_subs" FromValue="{$currElem/AttributeValue/@Value}"/>
                                  </THEN>
                                  <ELSE>
                                    <IF_TEST Test="$currElem/AttributeID/@Value= 'DATA_SRCE_NBR'">
                                      <THEN>
                                        <SET Var="DATA_SRCE_NBR_subs" FromValue="{$currElem/AttributeValue/@Value}"/>
                                      </THEN>
                                      <ELSE>
                                        <IF_TEST Test="$currElem/AttributeID/@Value= 'CR_NUM'">
                                          <THEN>
                                            <SET Var="CR_NUM_subs" FromValue="{$currElem/AttributeValue/@Value}"/>
                                          </THEN>
                                          <ELSE>
                                            <IF_TEST Test="$currElem/AttributeID/@Value= 'CR_DESC'">
                                              <THEN>
                                                <SET Var="CR_DESC_subs" FromValue="{$currElem/AttributeValue/@Value}"/>
                                              </THEN>
                                              <ELSE>
                                                <IF_TEST Test="$currElem/AttributeID/@Value= 'ENG_TXT'">
                                                  <THEN>
                                                    <SET Var="ENG_TXT_subs" FromValue="{$currElem/AttributeValue/@Value}"/>
                                                  </THEN>
                                                  <ELSE>
                                                    <IF_TEST Test="$currElem/AttributeID/@Value= 'LOCAL_TXT'">
                                                      <THEN>
                                                        <SET Var="LOCAL_TXT_subs" FromValue="{$currElem/AttributeValue/@Value}"/>
                                                      </THEN>
                                                      <ELSE>
                                                        <IF_TEST Test="$currElem/AttributeID/@Value= 'BRAND_CODE'">
                                                          <THEN>
                                                            <SET Var="BRAND_CODE_subs" FromValue="{$currElem/AttributeValue/@Value}"/>
                                                          </THEN>
                                                          <ELSE>
                                                            <IF_TEST Test="$currElem/AttributeID/@Value= 'COMMENTS'">
                                                              <THEN>
                                                                <SET Var="COMMENTS_subs" FromValue="{$currElem/AttributeValue/@Value}"/>
                                                              </THEN>
                                                            </IF_TEST>
                                                          </ELSE>
                                                        </IF_TEST>
                                                      </ELSE>
                                                    </IF_TEST>
                                                  </ELSE>
                                                </IF_TEST>
                                              </ELSE>
                                            </IF_TEST>
                                          </ELSE>
                                        </IF_TEST>
                                      </ELSE>
                                    </IF_TEST>
                                  </ELSE>
                                </IF_TEST>
                              </ELSE>
                            </IF_TEST>
                          </FOR_EACH>
                          <IF_TEST Test="$DocumentName/@Value= 'DATA_SRCE_SUBS_OPT_IN'">
                            <THEN>
                              <!-- <TO_DOCVAR AssignToVar="thisParamInsideEmail">
                                <ROOT>
                                  <
                                </ROOT>
                              </TO_DOCVAR>-->
                              <SET Var="UserGrpId" FromValue="SU_UGP" scope="Global"/>
                              <TO_DOCVAR AssignToVar="emailSubject">
                                <ROOT>
                                  <!--<SUBJECT Value="INSERT request for DATA_SRCE_SUBS_OPT_IN with CR # {$CR_NUM_subs/@Value}is Approved."/>-->
                                  <SUBJECT Value="[MDM] {$DocumentInstance/DocumentInstance[1]/DocumentAction/@Value} request for {$DocumentName/@Value} with CR # {$CR_NUM_subs/@Value} is Rejected"/>
                                </ROOT>
                              </TO_DOCVAR>
                              <TO_DOCVAR AssignToVar="emailFormat">
                                <ROOT>
                                  <FORMAT Value="text/html"/>
                                </ROOT>
                              </TO_DOCVAR>
                              <TO_DOCVAR AssignToVar="emailMessage">
                                <ROOT>
                                  <MESSAGE>
                                    <SET Var="AcceptApprovalDetails" FromValue="E:\Teradata\MDM\3.05.02\custom\pngrelease3\AcceptApproval.xsl"/>
                                    <XML_DATA XsltFileName="{$AcceptApprovalDetails}">
                                      <REPORT>
                                        <DocumentAction Value="{$DocumentInstance/DocumentInstance[1]/DocumentAction/@Value}"/>
                                        <DocumentType Value="{$DocumentName/@Value}"/>
                                        <LOGIN_NAME Value="{$cur_approver_Details/USER_PROFILE/LOGIN_NAME/@Value}"/>
                                        <ApprovalType Value="{$ApprovalType/@Value}"/>
                                        <approvers Value="{$approvers/@Value}"/>
                                        <creatorDetails Value="{$creatorDetails/USER_PROFILE/LOGIN_NAME/@Value}"/>
                                        <DocumentInstance Value="{$DocumentInstance/DocumentInstance/AlertID/@Value}"/>
                                        <APPROVED_REJECTED Value="Rejected"/>
                                        <Comment Value="{$Comment/@Value}"/>
                                        <SUBSCRPTN_OPT_NBR Value="{$thisParam/SUBSCRPTN_OPT_NBR/@Value}"/>
                                        <LEGAL_ENT_NBR Value="{$LEGAL_ENT_NBR_subs}"/>
                                        <MKTNG_PGM_NBR Value="{$MKTNG_PGM_NBR_subs}"/>
                                        <DATA_SRCE_NBR Value="{$DATA_SRCE_NBR_subs}"/>
                                        <CR_NUM Value="{$CR_NUM_subs}"/>
                                        <CR_DESC Value="{$CR_DESC_subs}"/>
                                        <ENG_TXT Value="{$ENG_TXT_subs}"/>
                                        <LOCAL_TXT Value="{$LOCAL_TXT_subs}"/>
                                        <BRAND_CODE Value="{$BRAND_CODE_subs}"/>
                                        <COMMENTS Value="{$COMMENTS_subs}"/>
                                      </REPORT>
                                    </XML_DATA>
                                  </MESSAGE>
                                </ROOT>
                              </TO_DOCVAR>
                              <!--  <TO_DOCVAR AssignToVar="emailRecipients">
                                <TO_ADDRS>
                                  <TO_ADDR Value="{$creatorDetails/USER_PROFILE/EMAIL_ADDRESS/@Value}"/>
                                </TO_ADDRS>
                              </TO_DOCVAR>-->
                              <TO_DOCVAR AssignToVar="emailRecipients">
                                <TO_ADDRS/>
                              </TO_DOCVAR>
                              <EXECUTE_SQL_QUERY AssignToVar="GetApprGrpName" Value="SELECT APPROVER_NAME FROM AW_APPROVALS A, AW_APPROVAL_GROUPS B WHERE A.APPROVAL_GROUP_ID = B.SEQID AND B.EVENT_NAME = 'DATA_SRCE_SUBS_OPT_IN'"/>
                              <!--<EXECUTE_SQL_QUERY AssignToVar="allApproverUsers" Value="LOCKING ROW FOR ACCESS sel USER_ID from USER_UG_RELATION where user_grp_id in (  sel ID from USR_GRP_PROFIL where grp_name = 'DATA_SUBS_Approver_GRP' )"/>-->
                              <EXECUTE_SQL_QUERY AssignToVar="allApproverUsers" Value="LOCKING ROW FOR ACCESS sel USER_ID from USER_UG_RELATION where user_grp_id in (  sel ID from USR_GRP_PROFIL where grp_name = '{$GetApprGrpName/SQL_RESULT/APPROVER_NAME/@Value}' )"/>
                              <FOR_EACH CurrentElement="currAppr" SelectList="$allApproverUsers/SQL_RESULT">
                                <SET Var="currApprUser" FromValue="{$currAppr/USER_ID/@Value}"/>
                                <REQUEST Name="getUser" ServiceName="USER_SECURITY" AssignToVar="apprDetails">
                                  <ID Value="{$currApprUser/@Value}"/>
                                </REQUEST>
                                <APPEND_TO_XML SelectList="$emailRecipients">
                                  <TO_ADDR Value="{$apprDetails/USER_PROFILE/EMAIL_ADDRESS/@Value}"/>
                                </APPEND_TO_XML>
                              </FOR_EACH>
                              <APPEND_TO_XML DocVar="emailRecipients">
                                <TO_ADDR Value="{$creatorDetails/USER_PROFILE/EMAIL_ADDRESS/@Value}"/>
                              </APPEND_TO_XML>
                              <!--<FOR_EACH SelectList="$resAttValues/*" CurrentElement="currRec">
                                <APPEND_TO_XML DocVar="emailRecipients">
                                  <TO_ADDR Value="{$currRec/AV_DESCRIPTION/@Value}"/>
                                </APPEND_TO_XML>
                              </FOR_EACH>-->
                              <REQUEST Name="sendEmailNotification" AssignToVar="respEmail" ServiceName="BCM_MASTER" HandleException="true">
                                <TO_XML DocVar="emailRecipients"/>
                                <TO_XML SelectList="$emailSubject/*"/>
                                <TO_XML SelectList="$emailFormat/*"/>
                                <TO_XML SelectList="$emailMessage/*"/>
                              </REQUEST>
                            </THEN>
                            <ELSE>
                              <IF_TEST Test="$DocumentName/@Value= 'TRT_IN'">
                                <THEN>
                                  <SET Var="UserGrpId1" FromValue="SU_UGP"/>
                                  <FOR_EACH SelectList="$getAllRecords/DocumentAttributes" CurrentElement="currElem">
                                    <IF_TEST Test="$currElem/AttributeID/@Value= 'TRT_NBR'">
                                      <THEN>
                                        <SET Var="TRT_NBR_trt" FromValue="{$currElem/AttributeValue/@Value}"/>
                                      </THEN>
                                      <ELSE>
                                        <IF_TEST Test="$currElem/AttributeID/@Value ='TRT_NAME_LOCAL'">
                                          <THEN>
                                            <SET Var="TRT_NAME_trtl" FromValue="{$currElem/AttributeValue/@Value}"/>
                                          </THEN>
                                          <ELSE>
                                            <IF_TEST Test="$currElem/AttributeID/@Value ='LEGAL_ENT_NBR'">
                                              <THEN>
                                                <SET Var="LEGAL_ENT_trtl" FromValue="{$currElem/AttributeValue/@Value}"/>
                                              </THEN>
                                              <ELSE>
                                                <IF_TEST Test="$currElem/AttributeID/@Value ='MKTNG_PGM_NBR'">
                                                  <THEN>
                                                    <SET Var="MKTNG_PGM_trtl" FromValue="{$currElem/AttributeValue/@Value}"/>
                                                  </THEN>
                                                </IF_TEST>
                                              </ELSE>
                                            </IF_TEST>
                                          </ELSE>
                                        </IF_TEST>
                                      </ELSE>
                                    </IF_TEST>
                                  </FOR_EACH>
                                  <TO_DOCVAR AssignToVar="emailSubject">
                                    <ROOT>
                                      <SUBJECT Value="[MDM] {$DocumentInstance/DocumentInstance[1]/DocumentAction/@Value} request for {$DocumentName/@Value} with TRT # {$TRT_NBR_trt/@Value} is Rejected"/>
                                    </ROOT>
                                  </TO_DOCVAR>
                                  <TO_DOCVAR AssignToVar="emailFormat">
                                    <ROOT>
                                      <FORMAT Value="text/html"/>
                                    </ROOT>
                                  </TO_DOCVAR>
                                  <TO_DOCVAR AssignToVar="emailMessage">
                                    <ROOT>
                                      <MESSAGE>
                                        <SET Var="AcceptTRTApprovalDetails" FromValue="E:\Teradata\MDM\3.05.02\custom\pngrelease3\AcceptTRTApproval.xsl"/>
                                        <XML_DATA XsltFileName="{$AcceptTRTApprovalDetails}">
                                          <REPORT>
                                            <DocumentAction Value="{$DocumentInstance/DocumentInstance[1]/DocumentAction/@Value}"/>
                                            <DocumentType Value="{$DocumentName/@Value}"/>
                                            <LOGIN_NAME Value="{$cur_approver_Details/USER_PROFILE/LOGIN_NAME/@Value}"/>
                                            <ApprovalType Value="{$ApprovalType/@Value}"/>
                                            <approvers Value="{$approvers/@Value}"/>
                                            <creatorDetails Value="{$creatorDetails/USER_PROFILE/LOGIN_NAME/@Value}"/>
                                            <DocumentInstance Value="{$DocumentInstance/DocumentInstance/AlertID/@Value}"/>
                                            <APPROVED_REJECTED Value="Rejected"/>
                                            <Comment Value="{$Comment/@Value}"/>
                                            <TRT_NBR Value="{$TRT_NBR_trt}"/>
                                            <TRT_NAME Value="{$TRT_NAME_trtl}"/>
                                            <LEGAL_ENT_NBR Value="{$LEGAL_ENT_trtl}"/>
                                            <MKTNG_PGM_NBR Value="{$MKTNG_PGM_trtl}"/>
                                          </REPORT>
                                          <REPORT1>
                                            <TO_XML SelectList="$linkedPredfndTrt/*"/>
                                          </REPORT1>
                                        </XML_DATA>
                                      </MESSAGE>
                                    </ROOT>
                                  </TO_DOCVAR>
                                  <!--<TO_DOCVAR AssignToVar="emailRecipients">
                                    <TO_ADDRS>
                                      <TO_ADDR Value="{$creatorDetails/USER_PROFILE/EMAIL_ADDRESS/@Value}"/>
                                    </TO_ADDRS>
                                  </TO_DOCVAR>-->
                                  <TO_DOCVAR AssignToVar="emailRecipients">
                                    <TO_ADDRS/>
                                  </TO_DOCVAR>
                                  <EXECUTE_SQL_QUERY AssignToVar="GetApprGrpName" Value="SELECT APPROVER_NAME FROM AW_APPROVALS A, AW_APPROVAL_GROUPS B WHERE A.APPROVAL_GROUP_ID = B.SEQID AND B.EVENT_NAME = 'TRT_IN'"/>
                                  <EXECUTE_SQL_QUERY AssignToVar="allApproverUsers" Value="LOCKING ROW FOR ACCESS sel USER_ID from USER_UG_RELATION where user_grp_id in (  sel ID from USR_GRP_PROFIL where grp_name = '{$GetApprGrpName/SQL_RESULT/APPROVER_NAME/@Value}' )"/>
                                  <FOR_EACH CurrentElement="currAppr" SelectList="$allApproverUsers/SQL_RESULT">
                                    <SET Var="currApprUser" FromValue="{$currAppr/USER_ID/@Value}"/>
                                    <REQUEST Name="getUser" ServiceName="USER_SECURITY" AssignToVar="apprDetails">
                                      <ID Value="{$currApprUser/@Value}"/>
                                    </REQUEST>
                                    <APPEND_TO_XML SelectList="$emailRecipients">
                                      <TO_ADDR Value="{$apprDetails/USER_PROFILE/EMAIL_ADDRESS/@Value}"/>
                                    </APPEND_TO_XML>
                                  </FOR_EACH>
                                  <APPEND_TO_XML DocVar="emailRecipients">
                                    <TO_ADDR Value="{$creatorDetails/USER_PROFILE/EMAIL_ADDRESS/@Value}"/>
                                  </APPEND_TO_XML>
                                  <!--<FOR_EACH SelectList="$resAttValues/*" CurrentElement="currRec">
                          <APPEND_TO_XML DocVar="emailRecipients">
<TO_ADDR Value="{$currRec/AV_DESCRIPTION/@Value}"/>
                          </APPEND_TO_XML>
                          </FOR_EACH>-->
                                  <REQUEST Name="sendEmailNotification" AssignToVar="respEmail" ServiceName="BCM_MASTER" HandleException="true">
                                    <TO_XML DocVar="emailRecipients"/>
                                    <TO_XML SelectList="$emailSubject/*"/>
                                    <TO_XML SelectList="$emailFormat/*"/>
                                    <TO_XML SelectList="$emailMessage/*"/>
                                  </REQUEST>
                                </THEN>
                              </IF_TEST>
                            </ELSE>
                          </IF_TEST>
                        </THEN>
                      </IF_TEST>
                    </THEN>
                  </IF_TEST>
                  <ADD_CHILDREN DocVar="thisParam" FromDocVar="activateAppNodeResp"/>
                  <SET Var="subj" FromValue="Rejected"/>
                  <SET Var="alertGreen" FromValue="Approval rejected successfully."/>
                  <SET Var="mesg" FromValue="Rejected"/>
                </THEN>
                <ELSE>
                  <EXCEPTION Value="Probably rejected by some other user."/>
                </ELSE>
              </IF_TEST>
            </THEN>
            <ELSE>
              <SET Var="alertRed" FromValue="Assign the record to yourself before taking an action."/>
            </ELSE>
          </IF_TEST>
          <!--Code written by Ankita Sadhwani Starts-->
          <!--Update Status of tables DATA_SRCE_SUBS_OPT_IN & DATA_SRCE_SUBS_OPT_IN_DMY if the record is Rejected-->
          <IF_TEST Test="$alertGreen/@Value='Approval rejected successfully.' and $DocumentName/@Value= 'DATA_SRCE_SUBS_OPT_IN'">
            <THEN>
              <FOR_EACH SelectList="$getAllRecords/DocumentAttributes" CurrentElement="currElem">
                <IF_TEST Test="$currElem/AttributeID/@Value= 'MKTNG_PGM_NBR'">
                  <THEN>
                    <SET Var="MKTNG_PGM_NBR_6" FromValue="{$currElem/AttributeValue/@Value}"/>
                  </THEN>
                  <ELSE>
                    <IF_TEST Test="$currElem/AttributeID/@Value ='LEGAL_ENT_NBR'">
                      <THEN>
                        <SET Var="LEGAL_ENT_NBR_6" FromValue="{$currElem/AttributeValue/@Value}"/>
                      </THEN>
                      <ELSE>
                        <IF_TEST Test="$currElem/AttributeID/@Value= 'DATA_SRCE_NBR'">
                          <THEN>
                            <SET Var="DATA_SRCE_NBR_6" FromValue="{$currElem/AttributeValue/@Value}"/>
                          </THEN>
                          <ELSE>
                            <IF_TEST Test="$currElem/AttributeID/@Value= 'CR_NUM'">
                              <THEN>
                                <SET Var="CR_NUM_6" FromValue="{$currElem/AttributeValue/@Value}"/>
                              </THEN>
                              <ELSE>
                                <IF_TEST Test="$currElem/AttributeID/@Value= 'CR_DESC'">
                                  <THEN>
                                    <SET Var="CR_DESC_6" FromValue="{$currElem/AttributeValue/@Value}"/>
                                  </THEN>
                                  <ELSE>
                                    <IF_TEST Test="$currElem/AttributeID/@Value= 'ENG_TXT'">
                                      <THEN>
                                        <SET Var="ENG_TXT_6" FromValue="{$currElem/AttributeValue/@Value}"/>
                                      </THEN>
                                      <ELSE>
                                        <IF_TEST Test="$currElem/AttributeID/@Value= 'LOCAL_TXT'">
                                          <THEN>
                                            <SET Var="LOCAL_TXT_6" FromValue="{$currElem/AttributeValue/@Value}"/>
                                          </THEN>
                                          <ELSE>
                                            <IF_TEST Test="$currElem/AttributeID/@Value= 'BRAND_CODE'">
                                              <THEN>
                                                <SET Var="BRAND_CODE_6" FromValue="{$currElem/AttributeValue/@Value}"/>
                                              </THEN>
                                              <ELSE>
                                                <IF_TEST Test="$currElem/AttributeID/@Value= 'COMMENTS'">
                                                  <THEN>
                                                    <SET Var="COMMENTS_6" FromValue="{$currElem/AttributeValue/@Value}"/>
                                                  </THEN>
                                                </IF_TEST>
                                              </ELSE>
                                            </IF_TEST>
                                          </ELSE>
                                        </IF_TEST>
                                      </ELSE>
                                    </IF_TEST>
                                  </ELSE>
                                </IF_TEST>
                              </ELSE>
                            </IF_TEST>
                          </ELSE>
                        </IF_TEST>
                      </ELSE>
                    </IF_TEST>
                  </ELSE>
                </IF_TEST>
              </FOR_EACH>
              <MODIFY_DOCUMENT Name="DATA_SRCE_SUBS_OPT_IN_DMY" AssignToVar="addOptInDummy" HandleException="true" ServiceName="BCM_MASTER">
                <DOCUMENT_CONTEXT>
                  <MKTNG_PGM_NBR Value="{$MKTNG_PGM_NBR_6/@Value}"/>
                  <LEGAL_ENT_NBR Value="{$LEGAL_ENT_NBR_6/@Value}"/>
                  <DATA_SRCE_NBR Value="{$DATA_SRCE_NBR_6/@Value}"/>
                </DOCUMENT_CONTEXT>
                <UPDATE_PROPERTIES>
                  <SUBSCRPTN_OPT_NBR Value="{$thisParam/SUBSCRPTN_OPT_NBR/@Value}"/>
                  <CR_NUM Value="{$CR_NUM_6/@Value}"/>
                  <CR_DESC Value="{$CR_DESC_6/@Value}"/>
                  <ENG_TXT Value="{$ENG_TXT_6/@Value}"/>
                  <LOCAL_TXT Value="{$LOCAL_TXT_6/@Value}"/>
                  <BRAND_CODE Value="{$BRAND_CODE_6/@Value}"/>
                  <COMMENTS Value="{$COMMENTS_6/@Value}"/>
                  <STATUS Value="Rejected"/>
                  <!--<CNTCT_CHANL_TYPE_CODE Value="{$createOptTypRetain/CNTCT_CHANL_TYPE_CODE/@Value}"/>
                      <CNTCT_POINT_CATEG_CODE Value="{$createOptTypRetain/CNTCT_POINT_CATEG_CODE/@Value}"/>
                      <SUBSCRPTN_OPT_FREQ_TXT Value="{$createOptTypRetain/SUBSCRPTN_OPT_FREQ_TXT/@Value}"/>
                      <SUBSCRPTN_OPT_NAME Value="{$createOptNumRetain/SUBSCRPTN_OPT_NAME/@Value}"/>
                      <SUBSCRPTN_OPT_STMT_TXT Value="{$createOptNumRetain/SUBSCRPTN_OPT_STMT_TXT/@Value}"/>-->
                </UPDATE_PROPERTIES>
              </MODIFY_DOCUMENT>
              <!--<MODIFY_DOCUMENT Name="DATA_SRCE_SUBS_OPT_IN" AssignToVar="modifyaddOptIn" HandleException="true" ServiceName="BCM_MASTER">
                <DOCUMENT_CONTEXT>
                  <MKTNG_PGM_NBR Value="{$MKTNG_PGM_NBR_6/@Value}"/>
                  <LEGAL_ENT_NBR Value="{$LEGAL_ENT_NBR_6/@Value}"/>
                  <DATA_SRCE_NBR Value="{$DATA_SRCE_NBR_6/@Value}"/>
                </DOCUMENT_CONTEXT>
                <UPDATE_PROPERTIES>
                  <SUBSCRPTN_OPT_NBR Value="{$thisParam/SUBSCRPTN_OPT_NBR/@Value}"/>
                  <CR_NUM Value="{$CR_NUM_6/@Value}"/>
                  <CR_DESC Value="{$CR_DESC_6/@Value}"/>
                  <ENG_TXT Value="{$ENG_TXT_6/@Value}"/>
                  <LOCAL_TXT Value="{$LOCAL_TXT_6/@Value}"/>
                  <BRAND_CODE Value="{$BRAND_CODE_6/@Value}"/>
                  <COMMENTS Value="{$COMMENTS_6/@Value}"/>
                  <STATUS Value="Rejected"/>
                 <CNTCT_CHANL_TYPE_CODE Value="{$createOptTypRetain/CNTCT_CHANL_TYPE_CODE/@Value}"/>
                 <CNTCT_POINT_CATEG_CODE Value="{$createOptTypRetain/CNTCT_POINT_CATEG_CODE/@Value}"/>
                 <SUBSCRPTN_OPT_FREQ_TXT Value="{$createOptTypRetain/SUBSCRPTN_OPT_FREQ_TXT/@Value}"/>
                 <SUBSCRPTN_OPT_NAME Value="{$createOptNumRetain/SUBSCRPTN_OPT_NAME/@Value}"/>
                 <SUBSCRPTN_OPT_STMT_TXT Value="{$createOptNumRetain/SUBSCRPTN_OPT_STMT_TXT/@Value}"/>
                </UPDATE_PROPERTIES>
              </MODIFY_DOCUMENT>-->
            </THEN>
          </IF_TEST>
          <!--Code written by Ankita Sadhwani Ends-->
          <!-- Code written by Aishwarya starts -->
          <IF_TEST Test="$alertGreen/@Value='Approval rejected successfully.' and $DocumentName/@Value= 'TRT_IN'">
            <THEN>
              <FOR_EACH SelectList="$getAllRecords/DocumentAttributes" CurrentElement="currElem">
                <IF_TEST Test="$currElem/AttributeID/@Value= 'TRT_NBR'">
                  <THEN>
                    <SET Var="TRT_NBR_Final" FromValue="{$currElem/AttributeValue/@Value}"/>
                  </THEN>
                  <ELSE>
                    <IF_TEST Test="$currElem/AttributeID/@Value ='TRT_NAME_LOCAL'">
                      <THEN>
                        <SET Var="TRT_NAME_Final" FromValue="{$currElem/AttributeValue/@Value}"/>
                      </THEN>
                      <ELSE>
                        <IF_TEST Test="$currElem/AttributeID/@Value ='LEGAL_ENT_NBR'">
                          <THEN>
                            <SET Var="LEGAL_ENT_Final" FromValue="{$currElem/AttributeValue/@Value}"/>
                          </THEN>
                          <ELSE>
                            <IF_TEST Test="$currElem/AttributeID/@Value ='MKTNG_PGM_NBR'">
                              <THEN>
                                <SET Var="MKTNG_PGM_Final" FromValue="{$currElem/AttributeValue/@Value}"/>
                              </THEN>
                              <ELSE>
                                <IF_TEST Test="$currElem/AttributeID/@Value ='ID'">
                                  <THEN>
                                    <SET Var="ID_Final" FromValue="{$currElem/AttributeValue/@Value}"/>
                                  </THEN>
                                </IF_TEST>
                              </ELSE>
                            </IF_TEST>
                          </ELSE>
                        </IF_TEST>
                      </ELSE>
                    </IF_TEST>
                  </ELSE>
                </IF_TEST>
              </FOR_EACH>
              <MODIFY_DOC_SMART Name="TRT_IN_DUMMY" ServiceName="BCM_MASTER" AssignToVar="trt_in_d_upd">
                <DOCUMENT_CONTEXT>
                  <ID Value="{$ID_Final/@Value}"/>
                  <TRT_NAME_LOCAL Value="{$TRT_NAME_Final/@Value}"/>
                </DOCUMENT_CONTEXT>
                <UPDATE_PROPERTIES>
                  <STATUS Value="Rejected"/>
                </UPDATE_PROPERTIES>
              </MODIFY_DOC_SMART>
              <FOR_EACH CurrentElement="currElem" SelectList="$linkedPredfndTrt/PREDFND_TRT_VAL_IN_DUMMY">
                <SET Var="PREDFND_TRT_VAL_NBR" FromValue="{$currElem/PREDFND_TRT_VAL_NBR/@Value}"/>
                <SET Var="PREDFND_TRT_TXT" FromValue="{$currElem/PREDFND_TRT_VAL_NAME_LOCAL/@Value}"/>
                <SET Var="PREDFND_TRT_VAL_NAME" FromValue="{$currElem/PREDFND_TRT_VAL_NAME/@Value}"/>
                <SET Var="PRE_ID" FromValue="{$currElem/ID/@Value}"/>
                <DO_DB_PERSIST DocumentName="PREDFND_TRT_VAL_IN_DUMMY" ServiceName="BCM_MASTER" Action="UPDATE" AssignToVar="UPD_TRT_IN_DUMMY">
                  <DOCUMENT_CONTEXT>
                    <ID Value="{$PRE_ID/@Value}"/>
                    <TRT_NAME Value="{$TRT_NAME_Final/@Value}"/>
                  </DOCUMENT_CONTEXT>
                  <UPDATE_PROPERTIES>
                    <STATUS Value="Rejected"/>
                  </UPDATE_PROPERTIES>
                </DO_DB_PERSIST>
              </FOR_EACH>
            </THEN>
          </IF_TEST>
          <!-- Code written by Aishwarya ends -->
        </action>
      </actions>
      <next_nodes>
        <next_node Name="Dectsion on Notification"/>
      </next_nodes>
    </task>
    <decision Name="Dectsion on Notification">
      <actions>
        <action/>
      </actions>
      <condition Value="$thisParam/RESPONSE/EMAIL_NODE_TYPE/@Value='EMAIL'"/>
      <if_true>
        <next_nodes OutputVar="{messageType,String}"/>
      </if_true>
      <if_false>
        <next_nodes OutputVar="{messageType,String}">
          <next_node Name="Copy_of_Stop" Description=""/>
        </next_nodes>
      </if_false>
    </decision>
    <ui_form2 Name="ViewRecord" ShowInBreadCrumbs="SHOW" Template="viewRecord.pgl" InputFormVar="pglFormInput" OutputFormVar="pglFormOutput">
      <pre_actions>
        <action>
          <TO_DOCVAR AssignToVar="pglFormInput">
            <root/>
          </TO_DOCVAR>
          <SET Var="fromViewRecordPage" FromValue="yes"/>
          <IF_TEST Test="$stepInfo/Container2SelectedStep/@Value=null">
            <THEN>
              <TO_DOCVAR AssignToVar="stepInfo">
                <step>
                  <APPEND_TO_XML>
                    <Container1SelectedStep Value="{$thisParam/container1_SELECTED_STEP/@Value}"/>
                    <Container1SelectedStepId Value="{$thisParam/container1_STEP_ID/@Value}"/>
                    <Container2SelectedStep Value="{$thisParam/container2_SELECTED_STEP/@Value}"/>
                    <Container2SelectedStepId Value="{$thisParam/container2_STEP_ID/@Value}"/>
                  </APPEND_TO_XML>
                </step>
              </TO_DOCVAR>
            </THEN>
          </IF_TEST>
          <IF_TEST Test="($thisParam/container1_SELECTED_STEP =null )and ($thisParam/container2_SELECTED_STEP =null)">
            <THEN>
              <SET_PROPS SelectList="$thisParam">
                <Container1_STEP_ID Value="{$stepInfo/Container1SelectedStepId/@Value}" Overwrite="true"/>
                <Container1_SELECTED_STEP Value="{$stepInfo/Container1SelectedStep/@Value}" Overwrite="true"/>
                <container2_STEP_ID Value="{$stepInfo/Container2SelectedStepId/@Value}" Overwrite="true"/>
                <container2_SELECTED_STEP Value="{$stepInfo/Container2SelectedStep/@Value}" Overwrite="true"/>
              </SET_PROPS>
            </THEN>
          </IF_TEST>
          <IF_TEST Test="$thisParam/container2_SELECTED_STEP/@Value='History'">
            <THEN>
              <TO_DOCVAR AssignToVar="pglFormInput">
                <ROOT/>
              </TO_DOCVAR>
            </THEN>
            <ELSE>
              <TO_DOCVAR AssignToVar="pglFormInput">
                <ROOT>
                  <AcceptRejectEnabled Value="true"/>
                </ROOT>
              </TO_DOCVAR>
            </ELSE>
          </IF_TEST>
          <REQUEST Name="viewApprovalRecords" AssignToVar="resultVar">
            <TO_XML SelectList="$thisParam/*"/>
          </REQUEST>
          <ADD_CHILDREN DocVar="pglFormInput" FromSelectList="$DocID/*"/>
          <ADD_CHILDREN DocVar="pglFormInput" FromSelectList="$resultVar/*"/>
          <!--Code written by Ankita Sadhwani Starts-->
          <!--Lookup table for selecting SUBSCRPTN_OPT_NBR, SUBSCRPTN_OPT_STMT_TXT & SUBSCRPTN_OPT_NAME(Hidden)-->
          <IF_TEST Test="$thisParam/BUTTON_ID/@Value='select_and_return' or $thisParam/BUTTON_ID/@Value='Back' or $thisParam/BUTTON_ID/@Value='cancel' or $thisParam/BUTTON_ID/@Value='Back1' or $thisParam/BUTTON_ID/@Value='HistoryOfRecord'">
            <!--<IF_TEST Test="$thisParam/BUTTON_ID/@Value='select_and_return' or $thisParam/BUTTON_ID/@Value='cancel' or $thisParam/BUTTON_ID/@Value='Back1' or $thisParam/BUTTON_ID/@Value='HistoryOfRecord'">-->
            <THEN>
              <IF_TEST Test="$thisParam/PAGE_NAME/@Value='ADMIN_UI.ApprovalInbox.SUBSCRPTN_OPT_Lookup.pgl'">
                <THEN>
                  <IF_TEST Test="$toViewRecordIndicator/@Value='true'">
                    <THEN>
                      <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_NBR">
                        <SUBSCRPTN_OPT_Number>
                          <SUBSCRPTN_OPT_NBR Value="{$toViewRecord/SUBSCRPTN_OPT_NBR/@Value}"/>
                        </SUBSCRPTN_OPT_Number>
                      </TO_DOCVAR>
                      <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_STMT_TXT">
                        <SUBSCRPTN_OPT_STMT_TXT>
                          <SUBSCRPTN_OPT_STMT_TXT Value="{$toViewRecord/SUBSCRPTN_OPT_STMT_TXT/@Value}"/>
                        </SUBSCRPTN_OPT_STMT_TXT>
                      </TO_DOCVAR>
                      <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_NAME">
                        <SUBSCRPTN_OPT_NAME>
                          <SUBSCRPTN_OPT_NAME Value="{$toViewRecord/SUBSCRPTN_OPT_NAME/@Value}"/>
                        </SUBSCRPTN_OPT_NAME>
                      </TO_DOCVAR>
                      <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_START_DATE">
                        <SUBSCRPTN_OPT_START_DATE>
                          <SUBSCRPTN_OPT_START_DATE Value="{$toViewRecord/SUBSCRPTN_OPT_START_DATE/@Value}"/>
                        </SUBSCRPTN_OPT_START_DATE>
                      </TO_DOCVAR>
                      <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_END_DATE">
                        <SUBSCRPTN_OPT_END_DATE>
                          <SUBSCRPTN_OPT_END_DATE Value="{$toViewRecord/SUBSCRPTN_OPT_END_DATE/@Value}"/>
                        </SUBSCRPTN_OPT_END_DATE>
                      </TO_DOCVAR>
                    </THEN>
                    <ELSE>
                      <IF_TEST Test="$retainVal_1_indicator/@Value='true'">
                        <THEN>
                          <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_NBR">
                            <SUBSCRPTN_OPT_Number>
                              <SUBSCRPTN_OPT_NBR Value="{$retainVal_1/SUBSCRPTN_OPT_NBR/@Value}"/>
                            </SUBSCRPTN_OPT_Number>
                          </TO_DOCVAR>
                          <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_STMT_TXT">
                            <SUBSCRPTN_OPT_STMT_TXT>
                              <SUBSCRPTN_OPT_STMT_TXT Value="{$retainVal_1/SUBSCRPTN_OPT_STMT_TXT/@Value}"/>
                            </SUBSCRPTN_OPT_STMT_TXT>
                          </TO_DOCVAR>
                          <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_NAME">
                            <SUBSCRPTN_OPT_NAME>
                              <SUBSCRPTN_OPT_NAME Value="{$retainVal_1/SUBSCRPTN_OPT_NAME/@Value}"/>
                            </SUBSCRPTN_OPT_NAME>
                          </TO_DOCVAR>
                          <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_START_DATE">
                            <SUBSCRPTN_OPT_START_DATE>
                              <SUBSCRPTN_OPT_START_DATE Value="{$thisParam/SUBSCRPTN_OPT_START_DATE/@Value}"/>
                            </SUBSCRPTN_OPT_START_DATE>
                          </TO_DOCVAR>
                          <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_END_DATE">
                            <SUBSCRPTN_OPT_END_DATE>
                              <SUBSCRPTN_OPT_END_DATE Value="{$thisParam/SUBSCRPTN_OPT_END_DATE/@Value}"/>
                            </SUBSCRPTN_OPT_END_DATE>
                          </TO_DOCVAR>
                        </THEN>
                        <ELSE>
                          <!--<TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_NBR">
                            <SUBSCRPTN_OPT_Number>
                              <SUBSCRPTN_OPT_NBR Value="{$thisParam/SUBSCRPTN_OPT_NBR/@Value}"/>
                            </SUBSCRPTN_OPT_Number>
                          </TO_DOCVAR>
                          <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_STMT_TXT">
                            <SUBSCRPTN_OPT_STMT_TXT>
                              <SUBSCRPTN_OPT_STMT_TXT Value="{$thisParam/SUBSCRPTN_OPT_STMT_TXT/@Value}"/>
                            </SUBSCRPTN_OPT_STMT_TXT>
                          </TO_DOCVAR>
                          <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_NAME">
                            <SUBSCRPTN_OPT_NAME>
                              <SUBSCRPTN_OPT_NAME Value="{$thisParam/SUBSCRPTN_OPT_NAME/@Value}"/>
                            </SUBSCRPTN_OPT_NAME>
                          </TO_DOCVAR>-->
                          <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_NBR">
                            <SUBSCRPTN_OPT_Number>
                              <SUBSCRPTN_OPT_NBR Value="{$thisParam_SUBSCRPTN_OPT_NBR/SUBSCRPTN_OPT_NBR/@Value}"/>
                            </SUBSCRPTN_OPT_Number>
                          </TO_DOCVAR>
                          <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_STMT_TXT">
                            <SUBSCRPTN_OPT_STMT_TXT>
                              <SUBSCRPTN_OPT_STMT_TXT Value="{$thisParam_SUBSCRPTN_OPT_STMT_TXT/SUBSCRPTN_OPT_STMT_TXT/@Value}"/>
                            </SUBSCRPTN_OPT_STMT_TXT>
                          </TO_DOCVAR>
                          <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_NAME">
                            <SUBSCRPTN_OPT_NAME>
                              <SUBSCRPTN_OPT_NAME Value="{$thisParam_SUBSCRPTN_OPT_NAME/SUBSCRPTN_OPT_NAME/@Value}"/>
                            </SUBSCRPTN_OPT_NAME>
                          </TO_DOCVAR>
                          <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_NAME">
                            <SUBSCRPTN_OPT_NAME>
                              <SUBSCRPTN_OPT_NAME Value="{$thisParam/SUBSCRPTN_OPT_NAME/@Value}"/>
                            </SUBSCRPTN_OPT_NAME>
                          </TO_DOCVAR>
                          <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_START_DATE">
                            <SUBSCRPTN_OPT_START_DATE>
                              <SUBSCRPTN_OPT_START_DATE Value="{$thisParam/SUBSCRPTN_OPT_START_DATE/@Value}"/>
                            </SUBSCRPTN_OPT_START_DATE>
                          </TO_DOCVAR>
                          <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_END_DATE">
                            <SUBSCRPTN_OPT_END_DATE>
                              <SUBSCRPTN_OPT_END_DATE Value="{$thisParam/SUBSCRPTN_OPT_END_DATE/@Value}"/>
                            </SUBSCRPTN_OPT_END_DATE>
                          </TO_DOCVAR>
                        </ELSE>
                      </IF_TEST>
                    </ELSE>
                  </IF_TEST>
                </THEN>
                <ELSE>
                  <IF_TEST Test="$thisParam/PAGE_NAME/@Value='ADMIN_UI.ApprovalInbox.SUBSCRPTN_OPT_Create.pgl'">
                    <THEN>
                      <IF_TEST Test="$retainVal_1_indicator/@Value='true'">
                        <THEN>
                          <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_NBR">
                            <SUBSCRPTN_OPT_Number>
                              <SUBSCRPTN_OPT_NBR Value="{$retainVal_1/SUBSCRPTN_OPT_NBR/@Value}"/>
                            </SUBSCRPTN_OPT_Number>
                          </TO_DOCVAR>
                          <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_STMT_TXT">
                            <SUBSCRPTN_OPT_STMT_TXT>
                              <SUBSCRPTN_OPT_STMT_TXT Value="{$retainVal_1/SUBSCRPTN_OPT_STMT_TXT/@Value}"/>
                            </SUBSCRPTN_OPT_STMT_TXT>
                          </TO_DOCVAR>
                          <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_NAME">
                            <SUBSCRPTN_OPT_NAME>
                              <SUBSCRPTN_OPT_NAME Value="{$retainVal_1/SUBSCRPTN_OPT_NAME/@Value}"/>
                            </SUBSCRPTN_OPT_NAME>
                          </TO_DOCVAR>
                          <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_START_DATE">
                            <SUBSCRPTN_OPT_START_DATE>
                              <SUBSCRPTN_OPT_START_DATE Value="{$retainVal_1/SUBSCRPTN_OPT_START_DATE/@Value}"/>
                            </SUBSCRPTN_OPT_START_DATE>
                          </TO_DOCVAR>
                          <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_END_DATE">
                            <SUBSCRPTN_OPT_END_DATE>
                              <SUBSCRPTN_OPT_END_DATE Value="{$retainVal_1/SUBSCRPTN_OPT_END_DATE/@Value}"/>
                            </SUBSCRPTN_OPT_END_DATE>
                          </TO_DOCVAR>
                        </THEN>
                        <ELSE>
                          <!--<IF_TEST Test="$thisParam/BUTTON_ID/@Value='Back'">
                            <THEN>-->
                          <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_NBR">
                            <SUBSCRPTN_OPT_Number>
                              <SUBSCRPTN_OPT_NBR Value="{$toViewRecord/SUBSCRPTN_OPT_NBR/@Value}"/>
                            </SUBSCRPTN_OPT_Number>
                          </TO_DOCVAR>
                          <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_STMT_TXT">
                            <SUBSCRPTN_OPT_STMT_TXT>
                              <SUBSCRPTN_OPT_STMT_TXT Value="{$toViewRecord/SUBSCRPTN_OPT_STMT_TXT/@Value}"/>
                            </SUBSCRPTN_OPT_STMT_TXT>
                          </TO_DOCVAR>
                          <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_NAME">
                            <SUBSCRPTN_OPT_NAME>
                              <SUBSCRPTN_OPT_NAME Value="{$toViewRecord/SUBSCRPTN_OPT_NAME/@Value}"/>
                            </SUBSCRPTN_OPT_NAME>
                          </TO_DOCVAR>
                          <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_START_DATE">
                            <SUBSCRPTN_OPT_START_DATE>
                              <SUBSCRPTN_OPT_START_DATE Value="{$retainVal/SUBSCRPTN_OPT_START_DATE/@Value}"/>
                            </SUBSCRPTN_OPT_START_DATE>
                          </TO_DOCVAR>
                          <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_END_DATE">
                            <SUBSCRPTN_OPT_END_DATE>
                              <SUBSCRPTN_OPT_END_DATE Value="{$retainVal/SUBSCRPTN_OPT_END_DATE/@Value}"/>
                            </SUBSCRPTN_OPT_END_DATE>
                          </TO_DOCVAR>
                          <!--</THEN>
                          </IF_TEST>-->
                        </ELSE>
                      </IF_TEST>
                    </THEN>
                  </IF_TEST>
                </ELSE>
              </IF_TEST>
              <!--Remove values of SUBSCRPTN_OPT_NBR from View Records table containing 
              values for and add values for them SUBSCRPTN_OPT_NBR(in SUBSCRPTN_OPT_NBR
              selected from Lookup/Created(add inside Lookup))-->
              <FOR_EACH SelectList="$getAllRecords/DocumentAttributes" CurrentElement="curr_NewView">
                <IF_TEST Test="$curr_NewView/AttributeID/@Value= 'SUBSCRPTN_OPT_NBR'">
                  <THEN>
                    <TO_DOCVAR AssignToVar="AttrVal">
                      <AttributeValue Value="{$varSUBSCRPTN_OPT_NBR/SUBSCRPTN_OPT_NBR/@Value}"/>
                    </TO_DOCVAR>
                    <REMOVE_CHILDREN DocVar="curr_NewView" ChildName="AttributeValue"/>
                    <ADD_CHILDREN DocVar="curr_NewView" FromDocVar="AttrVal"/>
                    <EXECUTE_SQL_QUERY AssignToVar="upd_doc_attr" Value="upd AW_DOC_ATTR set ATTRIBUTEVALUE='{$varSUBSCRPTN_OPT_NBR/SUBSCRPTN_OPT_NBR/@Value}' where INSTANCEID='{$curr_NewView/InstanceID/@Value}'  and ATTRIBUTEID='SUBSCRPTN_OPT_NBR'"/>
                  </THEN>
                  <!--<ELSE>
                    <IF_TEST Test="$curr_NewView/AttributeID/@Value ='ENG_TXT'">
                      <THEN>
                        <TO_DOCVAR AssignToVar="AttrVal">
                          <AttributeValue Value="{$varSUBSCRPTN_OPT_STMT_TXT/SUBSCRPTN_OPT_STMT_TXT/@Value}"/>
                        </TO_DOCVAR>
                        <REMOVE_CHILDREN DocVar="curr_NewView" ChildName="AttributeValue"/>
                        <ADD_CHILDREN DocVar="curr_NewView" FromDocVar="AttrVal"/>
                        <EXECUTE_SQL_QUERY AssignToVar="upd_doc_attr" Value="upd AW_DOC_ATTR set ATTRIBUTEVALUE='{$varSUBSCRPTN_OPT_STMT_TXT/SUBSCRPTN_OPT_STMT_TXT/@Value}' where INSTANCEID='{$curr_NewView/InstanceID/@Value}'  and ATTRIBUTEID='ENG_TXT'"/>
                      </THEN>
                    </IF_TEST>
                  </ELSE>-->
                </IF_TEST>
              </FOR_EACH>
              <ADD_CHILDREN DocVar="pglFormInput" FromSelectList="$getAllRecords/*"/>
            </THEN>
            <ELSE>
              <TO_DOCVAR AssignToVar="getAllRecords">
                <ROOT1/>
              </TO_DOCVAR>
              <ADD_CHILDREN DocVar="getAllRecords" FromSelectList="$pglFormInput/*"/>
            </ELSE>
          </IF_TEST>
          <!--<IF_TEST Test="$thisParam/BUTTON_ID/@Value='Back'">
            <THEN>
              <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_NBR">
                <SUBSCRPTN_OPT_Number>
                  <SUBSCRPTN_OPT_NBR Value="{$retainVal_1/SUBSCRPTN_OPT_NBR/@Value}"/>
                </SUBSCRPTN_OPT_Number>
              </TO_DOCVAR>
              <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_STMT_TXT">
                <SUBSCRPTN_OPT_STMT_TXT>
                  <SUBSCRPTN_OPT_STMT_TXT Value="{$retainVal_1/SUBSCRPTN_OPT_STMT_TXT/@Value}"/>
                </SUBSCRPTN_OPT_STMT_TXT>
              </TO_DOCVAR>
              <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_NAME">
                <SUBSCRPTN_OPT_NAME>
                  <SUBSCRPTN_OPT_NAME Value="{$retainVal_1/SUBSCRPTN_OPT_NAME/@Value}"/>
                </SUBSCRPTN_OPT_NAME>
              </TO_DOCVAR>
              <ADD_CHILDREN DocVar="pglFormInput" FromSelectList="$getAllRecords/*"/>
            </THEN>
            <ELSE>
              <TO_DOCVAR AssignToVar="getAllRecords">
                <ROOT1/>
              </TO_DOCVAR>
              <ADD_CHILDREN DocVar="getAllRecords" FromSelectList="$pglFormInput/*"/>
            </ELSE>
          </IF_TEST>-->
          <!--Retains the values in the View Records Page created in Add inside Lookup-->
          <IF_TEST Test="$thisParam/BUTTON_ID/@Value='Back1'">
            <THEN>
              <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_NBR">
                <SUBSCRPTN_OPT_Number>
                  <SUBSCRPTN_OPT_NBR Value="{$thisParamBkp1/SUBSCRPTN_OPT_NBR/@Value}"/>
                </SUBSCRPTN_OPT_Number>
              </TO_DOCVAR>
              <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_STMT_TXT">
                <SUBSCRPTN_OPT_STMT_TXT>
                  <SUBSCRPTN_OPT_STMT_TXT Value="{$thisParamBkp1/SUBSCRPTN_OPT_STMT_TXT/@Value}"/>
                </SUBSCRPTN_OPT_STMT_TXT>
              </TO_DOCVAR>
              <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_NAME">
                <SUBSCRPTN_OPT_NAME>
                  <SUBSCRPTN_OPT_NAME Value="{$thisParamBkp1/SUBSCRPTN_OPT_NAME/@Value}"/>
                </SUBSCRPTN_OPT_NAME>
              </TO_DOCVAR>
              <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_START_DATE">
                <SUBSCRPTN_OPT_START_DATE>
                  <SUBSCRPTN_OPT_START_DATE Value="{$thisParamBkp1/SUBSCRPTN_OPT_START_DATE/@Value}"/>
                </SUBSCRPTN_OPT_START_DATE>
              </TO_DOCVAR>
              <TO_DOCVAR AssignToVar="varSUBSCRPTN_OPT_END_DATE">
                <SUBSCRPTN_OPT_END_DATE>
                  <SUBSCRPTN_OPT_END_DATE Value="{$thisParamBkp1/SUBSCRPTN_OPT_END_DATE/@Value}"/>
                </SUBSCRPTN_OPT_END_DATE>
              </TO_DOCVAR>
              <ADD_CHILDREN DocVar="pglFormInput" FromSelectList="$getAllRecords/*"/>
            </THEN>
            <ELSE>
              <TO_DOCVAR AssignToVar="getAllRecords">
                <ROOT1/>
              </TO_DOCVAR>
              <ADD_CHILDREN DocVar="getAllRecords" FromSelectList="$pglFormInput/*"/>
            </ELSE>
          </IF_TEST>
          <ADD_CHILDREN DocVar="pglFormInput" FromSelectList="$varSUBSCRPTN_OPT_NBR/*"/>
          <ADD_CHILDREN DocVar="pglFormInput" FromSelectList="$varSUBSCRPTN_OPT_STMT_TXT/*"/>
          <ADD_CHILDREN DocVar="pglFormInput" FromSelectList="$varSUBSCRPTN_OPT_NAME/*"/>
          <!--<ADD_CHILDREN DocVar="pglFormInput" FromSelectList="$thisParam_SUBSCRPTN_OPT_NBR/*"/>
          <ADD_CHILDREN DocVar="pglFormInput" FromSelectList="$thisParam_SUBSCRPTN_OPT_STMT_TXT/*"/>
          <ADD_CHILDREN DocVar="pglFormInput" FromSelectList="$thisParam_SUBSCRPTN_OPT_NAME/*"/>-->
          <ADD_CHILDREN DocVar="pglFormInput" FromSelectList="$varSUBSCRPTN_OPT_START_DATE/*"/>
          <ADD_CHILDREN DocVar="pglFormInput" FromSelectList="$varSUBSCRPTN_OPT_END_DATE/*"/>
          <IF_TEST Test="$thisParam/BUTTON_ID/@Value='select_and_return' or $thisParam/PAGE/@Value='ADMIN_UI.ApprovalInbox.SUBSCRPTN_OPT_Create.pgl'">
            <THEN>
              <TO_DOCVAR AssignToVar="QRYModifiedByInsert">
                <ROOT>
                  locking row for access select * from aw_doc_attr where instanceid='{$curr_NewView/InstanceID/@Value}' and attributeid='MODIFIED_BY'
                </ROOT>
              </TO_DOCVAR>
              <EXECUTE_SQL_QUERY AssignToVar="varModifiedByExists" Value="{$QRYModifiedByInsert/@text}" ReturnRowCount="yes"/>
              <IF_TEST Test="$varModifiedByExists/@TotalRowCount='0'">
                <THEN>
                  <TO_DOCVAR AssignToVar="varModifiedByUpdate">
                    <ROOT>
                      INSERT INTO AW_DOC_ATTR (ID,ATTRIBUTEID,ATTRIBUTEVALUE,INSTANCEID) VALUES ('{$curr_NewView/ID/@Value}_1','MODIFIED_BY','{$userId}','{$curr_NewView/InstanceID/@Value}')
                    </ROOT>
                  </TO_DOCVAR>
                  <EXECUTE_SQL_QUERY AssignToVar="ModifiedByUpdate" Value="{$varModifiedByUpdate/@text}" HandleException="true"/>
                </THEN>
                <ELSE>
                  <TO_DOCVAR AssignToVar="varModifiedByUpdate">
                    <ROOT>UPDATE AW_DOC_ATTR SET ATTRIBUTEVALUE='{$userId}'
WHERE INSTANCEID='{$curr_NewView/InstanceID/@Value}' AND ATTRIBUTEID='MODIFIED_BY';</ROOT>
                  </TO_DOCVAR>
                  <EXECUTE_SQL_QUERY AssignToVar="ModifiedByUpdate" Value="{$varModifiedByUpdate/@text}" HandleException="true"/>
                </ELSE>
              </IF_TEST>
            </THEN>
          </IF_TEST>
        </action>
      </pre_actions>
      <post_actions>
        <action/>
      </post_actions>
      <if_cond Value="$userAction ='Back'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="Approval Inbox" Description=""/>
        </next_nodes>
      </if_cond>
      <else_if_cond Value="$userAction ='REJECT'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="Reject" Description=""/>
        </next_nodes>
      </else_if_cond>
      <else_if_cond Value="$userAction ='ACCEPT'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="Approve" Description=""/>
        </next_nodes>
      </else_if_cond>
      <else_if_cond Value="$userAction = 'select_SUBSCRPTN_OPT'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="SUBSCRPTN_OPT_Lookup" Description=""/>
        </next_nodes>
      </else_if_cond>
      <else_if_cond Value="$userAction ='Create'">
        <next_nodes OutputVar="{outputXml,xml}"/>
      </else_if_cond>
      <else_if_cond Value="$userAction ='HistoryOfRecord'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="ViewRecord" Description=""/>
          <next_node Name="HistoryOfRecord" Description=""/>
        </next_nodes>
      </else_if_cond>
      <else_if_cond Value="true()">
        <next_nodes OutputVar="{outputXml,xml}"/>
      </else_if_cond>
    </ui_form2>
    <ui_form2 Name="SUBSCRPTN_OPT_Lookup" ShowInBreadCrumbs="HIDE" Template="SUBSCRPTN_OPT_Lookup.pgl" Description="SUBSCRPTN_OPT_Lookup" InputFormVar="pglFormInput" OutputFormVar="pglFormOutput">
      <pre_actions>
        <action>
          <SET Var="startRow2" FromValue="{$thisParam/START_COUNT/@Value}"/>
          <TO_DOCVAR AssignToVar="thisParam_SUBSCRPTN_OPT_NBR">
            <SUBSCRPTN_OPT_Number>
              <SUBSCRPTN_OPT_NBR Value="{$thisParam/SUBSCRPTN_OPT_NBR/@Value}"/>
            </SUBSCRPTN_OPT_Number>
          </TO_DOCVAR>
          <TO_DOCVAR AssignToVar="thisParam_SUBSCRPTN_OPT_STMT_TXT">
            <SUBSCRPTN_OPT_STMT_TXT>
              <SUBSCRPTN_OPT_STMT_TXT Value="{$thisParam/SUBSCRPTN_OPT_STMT_TXT/@Value}"/>
            </SUBSCRPTN_OPT_STMT_TXT>
          </TO_DOCVAR>
          <TO_DOCVAR AssignToVar="thisParam_SUBSCRPTN_OPT_NAME">
            <SUBSCRPTN_OPT_NAME>
              <SUBSCRPTN_OPT_NAME Value="{$varSUBSCRPTN_OPT_NAME/SUBSCRPTN_OPT_NAME/@Value}"/>
            </SUBSCRPTN_OPT_NAME>
          </TO_DOCVAR>
          <SET Var="toViewRecordIndicator" FromValue="false"/>
          <!--<IF_TEST Test="$thisParam/BUTTON_ID/@Value= 'select_SUBSCRPTN_OPT'">
            <THEN>-->
          <FOR_EACH SelectList="$getAllRecords/DocumentAttributes" CurrentElement="currElem">
            <IF_TEST Test="$currElem/AttributeID/@Value= 'MKTNG_PGM_NBR'">
              <THEN>
                <SET Var="MKTNG_PGM_NBR_1" FromValue="{$currElem/AttributeValue/@Value}"/>
              </THEN>
              <ELSE>
                <IF_TEST Test="$currElem/AttributeID/@Value ='LEGAL_ENT_NBR'">
                  <THEN>
                    <SET Var="LEGAL_ENT_NBR_1" FromValue="{$currElem/AttributeValue/@Value}"/>
                  </THEN>
                  <ELSE>
                    <IF_TEST Test="$currElem/AttributeID/@Value= 'DATA_SRCE_NBR'">
                      <THEN>
                        <SET Var="DATA_SRCE_NBR_1" FromValue="{$currElem/AttributeValue/@Value}"/>
                      </THEN>
                      <ELSE>
                        <IF_TEST Test="$currElem/AttributeID/@Value= 'ENG_TXT'">
                          <THEN>
                            <SET Var="ENG_TXT_1" FromValue="{$currElem/AttributeValue/@Value}"/>
                          </THEN>
                          <ELSE>
                            <IF_TEST Test="$currElem/AttributeID/@Value= 'LOCAL_TXT'">
                              <THEN>
                                <SET Var="LOCAL_TXT_1" FromValue="{$currElem/AttributeValue/@Value}"/>
                              </THEN>
                            </IF_TEST>
                          </ELSE>
                        </IF_TEST>
                      </ELSE>
                    </IF_TEST>
                  </ELSE>
                </IF_TEST>
              </ELSE>
            </IF_TEST>
          </FOR_EACH>
          <!--</THEN>
          </IF_TEST>-->
          <TO_DOCVAR AssignToVar="filter">
            <filter/>
          </TO_DOCVAR>
          <FORM_SEARCH_FILTER Value="{$thisParam}" AssignToVar="filter">
            <FILTER_MKTNG_PGM_NBR/>
            <FILTER_LEGAL_ENT_NBR/>
            <FILTER_SUBSCRPTN_OPT_NBR/>
            <FILTER_SUBSCRPTN_OPT_NAME/>
            <FILTER_PARNTL_CNSNT_IND/>
            <FILTER_SUBSCRPTN_OPT_STMT_TXT/>
          </FORM_SEARCH_FILTER>
          <FOR_EACH SelectList="$filter/*/*" CurrentElement="currentSearchColumn">
            <SET_NAME DocVar="currentSearchColumn" FromValue="{substringAfter($currentSearchColumn/name(),'FILTER_')}"/>
          </FOR_EACH>
          <GET_DOC_SMART Name="SUBSCRPTN_OPT" AssignToVar="getOptResults" DirtyRead="true" ReturnRowCount="yes" ServiceName="BCM_MASTER" StartAtRow="{$startRow2}">
            <TO_XML SelectList="$filter/*/*"/>
            <SELECT>
              <MKTNG_PGM_NBR/>
              <LEGAL_ENT_NBR/>
              <SUBSCRPTN_OPT_NBR/>
              <SUBSCRPTN_OPT_NAME/>
              <PARNTL_CNSNT_IND/>
              <SUBSCRPTN_OPT_STMT_TXT/>
            </SELECT>
          </GET_DOC_SMART>
          <TO_DOCVAR AssignToVar="getFinalOptResults">
            <ROOT>
              <TO_XML SelectList="$getOptResults"/>
            </ROOT>
          </TO_DOCVAR>
          <TO_DOCVAR AssignToVar="retainViewRecords">
            <RETAIN>
              <MKTNG_PGM_NBR Value="{$MKTNG_PGM_NBR_1}"/>
              <LEGAL_ENT_NBR Value="{$LEGAL_ENT_NBR_1}"/>
              <DATA_SRCE_NBR Value="{$DATA_SRCE_NBR_1}"/>
              <ENG_TXT Value="{$ENG_TXT_1}"/>
              <LOCAL_TXT Value="{$LOCAL_TXT_1}"/>
            </RETAIN>
          </TO_DOCVAR>
          <TO_DOCVAR AssignToVar="pglFormInput">
            <ROOT>
              <TO_XML SelectList="$getOptResults"/>
              <TO_XML SelectList="$retainViewRecords/*"/>
              <SUBSCRPTN_OPT_START_DATE Value="{$thisParam/SUBSCRPTN_OPT_START_DATE/@Value}"/>
              <SUBSCRPTN_OPT_END_DATE Value="{$thisParam/SUBSCRPTN_OPT_END_DATE/@Value}"/>
              <RowCount Value="{$getOptResults/@TotalRowCount}"/>
            </ROOT>
          </TO_DOCVAR>
        </action>
      </pre_actions>
      <post_actions>
        <action>
          <IF_TEST Test="$userAction='select_and_return'">
            <THEN>
              <SET Var="toViewRecordIndicator" FromValue="true"/>
              <TO_DOCVAR AssignToVar="forViewRecord">
                <ROOT>
                  <SUBSCRPTN_OPT_NBR Value="{substringBefore(substringAfter($thisParam/SELECTED_ID/@Value,'SUBSCRPTN_OPT_NBR='),'#')}"/>
                  <SUBSCRPTN_OPT_STMT_TXT Value="{substringBefore(substringAfter(substringAfter($thisParam/SELECTED_ID/@Value,'SUBSCRPTN_OPT_NBR='),'SUBSCRPTN_OPT_STMT_TXT='),'#')}"/>
                  <SUBSCRPTN_OPT_NAME Value="{substringAfter(substringAfter(substringAfter($thisParam/SELECTED_ID/@Value,'SUBSCRPTN_OPT_NBR='),'SUBSCRPTN_OPT_STMT_TXT='),'SUBSCRPTN_OPT_NAME=')}"/>
                  <SUBSCRPTN_OPT_START_DATE Value="{$thisParam/SUBSCRPTN_OPT_START_DATE/@Value}"/>
                  <SUBSCRPTN_OPT_END_DATE Value="{$thisParam/SUBSCRPTN_OPT_END_DATE/@Value}"/>
                </ROOT>
              </TO_DOCVAR>
              <TO_DOCVAR AssignToVar="thisReturn">
                <TO_XML SelectList="$forViewRecord"/>
              </TO_DOCVAR>
              <TO_DOCVAR AssignToVar="toViewRecord">
                <TO_XML SelectList="$thisReturn"/>
              </TO_DOCVAR>
            </THEN>
          </IF_TEST>
        </action>
      </post_actions>
      <if_cond Value="$userAction ='cancel'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="ViewRecord" Description=""/>
        </next_nodes>
      </if_cond>
      <else_if_cond Value="$userAction ='select_and_return'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="ViewRecord" Description=""/>
        </next_nodes>
      </else_if_cond>
      <else_if_cond Value="$userAction ='Add'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="SUBSCRPTN_OPTandOPT_TypeCreate" Description=""/>
        </next_nodes>
      </else_if_cond>
      <else_if_cond Value="true()">
        <next_nodes OutputVar="{outputXml,xml}"/>
      </else_if_cond>
    </ui_form2>
    <ui_form2 Name="SUBSCRPTN_OPTandOPT_TypeCreate" Description="SUBSCRPTN_OPTandOPT_TypeCreate" ShowInBreadCrumbs="HIDE" Template="SUBSCRPTN_OPT_Create.pgl" InputFormVar="pglFormInput" OutputFormVar="pglFormOutput">
      <pre_actions>
        <action>
          <TO_DOCVAR AssignToVar="pglFormInput">
            <ROOT/>
          </TO_DOCVAR>
          <IF_TEST Test="$thisParam/BUTTON_ID/@Value='Submit'">
            <THEN>
              <REMOVE_CHILDREN SelectList="$thisParam/*" ChildName="alertMsg"/>
            </THEN>
          </IF_TEST>
          <IF_TEST Test="$userAction='Add' or $userAction='Create' or $userAction='CreateOptType' or $userAction='Submit'">
            <THEN>
              <FOR_EACH SelectList="$getAllRecords/DocumentAttributes" CurrentElement="currElem">
                <IF_TEST Test="$currElem/AttributeID/@Value= 'MKTNG_PGM_NBR'">
                  <THEN>
                    <SET Var="MKTNG_PGM_NBR_2" FromValue="{$currElem/AttributeValue/@Value}"/>
                  </THEN>
                  <ELSE>
                    <IF_TEST Test="$currElem/AttributeID/@Value ='LEGAL_ENT_NBR'">
                      <THEN>
                        <SET Var="LEGAL_ENT_NBR_2" FromValue="{$currElem/AttributeValue/@Value}"/>
                      </THEN>
                      <ELSE>
                        <IF_TEST Test="$currElem/AttributeID/@Value= 'DATA_SRCE_NBR'">
                          <THEN>
                            <SET Var="DATA_SRCE_NBR_2" FromValue="{$currElem/AttributeValue/@Value}"/>
                          </THEN>
                        </IF_TEST>
                      </ELSE>
                    </IF_TEST>
                    <TO_DOCVAR AssignToVar="retainVal">
                      <RETAIN>
                        <MKTNG_PGM_NBR Value="{$MKTNG_PGM_NBR_2}"/>
                        <LEGAL_ENT_NBR Value="{$LEGAL_ENT_NBR_2}"/>
                        <DATA_SRCE_NBR Value="{$DATA_SRCE_NBR_2}"/>
                        <SUBSCRPTN_OPT_START_DATE Value="{$thisParam/SUBSCRPTN_OPT_START_DATE/@Value}"/>
                        <SUBSCRPTN_OPT_END_DATE Value="{$thisParam/SUBSCRPTN_OPT_END_DATE/@Value}"/>
                      </RETAIN>
                    </TO_DOCVAR>
                  </ELSE>
                </IF_TEST>
              </FOR_EACH>
              <ADD_CHILDREN DocVar="pglFormInput" FromSelectList="$retainVal/*"/>
            </THEN>
          </IF_TEST>
          <SET Var="retainVal_1_indicator" FromValue="false"/>
          <IF_TEST Test="$userAction='Create' or $userAction='CreateOptType' or $userAction='Submit'">
            <THEN>
              <SET Var="retainVal_1_indicator" FromValue="true"/>
              <TO_DOCVAR AssignToVar="retainVal_1">
                <RETAIN_1>
                  <SUBSCRPTN_OPT_NBR Value="{$thisParam/SUBSCRPTN_OPT_NBR/@Value}"/>
                  <SUBSCRPTN_OPT_NAME Value="{$thisParam/SUBSCRPTN_OPT_NAME/@Value}"/>
                  <SUBSCRPTN_OPT_STMT_TXT Value="{$thisParam/SUBSCRPTN_OPT_STMT_TXT/@Value}"/>
                  <SUBSCRPTN_OPT_START_DATE Value="{$thisParam/SUBSCRPTN_OPT_START_DATE/@Value}"/>
                  <SUBSCRPTN_OPT_END_DATE Value="{$thisParam/SUBSCRPTN_OPT_END_DATE/@Value}"/>
                </RETAIN_1>
              </TO_DOCVAR>
              <ADD_CHILDREN DocVar="pglFormInput" FromSelectList="$retainVal_1/*"/>
              <TO_DOCVAR AssignToVar="retainVal_2">
                <RETAIN_2>
                  <SUBSCRPTN_OPT_NBR Value="{$thisParam/SUBSCRPTN_OPT_NBR/@Value}"/>
                  <SUBSCRPTN_OPT_FREQ_TXT Value="{$thisParam/SUBSCRPTN_OPT_FREQ_TXT/@Value}"/>
                  <CNTCT_CHANL_TYPE_CODE Value="{$thisParam/CNTCT_CHANL_TYPE_CODE/@Value}"/>
                  <CNTCT_POINT_CATEG_CODE Value="{$thisParam/CNTCT_POINT_CATEG_CODE/@Value}"/>
                </RETAIN_2>
              </TO_DOCVAR>
              <ADD_CHILDREN DocVar="pglFormInput" FromSelectList="$retainVal_2/*"/>
            </THEN>
          </IF_TEST>
          <!--Enable/Disable the container for SUBSCRPTN_OPT_TYPE-->
          <IF_TEST Test="$userAction='Add' or $userAction='Create'">
            <THEN>
              <TO_DOCVAR AssignToVar="containerHide">
                <ContainerHide Value="true"/>
              </TO_DOCVAR>
            </THEN>
            <ELSE>
              <TO_DOCVAR AssignToVar="containerHide">
                <ContainerHide Value="false"/>
              </TO_DOCVAR>
              <ADD_CHILDREN DocVar="pglFormInput" FromDocVar="containerHide"/>
            </ELSE>
          </IF_TEST>
          <IF_TEST Test="$userAction= 'Create'">
            <THEN>
              <DO_DB_PERSIST DocumentName="SUBSCRPTN_OPT" AssignToVar="createOptNum" ServiceName="BCM_MASTER" Action="INSERT" Source="EXTERNAL">
                <MKTNG_PGM_NBR Value="{$MKTNG_PGM_NBR_2/@Value}"/>
                <LEGAL_ENT_NBR Value="{$LEGAL_ENT_NBR_2/@Value}"/>
                <SUBSCRPTN_OPT_NBR Value="{$thisParam/SUBSCRPTN_OPT_NBR/@Value}"/>
                <SUBSCRPTN_OPT_NAME Value="{$thisParam/SUBSCRPTN_OPT_NAME/@Value}"/>
                <SUBSCRPTN_OPT_STMT_TXT Value="{$thisParam/SUBSCRPTN_OPT_STMT_TXT/@Value}"/>
              </DO_DB_PERSIST>
              <TO_DOCVAR AssignToVar="createOptNumRetain">
                <createOptNum>
                  <MKTNG_PGM_NBR Value="{$MKTNG_PGM_NBR_2/@Value}"/>
                  <LEGAL_ENT_NBR Value="{$LEGAL_ENT_NBR_2/@Value}"/>
                  <SUBSCRPTN_OPT_NBR Value="{$thisParam/SUBSCRPTN_OPT_NBR/@Value}"/>
                  <SUBSCRPTN_OPT_NAME Value="{$thisParam/SUBSCRPTN_OPT_NAME/@Value}"/>
                  <SUBSCRPTN_OPT_STMT_TXT Value="{$thisParam/SUBSCRPTN_OPT_STMT_TXT/@Value}"/>
                </createOptNum>
              </TO_DOCVAR>
              <IF_TEST Test="$createOptNum/VALIDATION_RESULT/@Value ='SUCCESS'">
                <THEN>
                  <TO_DOCVAR AssignToVar="optTypeEnable">
                    <optTypeEnable1>
                      <optTypeEnable Value="TRUE"/>
                    </optTypeEnable1>
                  </TO_DOCVAR>
                  <SET Var="alertGreen" FromValue="Record Created Successfully."/>
                  <SET Var="alertRed" FromValue=""/>
                </THEN>
                <ELSE>
                  <SET Var="alertGreen" FromValue=""/>
                  <SET Var="alertRed" FromValue="{$createOptNum/VALIDATION_RESULT/ERROR_CODE/@Value}"/>
                </ELSE>
              </IF_TEST>
              <TO_DOCVAR AssignToVar="alertMsg">
                <MSG>
                  <AlertGreen Value="{$alertGreen/@Value}"/>
                  <AlertRed Value="{$alertRed/@Value}"/>
                </MSG>
              </TO_DOCVAR>
              <ADD_CHILDREN DocVar="pglFormInput" FromSelectList="$optTypeEnable"/>
              <ADD_CHILDREN DocVar="pglFormInput" FromSelectList="$alertMsg"/>
            </THEN>
          </IF_TEST>
          <IF_TEST Test="$userAction= 'Submit'">
            <THEN>
              <DO_DB_PERSIST Action="INSERT" AssignToVar="createOptTyp" DocumentName="SUBSCRPTN_OPT_TYPE" ServiceName="BCM_MASTER" Source="EXTERNAL" HandleException="true">
                <MKTNG_PGM_NBR Value="{$MKTNG_PGM_NBR_2/@Value}"/>
                <LEGAL_ENT_NBR Value="{$LEGAL_ENT_NBR_2/@Value}"/>
                <SUBSCRPTN_OPT_NBR Value="{$retainVal_1/SUBSCRPTN_OPT_NBR/@Value}"/>
                <CNTCT_CHANL_TYPE_CODE Value="{$thisParam/CNTCT_CHANL_TYPE_CODE/@Value}"/>
                <CNTCT_POINT_CATEG_CODE Value="{$thisParam/CNTCT_POINT_CATEG_CODE/@Value}"/>
              </DO_DB_PERSIST>
              <TO_DOCVAR AssignToVar="createOptTypRetain">
                <createOptTyp>
                  <MKTNG_PGM_NBR Value="{$MKTNG_PGM_NBR_2/@Value}"/>
                  <LEGAL_ENT_NBR Value="{$LEGAL_ENT_NBR_2/@Value}"/>
                  <SUBSCRPTN_OPT_NBR Value="{$retainVal_1/SUBSCRPTN_OPT_NBR/@Value}"/>
                  <CNTCT_CHANL_TYPE_CODE Value="{$thisParam/CNTCT_CHANL_TYPE_CODE/@Value}"/>
                  <CNTCT_POINT_CATEG_CODE Value="{$thisParam/CNTCT_POINT_CATEG_CODE/@Value}"/>
                </createOptTyp>
              </TO_DOCVAR>
              <TO_DOCVAR AssignToVar="createOptTypCombine">
                <createOptTypCombine>
                  <TO_XML SelectList="$createOptTyp/*"/>
                </createOptTypCombine>
              </TO_DOCVAR>
              <IF_TEST Test="$createOptTyp/VALIDATION_RESULT/@Value ='SUCCESS'">
                <THEN>
                  <SET Var="alertGreen1" FromValue="Record Created Successfully."/>
                  <SET Var="alertRed1" FromValue=""/>
                </THEN>
                <ELSE>
                  <SET Var="alertGreen1" FromValue=""/>
                  <SET Var="alertRed1" FromValue="{$createOptTyp/VALIDATION_RESULT/ERROR_CODE/@Value}"/>
                </ELSE>
              </IF_TEST>
              <TO_DOCVAR AssignToVar="alertMsg1">
                <MSG1>
                  <AlertGreen Value="{$alertGreen1/@Value}"/>
                  <AlertRed Value="{$alertRed1/@Value}"/>
                </MSG1>
              </TO_DOCVAR>
              <ADD_CHILDREN DocVar="pglFormInput" FromSelectList="$alertMsg1"/>
            </THEN>
          </IF_TEST>
          <ADD_CHILDREN DocVar="thisReturn" FromSelectList="$createOptNumRetain"/>
          <ADD_CHILDREN DocVar="thisReturn" FromSelectList="$createOptTypRetain"/>
          <TO_DOCVAR AssignToVar="ifDataSubsOptTypeBeCreated">
            <ROOT/>
          </TO_DOCVAR>
          <ADD_CHILDREN DocVar="ifDataSubsOptTypeBeCreated" FromSelectList="$createOptTypCombine"/>
        </action>
      </pre_actions>
      <post_actions>
        <action/>
      </post_actions>
      <if_cond Value="$userAction ='cancel'">
        <next_nodes OutputVar="{outputXml,xml}"/>
      </if_cond>
      <else_if_cond Value="$userAction ='select_and_return'">
        <next_nodes OutputVar="{outputXml,xml}"/>
      </else_if_cond>
      <else_if_cond Value="$userAction ='Request'">
        <next_nodes OutputVar="{outputXml,xml}"/>
      </else_if_cond>
      <else_if_cond Value="$userAction ='Back'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="ViewRecord" Description=""/>
        </next_nodes>
      </else_if_cond>
      <else_if_cond Value="$userAction ='Create'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="SUBSCRPTN_OPTandOPT_TypeCreate" Description=""/>
        </next_nodes>
      </else_if_cond>
      <else_if_cond Value="$userAction ='CreateOptType'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="SUBSCRPTN_OPTandOPT_TypeCreate" Description=""/>
        </next_nodes>
      </else_if_cond>
      <else_if_cond Value="$userAction ='CreateOptTyp'">
        <next_nodes OutputVar="{outputXml,xml}"/>
      </else_if_cond>
      <else_if_cond Value="$userAction ='Submit'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="SUBSCRPTN_OPTandOPT_TypeCreate" Description=""/>
        </next_nodes>
      </else_if_cond>
      <else_if_cond Value="true()">
        <next_nodes OutputVar="{outputXml,xml}"/>
      </else_if_cond>
    </ui_form2>
    <ui_form2 Name="ViewRecord1" Description="ViewRecord1" ShowInBreadCrumbs="HIDE" Template="ViewRecord1.pgl" InputFormVar="pglFormInput" OutputFormVar="pglFormOutput">
      <pre_actions>
        <action>
          <SET Var="fromViewRecordPage" FromValue="yes"/>
          <IF_TEST Test="$stepInfo/Container2SelectedStep/@Value=null">
            <THEN>
              <TO_DOCVAR AssignToVar="stepInfo">
                <step>
                  <APPEND_TO_XML>
                    <Container1SelectedStep Value="{$thisParam/container1_SELECTED_STEP/@Value}"/>
                    <Container1SelectedStepId Value="{$thisParam/container1_STEP_ID/@Value}"/>
                    <Container2SelectedStep Value="{$thisParam/container2_SELECTED_STEP/@Value}"/>
                    <Container2SelectedStepId Value="{$thisParam/container2_STEP_ID/@Value}"/>
                  </APPEND_TO_XML>
                </step>
              </TO_DOCVAR>
            </THEN>
          </IF_TEST>
          <IF_TEST Test="($thisParam/container1_SELECTED_STEP =null )and ($thisParam/container2_SELECTED_STEP =null)">
            <THEN>
              <SET_PROPS SelectList="$thisParam">
                <Container1_STEP_ID Value="{$stepInfo/Container1SelectedStepId/@Value}" Overwrite="true"/>
                <Container1_SELECTED_STEP Value="{$stepInfo/Container1SelectedStep/@Value}" Overwrite="true"/>
                <container2_STEP_ID Value="{$stepInfo/Container2SelectedStepId/@Value}" Overwrite="true"/>
                <container2_SELECTED_STEP Value="{$stepInfo/Container2SelectedStep/@Value}" Overwrite="true"/>
              </SET_PROPS>
            </THEN>
          </IF_TEST>
          <IF_TEST Test="$thisParam/container2_SELECTED_STEP/@Value='History'">
            <THEN>
              <TO_DOCVAR AssignToVar="pglFormInput">
                <ROOT/>
              </TO_DOCVAR>
            </THEN>
            <ELSE>
              <TO_DOCVAR AssignToVar="pglFormInput">
                <ROOT>
                  <AcceptRejectEnabled Value="true"/>
                </ROOT>
              </TO_DOCVAR>
            </ELSE>
          </IF_TEST>
          <IF_TEST Test="$thisParam/@Name='ApprovalInbox.CreatePredfnd_SubWF'">
            <THEN>
              <APPEND_TO_XML DocVar="thisParam">
                <selected_ID Value="{$thisParam/ADDITIONAL_PARAMETERS/selected_ID/@Value}"/>
              </APPEND_TO_XML>
            </THEN>
          </IF_TEST>
          <REQUEST Name="viewApprovalRecords" AssignToVar="resultVar">
            <TO_XML SelectList="$thisParam/*"/>
          </REQUEST>
          <ADD_CHILDREN DocVar="pglFormInput" FromSelectList="$DocID/*"/>
          <ADD_CHILDREN DocVar="pglFormInput" FromSelectList="$resultVar/*"/>
          <!--   added by Aishwarya starts  -->
          <IF_TEST Test="$thisParam/BUTTON_ID/@Value='SEL_N_RTRN' or $thisParam/BUTTON_ID/@Value='Back' or $thisParam/BUTTON_ID/@Value='Back1' or $userAction='SEL_N_RTRN_1' or $userAction='BACK' or $thisParam/BUTTON_ID/@Value='SAVE'">
            <THEN>
              <ADD_CHILDREN DocVar="pglFormInput" FromSelectList="$getAllRecords/*"/>
              <IF_TEST Test="$userAction='SEL_N_RTRN_1'">
                <THEN>
                  <SET Var="selected_PREDFND_TRT_NBR" FromValue="{$thisParam/selected_PREDFND_TRT_NBR/@Value}"/>
                  <SET Var="selected_PREDFND_TRT_TXT" FromValue="{$thisParam/selected_PREDFND_TRT_TXT/@Value}"/>
                  <SET Var="selected_PREDFND_TRT_VAL_NAME" FromValue="{$thisParam/selected_PREDFND_TRT_VAL_NAME/@Value}"/>
                  <!-- local Linked Predefined TRT table value -->
                  <SET Var="PREDFND_TRT_VAL_NBR_1" FromValue="{substringBefore($selected_LINKED_PREDFND_TRT/@Value, '#')}"/>
                  <SET Var="PREDFND_TRT_VAL_NBR_1" FromValue="{substringAfter($PREDFND_TRT_VAL_NBR_1, '=')}"/>
                  <SET Var="selected_ID_2" FromValue="{substringAfter($selected_LINKED_PREDFND_TRT/@Value, '#')}"/>
                  <SET Var="PREDFND_TRT_VAL_NAME_1" FromValue="{substringBefore($selected_ID_2/@Value, '#')}"/>
                  <SET Var="PREDFND_TRT_VAL_NAME_1" FromValue="{substringAfter($PREDFND_TRT_VAL_NAME_1, '=')}"/>
                  <SET Var="PREDFND_TRT_TXT_1" FromValue="{substringAfter($selected_ID_2/@Value, '#')}"/>
                  <SET Var="PREDFND_TRT_TXT_1" FromValue="{substringAfter($PREDFND_TRT_TXT_1, '=')}"/>
                  <FOR_EACH CurrentElement="currElem" SelectList="$linkedPredfndTrt/PREDFND_TRT_VAL_IN_DUMMY">
                    <SET Var="PREDFND_TRT_VAL_NBR_ce" FromValue="{$currElem/PREDFND_TRT_VAL_NBR/@Value}"/>
                    <SET Var="PREDFND_TRT_TXT_ce" FromValue="{$currElem/PREDFND_TRT_TXT/@Value}"/>
                    <SET Var="PREDFND_TRT_TXT_LOCAL_ce" FromValue="{$currElem/PREDFND_TRT_TXT_LOCAL/@Value}"/>
                    <IF_TEST Test="$PREDFND_TRT_VAL_NBR_ce/@Value=$PREDFND_TRT_VAL_NBR_1/@Value and $PREDFND_TRT_TXT_ce/@Value=$PREDFND_TRT_VAL_NAME_1/@Value and $PREDFND_TRT_TXT_LOCAL_ce/@Value=$PREDFND_TRT_TXT_1/@Value">
                      <THEN>
                        <TO_DOCVAR AssignToVar="TRT_NBR_LOCL">
                          <TRT_NBR Value="{$lookup_TRT_NBR/@Value}"/>
                        </TO_DOCVAR>
                        <REMOVE_CHILDREN DocVar="currElem" ChildName="TRT_NBR"/>
                        <ADD_CHILDREN DocVar="currElem" FromDocVar="TRT_NBR_LOCL"/>
                        <TO_DOCVAR AssignToVar="TRT_NAME_LOCL">
                          <TRT_NAME Value="{$lookup_TRT_NAME_LOCAL/@Value}"/>
                        </TO_DOCVAR>
                        <REMOVE_CHILDREN DocVar="currElem" ChildName="TRT_NAME"/>
                        <ADD_CHILDREN DocVar="currElem" FromDocVar="TRT_NAME_LOCL"/>
                        <TO_DOCVAR AssignToVar="PREDFND_TRT_VAL_NBR_LOCL">
                          <PREDFND_TRT_VAL_NBR Value="{$selected_PREDFND_TRT_NBR/@Value}"/>
                        </TO_DOCVAR>
                        <REMOVE_CHILDREN DocVar="currElem" ChildName="PREDFND_TRT_VAL_NBR"/>
                        <ADD_CHILDREN DocVar="currElem" FromDocVar="PREDFND_TRT_VAL_NBR_LOCL"/>
                        <TO_DOCVAR AssignToVar="PREDFND_TRT_VAL_NAME_LOCL">
                          <PREDFND_TRT_TXT Value="{$selected_PREDFND_TRT_VAL_NAME/@Value}"/>
                        </TO_DOCVAR>
                        <REMOVE_CHILDREN DocVar="currElem" ChildName="PREDFND_TRT_TXT"/>
                        <ADD_CHILDREN DocVar="currElem" FromDocVar="PREDFND_TRT_VAL_NAME_LOCL"/>
                        <TO_DOCVAR AssignToVar="PREDFND_TRT_TXT_LOCL">
                          <PREDFND_TRT_TXT_LOCAL Value="{$selected_PREDFND_TRT_TXT/@Value}"/>
                        </TO_DOCVAR>
                        <REMOVE_CHILDREN DocVar="currElem" ChildName="PREDFND_TRT_TXT_LOCAL"/>
                        <ADD_CHILDREN DocVar="currElem" FromDocVar="PREDFND_TRT_TXT_LOCL"/>
                      </THEN>
                    </IF_TEST>
                  </FOR_EACH>
                  <MODIFY_DOC_SMART Name="PREDFND_TRT_VAL_IN_DUMMY" ServiceName="BCM_MASTER" AssignToVar="upd_linked_predfnd" HandleException="true">
                    <DOCUMENT_CONTEXT>
                      <TRT_NAME Value="{$lookup_TRT_NAME_LOCAL1/@Value}"/>
                      <PREDFND_TRT_VAL_NBR Value="{$PREDFND_TRT_VAL_NBR_1/@Value}"/>
                      <PREDFND_TRT_TXT Value="{$PREDFND_TRT_VAL_NAME_1/@Value}"/>
                      <PREDFND_TRT_TXT_LOCAL Value="{$PREDFND_TRT_TXT_1/@Value}"/>
                    </DOCUMENT_CONTEXT>
                    <UPDATE_PROPERTIES>
                      <TRT_NBR Value="{$lookup_TRT_NBR}"/>
                      <TRT_NAME Value="{$lookup_TRT_NAME_LOCAL}"/>
                      <!--<LEGAL_ENT_NBR Value="{lookup_LEGAL_ENT}"/>
                      <MKTNG_PGM_NBR Value="{lookup_MKTNG_PGM}"/>-->
                      <PREDFND_TRT_VAL_NBR Value="{$selected_PREDFND_TRT_NBR}"/>
                      <PREDFND_TRT_TXT Value="{$selected_PREDFND_TRT_VAL_NAME}"/>
                      <PREDFND_TRT_TXT_LOCAL Value="{$selected_PREDFND_TRT_TXT}"/>
                      <SYS_TARGET_ID Value="99"/>
                    </UPDATE_PROPERTIES>
                  </MODIFY_DOC_SMART>
                  <MODIFY_DOC_SMART Name="PREDFND_TRT_VAL_IN" ServiceName="BCM_MASTER" AssignToVar="upd_linked_predfnd_1" HandleException="true">
                    <DOCUMENT_CONTEXT>
                      <TRT_NAME Value="{$lookup_TRT_NAME_LOCAL1/@Value}"/>
                      <PREDFND_TRT_VAL_NBR Value="{$PREDFND_TRT_VAL_NBR_1/@Value}"/>
                      <PREDFND_TRT_TXT Value="{$PREDFND_TRT_VAL_NAME_1/@Value}"/>
                      <PREDFND_TRT_TXT_LOCAL Value="{$PREDFND_TRT_TXT_1/@Value}"/>
                    </DOCUMENT_CONTEXT>
                    <UPDATE_PROPERTIES>
                      <TRT_NBR Value="{$lookup_TRT_NBR}"/>
                      <TRT_NAME Value="{$lookup_TRT_NAME_LOCAL}"/>
                      <!--<LEGAL_ENT_NBR Value="{lookup_LEGAL_ENT}"/>
                      <MKTNG_PGM_NBR Value="{lookup_MKTNG_PGM}"/>-->
                      <PREDFND_TRT_VAL_NBR Value="{$selected_PREDFND_TRT_NBR}"/>
                      <PREDFND_TRT_TXT Value="{$selected_PREDFND_TRT_VAL_NAME}"/>
                      <PREDFND_TRT_TXT_LOCAL Value="{$selected_PREDFND_TRT_TXT}"/>
                      <SYS_TARGET_ID Value="99"/>
                    </UPDATE_PROPERTIES>
                  </MODIFY_DOC_SMART>
                </THEN>
              </IF_TEST>
              <IF_TEST Test="$thisParam/BUTTON_ID/@Value='SAVE' and $thisParam/RESPONSE/@Status='Success' and $thisParam/RESPONSE/VALIDATION_RESULT/@Value!='ERROR'">
                <THEN>
                  <SET Var="selected_TRT_NBR" FromValue="{$thisParam/TRT_NBR/@Value}"/>
                  <SET Var="selected_TRT_NAME" FromValue="{$thisParam/TRT_NAME/@Value}"/>
                  <MODIFY_DOC_SMART Name="TRT_IN_DUMMY" ServiceName="BCM_MASTER" AssignToVar="upd_trt_in_dummy" HandleException="true">
                    <DOCUMENT_CONTEXT>
                      <TRT_NAME Value="{$lookup_TRT_NAME/@Value}"/>
                    </DOCUMENT_CONTEXT>
                    <UPDATE_PROPERTIES>
                      <TRT_NBR Value="{$selected_TRT_NBR}"/>
                      <TRT_NAME_LOCAL Value="{$selected_TRT_NAME}"/>
                    </UPDATE_PROPERTIES>
                  </MODIFY_DOC_SMART>
                  <FOR_EACH SelectList="$getAllRecords/DocumentAttributes" CurrentElement="currElem">
                    <IF_TEST Test="$currElem/AttributeID/@Value= 'TRT_NBR'">
                      <THEN>
                        <TO_DOCVAR AssignToVar="AttrVal">
                          <AttributeValue Value="{$selected_TRT_NBR/@Value}"/>
                        </TO_DOCVAR>
                        <REMOVE_CHILDREN DocVar="currElem" ChildName="AttributeValue"/>
                        <ADD_CHILDREN DocVar="currElem" FromDocVar="AttrVal"/>
                        <EXECUTE_SQL_QUERY AssignToVar="upd_doc_attr" Value="upd AW_DOC_ATTR set ATTRIBUTEVALUE='{$selected_TRT_NBR/@Value}' where INSTANCEID='{$currElem/InstanceID/@Value}'  and ATTRIBUTEID='TRT_NBR'"/>
                      </THEN>
                      <ELSE>
                        <IF_TEST Test="$currElem/AttributeID/@Value ='TRT_NAME_LOCAL'">
                          <THEN>
                            <TO_DOCVAR AssignToVar="AttrVal">
                              <AttributeValue Value="{$selected_TRT_NAME/@Value}"/>
                            </TO_DOCVAR>
                            <REMOVE_CHILDREN DocVar="currElem" ChildName="AttributeValue"/>
                            <ADD_CHILDREN DocVar="currElem" FromDocVar="AttrVal"/>
                            <EXECUTE_SQL_QUERY AssignToVar="upd_doc_attr" Value="upd AW_DOC_ATTR set ATTRIBUTEVALUE='{$selected_TRT_NAME/@Value}' where INSTANCEID='{$currElem/InstanceID/@Value}'  and ATTRIBUTEID='TRT_NAME_LOCAL'"/>
                          </THEN>
                        </IF_TEST>
                      </ELSE>
                    </IF_TEST>
                  </FOR_EACH>
                </THEN>
              </IF_TEST>
              <IF_TEST Test="$thisParam/BUTTON_ID/@Value='SEL_N_RTRN'">
                <THEN>
                  <MODIFY_DOC_SMART Name="TRT_IN_DUMMY" ServiceName="BCM_MASTER" AssignToVar="upd_trt_in_dummy" HandleException="true">
                    <DOCUMENT_CONTEXT>
                      <TRT_NAME Value="{$lookup_TRT_NAME/@Value}"/>
                    </DOCUMENT_CONTEXT>
                    <UPDATE_PROPERTIES>
                      <TRT_NBR Value="{$selected_TRT_NBR}"/>
                      <TRT_NAME_LOCAL Value="{$selected_TRT_NAME}"/>
                    </UPDATE_PROPERTIES>
                  </MODIFY_DOC_SMART>
                  <FOR_EACH SelectList="$getAllRecords/DocumentAttributes" CurrentElement="currElem">
                    <IF_TEST Test="$currElem/AttributeID/@Value= 'TRT_NBR'">
                      <THEN>
                        <TO_DOCVAR AssignToVar="AttrVal">
                          <AttributeValue Value="{$selected_TRT_NBR/@Value}"/>
                        </TO_DOCVAR>
                        <REMOVE_CHILDREN DocVar="currElem" ChildName="AttributeValue"/>
                        <ADD_CHILDREN DocVar="currElem" FromDocVar="AttrVal"/>
                        <EXECUTE_SQL_QUERY AssignToVar="upd_doc_attr" Value="upd AW_DOC_ATTR set ATTRIBUTEVALUE='{$selected_TRT_NBR/@Value}' where INSTANCEID='{$currElem/InstanceID/@Value}'  and ATTRIBUTEID='TRT_NBR'"/>
                      </THEN>
                      <ELSE>
                        <IF_TEST Test="$currElem/AttributeID/@Value ='TRT_NAME_LOCAL'">
                          <THEN>
                            <TO_DOCVAR AssignToVar="AttrVal">
                              <AttributeValue Value="{$selected_TRT_NAME/@Value}"/>
                            </TO_DOCVAR>
                            <REMOVE_CHILDREN DocVar="currElem" ChildName="AttributeValue"/>
                            <ADD_CHILDREN DocVar="currElem" FromDocVar="AttrVal"/>
                            <EXECUTE_SQL_QUERY AssignToVar="upd_doc_attr" Value="upd AW_DOC_ATTR set ATTRIBUTEVALUE='{$selected_TRT_NAME/@Value}' where INSTANCEID='{$currElem/InstanceID/@Value}'  and ATTRIBUTEID='TRT_NAME_LOCAL'"/>
                          </THEN>
                        </IF_TEST>
                      </ELSE>
                    </IF_TEST>
                  </FOR_EACH>
                </THEN>
              </IF_TEST>
            </THEN>
            <ELSE>
              <TO_DOCVAR AssignToVar="getAllRecords">
                <ROOT1/>
              </TO_DOCVAR>
              <ADD_CHILDREN DocVar="getAllRecords" FromSelectList="$pglFormInput/*"/>
              <FOR_EACH SelectList="$getAllRecords/DocumentAttributes" CurrentElement="currElem">
                <IF_TEST Test="$currElem/AttributeID/@Value= 'TRT_NBR'">
                  <THEN>
                    <SET Var="lookup_TRT_NBR" FromValue="{$currElem/AttributeValue/@Value}"/>
                  </THEN>
                  <ELSE>
                    <IF_TEST Test="$currElem/AttributeID/@Value ='TRT_NAME'">
                      <THEN>
                        <SET Var="lookup_TRT_NAME" FromValue="{$currElem/AttributeValue/@Value}"/>
                      </THEN>
                      <ELSE>
                        <IF_TEST Test="$currElem/AttributeID/@Value ='LEGAL_ENT_NBR'">
                          <THEN>
                            <SET Var="lookup_LEGAL_ENT" FromValue="{$currElem/AttributeValue/@Value}"/>
                          </THEN>
                          <ELSE>
                            <IF_TEST Test="$currElem/AttributeID/@Value ='MKTNG_PGM_NBR'">
                              <THEN>
                                <SET Var="lookup_MKTNG_PGM" FromValue="{$currElem/AttributeValue/@Value}"/>
                              </THEN>
                              <ELSE>
                                <IF_TEST Test="$currElem/AttributeID/@Value ='TRT_NAME_LOCAL'">
                                  <THEN>
                                    <SET Var="lookup_TRT_NAME_LOCAL" FromValue="{$currElem/AttributeValue/@Value}"/>
                                  </THEN>
                                  <ELSE>
                                    <IF_TEST Test="$currElem/AttributeID/@Value ='DISPLAY_TYPE'">
                                      <THEN>
                                        <SET Var="lookup_DISPLAY_TYPE" FromValue="{$currElem/AttributeValue/@Value}"/>
                                      </THEN>
                                    </IF_TEST>
                                  </ELSE>
                                </IF_TEST>
                              </ELSE>
                            </IF_TEST>
                          </ELSE>
                        </IF_TEST>
                      </ELSE>
                    </IF_TEST>
                  </ELSE>
                </IF_TEST>
              </FOR_EACH>
              <GET_DOC_SMART Name="PREDFND_TRT_VAL_IN_DUMMY" AssignToVar="GET_PREDFND_TRT" ServiceName="BCM_MASTER" HandleException="true" DirtyRead="true">
                <!-- <TRT_NBR Value="{$TRT_NBR_1/@Value}"/> -->
                <TRT_NAME Value="{$lookup_TRT_NAME_LOCAL/@Value}"/>
                <SELECT>
                  <ID/>
                  <TRT_NBR/>
                  <TRT_NAME/>
                  <PREDFND_TRT_VAL_NBR/>
                  <PREDFND_TRT_TXT/>
                  <PREDFND_TRT_TXT_LOCAL/>
                  <SYS_TARGET_ID/>
                </SELECT>
              </GET_DOC_SMART>
              <TO_DOCVAR AssignToVar="linkedPredfndTrt">
                <ROOT2/>
              </TO_DOCVAR>
              <ADD_CHILDREN DocVar="linkedPredfndTrt" FromSelectList="$GET_PREDFND_TRT/*"/>
            </ELSE>
          </IF_TEST>
          <SET Var="lookup_TRT_NBR1" FromValue="{$lookup_TRT_NBR/@Value}"/>
          <SET Var="lookup_TRT_NAME_LOCAL1" FromValue="{$lookup_TRT_NAME_LOCAL/@Value}"/>
          <FOR_EACH SelectList="$getAllRecords/DocumentAttributes" CurrentElement="currElem">
            <IF_TEST Test="$currElem/AttributeID/@Value= 'TRT_NBR'">
              <THEN>
                <SET Var="lookup_TRT_NBR" FromValue="{$currElem/AttributeValue/@Value}"/>
              </THEN>
              <ELSE>
                <IF_TEST Test="$currElem/AttributeID/@Value ='TRT_NAME'">
                  <THEN>
                    <SET Var="lookup_TRT_NAME" FromValue="{$currElem/AttributeValue/@Value}"/>
                  </THEN>
                  <ELSE>
                    <IF_TEST Test="$currElem/AttributeID/@Value ='TRT_NAME_LOCAL'">
                      <THEN>
                        <SET Var="lookup_TRT_NAME_LOCAL" FromValue="{$currElem/AttributeValue/@Value}"/>
                      </THEN>
                    </IF_TEST>
                  </ELSE>
                </IF_TEST>
              </ELSE>
            </IF_TEST>
          </FOR_EACH>
          <IF_TEST Test="$thisParam/BUTTON_ID/@Value!='VIEW' and $thisParam/PAGE_NAME/@Value!='ADMIN_UI.ApprovalInbox.Manage_Approvals.pgl'">
            <THEN>
              <IF_TEST Test="$thisParam/@Name='ApprovalInbox.CreatePredfnd_SubWF'">
                <THEN>
                  <APPEND_TO_XML DocVar="pglFormInput">
                    <lookup_TRT_NBR Value="{$lookup_TRT_NBR/@Value}"/>
                    <lookup_TRT_NAME Value="{$lookup_TRT_NAME/@Value}"/>
                    <selected_TRT_NBR Value="{$selected_TRT_NBR/@Value}"/>
                    <selected_PREDFND_TRT_NBR Value="{$selected_PREDFND_TRT_NBR/@Value}"/>
                    <TO_XML SelectList="$linkedPredfndTrt/*"/>
                    <Message Value="{$thisParam/Message/@Value}"/>
                  </APPEND_TO_XML>
                </THEN>
                <ELSE>
                  <APPEND_TO_XML DocVar="pglFormInput">
                    <lookup_TRT_NBR Value="{$lookup_TRT_NBR/@Value}"/>
                    <lookup_TRT_NAME Value="{$lookup_TRT_NAME/@Value}"/>
                    <selected_TRT_NBR Value="{$selected_TRT_NBR/@Value}"/>
                    <selected_PREDFND_TRT_NBR Value="{$selected_PREDFND_TRT_NBR/@Value}"/>
                    <TO_XML SelectList="$linkedPredfndTrt/*"/>
                    <Message Value="{$thisParam/Message/@Value}"/>
                  </APPEND_TO_XML>
                </ELSE>
              </IF_TEST>
            </THEN>
            <ELSE>
              <APPEND_TO_XML DocVar="pglFormInput">
                <!--<lookup_TRT_NBR Value="{$lookup_TRT_NBR/@Value}"/>-->
                <lookup_TRT_NAME Value="{$lookup_TRT_NAME/@Value}"/>
                <selected_TRT_NBR Value="{$selected_TRT_NBR/@Value}"/>
                <selected_PREDFND_TRT_NBR Value="{$selected_PREDFND_TRT_NBR/@Value}"/>
                <TO_XML SelectList="$linkedPredfndTrt/*"/>
              </APPEND_TO_XML>
            </ELSE>
          </IF_TEST>
          <IF_TEST Test="$thisParam/BUTTON_ID/@Value='SEL_N_RTRN' or $thisParam/BUTTON_ID/@Value='SAVE' or $thisParam/ADDITIONAL_PARAMETERS/BUTTON_ID/@Value='COMPARE_PREDFND_TRT'">
            <THEN>
              <TO_DOCVAR AssignToVar="QRYModifiedByInsert">
                <ROOT>locking row for access select * from aw_doc_attr where instanceid='{$currElem/InstanceID/@Value}' and attributeid='MODIFIED_BY'</ROOT>
              </TO_DOCVAR>
              <EXECUTE_SQL_QUERY AssignToVar="varModifiedByExists" Value="{$QRYModifiedByInsert/@text}" ReturnRowCount="yes"/>
              <IF_TEST Test="$varModifiedByExists/@TotalRowCount='0'">
                <THEN>
                  <TO_DOCVAR AssignToVar="varModifiedByUpdate">
                    <ROOT>INSERT INTO AW_DOC_ATTR (ID,ATTRIBUTEID,ATTRIBUTEVALUE,INSTANCEID) VALUES ('{$currElem/ID/@Value}_1','MODIFIED_BY','{$userId}','{$currElem/InstanceID/@Value}')</ROOT>
                  </TO_DOCVAR>
                  <EXECUTE_SQL_QUERY AssignToVar="ModifiedByUpdate" Value="{$varModifiedByUpdate/@text}" HandleException="true"/>
                </THEN>
                <ELSE>
                  <TO_DOCVAR AssignToVar="varModifiedByUpdate">
                    <ROOT>UPDATE AW_DOC_ATTR SET ATTRIBUTEVALUE='{$userId}' 
WHERE INSTANCEID='{$currElem/InstanceID/@Value}' AND ATTRIBUTEID='MODIFIED_BY';</ROOT>
                  </TO_DOCVAR>
                  <EXECUTE_SQL_QUERY AssignToVar="ModifiedByUpdate" Value="{$varModifiedByUpdate/@text}" HandleException="true"/>
                </ELSE>
              </IF_TEST>
            </THEN>
          </IF_TEST>
        </action>
      </pre_actions>
      <post_actions>
        <action>
          <IF_TEST Test="$userAction='COMPARE_PREDFND_TRT'">
            <THEN>
              <SET Var="selected_LINKED_PREDFND_TRT" FromValue="{$thisParam/selected_ID_1/@Value}"/>
              <REMOVE_CHILDREN DocVar="thisParam" ChildName="FILTER_TRT_NBR"/>
              <REMOVE_CHILDREN DocVar="thisParam" ChildName="FILTER_PREDFND_TRT_VAL_NBR"/>
              <REMOVE_CHILDREN DocVar="thisParam" ChildName="FILTER_PREDFND_TRT_TXT"/>
              <REMOVE_CHILDREN DocVar="thisParam" ChildName="FILTER_PREDFND_TRT_TXT_LOCAL"/>
            </THEN>
          </IF_TEST>
        </action>
      </post_actions>
      <if_cond Value="$userAction ='Back'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="Approval Inbox" Description=""/>
        </next_nodes>
      </if_cond>
      <else_if_cond Value="$userAction ='REJECT'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="Reject" Description=""/>
        </next_nodes>
      </else_if_cond>
      <else_if_cond Value="$userAction ='ACCEPT'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="Approve" Description=""/>
        </next_nodes>
      </else_if_cond>
      <else_if_cond Value="$userAction ='LOAD_TRT'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="LookupTrait" Description=""/>
        </next_nodes>
      </else_if_cond>
      <else_if_cond Value="$userAction ='HistoryOfRecord'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="HistoryOfRecordTRT" Description=""/>
        </next_nodes>
      </else_if_cond>
      <else_if_cond Value="$userAction ='COMPARE_PREDFND_TRT'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="CreatePredfnd_SubWF" Description=""/>
        </next_nodes>
      </else_if_cond>
      <else_if_cond Value="true()">
        <next_nodes OutputVar="{outputXml,xml}"/>
      </else_if_cond>
    </ui_form2>
    <decision Name="display_ViewRecord" Description="Decision to display view record for which table">
      <actions>
        <action/>
      </actions>
      <condition Value="$thisParam/insDocType/@Value= 'DATA_SRCE_SUBS_OPT_IN'"/>
      <if_true>
        <next_nodes>
          <next_node Name="ViewRecord" Description="true"/>
        </next_nodes>
      </if_true>
      <if_false>
        <next_nodes>
          <next_node Name="ViewRecord1" Description="false"/>
        </next_nodes>
      </if_false>
    </decision>
    <ui_form2 Name="LookupTrait" ShowInBreadCrumbs="HIDE" Template="LookupTrait.pgl" InputFormVar="pglFormInput" OutputFormVar="pglFormOutput">
      <pre_actions>
        <action>
          <TO_DOCVAR AssignToVar="pglFormInput">
            <root/>
          </TO_DOCVAR>
          <IF_TEST Test="$userAction='Search' ">
            <THEN>
              <FORM_SEARCH_FILTER Value="{$thisParam}" AssignToVar="filters">
                <TRT_NBR/>
                <TRT_ENT_TYPE_CODE/>
                <TRT_NAME/>
                <TRT_DESC/>
                <TRT_DTTP_CODE/>
                <PII_DATA_IND/>
              </FORM_SEARCH_FILTER>
              <TO_DOCVAR AssignToVar="filterList">
                <FILTERLIST/>
              </TO_DOCVAR>
              <FOR_EACH SelectList="$filters/FILTER" CurrentElement="thisFilter">
                <APPEND_TO_XML SelectList="$filterList">
                  <TO_XML SelectList="$thisFilter/*"/>
                </APPEND_TO_XML>
              </FOR_EACH>
              <GET_DOC_SMART AssignToVar="trt_detail" Name="TRT" ServiceName="BCM_MASTER" DirtyRead="true">
                <TO_XML SelectList="$filterList/*"/>
                <SELECT>
                  <TRT_NBR/>
                  <TRT_ENT_TYPE_CODE/>
                  <TRT_NAME/>
                  <TRT_DESC/>
                  <TRT_DTTP_CODE/>
                  <PII_DATA_IND/>
                </SELECT>
              </GET_DOC_SMART>
            </THEN>
            <ELSE>
              <FORM_SEARCH_FILTER Value="{$thisParam}" AssignToVar="filters">
                <FILTER_TRT_NBR/>
                <FILTER_TRT_ENT_TYPE_CODE/>
                <FILTER_TRT_NAME/>
                <FILTER_TRT_DESC/>
                <FILTER_TRT_DTTP_CODE/>
                <FILTER_PII_DATA_IND/>
              </FORM_SEARCH_FILTER>
              <FOR_EACH SelectList="$filters/*/*" CurrentElement="currentSearchColumn">
                <SET_NAME DocVar="currentSearchColumn" FromValue="{substringAfter($currentSearchColumn/name(),'FILTER_')}"/>
              </FOR_EACH>
              <TO_DOCVAR AssignToVar="filterList">
                <FILTERLIST/>
              </TO_DOCVAR>
              <FOR_EACH SelectList="$filters/FILTER" CurrentElement="thisFilter">
                <APPEND_TO_XML SelectList="$filterList">
                  <TO_XML SelectList="$thisFilter/*"/>
                </APPEND_TO_XML>
              </FOR_EACH>
              <SET Var="startRow1" FromValue="{$thisParam/START_COUNT/@Value}"/>
              <GET_DOC_SMART AssignToVar="trt_detail" Name="TRT" ServiceName="BCM_MASTER" DirtyRead="true" ReturnRowCount="yes" MaxRows="50" StartAtRow="{$startRow1}">
                <TO_XML SelectList="$filterList/*"/>
                <SELECT>
                  <TRT_NBR/>
                  <TRT_ENT_TYPE_CODE/>
                  <TRT_NAME/>
                  <TRT_DESC/>
                  <TRT_DTTP_CODE/>
                  <PII_DATA_IND/>
                </SELECT>
              </GET_DOC_SMART>
            </ELSE>
          </IF_TEST>
          <APPEND_TO_XML DocVar="pglFormInput">
            <TO_XML SelectList="$trt_detail/*"/>
            <lookup_TRT_NBR Value="{$lookup_TRT_NBR/@Value}"/>
            <lookup_TRT_NAME Value="{$lookup_TRT_NAME/@Value}"/>
            <lookup_TRT_NAME_LOCAL Value="{$lookup_TRT_NAME_LOCAL/@Value}"/>
            <lookup_LEGAL_ENT Value="{$lookup_LEGAL_ENT/@Value}"/>
            <lookup_MKTNG_PGM Value="{$lookup_MKTNG_PGM/@Value}"/>
            <RowCount Value="{$trt_detail/@TotalRowCount}"/>
          </APPEND_TO_XML>
        </action>
      </pre_actions>
      <post_actions>
        <action>
          <IF_TEST Test="$userAction='SEL_N_RTRN'">
            <THEN>
              <SET Var="selected_TRT_NBR" FromValue="{substringBefore($thisParam/selected_TRT/@Value, '#')}"/>
              <SET Var="selected_TRT_NBR" FromValue="{substringAfter($selected_TRT_NBR, '=')}"/>
              <SET Var="selected_TRT_NAME" FromValue="{substringAfter($thisParam/selected_TRT/@Value, '#')}"/>
              <SET Var="selected_TRT_NAME" FromValue="{substringAfter($selected_TRT_NAME, '=')}"/>
              <!--      <SET Var="selected_TRT_NBR" FromValue="{$thisParam/selected_TRT/@Value}"/>		-->
              <REMOVE_CHILDREN DocVar="thisParam" ChildName="FILTER_TRT_NBR"/>
              <REMOVE_CHILDREN DocVar="thisParam" ChildName="FILTER_TRT_NAME"/>
            </THEN>
          </IF_TEST>
        </action>
      </post_actions>
      <if_cond Value="$userAction ='Search'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="LookupTrait" Description=""/>
        </next_nodes>
      </if_cond>
      <else_if_cond Value="$userAction ='CREATE'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="CreateTrait" Description=""/>
        </next_nodes>
      </else_if_cond>
      <else_if_cond Value="$userAction ='SEL_N_RTRN'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="ViewRecord1" Description=""/>
        </next_nodes>
      </else_if_cond>
      <else_if_cond Value="$userAction ='BACK'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="ViewRecord1" Description=""/>
        </next_nodes>
      </else_if_cond>
      <else_if_cond Value="true()">
        <next_nodes OutputVar="{outputXml,xml}"/>
      </else_if_cond>
    </ui_form2>
    <ui_form2 Name="CreateTrait" ShowInBreadCrumbs="HIDE" Template="CreateTrait.pgl" InputFormVar="pglFormInput" OutputFormVar="pglFormOutput">
      <pre_actions>
        <action>
          <TO_DOCVAR AssignToVar="pglFormInput">
            <root/>
          </TO_DOCVAR>
          <!--<IF_TEST Test="$userAction='SAVE'">
            <THEN>
              <SET Var="TRT_NBR" FromValue="{$thisParam/TRT_NBR/@Value}"/>
              <SET Var="TRT_NAME" FromValue="{$thisParam/TRT_NAME/@Value}"/>
              <SET Var="TRT_ENT_TYPE_CODE" FromValue="{$thisParam/TRT_ENT_TYPE_CODE/@Value}"/>
              <SET Var="TRT_DESC" FromValue="{$thisParam/TRT_DESC/@Value}"/>
              <SET Var="PII_DATA_IND" FromValue="{$thisParam/PII_DATA_IND/@Value}"/>
              <SET Var="TRT_DTTP_CODE" FromValue="{$thisParam/TRT_DTTP_CODE/@Value}"/>
              <DO_DB_PERSIST Action="INSERT" DocumentName="TRT" AssignToVar="TRT_INS" ServiceName="BCM_MASTER" HandleException="true">
                <TRT_NBR Value="{$TRT_NBR/@Value}"/>
                <TRT_NAME Value="{$TRT_NAME/@Value}"/>
                <TRT_ENT_TYPE_CODE Value="{$TRT_ENT_TYPE_CODE/@Value}"/>
                <TRT_DESC Value="{$TRT_DESC/@Value}"/>
                <PII_DATA_IND Value="{$PII_DATA_IND/@Value}"/>
                <TRT_DTTP_CODE Value="{$TRT_DTTP_CODE/@Value}"/>
              </DO_DB_PERSIST>
              <IF_TEST Test="$TRT_INS/@Status='Success'">
                <THEN>
                  <SET Var="msg" FromValue="Trait record created !!!"/>
                </THEN>
                <ELSE>
                  <SET Var="msg" FromValue="{$TRT_INS/@Description}"/>
                </ELSE>
              </IF_TEST>
            </THEN>
            <ELSE>-->
          <EXECUTE_SQL_QUERY AssignToVar="maxTRT_NBR" Value="SEL MAX(TRT_NBR) + 1 AS MAX_TRT_NBR FROM TRT"/>
          <SET Var="maxIdVal" FromValue="{$maxTRT_NBR/SQL_RESULT/MAX_TRT_NBR/@Value}"/>
          <!--</ELSE>
          </IF_TEST>-->
          <APPEND_TO_XML DocVar="pglFormInput">
            <Message Value="{$msg/@Value}"/>
            <MAX_TRT_NBR Value="{$maxIdVal/@Value}"/>
            <!--<lookup_TRT_NAME_LOCAL Value="{$lookup_TRT_NAME_LOCAL/@Value}"/>
            <TRT_ENT_TYPE_CODE Value="{$thisParam/TRT_ENT_TYPE_CODE/@Value}"/>
            <TRT_DESC Value="{$thisParam/TRT_DESC/@Value}"/>
            <TRT_DTTP_CODE Value="{$thisParam/TRT_DTTP_CODE/@Value}"/>
            <PII_DATA_IND Value="{$thisParam/PII_DATA_IND/@Value}"/>-->
          </APPEND_TO_XML>
        </action>
      </pre_actions>
      <post_actions>
        <action>
          <IF_TEST Test="$userAction='SAVE'">
            <THEN>
              <SET Var="TRT_NBR" FromValue="{$thisParam/TRT_NBR/@Value}"/>
              <SET Var="TRT_NAME" FromValue="{$thisParam/TRT_NAME/@Value}"/>
              <SET Var="TRT_ENT_TYPE_CODE" FromValue="{$thisParam/TRT_ENT_TYPE_CODE/@Value}"/>
              <SET Var="TRT_DESC" FromValue="{$thisParam/TRT_DESC/@Value}"/>
              <SET Var="PII_DATA_IND" FromValue="{$thisParam/PII_DATA_IND/@Value}"/>
              <SET Var="TRT_DTTP_CODE" FromValue="{$thisParam/TRT_DTTP_CODE/@Value}"/>
              <DO_DB_PERSIST Action="INSERT" DocumentName="TRT" AssignToVar="TRT_INS" ServiceName="BCM_MASTER" HandleException="true">
                <TRT_NBR Value="{$TRT_NBR/@Value}"/>
                <TRT_NAME Value="{$TRT_NAME/@Value}"/>
                <TRT_ENT_TYPE_CODE Value="{$TRT_ENT_TYPE_CODE/@Value}"/>
                <TRT_DESC Value="{$TRT_DESC/@Value}"/>
                <PII_DATA_IND Value="{$PII_DATA_IND/@Value}"/>
                <TRT_DTTP_CODE Value="{$TRT_DTTP_CODE/@Value}"/>
              </DO_DB_PERSIST>
              <IF_TEST Test="$TRT_INS/@Status='Success'">
                <THEN>
                  <IF_TEST Test="$TRT_INS/VALIDATION_RESULT/@Value='ERROR'">
                    <THEN>
                      <SET Var="msg" FromValue="{$TRT_INS/VALIDATION_RESULT/ERROR_CODE/@Value}"/>
                      <!--<TO_DOCVAR AssignToVar="MSG">
                        <AlertGreen Value=""/>
                        <AlertRed Value="{$TRT_INS/VALIDATION_RESULT/ERROR_CODE/@Value}"/>
                      </TO_DOCVAR>-->
                    </THEN>
                    <ELSE>
                      <SET Var="msg" FromValue="Trait record created !!!"/>
                      <!--<TO_DOCVAR AssignToVar="MSG">
                        <AlertGreen Value="Trait record created !!!"/>
                        <AlertRed Value=""/>
                      </TO_DOCVAR>-->
                    </ELSE>
                  </IF_TEST>
                </THEN>
                <ELSE>
                  <SET Var="msg" FromValue="{$TRT_INS/@Description}"/>
                  <!--<TO_DOCVAR AssignToVar="MSG">
                    <AlertGreen Value=""/>
                    <AlertRed Value="{$TRT_INS/@Description}"/>
                  </TO_DOCVAR>-->
                </ELSE>
              </IF_TEST>
            </THEN>
            <!--            <ELSE>
              <EXECUTE_SQL_QUERY AssignToVar="maxTRT_NBR" Value="SEL MAX(TRT_NBR) + 1 AS MAX_TRT_NBR FROM TRT"/>
              <SET Var="maxIdVal" FromValue="{$maxTRT_NBR/SQL_RESULT/MAX_TRT_NBR/@Value}"/>
            </ELSE>-->
          </IF_TEST>
          <IF_TEST Test="$thisParam/BUTTON_ID/@Value='SAVE' and $thisParam/PAGE_NAME/@Value='ADMIN_UI.ApprovalInbox.CreateTrait.pgl'">
            <THEN>
              <REMOVE_CHILDREN ChildName="Message" DocVar="thisParam"/>
              <APPEND_TO_XML DocVar="thisParam">
                <!--<TO_XML DocVar="MSG"/>-->
                <Message Value="{$msg}"/>
                <MAX_TRT_NBR Value="{$thisParam/MAX_TRT_NBR/@Value}"/>
                <TRT_NBR Value="{$thisParam/TRT_NBR/@Value}"/>
                <lookup_TRT_NAME_LOCAL Value="{$lookup_TRT_NAME_LOCAL/@Value}"/>
                <TRT_ENT_TYPE_CODE Value="{$thisParam/TRT_ENT_TYPE_CODE/@Value}"/>
                <TRT_DESC Value="{$thisParam/TRT_DESC/@Value}"/>
                <TRT_DTTP_CODE Value="{$thisParam/TRT_DTTP_CODE/@Value}"/>
                <PII_DATA_IND Value="{$thisParam/PII_DATA_IND/@Value}"/>
                <TRT_NAME Value="{$thisParam/TRT_NAME/@Value}"/>
                <TO_XML DocVar="TRT_INS"/>
                <TO_XML DocVar="MSG"/>
              </APPEND_TO_XML>
            </THEN>
            <ELSE>
              <APPEND_TO_XML DocVar="thisParam">
                <!--<TO_XML DocVar="MSG"/>-->
                <Message Value="{$msg}"/>
                <MAX_TRT_NBR Value="{$maxIdVal/@Value}"/>
                <lookup_TRT_NAME_LOCAL Value="{$lookup_TRT_NAME_LOCAL/@Value}"/>
                <TRT_ENT_TYPE_CODE Value="{$thisParam/TRT_ENT_TYPE_CODE/@Value}"/>
                <TRT_DESC Value="{$thisParam/TRT_DESC/@Value}"/>
                <TRT_DTTP_CODE Value="{$thisParam/TRT_DTTP_CODE/@Value}"/>
                <PII_DATA_IND Value="{$thisParam/PII_DATA_IND/@Value}"/>
                <TO_XML DocVar="TRT_INS"/>
                <TO_XML DocVar="MSG"/>
              </APPEND_TO_XML>
            </ELSE>
          </IF_TEST>
          <!--          <APPEND_TO_XML DocVar="thisParam">
            <Message Value="{$msg/@Value}"/>
            <MAX_TRT_NBR Value="{$maxIdVal/@Value}"/>
            <lookup_TRT_NAME_LOCAL Value="{$lookup_TRT_NAME_LOCAL/@Value}"/>
            <TRT_ENT_TYPE_CODE Value="{$thisParam/TRT_ENT_TYPE_CODE/@Value}"/>
            <TRT_DESC Value="{$thisParam/TRT_DESC/@Value}"/>
            <TRT_DTTP_CODE Value="{$thisParam/TRT_DTTP_CODE/@Value}"/>
            <PII_DATA_IND Value="{$thisParam/PII_DATA_IND/@Value}"/>
          </APPEND_TO_XML>-->
        </action>
      </post_actions>
      <if_cond Value="$userAction ='SAVE'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="ViewRecord1" Description=""/>
        </next_nodes>
      </if_cond>
      <else_if_cond Value="$userAction ='BACK'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="LookupTrait" Description=""/>
        </next_nodes>
      </else_if_cond>
      <else_if_cond Value="true()">
        <next_nodes OutputVar="{outputXml,xml}"/>
      </else_if_cond>
    </ui_form2>
    <sub_workflow Name="CreatePredfnd_SubWF" Workflow="CreatePredfndTrtWF">
      <pre_actions>
        <action/>
      </pre_actions>
      <post_actions>
        <action/>
      </post_actions>
      <input>
        <action>
          <TO_XML SelectList="$thisParam/*"/>
          <TO_XML SelectList="$getAllRecords/*"/>
        </action>
      </input>
      <next_nodes>
        <next_node Name="ViewRecord1"/>
      </next_nodes>
    </sub_workflow>
    <ui_form2 Name="HistoryOfRecord" Description="HistoryOfRecord" ShowInBreadCrumbs="HIDE" Template="HistoryOfRecord.pgl" InputFormVar="pglFormInput" OutputFormVar="pglFormOutput">
      <pre_actions>
        <action>
          <TO_DOCVAR AssignToVar="pglFormInput">
            <ROOT/>
          </TO_DOCVAR>
          <IF_TEST Test="$userAction= 'HistoryOfRecord' ">
            <THEN>
              <TO_DOCVAR AssignToVar="thisParamBkp1">
                <TO_XML SelectList="$thisParam"/>
              </TO_DOCVAR>
              <FOR_EACH SelectList="$getAllRecords/DocumentAttributes" CurrentElement="currElem">
                <IF_TEST Test="$currElem/AttributeID/@Value= 'MKTNG_PGM_NBR'">
                  <THEN>
                    <SET Var="MKTNG_PGM_NBR_9" FromValue="{$currElem/AttributeValue/@Value}"/>
                  </THEN>
                  <ELSE>
                    <IF_TEST Test="$currElem/AttributeID/@Value ='LEGAL_ENT_NBR'">
                      <THEN>
                        <SET Var="LEGAL_ENT_NBR_9" FromValue="{$currElem/AttributeValue/@Value}"/>
                      </THEN>
                      <ELSE>
                        <IF_TEST Test="$currElem/AttributeID/@Value= 'DATA_SRCE_NBR'">
                          <THEN>
                            <SET Var="DATA_SRCE_NBR_9" FromValue="{$currElem/AttributeValue/@Value}"/>
                          </THEN>
                        </IF_TEST>
                      </ELSE>
                    </IF_TEST>
                  </ELSE>
                </IF_TEST>
              </FOR_EACH>
              <EXECUTE_SQL_QUERY Value="LOCKING ROW FOR ACCESS NONSEQUENCED  TRANSACTIONTIME SELECT MAX(SUBSCRPTN_VERSION_NBR)  FROM DATA_SRCE_SUBS_OPT WHERE SUBSCRPTN_OPT_NBR='{$thisParam/SUBSCRPTN_OPT_NBR/@Value}' and MKTNG_PGM_NBR='{$MKTNG_PGM_NBR_9/@Value}' AND DATA_SRCE_NBR='{$DATA_SRCE_NBR_9/@Value}'" AssignToVar="MaxVersion" ReturnRowCount="yes"/>
              <GET_DOC_SMART Name="DATA_SRCE_SUBS_OPT" AssignToVar="displayHistoryNum" DirtyRead="true" HandleException="true" ReturnRowCount="true" ServiceName="BCM_MASTER">
                <MKTNG_PGM_NBR Value="{$MKTNG_PGM_NBR_9/@Value}"/>
                <!--<LEGAL_ENT_NBR Value="{$LEGAL_ENT_NBR_9/@Value}"/>-->
                <DATA_SRCE_NBR Value="{$DATA_SRCE_NBR_9/@Value}"/>
                <SUBSCRPTN_OPT_NBR Value="{$thisParam/SUBSCRPTN_OPT_NBR/@Value}"/>
                <!--<SUBSCRPTN_OPT_STMT_TXT Value="{$thisParam/SUBSCRPTN_OPT_STMT_TXT/@Value}"/>-->
                <SUBSCRPTN_VERSION_NBR Value="{$MaxVersion/SQL_RESULT/SUBSCRPTN_VERSION_NBR/@Value}"/>
                <SELECT>
                  <SUBSCRPTN_OPT_NBR/>
                  <MKTNG_PGM_NBR/>
                  <LEGAL_ENT_NBR/>
                  <DATA_SRCE_NBR/>
                  <SUBSCRPTN_OPT_STMT_TXT/>
                  <SUBSCRPTN_OPT_NAME/>
                  <SUBSCRPTN_VERSION_NBR/>
                  <SUBSCRPTN_OPT_START_DATE/>
                  <SUBSCRPTN_OPT_END_DATE/>
                </SELECT>
              </GET_DOC_SMART>
              <REQUEST Name="getMatchedDomains" ServiceName="BCM_MASTER" AssignToVar="domainValues"/>
              <FOR_EACH SelectList="$domainValues/*" CurrentElement="currEle2">
                <IF_TEST Test="$LEGAL_ENT_NBR_9/@Value=$currEle2/LEGAL_ENT_NBR/@Value">
                  <THEN>
                    <SET Var="LEGAL_ENT_NBR_display" FromValue="{$currEle2/LEGAL_ENT_NAME/@Value}"/>
                  </THEN>
                </IF_TEST>
              </FOR_EACH>
              <REQUEST Name="getProgramIDs_for_Subscription" AssignToVar="programIDValues" ServiceName="BCM_MASTER">
                <LEGAL_ENT_NBR Value="{$LEGAL_ENT_NBR_9/@Value}"/>
              </REQUEST>
              <FOR_EACH SelectList="$programIDValues/MKTNG_PGM/OPTION" CurrentElement="currEle7">
                <IF_TEST Test="$currEle7/@Id=$MKTNG_PGM_NBR_9/@Value">
                  <THEN>
                    <SET Var="MKTNG_PGM_NBR_display" FromValue="{$currEle7/@Value}"/>
                  </THEN>
                </IF_TEST>
              </FOR_EACH>
              <REQUEST Name="getDataSourceNamesAndNbr" ServiceName="BCM_MASTER" AssignToVar="SourceValues">
                <MKTNG_PGM_NBR Value="{$MKTNG_PGM_NBR_9/@Value}"/>
              </REQUEST>
              <FOR_EACH SelectList="$SourceValues/DATA_SRCE/*" CurrentElement="currEle2">
                <IF_TEST Test="$DATA_SRCE_NBR_9/@Value=$currEle2/@Id">
                  <THEN>
                    <SET Var="DATA_SRCE_NBR_display" FromValue="{$currEle2/@Value}"/>
                  </THEN>
                </IF_TEST>
              </FOR_EACH>
              <TO_DOCVAR AssignToVar="displayDetails">
                <DETAILS>
                  <SUBSCRPTN_OPT_NBR Value="{$thisParam/SUBSCRPTN_OPT_NBR/@Value}"/>
                  <LEGAL_ENT_NBR Value="{$LEGAL_ENT_NBR_display/@Value}"/>
                  <MKTNG_PGM_NBR Value="{$MKTNG_PGM_NBR_display/@Value}"/>
                  <DATA_SRCE_NBR Value="{$DATA_SRCE_NBR_display/@Value}"/>
                  <SUBSCRPTN_OPT_STMT_TXT Value="{$thisParam/SUBSCRPTN_OPT_STMT_TXT/@Value}"/>
                  <SUBSCRPTN_OPT_NAME Value="{$displayHistoryNum/DATA_SRCE_SUBS_OPT/SUBSCRPTN_OPT_NAME/@Value}"/>
                  <SUBSCRPTN_VERSION_NBR Value="{$displayHistoryNum/DATA_SRCE_SUBS_OPT/SUBSCRPTN_VERSION_NBR/@Value}"/>
                  <SUBSCRPTN_OPT_START_DATE Value="{$displayHistoryNum/DATA_SRCE_SUBS_OPT/SUBSCRPTN_OPT_START_DATE/@Value}"/>
                  <SUBSCRPTN_OPT_END_DATE Value="{$displayHistoryNum/DATA_SRCE_SUBS_OPT/SUBSCRPTN_OPT_END_DATE/@Value}"/>
                </DETAILS>
              </TO_DOCVAR>
              <ADD_CHILDREN DocVar="pglFormInput" FromSelect="$displayDetails"/>
            </THEN>
          </IF_TEST>
        </action>
      </pre_actions>
      <post_actions>
        <action/>
      </post_actions>
      <if_cond Value="$userAction ='Back'">
        <next_nodes OutputVar="{outputXml,xml}"/>
      </if_cond>
      <else_if_cond Value="$userAction ='Back1'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="ViewRecord" Description=""/>
        </next_nodes>
      </else_if_cond>
      <else_if_cond Value="true()">
        <next_nodes OutputVar="{outputXml,xml}"/>
      </else_if_cond>
    </ui_form2>
    <ui_form2 Name="HistoryOfRecordTRT" ShowInBreadCrumbs="HIDE" Template="HistoryOfRecordTRT.pgl" InputFormVar="pglFormInput" OutputFormVar="pglFormOutput">
      <pre_actions>
        <action>
          <SET Var="LOC_TRT_NBR" FromValue="{$selected_TRT_NBR/@Value}"/>
          <EXECUTE_SQL_QUERY AssignToVar="TRT_HIST" Value="nonsequenced transactiontime sel * from TRT where TRT_NBR = {$LOC_TRT_NBR/@Value} order by 18 desc"/>
          <TO_DOCVAR AssignToVar="pglFormInput">
            <root/>
          </TO_DOCVAR>
          <APPEND_TO_XML DocVar="pglFormInput">
            <TO_XML SelectList="$TRT_HIST/*"/>
          </APPEND_TO_XML>
        </action>
      </pre_actions>
      <post_actions>
        <action/>
      </post_actions>
      <if_cond Value="$userAction ='Back1'">
        <next_nodes OutputVar="{outputXml,xml}">
          <next_node Name="ViewRecord1" Description=""/>
        </next_nodes>
      </if_cond>
      <else_if_cond Value="true()">
        <next_nodes OutputVar="{outputXml,xml}"/>
      </else_if_cond>
    </ui_form2>
  </nodes>
  <mgcview>
    <mgcgroups>
      <group rect="303,204,644,241" groupFillColor="192,192,192"/>
    </mgcgroups>
    <mgcdashboard location="-6,13" compId="MgcDashboard1" font="Verdana,0,9" componentConnect="false" componentIconBorder="false" componentTextColor="0,0,0" componentBorderColor="255,255,255" freeze="false" visible="true" fade="false" fadeConnectors="false" shapeKey="UML" snapPointKey="MID" leadingEdge="5" trailingEdge="5" topGap="3" bottomGap="2" textAttrsSize="0">
      <textProps text="Pipeline" font="Verdana,0,9"/>
      <iconProps iconfile="defaultNode.gif"/>
      <variables/>
    </mgcdashboard>
    <mgcnodes>
      <start2 font="Verdana,0,9" componentConnect="true" componentIconBorder="false" componentTextColor="80,80,80" componentBorderColor="255,255,255" freeze="false" visible="true" fade="false" fadeConnectors="false" shapeKey="ICONISH" snapPointKey="MID" leadingEdge="5" trailingEdge="5" topGap="3" bottomGap="2" location="312,249">
        <iconProps iconfile="z1start.gif" location="0,0"/>
        <textProps text="start2" font="Verdana,0,9" textColor="80,80,80"/>
      </start2>
      <mgcnode Name="Approval Inbox" font="Verdana,0,9" componentConnect="true" componentIconBorder="false" componentTextColor="80,80,80" componentBorderColor="255,255,255" freeze="false" visible="true" fade="false" fadeConnectors="false" shapeKey="ICONISH" snapPointKey="MID" leadingEdge="5" trailingEdge="5" topGap="3" bottomGap="2" location="487,249" size="1364,684">
        <iconProps iconfile="x1age80.gif" location="0,0"/>
        <textProps text="Approval Inbox" font="Verdana,0,9" textColor="80,80,80"/>
      </mgcnode>
      <Stop font="Verdana,0,9" componentConnect="false" componentIconBorder="false" componentTextColor="80,80,80" componentBorderColor="255,255,255" freeze="false" visible="true" fade="false" fadeConnectors="false" shapeKey="ICONISH" snapPointKey="MID" leadingEdge="5" trailingEdge="5" topGap="3" bottomGap="2" location="520,352" size="732,534">
        <iconProps iconfile="z1end.gif" location="0,0"/>
        <textProps text="Stop" font="Verdana,0,9" textColor="80,80,80"/>
      </Stop>
      <Approve font="Verdana,0,9" componentConnect="true" componentIconBorder="false" componentTextColor="80,80,80" componentBorderColor="255,255,255" freeze="false" visible="true" fade="false" fadeConnectors="false" shapeKey="ICONISH" snapPointKey="MID" leadingEdge="5" trailingEdge="5" topGap="3" bottomGap="2" location="690,309" size="1372,692">
        <iconProps iconfile="z1task.gif" location="0,0"/>
        <textProps text="Approve" font="Verdana,0,9" textColor="80,80,80"/>
      </Approve>
      <mgcnode Name="Does next approver exist ?" font="Verdana,0,9" componentConnect="true" componentIconBorder="false" componentTextColor="80,80,80" componentBorderColor="255,255,255" freeze="false" visible="true" fade="false" fadeConnectors="false" shapeKey="ICONISH" snapPointKey="MID" leadingEdge="5" trailingEdge="5" topGap="3" bottomGap="2" location="620,353">
        <iconProps iconfile="z1decision.gif" location="0,0"/>
        <textProps text="Does next approver exist ?" font="Verdana,0,9" textColor="186,12,12"/>
      </mgcnode>
      <Copy_of_Stop font="Verdana,0,9" componentConnect="false" componentIconBorder="false" componentTextColor="80,80,80" componentBorderColor="255,255,255" freeze="false" visible="true" fade="false" fadeConnectors="false" shapeKey="ICONISH" snapPointKey="MID" leadingEdge="5" trailingEdge="5" topGap="3" bottomGap="2" location="886,383" size="732,534">
        <iconProps iconfile="z1end.gif" location="0,0"/>
        <textProps text="Copy_of_Stop" font="Verdana,0,9" textColor="80,80,80"/>
      </Copy_of_Stop>
      <Reject font="Verdana,0,9" componentConnect="true" componentIconBorder="false" componentTextColor="80,80,80" componentBorderColor="255,255,255" freeze="false" visible="true" fade="false" fadeConnectors="false" shapeKey="ICONISH" snapPointKey="MID" leadingEdge="5" trailingEdge="5" topGap="3" bottomGap="2" location="393,385" size="1600,818">
        <iconProps iconfile="z1task.gif" location="0,0"/>
        <textProps text="Reject" font="Verdana,0,9" textColor="80,80,80"/>
      </Reject>
      <mgcnode Name="Dectsion on Notification" font="Times New Roman,0,9" componentConnect="true" componentIconBorder="false" componentTextColor="80,80,80" componentBorderColor="255,255,255" freeze="false" visible="true" fade="false" fadeConnectors="false" shapeKey="ICONISH" snapPointKey="REGULAR" leadingEdge="5" trailingEdge="5" topGap="3" bottomGap="2" location="731,386">
        <iconProps iconfile="z1decision.gif"/>
      </mgcnode>
      <ViewRecord font="Times New Roman,0,9" componentConnect="true" componentIconBorder="false" componentTextColor="80,80,80" componentBorderColor="255,255,255" freeze="false" visible="true" fade="false" fadeConnectors="false" shapeKey="ICONISH" snapPointKey="REGULAR" leadingEdge="5" trailingEdge="5" topGap="3" bottomGap="2" location="707,131" size="1364,684">
        <iconProps iconfile="x1age80.gif"/>
      </ViewRecord>
      <SUBSCRPTN_OPT_Lookup font="Times New Roman,0,9" componentConnect="true" componentIconBorder="false" componentTextColor="80,80,80" componentBorderColor="255,255,255" freeze="false" visible="true" fade="false" fadeConnectors="false" shapeKey="ICONISH" snapPointKey="REGULAR" leadingEdge="5" trailingEdge="5" topGap="3" bottomGap="2" location="1146,28" size="1364,684">
        <iconProps iconfile="x1age80.gif"/>
      </SUBSCRPTN_OPT_Lookup>
      <SUBSCRPTN_OPTandOPT_TypeCreate font="Times New Roman,0,9" componentConnect="true" componentIconBorder="false" componentTextColor="80,80,80" componentBorderColor="255,255,255" freeze="false" visible="true" fade="false" fadeConnectors="false" shapeKey="ICONISH" snapPointKey="REGULAR" leadingEdge="5" trailingEdge="5" topGap="3" bottomGap="2" location="1109,285" size="1364,684">
        <iconProps iconfile="x1age80.gif"/>
      </SUBSCRPTN_OPTandOPT_TypeCreate>
      <ViewRecord1 font="Times New Roman,0,9" componentConnect="true" componentIconBorder="false" componentTextColor="80,80,80" componentBorderColor="255,255,255" freeze="false" visible="true" fade="false" fadeConnectors="false" shapeKey="ICONISH" snapPointKey="REGULAR" leadingEdge="5" trailingEdge="5" topGap="3" bottomGap="2" location="189,3" size="1364,684">
        <iconProps iconfile="x1age80.gif"/>
      </ViewRecord1>
      <display_ViewRecord font="Times New Roman,0,9" componentConnect="true" componentIconBorder="false" componentTextColor="80,80,80" componentBorderColor="255,255,255" freeze="false" visible="true" fade="false" fadeConnectors="false" shapeKey="ICONISH" snapPointKey="REGULAR" leadingEdge="5" trailingEdge="5" topGap="3" bottomGap="2" location="532,115" size="732,600">
        <iconProps iconfile="z1decision.gif"/>
      </display_ViewRecord>
      <LookupTrait font="Times New Roman,0,9" componentConnect="true" componentIconBorder="false" componentTextColor="80,80,80" componentBorderColor="255,255,255" freeze="false" visible="true" fade="false" fadeConnectors="false" shapeKey="ICONISH" snapPointKey="REGULAR" leadingEdge="5" trailingEdge="5" topGap="3" bottomGap="2" location="165,390" size="1364,684">
        <iconProps iconfile="x1age80.gif"/>
      </LookupTrait>
      <CreateTrait font="Times New Roman,0,9" componentConnect="true" componentIconBorder="false" componentTextColor="80,80,80" componentBorderColor="255,255,255" freeze="false" visible="true" fade="false" fadeConnectors="false" shapeKey="ICONISH" snapPointKey="REGULAR" leadingEdge="5" trailingEdge="5" topGap="3" bottomGap="2" location="156,544" size="1364,684">
        <iconProps iconfile="x1age80.gif"/>
      </CreateTrait>
      <CreatePredfnd_SubWF font="Times New Roman,0,9" componentConnect="true" componentIconBorder="false" componentTextColor="80,80,80" componentBorderColor="255,255,255" freeze="false" visible="true" fade="false" fadeConnectors="false" shapeKey="ICONISH" snapPointKey="REGULAR" leadingEdge="5" trailingEdge="5" topGap="3" bottomGap="2" location="456,467" size="732,628">
        <iconProps iconfile="z1sub_workflow.gif"/>
      </CreatePredfnd_SubWF>
      <HistoryOfRecord font="Times New Roman,0,9" componentConnect="true" componentIconBorder="false" componentTextColor="80,80,80" componentBorderColor="255,255,255" freeze="false" visible="true" fade="false" fadeConnectors="false" shapeKey="ICONISH" snapPointKey="REGULAR" leadingEdge="5" trailingEdge="5" topGap="3" bottomGap="2" location="960,18" size="1364,684">
        <iconProps iconfile="x1age80.gif"/>
      </HistoryOfRecord>
      <HistoryOfRecordTRT font="Times New Roman,0,9" componentConnect="true" componentIconBorder="false" componentTextColor="80,80,80" componentBorderColor="255,255,255" freeze="false" visible="true" fade="false" fadeConnectors="false" shapeKey="ICONISH" snapPointKey="REGULAR" leadingEdge="5" trailingEdge="5" topGap="3" bottomGap="2" location="404,534" size="1364,724">
        <iconProps iconfile="x1age80.gif"/>
      </HistoryOfRecordTRT>
    </mgcnodes>
    <mgcconnectors>
      <start2>
        <nextNodeView wavyConnector="true" connectorTextColor="80,80,80" connectorColor="70,81,173" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" font="Verdana,0,9" connectorStroke="1.0,2,0,10.0,null,0.0" fade="false" allowedToSelectConnector="true" startpoint="312,271" endpoint="487,271" ctrlRect1Dirty="true" ctrlRect2Dirty="true" textRectDirty="false" ctrlRect1="249,187,4,4" ctrlRect2="243,196,4,4">
          <textProps/>
        </nextNodeView>
      </start2>
      <mgcnode Name="Approval Inbox">
        <nextNodeView wavyConnector="true" connectorTextColor="80,80,80" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" font="Verdana,0,9" connectorStroke="1.0,2,0,10.0,null,0.0" fade="false" allowedToSelectConnector="true" startpoint="532,271" endpoint="542,352" ctrlRect1Dirty="false" ctrlRect2Dirty="false" textRectDirty="false" ctrlRect1="537,269,4,4" ctrlRect2="540,289,4,4"/>
        <nextNodeView wavyConnector="true" connectorTextColor="80,80,80" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" font="Verdana,0,9" connectorStroke="1.0,2,0,10.0,null,0.0" fade="false" allowedToSelectConnector="true" startpoint="487,271" endpoint="415,385" ctrlRect1Dirty="false" ctrlRect2Dirty="false" textRectDirty="false" ctrlRect1="431,269,4,4" ctrlRect2="413,297,4,4"/>
        <nextNodeView wavyConnector="true" connectorTextColor="80,80,80" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" font="Verdana,0,9" connectorStroke="1.0,2,0,10.0,null,0.0" fade="false" allowedToSelectConnector="true" startpoint="487,271" endpoint="690,331" ctrlRect1Dirty="true" ctrlRect2Dirty="false" textRectDirty="false" ctrlRect1="343,242,4,4" ctrlRect2="535,329,4,4"/>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="509,249" endpoint="532,137" ctrlRect1="507,163,4,4" ctrlRect2="292,95,4,4" ctrlRect2Dirty="true" textRect="396,127,11,8">
          <textProps text="$userAction ='VIEW'"/>
        </nextNodeView>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="509,249" endpoint="509,249" ctrlRect1="507,172,4,4" ctrlRect2="507,172,4,4"/>
      </mgcnode>
      <Approve>
        <nextNodeView wavyConnector="true" connectorTextColor="80,80,80" connectorColor="70,81,173" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" font="Verdana,0,9" connectorStroke="1.0,2,0,10.0,null,0.0" fade="false" allowedToSelectConnector="true" startpoint="690,331" endpoint="665,375" ctrlRect1Dirty="false" ctrlRect2Dirty="false" textRectDirty="false" ctrlRect1="670,329,4,4" ctrlRect2="682,373,4,4"/>
      </Approve>
      <mgcnode Name="Does next approver exist ?">
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,0" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="620,375" endpoint="731,408" ctrlRect1="510,296,4,4" ctrlRect2="645,406,4,4" ctrlRect1Dirty="true">
          <textProps/>
        </nextNodeView>
        <nextNodeView wavyConnector="true" connectorTextColor="80,80,80" connectorColor="178,0,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" font="Verdana,0,9" connectorStroke="1.0,2,0,10.0,null,0.0" fade="false" allowedToSelectConnector="true" startpoint="620,375" endpoint="520,374" ctrlRect1Dirty="false" ctrlRect2Dirty="true" textRectDirty="false" ctrlRect1="543,373,4,4" ctrlRect2="346,268,4,4">
          <textProps/>
        </nextNodeView>
      </mgcnode>
      <Reject>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="393,407" endpoint="731,408" ctrlRect1="207,330,4,4" ctrlRect2="475,406,4,4" ctrlRect1Dirty="true"/>
      </Reject>
      <mgcnode Name="Dectsion on Notification">
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="178,0,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="776,408" endpoint="886,405" ctrlRect1="856,406,4,4" ctrlRect2="801,403,4,4"/>
      </mgcnode>
      <ViewRecord>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="707,153" endpoint="532,271" ctrlRect1="421,131,4,4" ctrlRect2="547,279,4,4" ctrlRect1Dirty="true" ctrlRect2Dirty="true">
          <textProps/>
        </nextNodeView>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="707,153" endpoint="415,385" ctrlRect1="486,151,4,4" ctrlRect2="418,202,4,4" textRect="309,204,26,8" ctrlRect2Dirty="true">
          <textProps/>
        </nextNodeView>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="729,176" endpoint="690,331" ctrlRect1="727,289,4,4" ctrlRect2="480,165,4,4" ctrlRect2Dirty="true">
          <textProps/>
        </nextNodeView>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="729,131" endpoint="1146,50" ctrlRect1="733,126,4,4" ctrlRect2="839,153,4,4" ctrlRect1Dirty="true" ctrlRect2Dirty="true" textRect="776,137,25,8">
          <textProps text="$userAction = 'select_SUBSCRPTN_OPT'"/>
        </nextNodeView>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="707,153" endpoint="707,153" ctrlRect1="630,151,4,4" ctrlRect2="582,221,4,4" ctrlRect2Dirty="true" textRect="591,184,35,8">
          <textProps text="$userAction ='HistoryOfRecord'"/>
        </nextNodeView>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="752,153" endpoint="960,40" ctrlRect1="906,151,4,4" ctrlRect2="802,38,4,4" textRect="839,92,35,8">
          <textProps text="$userAction ='HistoryOfRecord'"/>
        </nextNodeView>
      </ViewRecord>
      <SUBSCRPTN_OPT_Lookup>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="1146,50" endpoint="707,153" ctrlRect1="741,305,4,4" ctrlRect2="609,124,4,4" ctrlRect2Dirty="true" textRect="659,212,37,8" ctrlRect1Dirty="true">
          <textProps text="$userAction ='cancel'"/>
        </nextNodeView>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="1146,50" endpoint="707,153" ctrlRect1="1115,70,4,4" ctrlRect2="588,120,4,4" ctrlRect1Dirty="true" textRect="842,93,23,8" ctrlRect2Dirty="true">
          <textProps text="$userAction ='Add'"/>
        </nextNodeView>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="1146,50" endpoint="1109,307" ctrlRect1="878,230,4,4" ctrlRect2="737,184,4,4" ctrlRect1Dirty="true" textRect="798,205,23,8" ctrlRect2Dirty="true">
          <textProps text="$userAction ='Add'"/>
        </nextNodeView>
      </SUBSCRPTN_OPT_Lookup>
      <SUBSCRPTN_OPTandOPT_TypeCreate>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="1109,307" endpoint="752,153" ctrlRect1="1001,427,4,4" ctrlRect2="1018,151,4,4" textRect="999,287,24,8" ctrlRect1Dirty="true">
          <textProps text="$userAction ='Back'"/>
        </nextNodeView>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="1109,307" endpoint="1109,307" ctrlRect1="1280,196,4,4" ctrlRect2="966,173,4,4" ctrlRect1Dirty="true" textRect="1112,182,26,8" ctrlRect2Dirty="true">
          <textProps text="$userAction ='Create'"/>
        </nextNodeView>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="1109,307" endpoint="1109,307" ctrlRect1="647,368,4,4" ctrlRect2="791,469,4,4" ctrlRect2Dirty="true" textRect="708,416,26,8" ctrlRect1Dirty="true">
          <textProps text="$userAction ='CreateOptType'"/>
        </nextNodeView>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="1109,307" endpoint="1109,307" ctrlRect1="842,333,4,4" ctrlRect2="812,351,4,4" ctrlRect2Dirty="true" ctrlRect1Dirty="true" textRect="816,340,26,8">
          <textProps text="$userAction ='Submit'"/>
        </nextNodeView>
      </SUBSCRPTN_OPTandOPT_TypeCreate>
      <ViewRecord1>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="234,25" endpoint="487,271" ctrlRect1="421,23,4,4" ctrlRect2="295,269,4,4"/>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="211,48" endpoint="415,385" ctrlRect1="209,298,4,4" ctrlRect2="413,130,4,4"/>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="234,25" endpoint="690,331" ctrlRect1="574,23,4,4" ctrlRect2="346,329,4,4"/>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="211,48" endpoint="187,390" ctrlRect1="209,302,4,4" ctrlRect2="226,371,4,4" ctrlRect2Dirty="true">
          <textProps/>
        </nextNodeView>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="211,48" endpoint="426,534" ctrlRect1="209,410,4,4" ctrlRect2="424,167,4,4">
          <textProps/>
        </nextNodeView>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="211,48" endpoint="478,467" ctrlRect1="209,359,4,4" ctrlRect2="476,150,4,4" textRect="325,252,39,8">
          <textProps text="$userAction ='COMPARE_PREDFND_TRT'"/>
        </nextNodeView>
      </ViewRecord1>
      <display_ViewRecord>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,0" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="577,137" endpoint="707,153" ctrlRect1="652,112,4,4" ctrlRect2="494,136,4,4" textRect="571,122,9,8" ctrlRect2Dirty="true" ctrlRect1Dirty="true">
          <textProps text="true"/>
        </nextNodeView>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="178,0,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="532,137" endpoint="234,25" ctrlRect1="307,135,4,4" ctrlRect2="381,21,4,4" textRect="342,76,9,8" ctrlRect2Dirty="true">
          <textProps text="false"/>
        </nextNodeView>
      </display_ViewRecord>
      <LookupTrait>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="210,412" endpoint="210,412" ctrlRect1="283,410,4,4" ctrlRect2="283,410,4,4" textRect="272,408,26,8">
          <textProps text="$userAction ='Search'"/>
        </nextNodeView>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="165,412" endpoint="178,544" ctrlRect1="-99,410,4,4" ctrlRect2="176,443,4,4" ctrlRect1Dirty="true" textRect="27,424,26,8">
          <textProps text="$userAction ='CREATE'"/>
        </nextNodeView>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="187,390" endpoint="211,48" ctrlRect1="185,132,4,4" ctrlRect2="157,105,4,4" textRect="158,116,30,8" ctrlRect2Dirty="true">
          <textProps text="$userAction ='SEL_N_RTRN'"/>
        </nextNodeView>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="187,390" endpoint="211,48" ctrlRect1="209,304,4,4" ctrlRect2="270,126,4,4" ctrlRect2Dirty="true" textRect="229,213,24,8" ctrlRect1Dirty="true">
          <textProps text="$userAction ='BACK'"/>
        </nextNodeView>
      </LookupTrait>
      <CreateTrait>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="178,544" endpoint="211,48" ctrlRect1="176,170,4,4" ctrlRect2="187,173,4,4" textRect="171,169,24,8" ctrlRect2Dirty="true">
          <textProps text="$userAction ='SAVE'"/>
        </nextNodeView>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="178,544" endpoint="187,435" ctrlRect1="176,461,4,4" ctrlRect2="652,333,4,4" ctrlRect2Dirty="true" textRect="404,395,24,8">
          <textProps text="$userAction ='BACK'"/>
        </nextNodeView>
      </CreateTrait>
      <CreatePredfnd_SubWF>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="478,467" endpoint="211,48" ctrlRect1="476,152,4,4" ctrlRect2="276,250,4,4" ctrlRect2Dirty="true"/>
      </CreatePredfnd_SubWF>
      <HistoryOfRecord>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="960,40" endpoint="729,131" ctrlRect1="924,38,4,4" ctrlRect2="716,50,4,4" textRect="810,42,24,8" ctrlRect1Dirty="true" ctrlRect2Dirty="true">
          <textProps text="$userAction ='Back1'"/>
        </nextNodeView>
      </HistoryOfRecord>
      <HistoryOfRecordTRT>
        <nextNodeView wavyConnector="true" connectorTextColor="0,0,0" connectorColor="0,178,178" connStartPointFill="false" connEndPointFill="true" connStartPointOval="true" draggable="true" startpoint="426,534" endpoint="211,48" ctrlRect1="424,168,4,4" ctrlRect2="255,86,4,4" ctrlRect2Dirty="true">
          <textProps/>
        </nextNodeView>
      </HistoryOfRecordTRT>
    </mgcconnectors>
    <mgctexts>
      <text location="437,0" componentTextColor="0,153,153" font="Arial,1,18" textAttrsKey0="Manage Approval UI "/>
      <text location="435,32" componentTextColor="153,153,153" font="Arial,0,9" textAttrsKey0="This task for Approval Inbox, based on the approval " textAttrsKey1="and you can approve or rejects records. Each Approval , " textAttrsKey2="it is activate the serial approval node. "/>
    </mgctexts>
  </mgcview>
  <shutdown_handler>
    <pre_actions>
      <action/>
    </pre_actions>
    <post_actions>
      <action/>
    </post_actions>
    <checkcondition Value=""/>
  </shutdown_handler>
</workflow>